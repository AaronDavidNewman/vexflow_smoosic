/*!
 * VexFlow 3.0.9   2021-08-03T01:20:01.126Z   6c373fc6e0e699bb6ac90e05e11c9dce6364c1b7
 * Copyright (c) 2010 Mohit Muthanna Cheppudira <mohit@muthanna.com>
 * http://www.vexflow.com   http://github.com/0xfe/vexflow
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Vex=e():t.Vex=e()}(this,(function(){return(()=>{"use strict";var t,e,i={763:(t,e,i)=>{i.d(e,{s:()=>ii});
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)};function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var r=function(){return(r=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function a(t,e,i,n){return new(i||(i=Promise))((function(o,r){function a(t){try{h(n.next(t))}catch(t){r(t)}}function s(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,s)}h((n=n.apply(t,e||[])).next())}))}function s(t,e){var i,n,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(o=2&r[0]?n.return:r[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,r[1])).done)return o;switch(n=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,n=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(t){r=[6,t],n=0}finally{i=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}}Object.create;Object.create;var h=function(t){function e(e,i){var n=t.call(this,"[RuntimeError] "+e+":"+i)||this;return n.code=e,n}return o(e,t),e}(Error);function c(t){if(void 0===t)throw new h("undefined");return t}function d(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(e){var n=Array.prototype.slice.call(e).join(" ");window.console.log(t+": "+n)}}function l(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t.join(" "),n=new Error;window.console.log("Warning: ",i,n.stack)}function p(t,e){var i,n,o=e+(t-e)/2;return o%2>0&&(o=((i=10*o)%(n=5)>=n/2?parseInt(""+i/n,10)*n+n:parseInt(""+i/n,10)*n)/10),o}function u(t){return"vf-"+t}var f=function(){function t(t,e){this.numerator=1,this.denominator=1,this.set(t,e)}return t.GCD=function(t,e){if("number"!=typeof t||Number.isNaN(t)||0===t||"number"!=typeof e||Number.isNaN(e)||0===e)throw new h("BadArgument","Invalid numbers: "+t+", "+e);for(var i;0!==e;)i=e,e=t%e,t=i;return t},t.LCM=function(e,i){return e*i/t.GCD(e,i)},t.LCMM=function(e){if(0===e.length)return 0;if(1===e.length)return e[0];if(2===e.length)return t.LCM(e[0],e[1]);var i=e[0];return e.shift(),t.LCM(i,t.LCMM(e))},t.prototype.set=function(t,e){return void 0===t&&(t=1),void 0===e&&(e=1),this.numerator=t,this.denominator=e,this},t.prototype.value=function(){return this.numerator/this.denominator},t.prototype.simplify=function(){var e=this.numerator,i=this.denominator,n=t.GCD(e,i);return e/=n,(i/=n)<0&&(i=-i,e=-e),this.set(e,i)},t.prototype.add=function(e,i){var n,o;void 0===e&&(e=0),void 0===i&&(i=1),e instanceof t?(n=e.numerator,o=e.denominator):(n=e,o=i);var r=t.LCM(this.denominator,o),a=r/this.denominator,s=r/o,h=this.numerator*a+n*s;return this.set(h,r)},t.prototype.subtract=function(e,i){var n,o;void 0===e&&(e=0),void 0===i&&(i=1),e instanceof t?(n=e.numerator,o=e.denominator):(n=e,o=i);var r=t.LCM(this.denominator,o),a=r/this.denominator,s=r/o,h=this.numerator*a-n*s;return this.set(h,r)},t.prototype.multiply=function(e,i){var n,o;return void 0===e&&(e=1),void 0===i&&(i=1),e instanceof t?(n=e.numerator,o=e.denominator):(n=e,o=i),this.set(this.numerator*n,this.denominator*o)},t.prototype.divide=function(e,i){var n,o;return void 0===e&&(e=1),void 0===i&&(i=1),e instanceof t?(n=e.numerator,o=e.denominator):(n=e,o=i),this.set(this.numerator*o,this.denominator*n)},t.prototype.equals=function(e){var i=t.__staticFractionA.copy(e).simplify(),n=t.__staticFractionB.copy(this).simplify();return i.numerator===n.numerator&&i.denominator===n.denominator},t.prototype.greaterThan=function(e){var i=t.__staticFractionB.copy(this);return i.subtract(e),i.numerator>0},t.prototype.greaterThanEquals=function(e){var i=t.__staticFractionB.copy(this);return i.subtract(e),i.numerator>=0},t.prototype.lessThan=function(t){return!this.greaterThanEquals(t)},t.prototype.lessThanEquals=function(t){return!this.greaterThan(t)},t.prototype.clone=function(){return new t(this.numerator,this.denominator)},t.prototype.copy=function(t){return"number"==typeof t?this.set(t||0,1):this.set(t.numerator,t.denominator)},t.prototype.quotient=function(){return Math.floor(this.numerator/this.denominator)},t.prototype.remainder=function(){return this.numerator%this.denominator},t.prototype.makeAbs=function(){return this.denominator=Math.abs(this.denominator),this.numerator=Math.abs(this.numerator),this},t.prototype.toString=function(){return this.numerator+"/"+this.denominator},t.prototype.toSimplifiedString=function(){return t.__staticFractionTmp.copy(this).simplify().toString()},t.prototype.toMixedString=function(){var e="",i=this.quotient(),n=t.__staticFractionTmp.copy(this);return i<0&&n.makeAbs(),0!==i?(e+=i,0!==n.numerator&&(e+=" "+n.toSimplifiedString())):e=0===n.numerator?"0":n.toSimplifiedString(),e},t.prototype.parse=function(t){var e=t.split("/"),i=parseInt(e[0],10),n=e[1]?parseInt(e[1],10):1;return this.set(i,n)},t.__staticFractionA=new t,t.__staticFractionB=new t,t.__staticFractionTmp=new t,t}(),g=function(){this.id={},this.type={},this.class={}},m=function(){function t(){this.index=new g}return t.getDefaultRegistry=function(){return t.defaultRegistry},t.enableDefaultRegistry=function(e){t.defaultRegistry=e},t.disableDefaultRegistry=function(){t.defaultRegistry=void 0},t.prototype.clear=function(){return this.index=new g,this},t.prototype.setIndexValue=function(t,e,i,n){var o=this.index;o[t][e]||(o[t][e]={}),o[t][e][i]=n},t.prototype.updateIndex=function(t){var e=t.id,i=t.name,n=t.value,o=t.oldValue,r=this.getElementById(e);void 0!==o&&this.index[i][o]&&delete this.index[i][o][e],n&&r&&this.setIndexValue(i,n,r.getAttribute("id"),r)},t.prototype.register=function(t,e){if(!(e=e||t.getAttribute("id")))throw new h("Can't add element without `id` attribute to registry");return t.setAttribute("id",e),this.setIndexValue("id",e,e,t),this.updateIndex({id:e,name:"type",value:t.getAttribute("type"),oldValue:void 0}),t.onRegister(this),this},t.prototype.getElementById=function(t){var e,i;return null===(i=null===(e=this.index.id)||void 0===e?void 0:e[t])||void 0===i?void 0:i[t]},t.prototype.getElementsByAttribute=function(t,e){var i=this.index[t];if(i){var n=i[e];if(n)return Object.keys(n).map((function(t){return n[t]}))}return[]},t.prototype.getElementsByType=function(t){return this.getElementsByAttribute("type",t)},t.prototype.getElementsByClass=function(t){return this.getElementsByAttribute("class",t)},t.prototype.onUpdate=function(t){return["id","type","class"].includes(t.name)&&this.updateIndex(t),this},t}(),y=function(){function t(e){var i,n=(void 0===e?{}:e).type;this.attrs={id:t.newID(),el:void 0,type:n||"Base",classes:{}},this.rendered=!1,this.fontStack=ei.DEFAULT_FONT_STACK,this.musicFont=ei.DEFAULT_FONT_STACK[0],null===(i=m.getDefaultRegistry())||void 0===i||i.register(this)}return t.newID=function(){return"auto"+t.ID++},t.prototype.setFontStack=function(t){return this.fontStack=t,this.musicFont=t[0],this},t.prototype.getFontStack=function(){return this.fontStack},t.prototype.setStyle=function(t){return this.style=t,this},t.prototype.getStyle=function(){return this.style},t.prototype.applyStyle=function(t,e){return void 0===t&&(t=this.context),void 0===e&&(e=this.getStyle()),e&&t?(t.save(),e.shadowColor&&t.setShadowColor(e.shadowColor),e.shadowBlur&&t.setShadowBlur(e.shadowBlur),e.fillStyle&&t.setFillStyle(e.fillStyle),e.strokeStyle&&t.setStrokeStyle(e.strokeStyle),e.lineWidth&&t.setLineWidth(e.lineWidth),this):this},t.prototype.restoreStyle=function(t,e){return void 0===t&&(t=this.context),void 0===e&&(e=this.getStyle()),e&&t?(t.restore(),this):this},t.prototype.drawWithStyle=function(){this.checkContext(),this.applyStyle(),this.draw(),this.restoreStyle()},t.prototype.hasClass=function(t){return!0===this.attrs.classes[t]},t.prototype.addClass=function(t){return this.attrs.classes[t]=!0,this.registry&&this.registry.onUpdate({id:this.attrs.id,name:"class",value:t,oldValue:void 0}),this},t.prototype.removeClass=function(t){return delete this.attrs.classes[t],this.registry&&this.registry.onUpdate({id:this.attrs.id,name:"class",value:void 0,oldValue:t}),this},t.prototype.onRegister=function(t){return this.registry=t,this},t.prototype.isRendered=function(){return this.rendered},t.prototype.setRendered=function(t){return void 0===t&&(t=!0),this.rendered=t,this},t.prototype.getAttributes=function(){return this.attrs},t.prototype.getAttribute=function(t){return this.attrs[t]},t.prototype.setAttribute=function(t,e){var i=this.attrs.id,n=this.attrs[t];return this.attrs[t]=e,this.registry&&this.registry.onUpdate({id:i,name:t,value:e,oldValue:n}),this},t.prototype.getContext=function(){return this.context},t.prototype.setContext=function(t){return this.context=t,this},t.prototype.getBoundingBox=function(){return this.boundingBox},t.prototype.checkContext=function(){if(!this.context)throw new h("NoContext","No rendering context attached to instance.");return this.context},t.ID=1e3,t}(),_=function(){function t(t,e,i,n){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN,this.addPoint(t,e),this.addPoint(i,n)}return t.prototype.getX1=function(){return this.x1},t.prototype.getY1=function(){return this.y1},t.prototype.width=function(){return this.x2-this.x1},t.prototype.height=function(){return this.y2-this.y1},t.prototype.noOp=function(){},t.prototype.addPoint=function(t,e){null!=t&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=t,this.x2=t),t<this.x1&&(this.x1=t),t>this.x2&&(this.x2=t)),null!=e&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=e,this.y2=e),e<this.y1&&(this.y1=e),e>this.y2&&(this.y2=e))},t.prototype.addX=function(t){this.addPoint(t,void 0)},t.prototype.addY=function(t){this.addPoint(void 0,t)},t.prototype.addQuadraticCurve=function(t,e,i,n,o,r){var a=t+2/3*(i-t),s=e+2/3*(n-e),h=a+1/3*(o-t),c=s+1/3*(r-e);this.addBezierCurve(t,e,a,s,h,c,o,r)},t.prototype.addBezierCurve=function(t,e,i,n,o,r,a,s){var h,c=[t,e],d=[i,n],l=[o,r],p=[a,s];this.addPoint(c[0],c[1]),this.addPoint(p[0],p[1]);var u=function(t,e){return Math.pow(1-t,3)*c[e]+3*Math.pow(1-t,2)*t*d[e]+3*(1-t)*Math.pow(t,2)*l[e]+Math.pow(t,3)*p[e]};for(h=0;h<=1;h++){var f=6*c[h]-12*d[h]+6*l[h],g=-3*c[h]+9*d[h]-9*l[h]+3*p[h],m=3*d[h]-3*c[h];if(0!==g){var y=Math.pow(f,2)-4*m*g;if(!(y<0)){var _=(-f+Math.sqrt(y))/(2*g);0<_&&_<1&&(0===h&&this.addX(u(_,h)),1===h&&this.addY(u(_,h)));var x=(-f-Math.sqrt(y))/(2*g);0<x&&x<1&&(0===h&&this.addX(u(x,h)),1===h&&this.addY(u(x,h)))}}else{if(0===f)continue;var v=-m/f;0<v&&v<1&&(0===h&&this.addX(u(v,h)),1===h&&this.addY(u(v,h)))}}},t}(),x=function(){function t(t,e,i,n){this.x=t,this.y=e,this.w=i,this.h=n}return t.copy=function(e){return new t(e.x,e.y,e.w,e.h)},t.prototype.getX=function(){return this.x},t.prototype.getY=function(){return this.y},t.prototype.getW=function(){return this.w},t.prototype.getH=function(){return this.h},t.prototype.setX=function(t){return this.x=t,this},t.prototype.setY=function(t){return this.y=t,this},t.prototype.setW=function(t){return this.w=t,this},t.prototype.setH=function(t){return this.h=t,this},t.prototype.move=function(t,e){return this.x+=t,this.y+=e,this},t.prototype.clone=function(){return t.copy(this)},t.prototype.mergeWith=function(t,e){var i=t,n=this.x<i.x?this.x:i.x,o=this.y<i.y?this.y:i.y,r=Math.max(this.x+this.w,i.x+i.w)-n,a=Math.max(this.y+this.h,i.y+i.h)-o;return this.x=n,this.y=o,this.w=r,this.h=a,e&&this.draw(e),this},t.prototype.draw=function(t,e,i){e||(e=0),i||(i=0),t.rect(this.x+e,this.y+i,this.w,this.h),t.stroke()},t}();function v(t,e,i,n,o,r){var a,s,h,c=0;function d(){return e+parseInt(t[c++])*n}function l(){return i+parseInt(t[c++])*o}function p(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];r[t].apply(r,e)}for(;c<t.length;)switch(a=t[c++]){case"m":case"l":p(a,d(),l());break;case"q":s=d(),h=l(),p(a,d(),l(),s,h);break;case"b":s=d(),h=l(),p(a,d(),l(),d(),l(),s,h)}}var S=function(t){function e(e,i,n){var o=t.call(this)||this;return o.bbox=new x(0,0,0,0),o.topGlyphs=[],o.botGlyphs=[],o.scale=1,o.setAttribute("type","Glyph"),o.code=e,o.point=i,o.options={fontStack:o.getFontStack()},o.x_shift=0,o.y_shift=0,o.originShift={x:0,y:0},n?o.setOptions(n):o.reset(),o}return o(e,t),e.prototype.draw=function(){},e.lookupFontMetric=function(t){var e=t.font,i=t.category,n=t.code,o=t.key,r=t.defaultValue,a=e.lookupMetric("glyphs."+i+"."+n+"."+o,void 0);return void 0===a&&(a=e.lookupMetric("glyphs."+i+"."+o,r)),a},e.lookupGlyph=function(t,e){if(!t)throw new h("BAD_FONTSTACK","Font stack is misconfigured");for(var i,n,o=0;o<t.length;o++)if(i=(n=t[o]).getGlyphs()[e])return{glyph:i,font:n};throw new h("BadGlyph","Glyph "+e+" does not exist in font.")},e.loadMetrics=function(t,i,n){var o=e.lookupGlyph(t,i),r=o.glyph,a=o.font,s=0,c=0,d=1;n&&a&&(s=e.lookupFontMetric({font:a,category:n,code:i,key:"shiftX",defaultValue:0}),c=e.lookupFontMetric({font:a,category:n,code:i,key:"shiftY",defaultValue:0}),d=e.lookupFontMetric({font:a,category:n,code:i,key:"scale",defaultValue:1}));var l,p=r.x_min,u=r.x_max,f=r.ha;if(r.o)return r.cached_outline?l=r.cached_outline:(l=r.o.split(" "),r.cached_outline=l),{x_min:p,x_max:u,x_shift:s,y_shift:c,scale:d,ha:f,outline:l,font:a,width:u-p,height:f};throw new h("BadGlyph","Glyph "+i+" has no outline defined.")},e.renderGlyph=function(t,i,n,o,a,s){var h=r({fontStack:ei.DEFAULT_FONT_STACK},s),c=e.loadMetrics(h.fontStack,a,h.category);h.category&&c.font&&(o=e.lookupFontMetric({font:c.font,category:h.category,code:a,key:"point",defaultValue:o}));var d=72*o/(100*c.font.getResolution());return e.renderOutline(t,c.outline,d*c.scale,i+c.x_shift,n+c.y_shift),c},e.renderOutline=function(t,e,i,n,o){t.beginPath(),t.moveTo(n,o),v(e,n,o,i,-i,{m:t.moveTo.bind(t),l:t.lineTo.bind(t),q:t.quadraticCurveTo.bind(t),b:t.bezierCurveTo.bind(t)}),t.fill()},e.getOutlineBoundingBox=function(t,e,i,n){var o=new _;return v(t,i,n,e,-e,{m:o.addPoint.bind(o),l:o.addPoint.bind(o),q:o.addQuadraticCurve.bind(o),b:o.addBezierCurve.bind(o),z:o.noOp.bind(o)}),new x(o.getX1(),o.getY1(),o.width(),o.height())},e.prototype.getCode=function(){return this.code},e.prototype.setOptions=function(t){this.options=r(r({},this.options),t),this.reset()},e.prototype.setPoint=function(t){return this.point=t,this},e.prototype.setStave=function(t){return this.stave=t,this},e.prototype.setXShift=function(t){return this.x_shift=t,this},e.prototype.setYShift=function(t){return this.y_shift=t,this},e.prototype.reset=function(){this.metrics=e.loadMetrics(this.options.fontStack,this.code,this.options.category),this.options.category&&(this.point=e.lookupFontMetric({category:this.options.category,font:this.metrics.font,code:this.code,key:"point",defaultValue:this.point})),this.scale=72*this.point/(100*this.metrics.font.getResolution()),this.bbox=e.getOutlineBoundingBox(this.metrics.outline,this.scale*this.metrics.scale,this.metrics.x_shift,this.metrics.y_shift)},e.prototype.getMetrics=function(){if(!this.metrics)throw new h("BadGlyph","Glyph "+this.code+" is not initialized.");return{x_min:this.metrics.x_min*this.scale*this.metrics.scale,x_max:this.metrics.x_max*this.scale*this.metrics.scale,width:this.bbox.getW(),height:this.bbox.getH(),scale:this.scale*this.metrics.scale,x_shift:this.metrics.x_shift,y_shift:this.metrics.y_shift,outline:this.metrics.outline,font:this.metrics.font,ha:this.metrics.ha}},e.prototype.setOriginX=function(t){var e=this.bbox,i=(t-Math.abs(e.getX()/e.getW()))*e.getW();this.originShift.x=-i},e.prototype.setOriginY=function(t){var e=this.bbox,i=(t-Math.abs(e.getY()/e.getH()))*e.getH();this.originShift.y=-i},e.prototype.setOrigin=function(t,e){this.setOriginX(t),this.setOriginY(e)},e.prototype.render=function(t,i,n){if(!this.metrics)throw new h("BadGlyph","Glyph "+this.code+" is not initialized.");var o=this.metrics.outline,r=this.scale*this.metrics.scale;this.setRendered(),this.applyStyle(t),e.renderOutline(t,o,r,i+this.originShift.x+this.metrics.x_shift,n+this.originShift.y+this.metrics.y_shift),this.restoreStyle(t)},e.prototype.renderToStave=function(t){var i=this.checkContext();if(!this.metrics)throw new h("BadGlyph","Glyph "+this.code+" is not initialized.");if(!this.stave)throw new h("GlyphError","No valid stave");var n=this.metrics.outline,o=this.scale*this.metrics.scale;this.setRendered(),this.applyStyle(),e.renderOutline(i,n,o,t+this.x_shift+this.metrics.x_shift,this.stave.getYForGlyphs()+this.y_shift+this.metrics.y_shift),this.restoreStyle()},e}(y);var b,w=function(){function t(t,e,n){switch(this.name=t,this.fontDataMetrics={fontData:void 0,metrics:void 0},t){case"Bravura":!function(t){a(this,void 0,void 0,(function(){var e;return s(this,(function(n){switch(n.label){case 0:return[4,i.e(347).then(i.bind(i,387))];case 1:return e=n.sent(),t.fontData=e.default.fontData,t.metrics=e.default.metrics,[2]}}))}))}(this.fontDataMetrics);break;case"Custom":!function(t){a(this,void 0,void 0,(function(){var e;return s(this,(function(n){switch(n.label){case 0:return[4,i.e(289).then(i.bind(i,114))];case 1:return e=n.sent(),t.fontData=e.default.fontData,t.metrics=e.default.metrics,[2]}}))}))}(this.fontDataMetrics);break;case"Gonville":!function(t){a(this,void 0,void 0,(function(){var e;return s(this,(function(n){switch(n.label){case 0:return[4,i.e(571).then(i.bind(i,863))];case 1:return e=n.sent(),t.fontData=e.default.fontData,t.metrics=e.default.metrics,[2]}}))}))}(this.fontDataMetrics);break;case"Petaluma":!function(t){a(this,void 0,void 0,(function(){var e;return s(this,(function(n){switch(n.label){case 0:return[4,i.e(623).then(i.bind(i,987))];case 1:return e=n.sent(),t.fontData=e.default.fontData,t.metrics=e.default.metrics,[2]}}))}))}(this.fontDataMetrics);break;case"Leland":!function(t){a(this,void 0,void 0,(function(){var e;return s(this,(function(n){switch(n.label){case 0:return[4,i.e(81).then(i.bind(i,426))];case 1:return e=n.sent(),t.fontData=e.default.fontData,t.metrics=e.default.metrics,[2]}}))}))}(this.fontDataMetrics);break;default:this.fontDataMetrics.metrics=e,this.fontDataMetrics.fontData=n}}return t.prototype.getName=function(){return this.name},t.prototype.getResolution=function(){if(!this.fontDataMetrics.fontData)throw new h("Missing metrics or font data");return this.fontDataMetrics.fontData.resolution},t.prototype.getMetrics=function(){if(!this.fontDataMetrics.metrics)throw new h("Missing metrics or font data");return this.fontDataMetrics.metrics},t.prototype.lookupMetric=function(t,e){if(!this.fontDataMetrics.metrics)throw new h("Missing metrics or font data");for(var i=t.split("."),n=this.fontDataMetrics.metrics,o=0;o<i.length;o++){if(void 0===n[i[o]])return e;n=n[i[o]]}return n},t.prototype.getFontData=function(){if(!this.fontDataMetrics.fontData)throw new h("Missing metrics or font data");return this.fontDataMetrics.fontData},t.prototype.getGlyphs=function(){if(!this.fontDataMetrics.fontData)throw new h("Missing metrics or font data");return this.fontDataMetrics.fontData.glyphs},t}(),T={Bravura:function(){return new w("Bravura")},Gonville:function(){return new w("Gonville")},Petaluma:function(){return new w("Petaluma")},Custom:function(){return new w("Custom")},Leland:function(){return new w("Leland")}},C={D0:{code:"noteheadDiamondWhole"},D1:{code:"noteheadDiamondHalf"},D2:{code:"noteheadDiamondBlack"},D3:{code:"noteheadDiamondBlack"},T0:{code:"noteheadTriangleUpWhole"},T1:{code:"noteheadTriangleUpHalf"},T2:{code:"noteheadTriangleUpBlack"},T3:{code:"noteheadTriangleUpBlack"},X0:{code:"noteheadXWhole"},X1:{code:"noteheadXHalf"},X2:{code:"noteheadXBlack"},X3:{code:"noteheadCircleX"},S1:{code:"noteheadSquareWhite"},S2:{code:"noteheadSquareBlack"},R1:{code:"vexNoteHeadRectWhite"},R2:{code:"vexNoteHeadRectBlack"}},E=16384,A={"1/2":32768,1:16384,2:8192,4:4096,8:2048,16:1024,32:512,64:256,128:128,256:64},P={"#":{code:"accidentalSharp",parenRightPaddingAdjustment:-1},"##":{code:"accidentalDoubleSharp",parenRightPaddingAdjustment:-1},b:{code:"accidentalFlat",parenRightPaddingAdjustment:-2},bb:{code:"accidentalDoubleFlat",parenRightPaddingAdjustment:-2},n:{code:"accidentalNatural",parenRightPaddingAdjustment:-1},"{":{code:"accidentalParensLeft",parenRightPaddingAdjustment:-1},"}":{code:"accidentalParensRight",parenRightPaddingAdjustment:-1},db:{code:"accidentalThreeQuarterTonesFlatZimmermann",parenRightPaddingAdjustment:-1},d:{code:"accidentalQuarterToneFlatStein",parenRightPaddingAdjustment:0},"++":{code:"accidentalThreeQuarterTonesSharpStein",parenRightPaddingAdjustment:-1},"+":{code:"accidentalQuarterToneSharpStein",parenRightPaddingAdjustment:-1},"+-":{code:"accidentalKucukMucennebSharp",parenRightPaddingAdjustment:-1},bs:{code:"accidentalBakiyeFlat",parenRightPaddingAdjustment:-1},bss:{code:"accidentalBuyukMucennebFlat",parenRightPaddingAdjustment:-1},o:{code:"accidentalSori",parenRightPaddingAdjustment:-1},k:{code:"accidentalKoron",parenRightPaddingAdjustment:-1},bbs:{code:"vexAccidentalMicrotonal1",parenRightPaddingAdjustment:-1},"++-":{code:"vexAccidentalMicrotonal2",parenRightPaddingAdjustment:-1},ashs:{code:"vexAccidentalMicrotonal3",parenRightPaddingAdjustment:-1},afhf:{code:"vexAccidentalMicrotonal4",parenRightPaddingAdjustment:-1},accSagittal5v7KleismaUp:{code:"accSagittal5v7KleismaUp",parenRightPaddingAdjustment:-1},accSagittal5v7KleismaDown:{code:"accSagittal5v7KleismaDown",parenRightPaddingAdjustment:-1},accSagittal5CommaUp:{code:"accSagittal5CommaUp",parenRightPaddingAdjustment:-1},accSagittal5CommaDown:{code:"accSagittal5CommaDown",parenRightPaddingAdjustment:-1},accSagittal7CommaUp:{code:"accSagittal7CommaUp",parenRightPaddingAdjustment:-1},accSagittal7CommaDown:{code:"accSagittal7CommaDown",parenRightPaddingAdjustment:-1},accSagittal25SmallDiesisUp:{code:"accSagittal25SmallDiesisUp",parenRightPaddingAdjustment:-1},accSagittal25SmallDiesisDown:{code:"accSagittal25SmallDiesisDown",parenRightPaddingAdjustment:-1},accSagittal35MediumDiesisUp:{code:"accSagittal35MediumDiesisUp",parenRightPaddingAdjustment:-1},accSagittal35MediumDiesisDown:{code:"accSagittal35MediumDiesisDown",parenRightPaddingAdjustment:-1},accSagittal11MediumDiesisUp:{code:"accSagittal11MediumDiesisUp",parenRightPaddingAdjustment:-1},accSagittal11MediumDiesisDown:{code:"accSagittal11MediumDiesisDown",parenRightPaddingAdjustment:-1},accSagittal11LargeDiesisUp:{code:"accSagittal11LargeDiesisUp",parenRightPaddingAdjustment:-1},accSagittal11LargeDiesisDown:{code:"accSagittal11LargeDiesisDown",parenRightPaddingAdjustment:-1},accSagittal35LargeDiesisUp:{code:"accSagittal35LargeDiesisUp",parenRightPaddingAdjustment:-1},accSagittal35LargeDiesisDown:{code:"accSagittal35LargeDiesisDown",parenRightPaddingAdjustment:-1},accSagittalSharp25SDown:{code:"accSagittalSharp25SDown",parenRightPaddingAdjustment:-1},accSagittalFlat25SUp:{code:"accSagittalFlat25SUp",parenRightPaddingAdjustment:-1},accSagittalSharp7CDown:{code:"accSagittalSharp7CDown",parenRightPaddingAdjustment:-1},accSagittalFlat7CUp:{code:"accSagittalFlat7CUp",parenRightPaddingAdjustment:-1},accSagittalSharp5CDown:{code:"accSagittalSharp5CDown",parenRightPaddingAdjustment:-1},accSagittalFlat5CUp:{code:"accSagittalFlat5CUp",parenRightPaddingAdjustment:-1},accSagittalSharp5v7kDown:{code:"accSagittalSharp5v7kDown",parenRightPaddingAdjustment:-1},accSagittalFlat5v7kUp:{code:"accSagittalFlat5v7kUp",parenRightPaddingAdjustment:-1},accSagittalSharp:{code:"accSagittalSharp",parenRightPaddingAdjustment:-1},accSagittalFlat:{code:"accSagittalFlat",parenRightPaddingAdjustment:-1},accSagittalSharp5v7kUp:{code:"accSagittalSharp5v7kUp",parenRightPaddingAdjustment:-1},accSagittalFlat5v7kDown:{code:"accSagittalFlat5v7kDown",parenRightPaddingAdjustment:-1},accSagittalSharp5CUp:{code:"accSagittalSharp5CUp",parenRightPaddingAdjustment:-1},accSagittalFlat5CDown:{code:"accSagittalFlat5CDown",parenRightPaddingAdjustment:-1},accSagittalSharp7CUp:{code:"accSagittalSharp7CUp",parenRightPaddingAdjustment:-1},accSagittalFlat7CDown:{code:"accSagittalFlat7CDown",parenRightPaddingAdjustment:-1},accSagittalSharp25SUp:{code:"accSagittalSharp25SUp",parenRightPaddingAdjustment:-1},accSagittalFlat25SDown:{code:"accSagittalFlat25SDown",parenRightPaddingAdjustment:-1},accSagittalSharp35MUp:{code:"accSagittalSharp35MUp",parenRightPaddingAdjustment:-1},accSagittalFlat35MDown:{code:"accSagittalFlat35MDown",parenRightPaddingAdjustment:-1},accSagittalSharp11MUp:{code:"accSagittalSharp11MUp",parenRightPaddingAdjustment:-1},accSagittalFlat11MDown:{code:"accSagittalFlat11MDown",parenRightPaddingAdjustment:-1},accSagittalSharp11LUp:{code:"accSagittalSharp11LUp",parenRightPaddingAdjustment:-1},accSagittalFlat11LDown:{code:"accSagittalFlat11LDown",parenRightPaddingAdjustment:-1},accSagittalSharp35LUp:{code:"accSagittalSharp35LUp",parenRightPaddingAdjustment:-1},accSagittalFlat35LDown:{code:"accSagittalFlat35LDown",parenRightPaddingAdjustment:-1},accSagittalDoubleSharp25SDown:{code:"accSagittalDoubleSharp25SDown",parenRightPaddingAdjustment:-1},accSagittalDoubleFlat25SUp:{code:"accSagittalDoubleFlat25SUp",parenRightPaddingAdjustment:-1},accSagittalDoubleSharp7CDown:{code:"accSagittalDoubleSharp7CDown",parenRightPaddingAdjustment:-1},accSagittalDoubleFlat7CUp:{code:"accSagittalDoubleFlat7CUp",parenRightPaddingAdjustment:-1},accSagittalDoubleSharp5CDown:{code:"accSagittalDoubleSharp5CDown",parenRightPaddingAdjustment:-1},accSagittalDoubleFlat5CUp:{code:"accSagittalDoubleFlat5CUp",parenRightPaddingAdjustment:-1},accSagittalDoubleSharp5v7kDown:{code:"accSagittalDoubleSharp5v7kDown",parenRightPaddingAdjustment:-1},accSagittalDoubleFlat5v7kUp:{code:"accSagittalDoubleFlat5v7kUp",parenRightPaddingAdjustment:-1},accSagittalDoubleSharp:{code:"accSagittalDoubleSharp",parenRightPaddingAdjustment:-1},accSagittalDoubleFlat:{code:"accSagittalDoubleFlat",parenRightPaddingAdjustment:-1},accSagittal7v11KleismaUp:{code:"accSagittal7v11KleismaUp",parenRightPaddingAdjustment:-1},accSagittal7v11KleismaDown:{code:"accSagittal7v11KleismaDown",parenRightPaddingAdjustment:-1},accSagittal17CommaUp:{code:"accSagittal17CommaUp",parenRightPaddingAdjustment:-1},accSagittal17CommaDown:{code:"accSagittal17CommaDown",parenRightPaddingAdjustment:-1},accSagittal55CommaUp:{code:"accSagittal55CommaUp",parenRightPaddingAdjustment:-1},accSagittal55CommaDown:{code:"accSagittal55CommaDown",parenRightPaddingAdjustment:-1},accSagittal7v11CommaUp:{code:"accSagittal7v11CommaUp",parenRightPaddingAdjustment:-1},accSagittal7v11CommaDown:{code:"accSagittal7v11CommaDown",parenRightPaddingAdjustment:-1},accSagittal5v11SmallDiesisUp:{code:"accSagittal5v11SmallDiesisUp",parenRightPaddingAdjustment:-1},accSagittal5v11SmallDiesisDown:{code:"accSagittal5v11SmallDiesisDown",parenRightPaddingAdjustment:-1},accSagittalSharp5v11SDown:{code:"accSagittalSharp5v11SDown",parenRightPaddingAdjustment:-1},accSagittalFlat5v11SUp:{code:"accSagittalFlat5v11SUp",parenRightPaddingAdjustment:-1},accSagittalSharp7v11CDown:{code:"accSagittalSharp7v11CDown",parenRightPaddingAdjustment:-1},accSagittalFlat7v11CUp:{code:"accSagittalFlat7v11CUp",parenRightPaddingAdjustment:-1},accSagittalSharp55CDown:{code:"accSagittalSharp55CDown",parenRightPaddingAdjustment:-1},accSagittalFlat55CUp:{code:"accSagittalFlat55CUp",parenRightPaddingAdjustment:-1},accSagittalSharp17CDown:{code:"accSagittalSharp17CDown",parenRightPaddingAdjustment:-1},accSagittalFlat17CUp:{code:"accSagittalFlat17CUp",parenRightPaddingAdjustment:-1},accSagittalSharp7v11kDown:{code:"accSagittalSharp7v11kDown",parenRightPaddingAdjustment:-1},accSagittalFlat7v11kUp:{code:"accSagittalFlat7v11kUp",parenRightPaddingAdjustment:-1},accSagittalSharp7v11kUp:{code:"accSagittalSharp7v11kUp",parenRightPaddingAdjustment:-1},accSagittalFlat7v11kDown:{code:"accSagittalFlat7v11kDown",parenRightPaddingAdjustment:-1},accSagittalSharp17CUp:{code:"accSagittalSharp17CUp",parenRightPaddingAdjustment:-1},accSagittalFlat17CDown:{code:"accSagittalFlat17CDown",parenRightPaddingAdjustment:-1},accSagittalSharp55CUp:{code:"accSagittalSharp55CUp",parenRightPaddingAdjustment:-1},accSagittalFlat55CDown:{code:"accSagittalFlat55CDown",parenRightPaddingAdjustment:-1},accSagittalSharp7v11CUp:{code:"accSagittalSharp7v11CUp",parenRightPaddingAdjustment:-1},accSagittalFlat7v11CDown:{code:"accSagittalFlat7v11CDown",parenRightPaddingAdjustment:-1},accSagittalSharp5v11SUp:{code:"accSagittalSharp5v11SUp",parenRightPaddingAdjustment:-1},accSagittalFlat5v11SDown:{code:"accSagittalFlat5v11SDown",parenRightPaddingAdjustment:-1},accSagittalDoubleSharp5v11SDown:{code:"accSagittalDoubleSharp5v11SDown",parenRightPaddingAdjustment:-1},accSagittalDoubleFlat5v11SUp:{code:"accSagittalDoubleFlat5v11SUp",parenRightPaddingAdjustment:-1},accSagittalDoubleSharp7v11CDown:{code:"accSagittalDoubleSharp7v11CDown",parenRightPaddingAdjustment:-1},accSagittalDoubleFlat7v11CUp:{code:"accSagittalDoubleFlat7v11CUp",parenRightPaddingAdjustment:-1},accSagittalDoubleSharp55CDown:{code:"accSagittalDoubleSharp55CDown",parenRightPaddingAdjustment:-1},accSagittalDoubleFlat55CUp:{code:"accSagittalDoubleFlat55CUp",parenRightPaddingAdjustment:-1},accSagittalDoubleSharp17CDown:{code:"accSagittalDoubleSharp17CDown",parenRightPaddingAdjustment:-1},accSagittalDoubleFlat17CUp:{code:"accSagittalDoubleFlat17CUp",parenRightPaddingAdjustment:-1},accSagittalDoubleSharp7v11kDown:{code:"accSagittalDoubleSharp7v11kDown",parenRightPaddingAdjustment:-1},accSagittalDoubleFlat7v11kUp:{code:"accSagittalDoubleFlat7v11kUp",parenRightPaddingAdjustment:-1},accSagittal23CommaUp:{code:"accSagittal23CommaUp",parenRightPaddingAdjustment:-1},accSagittal23CommaDown:{code:"accSagittal23CommaDown",parenRightPaddingAdjustment:-1},accSagittal5v19CommaUp:{code:"accSagittal5v19CommaUp",parenRightPaddingAdjustment:-1},accSagittal5v19CommaDown:{code:"accSagittal5v19CommaDown",parenRightPaddingAdjustment:-1},accSagittal5v23SmallDiesisUp:{code:"accSagittal5v23SmallDiesisUp",parenRightPaddingAdjustment:-1},accSagittal5v23SmallDiesisDown:{code:"accSagittal5v23SmallDiesisDown",parenRightPaddingAdjustment:-1},accSagittalSharp5v23SDown:{code:"accSagittalSharp5v23SDown",parenRightPaddingAdjustment:-1},accSagittalFlat5v23SUp:{code:"accSagittalFlat5v23SUp",parenRightPaddingAdjustment:-1},accSagittalSharp5v19CDown:{code:"accSagittalSharp5v19CDown",parenRightPaddingAdjustment:-1},accSagittalFlat5v19CUp:{code:"accSagittalFlat5v19CUp",parenRightPaddingAdjustment:-1},accSagittalSharp23CDown:{code:"accSagittalSharp23CDown",parenRightPaddingAdjustment:-1},accSagittalFlat23CUp:{code:"accSagittalFlat23CUp",parenRightPaddingAdjustment:-1},accSagittalSharp23CUp:{code:"accSagittalSharp23CUp",parenRightPaddingAdjustment:-1},accSagittalFlat23CDown:{code:"accSagittalFlat23CDown",parenRightPaddingAdjustment:-1},accSagittalSharp5v19CUp:{code:"accSagittalSharp5v19CUp",parenRightPaddingAdjustment:-1},accSagittalFlat5v19CDown:{code:"accSagittalFlat5v19CDown",parenRightPaddingAdjustment:-1},accSagittalSharp5v23SUp:{code:"accSagittalSharp5v23SUp",parenRightPaddingAdjustment:-1},accSagittalFlat5v23SDown:{code:"accSagittalFlat5v23SDown",parenRightPaddingAdjustment:-1},accSagittalDoubleSharp5v23SDown:{code:"accSagittalDoubleSharp5v23SDown",parenRightPaddingAdjustment:-1},accSagittalDoubleFlat5v23SUp:{code:"accSagittalDoubleFlat5v23SUp",parenRightPaddingAdjustment:-1},accSagittalDoubleSharp5v19CDown:{code:"accSagittalDoubleSharp5v19CDown",parenRightPaddingAdjustment:-1},accSagittalDoubleFlat5v19CUp:{code:"accSagittalDoubleFlat5v19CUp",parenRightPaddingAdjustment:-1},accSagittalDoubleSharp23CDown:{code:"accSagittalDoubleSharp23CDown",parenRightPaddingAdjustment:-1},accSagittalDoubleFlat23CUp:{code:"accSagittalDoubleFlat23CUp",parenRightPaddingAdjustment:-1},accSagittal19SchismaUp:{code:"accSagittal19SchismaUp",parenRightPaddingAdjustment:-1},accSagittal19SchismaDown:{code:"accSagittal19SchismaDown",parenRightPaddingAdjustment:-1},accSagittal17KleismaUp:{code:"accSagittal17KleismaUp",parenRightPaddingAdjustment:-1},accSagittal17KleismaDown:{code:"accSagittal17KleismaDown",parenRightPaddingAdjustment:-1},accSagittal143CommaUp:{code:"accSagittal143CommaUp",parenRightPaddingAdjustment:-1},accSagittal143CommaDown:{code:"accSagittal143CommaDown",parenRightPaddingAdjustment:-1},accSagittal11v49CommaUp:{code:"accSagittal11v49CommaUp",parenRightPaddingAdjustment:-1},accSagittal11v49CommaDown:{code:"accSagittal11v49CommaDown",parenRightPaddingAdjustment:-1},accSagittal19CommaUp:{code:"accSagittal19CommaUp",parenRightPaddingAdjustment:-1},accSagittal19CommaDown:{code:"accSagittal19CommaDown",parenRightPaddingAdjustment:-1},accSagittal7v19CommaUp:{code:"accSagittal7v19CommaUp",parenRightPaddingAdjustment:-1},accSagittal7v19CommaDown:{code:"accSagittal7v19CommaDown",parenRightPaddingAdjustment:-1},accSagittal49SmallDiesisUp:{code:"accSagittal49SmallDiesisUp",parenRightPaddingAdjustment:-1},accSagittal49SmallDiesisDown:{code:"accSagittal49SmallDiesisDown",parenRightPaddingAdjustment:-1},accSagittal23SmallDiesisUp:{code:"accSagittal23SmallDiesisUp",parenRightPaddingAdjustment:-1},accSagittal23SmallDiesisDown:{code:"accSagittal23SmallDiesisDown",parenRightPaddingAdjustment:-1},accSagittal5v13MediumDiesisUp:{code:"accSagittal5v13MediumDiesisUp",parenRightPaddingAdjustment:-1},accSagittal5v13MediumDiesisDown:{code:"accSagittal5v13MediumDiesisDown",parenRightPaddingAdjustment:-1},accSagittal11v19MediumDiesisUp:{code:"accSagittal11v19MediumDiesisUp",parenRightPaddingAdjustment:-1},accSagittal11v19MediumDiesisDown:{code:"accSagittal11v19MediumDiesisDown",parenRightPaddingAdjustment:-1},accSagittal49MediumDiesisUp:{code:"accSagittal49MediumDiesisUp",parenRightPaddingAdjustment:-1},accSagittal49MediumDiesisDown:{code:"accSagittal49MediumDiesisDown",parenRightPaddingAdjustment:-1},accSagittal5v49MediumDiesisUp:{code:"accSagittal5v49MediumDiesisUp",parenRightPaddingAdjustment:-1},accSagittal5v49MediumDiesisDown:{code:"accSagittal5v49MediumDiesisDown",parenRightPaddingAdjustment:-1},accSagittal49LargeDiesisUp:{code:"accSagittal49LargeDiesisUp",parenRightPaddingAdjustment:-1},accSagittal49LargeDiesisDown:{code:"accSagittal49LargeDiesisDown",parenRightPaddingAdjustment:-1},accSagittal11v19LargeDiesisUp:{code:"accSagittal11v19LargeDiesisUp",parenRightPaddingAdjustment:-1},accSagittal11v19LargeDiesisDown:{code:"accSagittal11v19LargeDiesisDown",parenRightPaddingAdjustment:-1},accSagittal5v13LargeDiesisUp:{code:"accSagittal5v13LargeDiesisUp",parenRightPaddingAdjustment:-1},accSagittal5v13LargeDiesisDown:{code:"accSagittal5v13LargeDiesisDown",parenRightPaddingAdjustment:-1},accSagittalSharp23SDown:{code:"accSagittalSharp23SDown",parenRightPaddingAdjustment:-1},accSagittalFlat23SUp:{code:"accSagittalFlat23SUp",parenRightPaddingAdjustment:-1},accSagittalSharp49SDown:{code:"accSagittalSharp49SDown",parenRightPaddingAdjustment:-1},accSagittalFlat49SUp:{code:"accSagittalFlat49SUp",parenRightPaddingAdjustment:-1},accSagittalSharp7v19CDown:{code:"accSagittalSharp7v19CDown",parenRightPaddingAdjustment:-1},accSagittalFlat7v19CUp:{code:"accSagittalFlat7v19CUp",parenRightPaddingAdjustment:-1},accSagittalSharp19CDown:{code:"accSagittalSharp19CDown",parenRightPaddingAdjustment:-1},accSagittalFlat19CUp:{code:"accSagittalFlat19CUp",parenRightPaddingAdjustment:-1},accSagittalSharp11v49CDown:{code:"accSagittalSharp11v49CDown",parenRightPaddingAdjustment:-1},accSagittalFlat11v49CUp:{code:"accSagittalFlat11v49CUp",parenRightPaddingAdjustment:-1},accSagittalSharp143CDown:{code:"accSagittalSharp143CDown",parenRightPaddingAdjustment:-1},accSagittalFlat143CUp:{code:"accSagittalFlat143CUp",parenRightPaddingAdjustment:-1},accSagittalSharp17kDown:{code:"accSagittalSharp17kDown",parenRightPaddingAdjustment:-1},accSagittalFlat17kUp:{code:"accSagittalFlat17kUp",parenRightPaddingAdjustment:-1},accSagittalSharp19sDown:{code:"accSagittalSharp19sDown",parenRightPaddingAdjustment:-1},accSagittalFlat19sUp:{code:"accSagittalFlat19sUp",parenRightPaddingAdjustment:-1},accSagittalSharp19sUp:{code:"accSagittalSharp19sUp",parenRightPaddingAdjustment:-1},accSagittalFlat19sDown:{code:"accSagittalFlat19sDown",parenRightPaddingAdjustment:-1},accSagittalSharp17kUp:{code:"accSagittalSharp17kUp",parenRightPaddingAdjustment:-1},accSagittalFlat17kDown:{code:"accSagittalFlat17kDown",parenRightPaddingAdjustment:-1},accSagittalSharp143CUp:{code:"accSagittalSharp143CUp",parenRightPaddingAdjustment:-1},accSagittalFlat143CDown:{code:"accSagittalFlat143CDown",parenRightPaddingAdjustment:-1},accSagittalSharp11v49CUp:{code:"accSagittalSharp11v49CUp",parenRightPaddingAdjustment:-1},accSagittalFlat11v49CDown:{code:"accSagittalFlat11v49CDown",parenRightPaddingAdjustment:-1},accSagittalSharp19CUp:{code:"accSagittalSharp19CUp",parenRightPaddingAdjustment:-1},accSagittalFlat19CDown:{code:"accSagittalFlat19CDown",parenRightPaddingAdjustment:-1},accSagittalSharp7v19CUp:{code:"accSagittalSharp7v19CUp",parenRightPaddingAdjustment:-1},accSagittalFlat7v19CDown:{code:"accSagittalFlat7v19CDown",parenRightPaddingAdjustment:-1},accSagittalSharp49SUp:{code:"accSagittalSharp49SUp",parenRightPaddingAdjustment:-1},accSagittalFlat49SDown:{code:"accSagittalFlat49SDown",parenRightPaddingAdjustment:-1},accSagittalSharp23SUp:{code:"accSagittalSharp23SUp",parenRightPaddingAdjustment:-1},accSagittalFlat23SDown:{code:"accSagittalFlat23SDown",parenRightPaddingAdjustment:-1},accSagittalSharp5v13MUp:{code:"accSagittalSharp5v13MUp",parenRightPaddingAdjustment:-1},accSagittalFlat5v13MDown:{code:"accSagittalFlat5v13MDown",parenRightPaddingAdjustment:-1},accSagittalSharp11v19MUp:{code:"accSagittalSharp11v19MUp",parenRightPaddingAdjustment:-1},accSagittalFlat11v19MDown:{code:"accSagittalFlat11v19MDown",parenRightPaddingAdjustment:-1},accSagittalSharp49MUp:{code:"accSagittalSharp49MUp",parenRightPaddingAdjustment:-1},accSagittalFlat49MDown:{code:"accSagittalFlat49MDown",parenRightPaddingAdjustment:-1},accSagittalSharp5v49MUp:{code:"accSagittalSharp5v49MUp",parenRightPaddingAdjustment:-1},accSagittalFlat5v49MDown:{code:"accSagittalFlat5v49MDown",parenRightPaddingAdjustment:-1},accSagittalSharp49LUp:{code:"accSagittalSharp49LUp",parenRightPaddingAdjustment:-1},accSagittalFlat49LDown:{code:"accSagittalFlat49LDown",parenRightPaddingAdjustment:-1},accSagittalSharp11v19LUp:{code:"accSagittalSharp11v19LUp",parenRightPaddingAdjustment:-1},accSagittalFlat11v19LDown:{code:"accSagittalFlat11v19LDown",parenRightPaddingAdjustment:-1},accSagittalSharp5v13LUp:{code:"accSagittalSharp5v13LUp",parenRightPaddingAdjustment:-1},accSagittalFlat5v13LDown:{code:"accSagittalFlat5v13LDown",parenRightPaddingAdjustment:-1},accSagittalDoubleSharp23SDown:{code:"accSagittalDoubleSharp23SDown",parenRightPaddingAdjustment:-1},accSagittalDoubleFlat23SUp:{code:"accSagittalDoubleFlat23SUp",parenRightPaddingAdjustment:-1},accSagittalDoubleSharp49SDown:{code:"accSagittalDoubleSharp49SDown",parenRightPaddingAdjustment:-1},accSagittalDoubleFlat49SUp:{code:"accSagittalDoubleFlat49SUp",parenRightPaddingAdjustment:-1},accSagittalDoubleSharp7v19CDown:{code:"accSagittalDoubleSharp7v19CDown",parenRightPaddingAdjustment:-1},accSagittalDoubleFlat7v19CUp:{code:"accSagittalDoubleFlat7v19CUp",parenRightPaddingAdjustment:-1},accSagittalDoubleSharp19CDown:{code:"accSagittalDoubleSharp19CDown",parenRightPaddingAdjustment:-1},accSagittalDoubleFlat19CUp:{code:"accSagittalDoubleFlat19CUp",parenRightPaddingAdjustment:-1},accSagittalDoubleSharp11v49CDown:{code:"accSagittalDoubleSharp11v49CDown",parenRightPaddingAdjustment:-1},accSagittalDoubleFlat11v49CUp:{code:"accSagittalDoubleFlat11v49CUp",parenRightPaddingAdjustment:-1},accSagittalDoubleSharp143CDown:{code:"accSagittalDoubleSharp143CDown",parenRightPaddingAdjustment:-1},accSagittalDoubleFlat143CUp:{code:"accSagittalDoubleFlat143CUp",parenRightPaddingAdjustment:-1},accSagittalDoubleSharp17kDown:{code:"accSagittalDoubleSharp17kDown",parenRightPaddingAdjustment:-1},accSagittalDoubleFlat17kUp:{code:"accSagittalDoubleFlat17kUp",parenRightPaddingAdjustment:-1},accSagittalDoubleSharp19sDown:{code:"accSagittalDoubleSharp19sDown",parenRightPaddingAdjustment:-1},accSagittalDoubleFlat19sUp:{code:"accSagittalDoubleFlat19sUp",parenRightPaddingAdjustment:-1},accSagittalShaftUp:{code:"accSagittalShaftUp",parenRightPaddingAdjustment:-1},accSagittalShaftDown:{code:"accSagittalShaftDown",parenRightPaddingAdjustment:-1},accSagittalAcute:{code:"accSagittalAcute",parenRightPaddingAdjustment:-1},accSagittalGrave:{code:"accSagittalGrave",parenRightPaddingAdjustment:-1},accSagittal1MinaUp:{code:"accSagittal1MinaUp",parenRightPaddingAdjustment:-1},accSagittal1MinaDown:{code:"accSagittal1MinaDown",parenRightPaddingAdjustment:-1},accSagittal2MinasUp:{code:"accSagittal2MinasUp",parenRightPaddingAdjustment:-1},accSagittal2MinasDown:{code:"accSagittal2MinasDown",parenRightPaddingAdjustment:-1},accSagittal1TinaUp:{code:"accSagittal1TinaUp",parenRightPaddingAdjustment:-1},accSagittal1TinaDown:{code:"accSagittal1TinaDown",parenRightPaddingAdjustment:-1},accSagittal2TinasUp:{code:"accSagittal2TinasUp",parenRightPaddingAdjustment:-1},accSagittal2TinasDown:{code:"accSagittal2TinasDown",parenRightPaddingAdjustment:-1},accSagittal3TinasUp:{code:"accSagittal3TinasUp",parenRightPaddingAdjustment:-1},accSagittal3TinasDown:{code:"accSagittal3TinasDown",parenRightPaddingAdjustment:-1},accSagittal4TinasUp:{code:"accSagittal4TinasUp",parenRightPaddingAdjustment:-1},accSagittal4TinasDown:{code:"accSagittal4TinasDown",parenRightPaddingAdjustment:-1},accSagittal5TinasUp:{code:"accSagittal5TinasUp",parenRightPaddingAdjustment:-1},accSagittal5TinasDown:{code:"accSagittal5TinasDown",parenRightPaddingAdjustment:-1},accSagittal6TinasUp:{code:"accSagittal6TinasUp",parenRightPaddingAdjustment:-1},accSagittal6TinasDown:{code:"accSagittal6TinasDown",parenRightPaddingAdjustment:-1},accSagittal7TinasUp:{code:"accSagittal7TinasUp",parenRightPaddingAdjustment:-1},accSagittal7TinasDown:{code:"accSagittal7TinasDown",parenRightPaddingAdjustment:-1},accSagittal8TinasUp:{code:"accSagittal8TinasUp",parenRightPaddingAdjustment:-1},accSagittal8TinasDown:{code:"accSagittal8TinasDown",parenRightPaddingAdjustment:-1},accSagittal9TinasUp:{code:"accSagittal9TinasUp",parenRightPaddingAdjustment:-1},accSagittal9TinasDown:{code:"accSagittal9TinasDown",parenRightPaddingAdjustment:-1},accSagittalFractionalTinaUp:{code:"accSagittalFractionalTinaUp",parenRightPaddingAdjustment:-1},accSagittalFractionalTinaDown:{code:"accSagittalFractionalTinaDown",parenRightPaddingAdjustment:-1},accidentalNarrowReversedFlat:{code:"accidentalNarrowReversedFlat",parenRightPaddingAdjustment:-1},accidentalNarrowReversedFlatAndFlat:{code:"accidentalNarrowReversedFlatAndFlat",parenRightPaddingAdjustment:-1},accidentalWilsonPlus:{code:"accidentalWilsonPlus",parenRightPaddingAdjustment:-1},accidentalWilsonMinus:{code:"accidentalWilsonMinus",parenRightPaddingAdjustment:-1}},k={STEM_WIDTH:1.5,STEM_HEIGHT:35,STAVE_LINE_THICKNESS:1,RESOLUTION:E,DEFAULT_FONT_STACK:[T.Bravura(),T.Gonville(),T.Custom()],DEFAULT_NOTATION_FONT_SCALE:39,DEFAULT_TABLATURE_FONT_SCALE:39,SLASH_NOTEHEAD_WIDTH:15,STAVE_LINE_DISTANCE:10,TEXT_HEIGHT_OFFSET_HACK:1,IsKerned:!0,clefProperties:function(t){if(!t)throw new h("BadArgument","Invalid clef: "+t);var e={treble:{line_shift:0},bass:{line_shift:6},tenor:{line_shift:4},alto:{line_shift:3},soprano:{line_shift:1},percussion:{line_shift:0},"mezzo-soprano":{line_shift:2},"baritone-c":{line_shift:5},"baritone-f":{line_shift:5},subbass:{line_shift:7},french:{line_shift:-1}}[t];if(!e)throw new h("BadArgument","Invalid clef: "+t);return e},keyProperties:function(t,e,i){void 0===e&&(e="treble");var n={octave_shift:0};"object"==typeof i&&(n=r(r({},n),i));var o=t.split("/");if(o.length<2)throw new h("BadArguments","Key must have note + octave and an optional glyph: "+t);var a=o[0].toUpperCase(),s={C:{index:0,int_val:0},CN:{index:0,int_val:0,accidental:"n"},"C#":{index:0,int_val:1,accidental:"#"},"C##":{index:0,int_val:2,accidental:"##"},CB:{index:0,int_val:11,accidental:"b"},CBB:{index:0,int_val:10,accidental:"bb"},D:{index:1,int_val:2},DN:{index:1,int_val:2,accidental:"n"},"D#":{index:1,int_val:3,accidental:"#"},"D##":{index:1,int_val:4,accidental:"##"},DB:{index:1,int_val:1,accidental:"b"},DBB:{index:1,int_val:0,accidental:"bb"},E:{index:2,int_val:4},EN:{index:2,int_val:4,accidental:"n"},"E#":{index:2,int_val:5,accidental:"#"},"E##":{index:2,int_val:6,accidental:"##"},EB:{index:2,int_val:3,accidental:"b"},EBB:{index:2,int_val:2,accidental:"bb"},F:{index:3,int_val:5},FN:{index:3,int_val:5,accidental:"n"},"F#":{index:3,int_val:6,accidental:"#"},"F##":{index:3,int_val:7,accidental:"##"},FB:{index:3,int_val:4,accidental:"b"},FBB:{index:3,int_val:3,accidental:"bb"},G:{index:4,int_val:7},GN:{index:4,int_val:7,accidental:"n"},"G#":{index:4,int_val:8,accidental:"#"},"G##":{index:4,int_val:9,accidental:"##"},GB:{index:4,int_val:6,accidental:"b"},GBB:{index:4,int_val:5,accidental:"bb"},A:{index:5,int_val:9},AN:{index:5,int_val:9,accidental:"n"},"A#":{index:5,int_val:10,accidental:"#"},"A##":{index:5,int_val:11,accidental:"##"},AB:{index:5,int_val:8,accidental:"b"},ABB:{index:5,int_val:7,accidental:"bb"},B:{index:6,int_val:11},BN:{index:6,int_val:11,accidental:"n"},"B#":{index:6,int_val:12,accidental:"#"},"B##":{index:6,int_val:13,accidental:"##"},BB:{index:6,int_val:10,accidental:"b"},BBB:{index:6,int_val:9,accidental:"bb"},R:{index:6,rest:!0},X:{index:6,accidental:"",octave:4,code:"noteheadXBlack",shift_right:5.5}}[a];if(!s)throw new h("BadArguments","Invalid key name: "+a);s.octave&&(o[1]=s.octave.toString());var c=parseInt(o[1],10),d=(7*(c+=-1*n.octave_shift)-28+s.index)/2,l=0;(d+=k.clefProperties(e).line_shift)<=0&&2*d%2==0&&(l=1),d>=6&&2*d%2==0&&(l=-1);var p=void 0!==s.int_val?12*c+s.int_val:void 0,u=s.code,f=s.shift_right,g={};if(o.length>2&&o[2]){var m=o[2].toUpperCase();g=C[m]||{}}return r({key:a,octave:c,line:d,int_value:p,accidental:s.accidental,code:u,stroke:l,shift_right:f,displaced:!1},g)},integerToNote:function(t){if(void 0===t)throw new h("BadArguments","Undefined integer for integerToNote");if(t<-2)throw new h("BadArguments","integerToNote requires integer > -2: "+t);var e={0:"C",1:"C#",2:"D",3:"D#",4:"E",5:"F",6:"F#",7:"G",8:"G#",9:"A",10:"A#",11:"B"}[t];if(!e)throw new h("BadArguments","Unknown note value for integer: "+t);return e},tabToGlyph:function(t,e){void 0===e&&(e=1);var i=void 0,n=0,o=0;if("X"===t.toString().toUpperCase()){var r=new S("accidentalDoubleSharp",k.DEFAULT_TABLATURE_FONT_SCALE).getMetrics();if(i="accidentalDoubleSharp",null==r.width||null==r.height)throw new h("InvalidMetrics","Width and height required");n=r.width,o=-r.height/2}else n=k.textWidth(t.toString());return{text:t,code:i,getWidth:function(){return n*e},shift_y:o}},textWidth:function(t){return 7*t.toString().length},articulationCodes:function(t){return{"a.":{code:"augmentationDot",between_lines:!0},av:{aboveCode:"articStaccatissimoAbove",belowCode:"articStaccatissimoBelow",between_lines:!0},"a>":{aboveCode:"articAccentAbove",belowCode:"articAccentBelow",between_lines:!0},"a-":{aboveCode:"articTenutoAbove",belowCode:"articTenutoBelow",between_lines:!0},"a^":{aboveCode:"articMarcatoAbove",belowCode:"articMarcatoBelow",between_lines:!1},"a+":{code:"pluckedLeftHandPizzicato",between_lines:!1},ao:{aboveCode:"pluckedSnapPizzicatoAbove",belowCode:"pluckedSnapPizzicatoBelow",between_lines:!1},ah:{code:"stringsHarmonic",between_lines:!1},"a@":{aboveCode:"fermataAbove",belowCode:"fermataBelow",between_lines:!1},"a@a":{code:"fermataAbove",between_lines:!1},"a@u":{code:"fermataBelow",between_lines:!1},"a|":{code:"stringsUpBow",between_lines:!1},am:{code:"stringsDownBow",between_lines:!1},"a,":{code:"pictChokeCymbal",between_lines:!1}}[t]},accidentalMap:P,accidentalCodes:function(t){return P[t]},accidentalColumnsTable:{1:{a:[1],b:[1]},2:{a:[1,2]},3:{a:[1,3,2],b:[1,2,1],second_on_bottom:[1,2,3]},4:{a:[1,3,4,2],b:[1,2,3,1],spaced_out_tetrachord:[1,2,1,2]},5:{a:[1,3,5,4,2],b:[1,2,4,3,1],spaced_out_pentachord:[1,2,3,2,1],very_spaced_out_pentachord:[1,2,1,2,1]},6:{a:[1,3,5,6,4,2],b:[1,2,4,5,3,1],spaced_out_hexachord:[1,3,2,1,3,2],very_spaced_out_hexachord:[1,2,1,2,1,2]}},ornamentCodes:function(t){return{mordent:{code:"ornamentShortTrill"},mordent_inverted:{code:"ornamentMordent"},turn:{code:"ornamentTurn"},turn_inverted:{code:"ornamentTurnSlash"},tr:{code:"ornamentTrill"},upprall:{code:"ornamentPrecompSlideTrillDAnglebert"},downprall:{code:"ornamentPrecompDoubleCadenceUpperPrefix"},prallup:{code:"ornamentPrecompTrillSuffixDandrieu"},pralldown:{code:"ornamentPrecompTrillLowerSuffix"},upmordent:{code:"ornamentPrecompSlideTrillBach"},downmordent:{code:"ornamentPrecompDoubleCadenceUpperPrefixTurn"},lineprall:{code:"ornamentPrecompAppoggTrill"},prallprall:{code:"ornamentTremblement"},scoop:{code:"brassScoop"},doit:{code:"brassDoitMedium"},fall:{code:"brassFallLipShort"},doitLong:{code:"brassLiftMedium"},fallLong:{code:"brassFallRoughMedium"},bend:{code:"brassBend"},plungerClosed:{code:"brassMuteClosed"},plungerOpen:{code:"brassMuteOpen"},flip:{code:"brassFlip"},jazzTurn:{code:"brassJazzTurn"},smear:{code:"brassSmear"}}[t]},keySignature:function(t){var e={C:{num:0},Am:{num:0},F:{acc:"b",num:1},Dm:{acc:"b",num:1},Bb:{acc:"b",num:2},Gm:{acc:"b",num:2},Eb:{acc:"b",num:3},Cm:{acc:"b",num:3},Ab:{acc:"b",num:4},Fm:{acc:"b",num:4},Db:{acc:"b",num:5},Bbm:{acc:"b",num:5},Gb:{acc:"b",num:6},Ebm:{acc:"b",num:6},Cb:{acc:"b",num:7},Abm:{acc:"b",num:7},G:{acc:"#",num:1},Em:{acc:"#",num:1},D:{acc:"#",num:2},Bm:{acc:"#",num:2},A:{acc:"#",num:3},"F#m":{acc:"#",num:3},E:{acc:"#",num:4},"C#m":{acc:"#",num:4},B:{acc:"#",num:5},"G#m":{acc:"#",num:5},"F#":{acc:"#",num:6},"D#m":{acc:"#",num:6},"C#":{acc:"#",num:7},"A#m":{acc:"#",num:7}}[t];if(!e)throw new h("BadKeySignature","Bad key signature spec: '"+t+"'");if(!e.acc)return[];for(var i={b:[2,.5,2.5,1,3,1.5,3.5],"#":[0,1.5,-.5,1,2.5,.5,2]}[e.acc],n=[],o=0;o<e.num;++o){var r=i[o];n.push({type:e.acc,line:r})}return n},unicode:{sharp:String.fromCharCode(parseInt("266F",16)),flat:String.fromCharCode(parseInt("266D",16)),natural:String.fromCharCode(parseInt("266E",16)),triangle:String.fromCharCode(parseInt("25B3",16)),"o-with-slash":String.fromCharCode(parseInt("00F8",16)),degrees:String.fromCharCode(parseInt("00B0",16)),circle:String.fromCharCode(parseInt("25CB",16))},sanitizeDuration:function(t){var e={w:"1",h:"2",q:"4",b:"256"}[t];if(void 0!==e&&(t=e),void 0===A[t])throw new h("BadArguments","The provided duration is not valid: "+t);return t},durationToFraction:function(t){return(new f).parse(k.sanitizeDuration(t))},durationToNumber:function(t){return k.durationToFraction(t).value()},durationToTicks:function(t){t=k.sanitizeDuration(t);var e=A[t];if(void 0===e)throw new h("InvalidDuration");return e},getGlyphProps:function(t,e){e=e||"n";var i={"1/2":{common:{stem:!1,stem_offset:0,flag:!1,stem_up_extension:-k.STEM_HEIGHT,stem_down_extension:-k.STEM_HEIGHT,tabnote_stem_up_extension:-k.STEM_HEIGHT,tabnote_stem_down_extension:-k.STEM_HEIGHT,dot_shiftY:0,line_above:0,line_below:0},type:{n:{code_head:"noteheadDoubleWhole",getWidth:function(t){return void 0===t&&(t=k.DEFAULT_NOTATION_FONT_SCALE),new S("noteheadDoubleWhole",t).getMetrics().width}},h:{code_head:"unpitchedPercussionClef1",getWidth:function(t){return void 0===t&&(t=k.DEFAULT_NOTATION_FONT_SCALE),new S("unpitchedPercussionClef1",t).getMetrics().width}},m:{code_head:"vexNoteHeadMutedBreve",stem_offset:0,getWidth:function(t){return void 0===t&&(t=k.DEFAULT_NOTATION_FONT_SCALE),new S("vexNoteHeadMutedBreve",t).getMetrics().width}},r:{code_head:"restDoubleWhole",rest:!0,position:"B/5",dot_shiftY:.5,getWidth:function(t){return void 0===t&&(t=k.DEFAULT_NOTATION_FONT_SCALE),new S("restDoubleWhole",t).getMetrics().width}},s:{getWidth:function(){return k.SLASH_NOTEHEAD_WIDTH},position:"B/4"}}},1:{common:{stem:!1,stem_offset:0,flag:!1,stem_up_extension:-k.STEM_HEIGHT,stem_down_extension:-k.STEM_HEIGHT,tabnote_stem_up_extension:-k.STEM_HEIGHT,tabnote_stem_down_extension:-k.STEM_HEIGHT,dot_shiftY:0,line_above:0,line_below:0},type:{n:{code_head:"noteheadWhole",getWidth:function(t){return void 0===t&&(t=k.DEFAULT_NOTATION_FONT_SCALE),new S("noteheadWhole",t).getMetrics().width}},h:{code_head:"noteheadDiamondWhole",getWidth:function(t){return void 0===t&&(t=k.DEFAULT_NOTATION_FONT_SCALE),new S("noteheadDiamondWhole",t).getMetrics().width}},m:{code_head:"noteheadXWhole",stem_offset:-3,getWidth:function(t){return void 0===t&&(t=k.DEFAULT_NOTATION_FONT_SCALE),new S("noteheadXWhole",t).getMetrics().width}},r:{code_head:"restWhole",rest:!0,position:"D/5",dot_shiftY:.5,getWidth:function(t){return void 0===t&&(t=k.DEFAULT_NOTATION_FONT_SCALE),new S("restWhole",t).getMetrics().width}},s:{getWidth:function(){return k.SLASH_NOTEHEAD_WIDTH},position:"B/4"}}},2:{common:{stem:!0,stem_offset:0,flag:!1,stem_up_extension:0,stem_down_extension:0,tabnote_stem_up_extension:0,tabnote_stem_down_extension:0,dot_shiftY:0,line_above:0,line_below:0},type:{n:{code_head:"noteheadHalf",getWidth:function(t){return void 0===t&&(t=k.DEFAULT_NOTATION_FONT_SCALE),new S("noteheadHalf",t).getMetrics().width}},h:{code_head:"noteheadDiamondHalf",getWidth:function(t){return void 0===t&&(t=k.DEFAULT_NOTATION_FONT_SCALE),new S("noteheadDiamondHalf",t).getMetrics().width}},m:{code_head:"noteheadXHalf",stem_offset:-3,getWidth:function(t){return void 0===t&&(t=k.DEFAULT_NOTATION_FONT_SCALE),new S("noteheadXHalf",t).getMetrics().width}},r:{code_head:"restHalf",stem:!1,rest:!0,position:"B/4",dot_shiftY:-.5,getWidth:function(t){return void 0===t&&(t=k.DEFAULT_NOTATION_FONT_SCALE),new S("restHalf",t).getMetrics().width}},s:{getWidth:function(){return k.SLASH_NOTEHEAD_WIDTH},position:"B/4"}}},4:{common:{stem:!0,stem_offset:0,flag:!1,stem_up_extension:0,stem_down_extension:0,tabnote_stem_up_extension:0,tabnote_stem_down_extension:0,dot_shiftY:0,line_above:0,line_below:0},type:{n:{code_head:"noteheadBlack",getWidth:function(t){return void 0===t&&(t=k.DEFAULT_NOTATION_FONT_SCALE),new S("noteheadBlack",t).getMetrics().width}},h:{code_head:"noteheadDiamondBlack",getWidth:function(t){return void 0===t&&(t=k.DEFAULT_NOTATION_FONT_SCALE),new S("noteheadDiamondBlack",t).getMetrics().width}},m:{code_head:"noteheadXBlack",getWidth:function(t){return void 0===t&&(t=k.DEFAULT_NOTATION_FONT_SCALE),new S("noteheadXBlack",t).getMetrics().width}},r:{code_head:"restQuarter",stem:!1,rest:!0,position:"B/4",dot_shiftY:-.5,line_above:1.5,line_below:1.5,getWidth:function(t){return void 0===t&&(t=k.DEFAULT_NOTATION_FONT_SCALE),new S("restQuarter",t).getMetrics().width}},s:{getWidth:function(){return k.SLASH_NOTEHEAD_WIDTH},position:"B/4"}}},8:{common:{stem:!0,stem_offset:0,flag:!0,beam_count:1,code_flag_upstem:"flag8thUp",code_flag_downstem:"flag8thDown",stem_up_extension:0,stem_down_extension:0,tabnote_stem_up_extension:0,tabnote_stem_down_extension:0,dot_shiftY:0,line_above:0,line_below:0},type:{n:{code_head:"noteheadBlack",getWidth:function(t){return void 0===t&&(t=k.DEFAULT_NOTATION_FONT_SCALE),new S("noteheadBlack",t).getMetrics().width}},h:{code_head:"noteheadDiamondBlack",getWidth:function(t){return void 0===t&&(t=k.DEFAULT_NOTATION_FONT_SCALE),new S("noteheadDiamondBlack",t).getMetrics().width}},m:{code_head:"noteheadXBlack",getWidth:function(t){return void 0===t&&(t=k.DEFAULT_NOTATION_FONT_SCALE),new S("noteheadXBlack",t).getMetrics().width}},r:{code_head:"rest8th",stem:!1,flag:!1,rest:!0,position:"B/4",dot_shiftY:-.5,line_above:1,line_below:1,getWidth:function(t){return void 0===t&&(t=k.DEFAULT_NOTATION_FONT_SCALE),new S("rest8th",t).getMetrics().width}},s:{getWidth:function(){return k.SLASH_NOTEHEAD_WIDTH},position:"B/4"}}},16:{common:{beam_count:2,stem:!0,stem_offset:0,flag:!0,code_flag_upstem:"flag16thUp",code_flag_downstem:"flag16thDown",stem_up_extension:0,stem_down_extension:0,tabnote_stem_up_extension:0,tabnote_stem_down_extension:0,dot_shiftY:0,line_above:0,line_below:0},type:{n:{code_head:"noteheadBlack",getWidth:function(t){return void 0===t&&(t=k.DEFAULT_NOTATION_FONT_SCALE),new S("noteheadBlack",t).getMetrics().width}},h:{code_head:"noteheadDiamondBlack",getWidth:function(t){return void 0===t&&(t=k.DEFAULT_NOTATION_FONT_SCALE),new S("noteheadDiamondBlack",t).getMetrics().width}},m:{code_head:"noteheadXBlack",getWidth:function(t){return void 0===t&&(t=k.DEFAULT_NOTATION_FONT_SCALE),new S("noteheadXBlack",t).getMetrics().width}},r:{code_head:"rest16th",stem:!1,flag:!1,rest:!0,position:"B/4",dot_shiftY:-.5,line_above:1,line_below:2,getWidth:function(t){return void 0===t&&(t=k.DEFAULT_NOTATION_FONT_SCALE),new S("rest16th",t).getMetrics().width}},s:{getWidth:function(){return k.SLASH_NOTEHEAD_WIDTH},position:"B/4"}}},32:{common:{beam_count:3,stem:!0,stem_offset:0,flag:!0,code_flag_upstem:"flag32ndUp",code_flag_downstem:"flag32ndDown",stem_up_extension:9,stem_down_extension:9,tabnote_stem_up_extension:8,tabnote_stem_down_extension:5,dot_shiftY:0,line_above:0,line_below:0},type:{n:{code_head:"noteheadBlack",getWidth:function(t){return void 0===t&&(t=k.DEFAULT_NOTATION_FONT_SCALE),new S("noteheadBlack",t).getMetrics().width}},h:{code_head:"noteheadDiamondBlack",getWidth:function(t){return void 0===t&&(t=k.DEFAULT_NOTATION_FONT_SCALE),new S("noteheadDiamondBlack",t).getMetrics().width}},m:{code_head:"noteheadXBlack",getWidth:function(t){return void 0===t&&(t=k.DEFAULT_NOTATION_FONT_SCALE),new S("noteheadXBlack",t).getMetrics().width}},r:{code_head:"rest32nd",stem:!1,flag:!1,rest:!0,position:"B/4",dot_shiftY:-1.5,line_above:2,line_below:2,getWidth:function(t){return void 0===t&&(t=k.DEFAULT_NOTATION_FONT_SCALE),new S("rest32nd",t).getMetrics().width}},s:{getWidth:function(){return k.SLASH_NOTEHEAD_WIDTH},position:"B/4"}}},64:{common:{beam_count:4,stem:!0,stem_offset:0,flag:!0,code_flag_upstem:"flag64thUp",code_flag_downstem:"flag64thDown",stem_up_extension:13,stem_down_extension:13,tabnote_stem_up_extension:12,tabnote_stem_down_extension:9,dot_shiftY:0,line_above:0,line_below:0},type:{n:{code_head:"noteheadBlack",getWidth:function(t){return void 0===t&&(t=k.DEFAULT_NOTATION_FONT_SCALE),new S("noteheadBlack",t).getMetrics().width}},h:{code_head:"noteheadDiamondBlack",getWidth:function(t){return void 0===t&&(t=k.DEFAULT_NOTATION_FONT_SCALE),new S("noteheadDiamondBlack",t).getMetrics().width}},m:{code_head:"noteheadXBlack",getWidth:function(t){return void 0===t&&(t=k.DEFAULT_NOTATION_FONT_SCALE),new S("noteheadXBlack",t).getMetrics().width}},r:{code_head:"rest64th",stem:!1,flag:!1,rest:!0,position:"B/4",dot_shiftY:-1.5,line_above:2,line_below:3,getWidth:function(t){return void 0===t&&(t=k.DEFAULT_NOTATION_FONT_SCALE),new S("rest64th",t).getMetrics().width}},s:{getWidth:function(){return k.SLASH_NOTEHEAD_WIDTH},position:"B/4"}}},128:{common:{beam_count:5,stem:!0,stem_offset:0,flag:!0,code_flag_upstem:"flag128thUp",code_flag_downstem:"flag128thDown",stem_up_extension:22,stem_down_extension:22,tabnote_stem_up_extension:21,tabnote_stem_down_extension:18,dot_shiftY:0,line_above:0,line_below:0},type:{n:{code_head:"noteheadBlack",getWidth:function(t){return void 0===t&&(t=k.DEFAULT_NOTATION_FONT_SCALE),new S("noteheadBlack",t).getMetrics().width}},h:{code_head:"noteheadDiamondBlack",getWidth:function(t){return void 0===t&&(t=k.DEFAULT_NOTATION_FONT_SCALE),new S("noteheadDiamondBlack",t).getMetrics().width}},m:{code_head:"noteheadXBlack",getWidth:function(t){return void 0===t&&(t=k.DEFAULT_NOTATION_FONT_SCALE),new S("noteheadXBlack",t).getMetrics().width}},r:{code_head:"rest128th",stem:!1,flag:!1,rest:!0,position:"B/4",dot_shiftY:1.5,line_above:3,line_below:3,getWidth:function(t){return void 0===t&&(t=k.DEFAULT_NOTATION_FONT_SCALE),new S("rest128th",t).getMetrics().width}},s:{getWidth:function(){return k.SLASH_NOTEHEAD_WIDTH},position:"B/4"}}}}[t=k.sanitizeDuration(t)];if(void 0!==i){var n=i.type[e];if(void 0===n){var o=C[e.toUpperCase()];if(void 0===o)return;n=r({code_head:o.code},o)}return r(r({},i.common),n)}},validTypes:{n:{name:"note"},r:{name:"rest"},h:{name:"harmonic"},m:{name:"muted"},s:{name:"slash"}},TIME4_4:{num_beats:4,beat_value:4,resolution:E}},D=function(){function t(){}return Object.defineProperty(t,"NUM_TONES",{get:function(){return this.canonical_notes.length},enumerable:!1,configurable:!0}),Object.defineProperty(t,"roots",{get:function(){return["c","d","e","f","g","a","b"]},enumerable:!1,configurable:!0}),Object.defineProperty(t,"root_values",{get:function(){return[0,2,4,5,7,9,11]},enumerable:!1,configurable:!0}),Object.defineProperty(t,"root_indices",{get:function(){return{c:0,d:1,e:2,f:3,g:4,a:5,b:6}},enumerable:!1,configurable:!0}),Object.defineProperty(t,"canonical_notes",{get:function(){return["c","c#","d","d#","e","f","f#","g","g#","a","a#","b"]},enumerable:!1,configurable:!0}),Object.defineProperty(t,"diatonic_intervals",{get:function(){return["unison","m2","M2","m3","M3","p4","dim5","p5","m6","M6","b7","M7","octave"]},enumerable:!1,configurable:!0}),Object.defineProperty(t,"diatonic_accidentals",{get:function(){return{unison:{note:0,accidental:0},m2:{note:1,accidental:-1},M2:{note:1,accidental:0},m3:{note:2,accidental:-1},M3:{note:2,accidental:0},p4:{note:3,accidental:0},dim5:{note:4,accidental:-1},p5:{note:4,accidental:0},m6:{note:5,accidental:-1},M6:{note:5,accidental:0},b7:{note:6,accidental:-1},M7:{note:6,accidental:0},octave:{note:7,accidental:0}}},enumerable:!1,configurable:!0}),Object.defineProperty(t,"intervals",{get:function(){return{u:0,unison:0,m2:1,b2:1,min2:1,S:1,H:1,2:2,M2:2,maj2:2,T:2,W:2,m3:3,b3:3,min3:3,M3:4,3:4,maj3:4,4:5,p4:5,"#4":6,b5:6,aug4:6,dim5:6,5:7,p5:7,"#5":8,b6:8,aug5:8,6:9,M6:9,maj6:9,b7:10,m7:10,min7:10,dom7:10,M7:11,maj7:11,8:12,octave:12}},enumerable:!1,configurable:!0}),Object.defineProperty(t,"scales",{get:function(){return{major:[2,2,1,2,2,2,1],minor:[2,1,2,2,1,2,2],ionian:[2,2,1,2,2,2,1],dorian:[2,1,2,2,2,1,2],phyrgian:[1,2,2,2,1,2,2],lydian:[2,2,2,1,2,2,1],mixolydian:[2,2,1,2,2,1,2],aeolian:[2,1,2,2,1,2,2],locrian:[1,2,2,1,2,2,2]}},enumerable:!1,configurable:!0}),Object.defineProperty(t,"scaleTypes",{get:function(){return{M:t.scales.major,m:t.scales.minor}},enumerable:!1,configurable:!0}),Object.defineProperty(t,"accidentals",{get:function(){return["bb","b","n","#","##"]},enumerable:!1,configurable:!0}),t.prototype.isValidNoteValue=function(e){return e>=0&&e<t.canonical_notes.length},t.prototype.isValidIntervalValue=function(e){return e>=0&&e<t.diatonic_intervals.length},t.prototype.getNoteParts=function(t){if(!t||t.length<1)throw new h("BadArguments","Invalid note name: "+t);if(t.length>3)throw new h("BadArguments","Invalid note name: "+t);var e=t.toLowerCase(),i=/^([cdefgab])(b|bb|n|#|##)?$/.exec(e);if(null!==i)return{root:i[1],accidental:i[2]};throw new h("BadArguments","Invalid note name: "+t)},t.prototype.getKeyParts=function(t){if(!t||t.length<1)throw new h("BadArguments","Invalid key: "+t);var e=t.toLowerCase(),i=/^([cdefgab])(b|#)?(mel|harm|m|M)?$/.exec(e);if(null!==i){var n=i[1],o=i[2],r=i[3];return r||(r="M"),{root:n,accidental:o,type:r}}throw new h("BadArguments","Invalid key: "+t)},t.prototype.getNoteValue=function(t){var e=k.keyProperties(t.toUpperCase()+"/0");if(void 0===e||void 0===e.int_value)throw new h("BadArguments","Invalid note name: "+t);return e.int_value},t.prototype.getIntervalValue=function(e){var i=t.intervals[e];if(void 0===i)throw new h("BadArguments","Invalid interval name: "+e);return i},t.prototype.getCanonicalNoteName=function(e){if(!this.isValidNoteValue(e))throw new h("BadArguments","Invalid note value: "+e);return t.canonical_notes[e]},t.prototype.getCanonicalIntervalName=function(e){if(!this.isValidIntervalValue(e))throw new h("BadArguments","Invalid interval value: "+e);return t.diatonic_intervals[e]},t.prototype.getRelativeNoteValue=function(e,i,n){if(void 0===n&&(n=1),1!==n&&-1!==n)throw new h("BadArguments","Invalid direction: "+n);var o=(e+n*i)%t.NUM_TONES;return o<0&&(o+=t.NUM_TONES),o},t.prototype.getRelativeNoteName=function(e,i){var n=this.getNoteParts(e),o=this.getNoteValue(n.root),r=i-o;if(Math.abs(r)>t.NUM_TONES-3){var a=1;r>0&&(a=-1);var s=(i+1+(o+1))%t.NUM_TONES*a;if(Math.abs(s)>2)throw new h("BadArguments","Notes not related: "+e+", "+i+")");r=s}if(Math.abs(r)>2)throw new h("BadArguments","Notes not related: "+e+", "+i+")");var c=n.root;if(r>0)for(var d=1;d<=r;++d)c+="#";else if(r<0)for(d=-1;d>=r;--d)c+="b";return c},t.prototype.getScaleTones=function(t,e){for(var i=[t],n=t,o=0;o<e.length;o+=1)(n=this.getRelativeNoteValue(n,e[o]))!==t&&i.push(n);return i},t.prototype.getIntervalBetween=function(e,i,n){if(void 0===n&&(n=1),1!==n&&-1!==n)throw new h("BadArguments","Invalid direction: "+n);if(!this.isValidNoteValue(e)||!this.isValidNoteValue(i))throw new h("BadArguments","Invalid notes: "+e+", "+i);var o=1===n?i-e:e-i;return o<0&&(o+=t.NUM_TONES),o},t.prototype.createScaleMap=function(e){var i=this.getKeyParts(e);if(!i.type)throw new h("BadArguments","Unsupported key type: undefined");var n=t.scaleTypes[i.type],o=i.root;if(i.accidental&&(o+=i.accidental),!n)throw new h("BadArguments","Unsupported key type: "+e);for(var r=this.getScaleTones(this.getNoteValue(o),n),a=t.root_indices[i.root],s={},c=0;c<t.roots.length;++c){var d=(a+c)%t.roots.length,l=t.roots[d],p=this.getRelativeNoteName(l,r[c]);1===p.length&&(p+="n"),s[l]=p}return s},t}();!function(t){t[t.CENTER=0]="CENTER",t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT",t[t.ABOVE=3]="ABOVE",t[t.BELOW=4]="BELOW"}(b||(b={}));var F=function(t){function e(){var i=t.call(this)||this;return i.setAttribute("type","Modifier"),i.width=0,i.text_line=0,i.position=e.Position.LEFT,i.x_shift=0,i.y_shift=0,i.spacingFromNextModifier=0,i}return o(e,t),Object.defineProperty(e,"CATEGORY",{get:function(){return"none"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"Position",{get:function(){return b},enumerable:!1,configurable:!0}),Object.defineProperty(e,"PositionString",{get:function(){return{center:e.Position.CENTER,above:e.Position.ABOVE,below:e.Position.BELOW,left:e.Position.LEFT,right:e.Position.RIGHT}},enumerable:!1,configurable:!0}),e.prototype.reset=function(){},e.prototype.getCategory=function(){return e.CATEGORY},e.prototype.getWidth=function(){return this.width},e.prototype.setWidth=function(t){return this.width=t,this},e.prototype.getNote=function(){if(!this.note)throw new h("NoNote","Modifier has no note.");return this.note},e.prototype.checkAttachedNote=function(){if(!this.note||void 0===this.index)throw new h("NoAttachedNote","Can't draw "+this.getCategory()+" without a note and index.");return this.note},e.prototype.setNote=function(t){return this.note=t,this},e.prototype.getIndex=function(){return this.index},e.prototype.checkIndex=function(){if(void 0===this.index)throw new h("NoIndex","Modifier has an invalid index.");return this.index},e.prototype.setIndex=function(t){return this.index=t,this},e.prototype.getModifierContext=function(){return this.modifier_context},e.prototype.checkModifierContext=function(){if(!this.modifier_context)throw new h("NoModifierContext","Modifier Context Required");return this.modifier_context},e.prototype.setModifierContext=function(t){return this.modifier_context=t,this},e.prototype.getPosition=function(){return this.position},e.prototype.setPosition=function(t){return this.position="string"==typeof t?e.PositionString[t]:t,this.reset(),this},e.prototype.setTextLine=function(t){return this.text_line=t,this},e.prototype.setYShift=function(t){return this.y_shift=t,this},e.prototype.setSpacingFromNextModifier=function(t){this.spacingFromNextModifier=t},e.prototype.getSpacingFromNextModifier=function(){return this.spacingFromNextModifier},e.prototype.setXShift=function(t){return this.x_shift=0,this.position===e.Position.LEFT?this.x_shift-=t:this.x_shift+=t,this},e.prototype.getXShift=function(){return this.x_shift},e.prototype.draw=function(){throw this.checkContext(),new h("MethodNotImplemented","draw() not implemented for this modifier.")},e.prototype.alignSubNotesWithNote=function(t,e){var i=e.getTickContext(),n=i.getMetrics(),o=e.getStave(),r=i.getX()-n.modLeftPx-n.modRightPx+this.getSpacingFromNextModifier();t.forEach((function(t){var e=t.getTickContext();o&&t.setStave(o),e.setXOffset(r)}))},e}(y);function N(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];M.DEBUG&&d("Vex.Flow.Stem",t)}var M=function(t){function e(e){var i=t.call(this)||this;return i.stem_up_y_offset=0,i.stem_down_y_offset=0,i.stem_up_y_base_offset=0,i.stem_down_y_base_offset=0,i.setAttribute("type","Stem"),i.x_begin=(null==e?void 0:e.x_begin)||0,i.x_end=(null==e?void 0:e.x_end)||0,i.y_top=(null==e?void 0:e.y_top)||0,i.y_bottom=(null==e?void 0:e.y_bottom)||0,i.stem_extension=(null==e?void 0:e.stem_extension)||0,i.stem_direction=(null==e?void 0:e.stem_direction)||0,i.hide=(null==e?void 0:e.hide)||!1,i.isStemlet=(null==e?void 0:e.isStemlet)||!1,i.stemletHeight=(null==e?void 0:e.stemletHeight)||0,i.renderHeightAdjustment=0,i.setOptions(e),i}return o(e,t),Object.defineProperty(e,"CATEGORY",{get:function(){return"stem"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"UP",{get:function(){return 1},enumerable:!1,configurable:!0}),Object.defineProperty(e,"DOWN",{get:function(){return-1},enumerable:!1,configurable:!0}),Object.defineProperty(e,"WIDTH",{get:function(){return ei.STEM_WIDTH},enumerable:!1,configurable:!0}),Object.defineProperty(e,"HEIGHT",{get:function(){return ei.STEM_HEIGHT},enumerable:!1,configurable:!0}),e.prototype.setOptions=function(t){this.stem_up_y_offset=(null==t?void 0:t.stem_up_y_offset)||0,this.stem_down_y_offset=(null==t?void 0:t.stem_down_y_offset)||0,this.stem_up_y_base_offset=(null==t?void 0:t.stem_up_y_base_offset)||0,this.stem_down_y_base_offset=(null==t?void 0:t.stem_down_y_base_offset)||0},e.prototype.setNoteHeadXBounds=function(t,e){return this.x_begin=t,this.x_end=e,this},e.prototype.setDirection=function(t){this.stem_direction=t},e.prototype.setExtension=function(t){this.stem_extension=t},e.prototype.getExtension=function(){return this.stem_extension},e.prototype.setYBounds=function(t,e){this.y_top=t,this.y_bottom=e},e.prototype.getCategory=function(){return e.CATEGORY},e.prototype.getHeight=function(){var t=this.stem_direction===e.UP?this.stem_up_y_offset:this.stem_down_y_offset;return(this.y_bottom-this.y_top+(e.HEIGHT-t+this.stem_extension))*this.stem_direction},e.prototype.getBoundingBox=function(){throw new h("NotImplemented","getBoundingBox() not implemented.")},e.prototype.getExtents=function(){var t=this.stem_direction===e.UP,i=[this.y_top,this.y_bottom],n=e.HEIGHT+this.stem_extension,o=(t?Math.min:Math.max).apply(void 0,i),r=(t?Math.max:Math.min).apply(void 0,i);return{topY:o+n*-this.stem_direction,baseY:r}},e.prototype.setVisibility=function(t){return this.hide=!t,this},e.prototype.setStemlet=function(t,e){return this.isStemlet=t,this.stemletHeight=e,this},e.prototype.adjustHeightForFlag=function(){this.renderHeightAdjustment=this.musicFont.lookupMetric("stem.heightAdjustmentForFlag",-3)},e.prototype.adjustHeightForBeam=function(){this.renderHeightAdjustment=-e.WIDTH/2},e.prototype.draw=function(){if(this.setRendered(),!this.hide){var t,i,n=this.checkContext(),o=this.stem_direction,r=0;o===e.DOWN?(t=this.x_begin,i=this.y_top+this.stem_down_y_offset,r=this.stem_down_y_base_offset):(t=this.x_end,i=this.y_bottom-this.stem_up_y_offset,r=this.stem_up_y_base_offset);var a=this.getHeight();N("Rendering stem - ","Top Y: ",this.y_top,"Bottom Y: ",this.y_bottom);var s=this.isStemlet?a-this.stemletHeight*this.stem_direction:0;n.save(),this.applyStyle(n),n.beginPath(),n.setLineWidth(e.WIDTH),n.moveTo(t,i-s+r),n.lineTo(t,i-a-this.renderHeightAdjustment*o),n.stroke(),this.restoreStyle(n),n.restore()}},e}(y),B=function(t){function e(i,n){var o=t.call(this)||this;if(o.numerator_glyphs=[],o.denom_glyphs=[],o.setAttribute("type","Tuplet"),!i||!i.length)throw new h("BadArguments","No notes provided for tuplet.");return o.options=r({},n),o.notes=i,o.num_notes=null!=o.options.num_notes?o.options.num_notes:i.length,o.options.beats_occupied&&o.beatsOccupiedDeprecationWarning(),o.notes_occupied=o.options.notes_occupied||o.options.beats_occupied||2,null!=o.options.bracketed?o.bracketed=o.options.bracketed:o.bracketed=i.some((function(t){return!t.hasBeam()})),o.ratioed=null!=o.options.ratioed?o.options.ratioed:Math.abs(o.notes_occupied-o.num_notes)>1,o.point=o.musicFont.lookupMetric("digits.tupletPoint"),o.y_pos=16,o.x_pos=100,o.width=200,o.location=o.options.location||e.LOCATION_TOP,ee.AlignRestsToNotes(i,!0,!0),o.resolveGlyphs(),o.attach(),o}return o(e,t),Object.defineProperty(e,"LOCATION_TOP",{get:function(){return 1},enumerable:!1,configurable:!0}),Object.defineProperty(e,"LOCATION_BOTTOM",{get:function(){return-1},enumerable:!1,configurable:!0}),Object.defineProperty(e,"NESTING_OFFSET",{get:function(){return 15},enumerable:!1,configurable:!0}),e.prototype.attach=function(){for(var t=0;t<this.notes.length;t++){this.notes[t].setTuplet(this)}},e.prototype.detach=function(){for(var t=0;t<this.notes.length;t++){this.notes[t].resetTuplet(this)}},e.prototype.setBracketed=function(t){return this.bracketed=!!t,this},e.prototype.setRatioed=function(t){return this.ratioed=!!t,this},e.prototype.setTupletLocation=function(t){if(t){if(t!==e.LOCATION_TOP&&t!==e.LOCATION_BOTTOM)throw new h("BadArgument","Invalid tuplet location: "+t)}else t=e.LOCATION_TOP;return this.location=t,this},e.prototype.getNotes=function(){return this.notes},e.prototype.getNoteCount=function(){return this.num_notes},e.prototype.beatsOccupiedDeprecationWarning=function(){var t=["beats_occupied has been deprecated as an ","option for tuplets. Please use notes_occupied ","instead. Calls to getBeatsOccupied and ","setBeatsOccupied should now be routed to ","getNotesOccupied and setNotesOccupied instead"].join("");console&&console.warn?console.warn(t):console&&console.log(t)},e.prototype.getBeatsOccupied=function(){return this.beatsOccupiedDeprecationWarning(),this.getNotesOccupied()},e.prototype.setBeatsOccupied=function(t){return this.beatsOccupiedDeprecationWarning(),this.setNotesOccupied(t)},e.prototype.getNotesOccupied=function(){return this.notes_occupied},e.prototype.setNotesOccupied=function(t){this.detach(),this.notes_occupied=t,this.resolveGlyphs(),this.attach()},e.prototype.resolveGlyphs=function(){this.numerator_glyphs=[];for(var t=this.num_notes;t>=1;)this.numerator_glyphs.unshift(new S("timeSig"+t%10,this.point)),t=parseInt((t/10).toString(),10);for(this.denom_glyphs=[],t=this.notes_occupied;t>=1;)this.denom_glyphs.unshift(new S("timeSig"+t%10,this.point)),t=parseInt((t/10).toString(),10)},e.prototype.getNestedTupletCount=function(){var t=this.location,e=this.notes[0],i=o(e,t),n=o(e,t);function o(t,e){return t.tupletStack.filter((function(t){return t.location===e})).length}return this.notes.forEach((function(e){var r=o(e,t);i=r>i?r:i,n=r<n?r:n})),i-n},e.prototype.getYPosition=function(){var t,i=this.getNestedTupletCount()*e.NESTING_OFFSET*-this.location,n=this.options.y_offset||0,o=this.notes[0];if(this.location===e.LOCATION_TOP){t=o.checkStave().getYForLine(0)-15;for(var r=0;r<this.notes.length;++r){var a=this.notes[r].getStemDirection()===M.UP?this.notes[r].getStemExtents().topY-10:this.notes[r].getStemExtents().baseY-20;a<t&&(t=a)}}else{t=o.checkStave().getYForLine(4)+20;for(r=0;r<this.notes.length;++r){var s=this.notes[r].getStemDirection()===M.UP?this.notes[r].getStemExtents().baseY+20:this.notes[r].getStemExtents().topY+10;s>t&&(t=s)}}return t+i+n},e.prototype.draw=function(){var t=this,i=this.checkContext();this.setRendered();var n=this.notes[0],o=this.notes[this.notes.length-1];this.bracketed?(this.x_pos=n.getTieLeftX()-5,this.width=o.getTieRightX()-this.x_pos+5):(this.x_pos=n.getStemX(),this.width=o.getStemX()-this.x_pos),this.y_pos=this.getYPosition();var r=function(t,e){return t+c(e.getMetrics().width)},a=this.numerator_glyphs.reduce(r,0);this.ratioed&&(a=this.denom_glyphs.reduce(r,a),a+=.32*this.point);var s=this.x_pos+this.width/2-a/2;if(this.bracketed){var h=this.width/2-a/2-5;h>0&&(i.fillRect(this.x_pos,this.y_pos,h,1),i.fillRect(this.x_pos+this.width/2+a/2+5,this.y_pos,h,1),i.fillRect(this.x_pos,this.y_pos+(this.location===e.LOCATION_BOTTOM?1:0),1,10*this.location),i.fillRect(this.x_pos+this.width,this.y_pos+(this.location===e.LOCATION_BOTTOM?1:0),1,10*this.location))}var d=this.musicFont.lookupMetric("digits.shiftY",0),l=0;if(this.numerator_glyphs.forEach((function(e){e.render(i,s+l,t.y_pos+t.point/3-2+d),l+=c(e.getMetrics().width)})),this.ratioed){var p=s+l+.16*this.point,u=.06*this.point;i.beginPath(),i.arc(p,this.y_pos-.08*this.point,u,0,2*Math.PI,!0),i.closePath(),i.fill(),i.beginPath(),i.arc(p,this.y_pos+.12*this.point,u,0,2*Math.PI,!0),i.closePath(),i.fill(),l+=.32*this.point,this.denom_glyphs.forEach((function(e){e.render(i,s+l,t.y_pos+t.point/3-2+d),l+=c(e.getMetrics().width)}))}},e}(y),O=function(t){function e(){var e=t.call(this)||this;return e.setAttribute("type","Tickable"),e.ticks=new f(0,1),e.intrinsicTicks=0,e.tickMultiplier=new f(1,1),e.width=0,e.x_shift=0,e.modifiers=[],e.preFormatted=!1,e.postFormatted=!1,e.tupletStack=[],e.align_center=!1,e.center_x_shift=0,e.ignore_ticks=!1,e.formatterMetrics={freedom:{left:0,right:0},duration:"",iterations:0,space:{used:0,mean:0,deviation:0}},e}return o(e,t),e.prototype.reset=function(){return this},e.prototype.getTicks=function(){return this.ticks},e.prototype.shouldIgnoreTicks=function(){return this.ignore_ticks},e.prototype.setIgnoreTicks=function(t){this.ignore_ticks=t},e.prototype.setWidth=function(t){this.width=t},e.prototype.getWidth=function(){if(!this.preFormatted)throw new h("UnformattedNote","Can't call GetWidth on an unformatted note.");return this.width+(this.modifierContext?this.modifierContext.getWidth():0)},e.prototype.setXShift=function(t){return this.x_shift=t,this},e.prototype.getXShift=function(){return this.x_shift},e.prototype.getX=function(){if(!this.tickContext)throw new h("NoTickContext","Note needs a TickContext assigned for an X-Value");return this.tickContext.getX()+this.x_shift},e.prototype.getFormatterMetrics=function(){return this.formatterMetrics},e.prototype.getCenterXShift=function(){return this.isCenterAligned()?this.center_x_shift:0},e.prototype.setCenterXShift=function(t){return this.center_x_shift=t,this},e.prototype.isCenterAligned=function(){return this.align_center},e.prototype.setCenterAlignment=function(t){return this.align_center=t,this},e.prototype.getVoice=function(){if(!this.voice)throw new h("NoVoice","Tickable has no voice.");return this.voice},e.prototype.setVoice=function(t){this.voice=t},e.prototype.getTuplet=function(){return this.tuplet},e.prototype.resetTuplet=function(t){var e,i;if(t){var n=this.tupletStack.indexOf(t);return-1!==n&&(this.tupletStack.splice(n,1),e=t.getNoteCount(),i=t.getNotesOccupied(),this.applyTickMultiplier(e,i)),this}for(;this.tupletStack.length;)e=(t=this.tupletStack.pop()).getNoteCount(),i=t.getNotesOccupied(),this.applyTickMultiplier(e,i);return this},e.prototype.setTuplet=function(t){if(t){this.tupletStack.push(t);var e=t.getNoteCount(),i=t.getNotesOccupied();this.applyTickMultiplier(i,e)}return this.tuplet=t,this},e.prototype.addToModifierContext=function(t){this.modifierContext=t,this.preFormatted=!1},e.prototype.addModifier=function(t){return this.modifiers.push(t),this.preFormatted=!1,this},e.prototype.getModifiers=function(){return this.modifiers},e.prototype.setTickContext=function(t){this.tickContext=t,this.preFormatted=!1},e.prototype.preFormat=function(){this.preFormatted||(this.width=0,this.modifierContext&&(this.modifierContext.preFormat(),this.width+=this.modifierContext.getWidth()))},e.prototype.postFormat=function(){return this.postFormatted||(this.postFormatted=!0),this},e.prototype.getIntrinsicTicks=function(){return this.intrinsicTicks},e.prototype.setIntrinsicTicks=function(t){this.intrinsicTicks=t,this.ticks=this.tickMultiplier.clone().multiply(this.intrinsicTicks)},e.prototype.getTickMultiplier=function(){return this.tickMultiplier},e.prototype.applyTickMultiplier=function(t,e){this.tickMultiplier.multiply(t,e),this.ticks=this.tickMultiplier.clone().multiply(this.intrinsicTicks)},e.prototype.setDuration=function(t){var e=t.numerator*(ei.RESOLUTION/t.denominator);this.ticks=this.tickMultiplier.clone().multiply(e),this.intrinsicTicks=this.ticks.value()},e}(y),R=function(t){function e(i){var n=t.call(this)||this;if(n.setAttribute("type","Note"),!i)throw new h("BadArguments","Note must have valid initialization data to identify duration and type.");var o=e.parseNoteStruct(i);if(!o)throw new h("BadArguments","Invalid note initialization object: "+JSON.stringify(i));return n.keys=i.keys||[],n.keyProps=[],n.duration=o.duration,n.dots=o.dots,n.noteType=o.type,n.customTypes=o.customTypes,i.duration_override?n.setDuration(i.duration_override):n.setIntrinsicTicks(o.ticks),n.modifiers=[],n.glyph=ei.getGlyphProps(n.duration,n.noteType),n.customGlyphs=n.customTypes.map((function(t){return ei.getGlyphProps(n.duration,t)})),n.playNote=void 0,n.ignore_ticks=!1,n.width=0,n.leftDisplacedHeadPx=0,n.rightDisplacedHeadPx=0,n.x_shift=0,n.preFormatted=!1,n.ys=[],i.align_center&&n.setCenterAlignment(i.align_center),n.render_options={annotation_spacing:5,glyph_font_scale:1,stroke_px:1,scale:1,font:"",y_shift:0},n}return o(e,t),Object.defineProperty(e,"CATEGORY",{get:function(){return"note"},enumerable:!1,configurable:!0}),e.plotMetrics=function(t,e,i){var n=e.getMetrics(),o=e.getAbsoluteX()-n.modLeftPx-n.leftDisplacedHeadPx,r=e.getAbsoluteX()-n.leftDisplacedHeadPx,a=e.getAbsoluteX(),s=e.getAbsoluteX()+n.notePx,h=e.getAbsoluteX()+n.notePx+n.rightDisplacedHeadPx,c=e.getAbsoluteX()+n.notePx+n.rightDisplacedHeadPx+n.modRightPx,d=c+(e.getFormatterMetrics().freedom.right||0),l=c-o;t.save(),t.setFont("Arial",8,""),t.fillText(Math.round(l)+"px",o+e.getXShift(),i);var p=i+7;function u(i,n,o,r){void 0===r&&(r=p),t.beginPath(),t.setStrokeStyle(o),t.setFillStyle(o),t.setLineWidth(3),t.moveTo(i+e.getXShift(),r),t.lineTo(n+e.getXShift(),r),t.stroke()}u(o,r,"red"),u(r,a,"#999"),u(a,s,"green"),u(s,h,"#999"),u(h,c,"red"),u(c,d,"#DD0"),u(o-e.getXShift(),o,"#BBB"),function(t,e,i,n){void 0===n&&(n="#55"),t.save(),t.setFillStyle(n),t.beginPath(),t.arc(e,i,3,0,2*Math.PI,!0),t.closePath(),t.fill(),t.restore()}(t,a+e.getXShift(),p,"blue");var f=e.getFormatterMetrics();if(f.iterations>0){var g=f.space.deviation,m=g>=0?"+":"";t.setFillStyle("red"),t.fillText(m+Math.round(g),a+e.getXShift(),i-10)}t.restore()},e.parseDuration=function(t){var e=/(\d*\/?\d+|[a-z])(d*)([nrhms]|$)/.exec(t);if(e)return{duration:e[1],dots:e[2].length,type:e[3]||"n"}},e.parseNoteStruct=function(t){var i=t.duration,n=[],o=e.parseDuration(i);if(o){var r=t.type;if(!r||ei.validTypes[r]){r||(r=o.type||"n",void 0!==t.keys&&t.keys.forEach((function(t,e){var i=t.split("/");n[e]=i&&3===i.length?i[2]:r})));var a=ei.durationToTicks(o.duration);if(a){var s=t.dots?t.dots:o.dots;if("number"==typeof s){for(var h=a,c=0;c<s;c++){if(h<=1)return;a+=h/=2}return{duration:o.duration,type:r,customTypes:n,dots:s,ticks:a}}}}}},e.prototype.getPlayNote=function(){return this.playNote},e.prototype.setPlayNote=function(t){return this.playNote=t,this},e.prototype.isRest=function(){return!1},e.prototype.addStroke=function(t,e){return e.setNote(this),e.setIndex(t),this.modifiers.push(e),this.setPreFormatted(!1),this},e.prototype.getStave=function(){return this.stave},e.prototype.checkStave=function(){if(!this.stave)throw new h("NoStave","No stave attached to instance");return this.stave},e.prototype.setStave=function(t){return this.stave=t,this.setYs([t.getYForLine(0)]),this.setContext(this.stave.getContext()),this},e.prototype.getCategory=function(){return e.CATEGORY},e.prototype.getLeftDisplacedHeadPx=function(){return this.leftDisplacedHeadPx},e.prototype.getRightDisplacedHeadPx=function(){return this.rightDisplacedHeadPx},e.prototype.setLeftDisplacedHeadPx=function(t){return this.leftDisplacedHeadPx=t,this},e.prototype.setRightDisplacedHeadPx=function(t){return this.rightDisplacedHeadPx=t,this},e.prototype.shouldIgnoreTicks=function(){return this.ignore_ticks},e.prototype.getLineNumber=function(t){return 0},e.prototype.getLineForRest=function(){return 0},e.prototype.getGlyph=function(){return this.glyph},e.prototype.getGlyphWidth=function(){if(this.glyph){if(this.glyph.getMetrics)return this.glyph.getMetrics().width;if(this.glyph.getWidth)return this.glyph.getWidth(this.render_options.glyph_font_scale)}return 0},e.prototype.setYs=function(t){return this.ys=t,this},e.prototype.getYs=function(){if(0===this.ys.length)throw new h("NoYValues","No Y-values calculated for this note.");return this.ys},e.prototype.getYForTopText=function(t){return this.checkStave().getYForTopText(t)},e.prototype.getVoice=function(){if(!this.voice)throw new h("NoVoice","Note has no voice.");return this.voice},e.prototype.setVoice=function(t){return this.voice=t,this.preFormatted=!1,this},e.prototype.getTickContext=function(){if(!this.tickContext)throw new h("NoTickContext","Note has no tick context.");return this.tickContext},e.prototype.setTickContext=function(t){return this.tickContext=t,this.preFormatted=!1,this},e.prototype.getDuration=function(){return this.duration},e.prototype.isDotted=function(){return this.dots>0},e.prototype.hasStem=function(){return!1},e.prototype.getNoteType=function(){return this.noteType},e.prototype.getBeam=function(){return this.beam},e.prototype.checkBeam=function(){if(!this.beam)throw new h("NoBeam","No beam attached to instance");return this.beam},e.prototype.hasBeam=function(){return null!=this.beam},e.prototype.setBeam=function(t){return this.beam=t,this},e.prototype.setModifierContext=function(t){return this.modifierContext=t,this},e.prototype.addModifier=function(t,e){var i,n;if(void 0===e&&(e=0),"object"!=typeof t||"number"!=typeof e)throw new h("WrongParams","Call signature to addModifier not supported, use addModifier(modifier, index) instead.");return i=e,(n=t).setNote(this),n.setIndex(i),this.modifiers.push(n),this.setPreFormatted(!1),this},e.prototype.getModifierStartXY=function(t,e,i){if(!this.preFormatted)throw new h("UnformattedNote","Can't call GetModifierStartXY on an unformatted note");return{x:this.getAbsoluteX(),y:this.ys[0]}},e.prototype.getMetrics=function(){if(!this.preFormatted)throw new h("UnformattedNote","Can't call getMetrics on an unformatted note.");var t=this.modifierContext?this.modifierContext.state.left_shift:0,e=this.modifierContext?this.modifierContext.state.right_shift:0,i=this.getWidth();return{width:i,glyphWidth:this.getGlyphWidth(),notePx:i-t-e-this.leftDisplacedHeadPx-this.rightDisplacedHeadPx,modLeftPx:t,modRightPx:e,leftDisplacedHeadPx:this.leftDisplacedHeadPx,rightDisplacedHeadPx:this.rightDisplacedHeadPx,glyphPx:0}},e.prototype.getAbsoluteX=function(){if(!this.tickContext)throw new h("NoTickContext","Note needs a TickContext assigned for an X-Value");var t=this.tickContext.getX();return this.stave&&(t+=this.stave.getNoteStartX()+this.musicFont.lookupMetric("stave.padding")),this.isCenterAligned()&&(t+=this.getCenterXShift()),t},e.prototype.setPreFormatted=function(t){this.preFormatted=t},e.prototype.getStemDirection=function(){throw new h("NoStem","No stem attached to this note.")},e.prototype.getStemExtents=function(){throw new h("NoStem","No stem attached to this note.")},e.prototype.getTieRightX=function(){var t=this.getAbsoluteX();return t+=this.glyph.getWidth()/2,t+=-this.width/2+this.width+2},e.prototype.getTieLeftX=function(){var t=this.getAbsoluteX();return t+=this.glyph.getWidth()/2,t-=this.width/2+2},e}(O),L=function(t){function e(e){var i=t.call(this,e)||this;return i.setAttribute("type","StemmableNote"),i}return o(e,t),e.prototype.getStem=function(){return this.stem},e.prototype.checkStem=function(){if(!this.stem)throw new h("NoStem","No stem attached to instance");return this.stem},e.prototype.setStem=function(t){return this.stem=t,this},e.prototype.buildStem=function(){var t=new M;return this.setStem(t),this},e.prototype.buildFlag=function(t){void 0===t&&(t="flag");var e=this.glyph;if(this.hasFlag()){var i=this.getStemDirection()===M.DOWN?e.code_flag_downstem:e.code_flag_upstem;this.flag=new S(i,this.render_options.glyph_font_scale,{category:t})}},e.prototype.getBaseCustomNoteHeadGlyph=function(){return this.getStemDirection()===M.DOWN?this.customGlyphs[this.customGlyphs.length-1]:this.customGlyphs[0]},e.prototype.getStemLength=function(){return M.HEIGHT+this.getStemExtension()},e.prototype.getBeamCount=function(){var t=this.getGlyph();return t?t.beam_count:0},e.prototype.getStemMinimumLength=function(){var t=ei.durationToFraction(this.duration).value()<=1?0:20;switch(this.duration){case"8":null==this.beam&&(t=35);break;case"16":t=null==this.beam?35:25;break;case"32":t=null==this.beam?45:35;break;case"64":t=null==this.beam?50:40;break;case"128":t=null==this.beam?55:45}return t},e.prototype.getStemDirection=function(){if(!this.stem_direction)throw new h("NoStem","No stem attached to this note.");return this.stem_direction},e.prototype.setStemDirection=function(t){if(t||(t=M.UP),t!==M.UP&&t!==M.DOWN)throw new h("BadArgument","Invalid stem direction: "+t);if(this.stem_direction=t,this.stem){this.stem.setDirection(t),this.stem.setExtension(this.getStemExtension());var e=this.getBaseCustomNoteHeadGlyph()||this.getGlyph(),i=this.musicFont.lookupMetric("stem.noteHead."+e.code_head,{offsetYBaseStemUp:0,offsetYTopStemUp:0,offsetYBaseStemDown:0,offsetYTopStemDown:0});this.stem.setOptions({stem_up_y_offset:i.offsetYTopStemUp,stem_down_y_offset:i.offsetYTopStemDown,stem_up_y_base_offset:i.offsetYBaseStemUp,stem_down_y_base_offset:i.offsetYBaseStemDown})}return this.reset(),this.hasFlag()&&this.buildFlag(),this.beam=void 0,this.preFormatted&&this.preFormat(),this},e.prototype.getStemX=function(){var t=this.getAbsoluteX()+this.x_shift,e=this.getAbsoluteX()+this.x_shift+this.getGlyphWidth();return this.stem_direction===M.DOWN?t:e},e.prototype.getCenterGlyphX=function(){return this.getAbsoluteX()+this.x_shift+this.getGlyphWidth()/2},e.prototype.getStemExtension=function(){var t=this.getGlyph();return null!=this.stem_extension_override?this.stem_extension_override:t?this.getStemDirection()===M.UP?t.stem_up_extension:t.stem_down_extension:0},e.prototype.setStemLength=function(t){return this.stem_extension_override=t-M.HEIGHT,this},e.prototype.getStemExtents=function(){if(!this.stem)throw new h("NoStem","No stem attached to this note.");return this.stem.getExtents()},e.prototype.getYForTopText=function(t){var e=this.checkStave();if(this.hasStem()){var i=this.getStemExtents();if(!i)throw new h("InvalidState","Stem does not have extents.");return Math.min(e.getYForTopText(t),i.topY-this.render_options.annotation_spacing*(t+1))}return e.getYForTopText(t)},e.prototype.getYForBottomText=function(t){var e=this.checkStave();if(this.hasStem()){var i=this.getStemExtents();if(!i)throw new h("InvalidState","Stem does not have extents.");return Math.max(e.getYForTopText(t),i.baseY+this.render_options.annotation_spacing*t)}return e.getYForBottomText(t)},e.prototype.hasFlag=function(){return ei.getGlyphProps(this.duration).flag&&!this.beam},e.prototype.postFormat=function(){var t;return null===(t=this.beam)||void 0===t||t.postFormat(),this.postFormatted=!0,this},e.prototype.drawStem=function(t){var e;this.checkContext(),this.setRendered(),this.setStem(new M(t)),null===(e=this.stem)||void 0===e||e.setContext(this.getContext()).draw()},e}(R);function W(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];I.DEBUG&&d("Vex.Flow.NoteHead",t)}var I=function(t){function e(e){var i=t.call(this,e)||this;if(i.custom_glyph=!1,i.stem_up_x_offset=0,i.stem_down_x_offset=0,i.setAttribute("type","NoteHead"),i.index=e.index,i.x=e.x||0,i.y=e.y||0,i.note_type=e.note_type,i.duration=e.duration,i.displaced=e.displaced||!1,i.stem_direction=e.stem_direction||j.STEM_UP,i.line=e.line||0,i.glyph=ei.getGlyphProps(i.duration,i.note_type),!i.glyph)throw new h("BadArguments","No glyph found for duration '"+i.duration+"' and type '"+i.note_type+"'");return i.glyph_code=i.glyph.code_head,i.x_shift=e.x_shift||0,e.custom_glyph_code&&(i.custom_glyph=!0,i.glyph_code=e.custom_glyph_code,i.stem_up_x_offset=e.stem_up_x_offset||0,i.stem_down_x_offset=e.stem_down_x_offset||0),i.style=e.style,i.slashed=e.slashed||!1,i.render_options=r(r({},i.render_options),{glyph_font_scale:e.glyph_font_scale||ei.DEFAULT_NOTATION_FONT_SCALE,stroke_px:3}),i.setWidth(i.glyph.getWidth(i.render_options.glyph_font_scale)),i}return o(e,t),Object.defineProperty(e,"CATEGORY",{get:function(){return"notehead"},enumerable:!1,configurable:!0}),e.prototype.getCategory=function(){return e.CATEGORY},e.prototype.getWidth=function(){return this.width},e.prototype.isDisplaced=function(){return!0===this.displaced},e.prototype.getGlyph=function(){return this.glyph},e.prototype.setX=function(t){return this.x=t,this},e.prototype.getY=function(){return this.y},e.prototype.setY=function(t){return this.y=t,this},e.prototype.getLine=function(){return this.line},e.prototype.setLine=function(t){return this.line=t,this},e.prototype.getAbsoluteX=function(){var e=this.preFormatted?t.prototype.getAbsoluteX.call(this):this.x,i=M.WIDTH/2,n=this.musicFont.lookupMetric("notehead.shiftX",0)*this.stem_direction,o=this.musicFont.lookupMetric("noteHead.displaced.shiftX",0)*this.stem_direction;return e+n+(this.displaced?(this.width-i)*this.stem_direction+o:0)},e.prototype.getBoundingBox=function(){if(!this.preFormatted)throw new h("UnformattedNote","Can't call getBoundingBox on an unformatted note.");var t=this.checkStave().getSpacingBetweenLines(),e=t/2,i=this.y-e;return new x(this.getAbsoluteX(),i,this.width,t)},e.prototype.setStave=function(t){var e=this.getLine();return this.stave=t,this.stave&&(this.setY(this.stave.getYForNote(e)),this.setContext(this.stave.getContext())),this},e.prototype.preFormat=function(){if(this.preFormatted)return this;var t=this.getWidth()+this.leftDisplacedHeadPx+this.rightDisplacedHeadPx;return this.setWidth(t),this.setPreFormatted(!0),this},e.prototype.draw=function(){var t=this.checkContext();this.setRendered();var e=this.getAbsoluteX();this.custom_glyph&&(e+=this.stem_direction===M.UP?this.stem_up_x_offset:this.stem_down_x_offset);var i=this.y;W("Drawing note head '",this.note_type,this.duration,"' at",e,i);var n=this.stem_direction,o=this.render_options.glyph_font_scale;this.style&&this.applyStyle(t);var r=this.glyph_code+"Stem"+(n===M.UP?"Up":"Down");if("s"===this.note_type){var a=this.checkStave().getSpacingBetweenLines();!function(t,e,i,n,o,r){var a=ei.SLASH_NOTEHEAD_WIDTH;t.save(),t.setLineWidth(ei.STEM_WIDTH);var s=!1;if(ei.durationToNumber(e)>2&&(s=!0),s||(i-=ei.STEM_WIDTH/2*o),t.beginPath(),t.moveTo(i,n+r),t.lineTo(i,n+1),t.lineTo(i+a,n-r),t.lineTo(i+a,n),t.lineTo(i,n+r),t.closePath(),s?t.fill():t.stroke(),ei.durationToFraction(e).equals(.5))for(var h=[-3,-1,a+1,a+3],c=0;c<h.length;c++)t.beginPath(),t.moveTo(i+h[c],n-10),t.lineTo(i+h[c],n+11),t.stroke();t.restore()}(t,this.duration,e,i,n,a)}else S.renderGlyph(t,e,i,o,this.glyph_code,{font:this.musicFont,category:this.custom_glyph?"noteHead.custom."+r:"noteHead.standard."+r});this.style&&this.restoreStyle(t)},e}(R);function U(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];j.DEBUG&&d("Vex.Flow.StaveNote",t)}function G(t,e,i){var n=(e.isrest?0:1)*i;t.line+=n,t.maxLine+=n,t.minLine+=n,t.note.setKeyLine(0,t.note.getKeyLine(0)+n)}var j=function(t){function e(i){var n=t.call(this,i)||this;if(n.minLine=0,n.maxLine=0,n.setAttribute("type","StaveNote"),n.ledgerLineStyle={lineWidth:2},n.clef=i.clef,n.octave_shift=i.octave_shift,n.glyph=ei.getGlyphProps(n.duration,n.noteType),!n.glyph)throw new h("BadArguments","Invalid note initialization data (No glyph found): "+JSON.stringify(i));return n.displaced=!1,n.dot_shiftY=0,n.use_default_head_x=!1,n.note_heads=[],n.modifiers=[],n.ledgerLineStyle={},n.render_options=r(r({},n.render_options),{glyph_font_scale:i.glyph_font_scale||ei.DEFAULT_NOTATION_FONT_SCALE,stroke_px:i.stroke_px||e.DEFAULT_LEDGER_LINE_OFFSET}),n.calculateKeyProps(),n.buildStem(),i.auto_stem?n.autoStem():n.setStemDirection(i.stem_direction),n.reset(),n.buildFlag(),n}return o(e,t),Object.defineProperty(e,"CATEGORY",{get:function(){return"stavenotes"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"STEM_UP",{get:function(){return M.UP},enumerable:!1,configurable:!0}),Object.defineProperty(e,"STEM_DOWN",{get:function(){return M.DOWN},enumerable:!1,configurable:!0}),Object.defineProperty(e,"DEFAULT_LEDGER_LINE_OFFSET",{get:function(){return 3},enumerable:!1,configurable:!0}),Object.defineProperty(e,"minNoteheadPadding",{get:function(){return ei.DEFAULT_FONT_STACK[0].lookupMetric("glyphs.noteHead.minPadding")},enumerable:!1,configurable:!0}),e.format=function(t,i){if(!t||t.length<2)return!1;if(t[0].getStave())return e.formatByY(t,i),!0;for(var n=[],o=0;o<t.length;o++){var r=t[o].getKeyProps(),a=r[0].line,s=r[r.length-1].line,c=t[o].getStemDirection(),d=t[o].getStemLength()/10,l=t[o].getStemMinimumLength()/10,u=void 0;t[o].isRest()?(u=a+t[o].glyph.line_above,s=a-t[o].glyph.line_below):(u=1===c?r[r.length-1].line+d:r[r.length-1].line,s=1===c?r[0].line:r[0].line-d),n.push({line:r[0].line,maxLine:u,minLine:s,isrest:t[o].isRest(),stemDirection:c,stemMax:d,stemMin:l,voice_shift:t[o].getVoiceShiftWidth(),is_displaced:t[o].isDisplaced(),note:t[o]})}var f=n.length,g=n[0],m=f>2?n[1]:void 0,y=f>2?n[2]:n[1];2===f&&-1===g.stemDirection&&1===y.stemDirection&&(g=n[1],y=n[0]);var _,x=Math.max(g.voice_shift,y.voice_shift),v=0;if(2===f){var S=g.stemDirection===y.stemDirection?0:.5;return g.stemDirection===y.stemDirection&&g.minLine<=y.maxLine&&(g.isrest||(_=Math.abs(g.line-(y.maxLine+.5)),_=Math.max(_,g.stemMin),g.minLine=g.line-_,g.note.setStemLength(10*_))),g.minLine<=y.maxLine+S&&(g.isrest?G(g,y,1):y.isrest?G(y,g,-1):(v=x,g.stemDirection===y.stemDirection?g.note.setXShift(v+3):y.note.setXShift(v))),!0}if(!m)throw new h("InvalidState","noteM not defined.");if((m.minLine<y.maxLine+.5&&(m.isrest||(_=Math.abs(m.line-(y.maxLine+.5)),_=Math.max(_,m.stemMin),m.minLine=m.line-_,m.note.setStemLength(10*_))),m.isrest&&!g.isrest&&!y.isrest)&&(g.minLine<=m.maxLine||m.minLine<=y.maxLine))return m.maxLine-m.minLine<g.minLine-y.maxLine?function(t,e,i){var n=t.line-p(e.minLine,i.maxLine);t.note.setKeyLine(0,t.note.getKeyLine(0)-n),t.line-=n,t.maxLine-=n,t.minLine-=n}(m,g,y):(v=x+3,m.note.setXShift(v)),!0;return g.isrest&&m.isrest&&y.isrest?(G(g,m,1),G(y,m,-1),!0):(m.isrest&&g.isrest&&m.minLine<=y.maxLine&&G(m,y,1),m.isrest&&y.isrest&&g.minLine<=m.maxLine&&G(m,g,-1),g.isrest&&g.minLine<=m.maxLine&&G(g,m,1),y.isrest&&m.minLine<=y.maxLine&&G(y,m,-1),(!g.isrest&&!m.isrest&&g.minLine<=m.maxLine+.5||!m.isrest&&!y.isrest&&m.minLine<=y.maxLine)&&(v=x+3,m.note.setXShift(v)),!0)},e.formatByY=function(t,e){for(var i=!0,n=0;n<t.length;n++)i=i&&null!=t[n].getStave();if(!i)throw new h("Stave Missing","All notes must have a stave - Vex.Flow.ModifierContext.formatMultiVoice!");var o=0;for(n=0;n<t.length-1;n++){var r=t[n],a=t[n+1];r.getStemDirection()===M.DOWN&&(r=t[n+1],a=t[n]);var s=r.getKeyProps(),c=a.getKeyProps(),d=r.checkStave().getYForLine(5-s[0].line+.5),l=a.checkStave().getYForLine(5-c[c.length-1].line-.5);null!=l&&null!=d&&l-d<0&&(o=r.getVoiceShiftWidth()+2,a.setXShift(o))}e.right_shift+=o},e.postFormat=function(t){return!!t&&(t.forEach((function(t){return t.postFormat()})),!0)},e.prototype.reset=function(){t.prototype.reset.call(this);var e=this.note_heads.map((function(t){return t.getStyle()}));this.buildNoteHeads(),this.note_heads.forEach((function(t,i){var n=e[i];n&&t.setStyle(n)}));var i=this.stave;return i&&this.note_heads.forEach((function(t){return t.setStave(i)})),this.calcNoteDisplacements(),this},e.prototype.setBeam=function(t){return this.beam=t,this.calcNoteDisplacements(),this},e.prototype.getCategory=function(){return e.CATEGORY},e.prototype.buildStem=function(){return this.setStem(new M({hide:!!this.isRest()})),this},e.prototype.buildNoteHeads=function(){this.note_heads=[];var t,e,i,n=this.getStemDirection(),o=this.getKeys(),r=void 0,a=void 0,s=!1;n===M.UP?(t=0,e=o.length,i=1):(t=o.length-1,e=-1,i=-1);for(var h=t;h!==e;h+=i){var c=this.keyProps[h],d=c.line;void 0===r?r=d:0===(a=Math.abs(r-d))||.5===a?s=!s:(s=!1,this.use_default_head_x=!0),r=d;var l=new I({duration:this.duration,note_type:this.noteType,displaced:s,stem_direction:n,custom_glyph_code:c.code,glyph_font_scale:this.render_options.glyph_font_scale,x_shift:c.shift_right,stem_up_x_offset:c.stem_up_x_offset,stem_down_x_offset:c.stem_down_x_offset,line:c.line});this.note_heads[h]=l}},e.prototype.autoStem=function(){this.setStemDirection(this.calculateOptimalStemDirection())},e.prototype.calculateOptimalStemDirection=function(){this.minLine=this.keyProps[0].line,this.maxLine=this.keyProps[this.keyProps.length-1].line;return(this.minLine+this.maxLine)/2<3?M.UP:M.DOWN},e.prototype.calculateKeyProps=function(){for(var t,e=0;e<this.keys.length;++e){var i=this.keys[e];this.glyph.rest&&(this.glyph.position=i);var n={octave_shift:this.octave_shift||0},o=ei.keyProperties(i,this.clef,n);if(!o)throw new h("BadArguments","Invalid key for note properties: "+i);"R"===o.key&&("1"===this.duration||"w"===this.duration?o.line=4:o.line=3);var r=o.line;null==t?t=r:.5===Math.abs(t-r)&&(this.displaced=!0,o.displaced=!0,this.keyProps.length>0&&(this.keyProps[e-1].displaced=!0)),t=r,this.keyProps.push(o)}t=void 0,this.keyProps.forEach((function(e){t&&e.line<t&&l("Unsorted keys in note will be sorted. See https://github.com/0xfe/vexflow/issues/104 for details."),t=e.line})),this.keyProps.sort((function(t,e){return t.line-e.line}))},e.prototype.getBoundingBox=function(){var t,e;if(!this.preFormatted)throw new h("UnformattedNote","Can't call getBoundingBox on an unformatted note.");var i=this.getMetrics(),n=i.width,o=i.modLeftPx,r=i.leftDisplacedHeadPx,a=this.getAbsoluteX()-o-r,s=0,c=0,d=(null!==(e=null===(t=this.getStave())||void 0===t?void 0:t.getSpacingBetweenLines())&&void 0!==e?e:0)/2,l=2*d;if(this.isRest()){var p=this.ys[0],u=ei.durationToFraction(this.duration);u.equals(1)||u.equals(2)?(s=p-d,c=p+d):(s=p-this.glyph.line_above*l,c=p+this.glyph.line_below*l)}else if(this.glyph.stem){var f=this.getStemExtents();f.baseY+=d*this.getStemDirection(),s=Math.min(f.topY,f.baseY),c=Math.max(f.topY,f.baseY)}else{s=0,c=0;for(var g=0;g<this.ys.length;++g){var m=this.ys[g];0===g?(s=m,c=m):(s=Math.min(m,s),c=Math.max(m,c))}s-=d,c+=d}return new x(a,s,n,c-s)},e.prototype.getLineNumber=function(t){if(!this.keyProps.length)throw new h("NoKeyProps","Can't get bottom note line, because note is not initialized properly.");for(var e=this.keyProps[0].line,i=0;i<this.keyProps.length;i++){var n=this.keyProps[i].line;t?n>e&&(e=n):n<e&&(e=n)}return e},e.prototype.isRest=function(){return this.glyph.rest},e.prototype.isChord=function(){return!this.isRest()&&this.keys.length>1},e.prototype.hasStem=function(){return this.glyph.stem},e.prototype.hasFlag=function(){return t.prototype.hasFlag.call(this)&&!this.isRest()},e.prototype.getStemX=function(){return"r"===this.noteType?this.getCenterGlyphX():t.prototype.getStemX.call(this)+(this.stem_direction?M.WIDTH/(2*-this.stem_direction):0)},e.prototype.getYForTopText=function(t){var e=this.getStemExtents();return Math.min(this.checkStave().getYForTopText(t),e.topY-this.render_options.annotation_spacing*(t+1))},e.prototype.getYForBottomText=function(t){var e=this.getStemExtents();return Math.max(this.checkStave().getYForTopText(t),e.baseY+this.render_options.annotation_spacing*t)},e.prototype.setStave=function(e){t.prototype.setStave.call(this,e);var i=this.note_heads.map((function(t){return t.setStave(e),t.getY()}));if(this.setYs(i),this.stem){var n=this.getNoteHeadBounds(),o=n.y_top,r=n.y_bottom;this.stem.setYBounds(o,r)}return this},e.prototype.getKeys=function(){return this.keys},e.prototype.getKeyProps=function(){return this.keyProps},e.prototype.isDisplaced=function(){return this.displaced},e.prototype.setNoteDisplaced=function(t){return this.displaced=t,this},e.prototype.getTieRightX=function(){var t=this.getAbsoluteX();return t+=this.getGlyphWidth()+this.x_shift+this.rightDisplacedHeadPx,this.modifierContext&&(t+=this.modifierContext.getRightShift()),t},e.prototype.getTieLeftX=function(){var t=this.getAbsoluteX();return t+=this.x_shift-this.leftDisplacedHeadPx},e.prototype.getLineForRest=function(){var t=this.keyProps[0].line;if(this.keyProps.length>1){var e=this.keyProps[this.keyProps.length-1].line;t=p(Math.max(t,e),Math.min(t,e))}return t},e.prototype.getModifierStartXY=function(t,e,i){var n,o;if(void 0===i&&(i={}),!this.preFormatted)throw new h("UnformattedNote","Can't call GetModifierStartXY on an unformatted note");if(0===this.ys.length)throw new h("NoYValues","No Y-Values calculated for this note.");var r=F.Position,a=r.ABOVE,s=r.BELOW,c=r.LEFT,d=r.RIGHT,l=0;return t===c?l=-2:t===d?(l=this.getGlyphWidth()+this.x_shift+2,this.stem_direction===M.UP&&this.hasFlag()&&(i.forceFlagRight||function(t,e){return e===(t.getStemDirection()===M.UP?t.keyProps.length-1:0)}(this,e))&&(l+=null!==(o=null===(n=null==this?void 0:this.flag)||void 0===n?void 0:n.getMetrics().width)&&void 0!==o?o:0)):t!==s&&t!==a||(l=this.getGlyphWidth()/2),{x:this.getAbsoluteX()+l,y:this.ys[e]}},e.prototype.setStyle=function(e){var i;return t.prototype.setStyle.call(this,e),this.note_heads.forEach((function(t){return t.setStyle(e)})),null===(i=this.stem)||void 0===i||i.setStyle(e),this},e.prototype.setStemStyle=function(t){var e=this.getStem();return null==e||e.setStyle(t),this},e.prototype.getStemStyle=function(){var t;return null===(t=this.stem)||void 0===t?void 0:t.getStyle()},e.prototype.setLedgerLineStyle=function(t){this.ledgerLineStyle=t},e.prototype.getLedgerLineStyle=function(){return this.ledgerLineStyle},e.prototype.setFlagStyle=function(t){this.flagStyle=t},e.prototype.getFlagStyle=function(){return this.flagStyle},e.prototype.setKeyStyle=function(t,e){return this.note_heads[t].setStyle(e),this},e.prototype.setKeyLine=function(t,e){return this.keyProps[t].line=e,this.reset(),this},e.prototype.getKeyLine=function(t){return this.keyProps[t].line},e.prototype.addToModifierContext=function(t){this.modifierContext=t;for(var e=0;e<this.modifiers.length;++e)this.modifierContext.addMember(this.modifiers[e]);return this.modifierContext.addMember(this),this.setPreFormatted(!1),this},e.prototype.addModifier=function(t,e){var i,n;if("object"==typeof t&&"number"==typeof e)i=e,n=t;else{if("number"!=typeof t||"object"!=typeof e)throw new h("WrongParams","Call signature to addModifier not supported, use addModifier(modifier, index) instead.");console.warn("deprecated call signature to addModifier, use addModifier(modifier, index) instead"),i=t,n=e}return n.setNote(this),n.setIndex(i),this.modifiers.push(n),this.setPreFormatted(!1),this},e.prototype.addAccidental=function(t,e){return this.addModifier(e,t)},e.prototype.addArticulation=function(t,e){return this.addModifier(e,t)},e.prototype.addAnnotation=function(t,e){return this.addModifier(e,t)},e.prototype.addDot=function(t){var e=new H;return e.setDotShiftY(this.glyph.dot_shiftY),this.dots++,this.addModifier(e,t)},e.prototype.addDotToAll=function(){for(var t=0;t<this.keys.length;++t)this.addDot(t);return this},e.prototype.getAccidentals=function(){if(!this.modifierContext)throw new h("NoModifierContext","No modifier context attached to this note.");return this.modifierContext.getMembers("accidentals")},e.prototype.getDots=function(){if(!this.modifierContext)throw new h("NoModifierContext","No modifier context attached to this note.");return this.modifierContext.getMembers("dots")},e.prototype.getVoiceShiftWidth=function(){return this.getGlyphWidth()*(this.displaced?2:1)},e.prototype.calcNoteDisplacements=function(){this.setLeftDisplacedHeadPx(this.displaced&&this.stem_direction===M.DOWN?this.getGlyphWidth():0),this.setRightDisplacedHeadPx(!this.hasFlag()&&this.displaced&&this.stem_direction===M.UP?this.getGlyphWidth():0)},e.prototype.preFormat=function(){var t,i,n,o=0;if(!this.preFormatted){this.modifierContext&&(this.modifierContext.preFormat(),0===this.modifierContext.getWidth()&&(o=e.minNoteheadPadding));var r=this.getGlyphWidth(),a=null!==(n=null===(i=null===(t=this.flag)||void 0===t?void 0:t.getMetrics())||void 0===i?void 0:i.width)&&void 0!==n?n:0,s=(this.shouldDrawFlag()&&this.stem_direction===M.DOWN?Math.max(a+ei.STEM_WIDTH,r):this.shouldDrawFlag()&&this.stem_direction===M.UP?a+r+ei.STEM_WIDTH:r)+this.leftDisplacedHeadPx+this.rightDisplacedHeadPx+o;this.setWidth(s),this.setPreFormatted(!0)}},e.prototype.getNoteHeadBounds=function(){var t,e,i,n,o=1/0,r=-1/0,a=this.checkStave().getNumLines(),s=1,h=a,c=s;return this.note_heads.forEach((function(d){var l=d.getLine(),p=d.getY();o=Math.min(p,o),r=Math.max(p,r),void 0===e&&d.isDisplaced()&&(e=d.getAbsoluteX()),void 0!==t||d.isDisplaced()||(t=d.getAbsoluteX()),a=Math.max(l,a),s=Math.min(l,s),d.isDisplaced()?(i=void 0===i?l:Math.max(l,i),n=void 0===n?l:Math.min(l,n)):(h=Math.max(l,h),c=Math.min(l,c))}),this),{y_top:o,y_bottom:r,displaced_x:e,non_displaced_x:t,highest_line:a,lowest_line:s,highest_displaced_line:i,lowest_displaced_line:n,highest_non_displaced_line:h,lowest_non_displaced_line:c}},e.prototype.getNoteHeadBeginX=function(){return this.getAbsoluteX()+this.x_shift},e.prototype.getNoteHeadEndX=function(){return this.getNoteHeadBeginX()+this.getGlyphWidth()},e.prototype.drawLedgerLines=function(){var t=this.checkStave(),e=this.glyph,i=this.render_options.stroke_px,n=this.checkContext(),o=e.getWidth()+2*i,a=2*(e.getWidth()+i)-M.WIDTH/2;if(!this.isRest()){if(!n)throw new h("NoCanvasContext","Can't draw without a canvas context.");var s=this.getNoteHeadBounds(),c=s.highest_line,d=s.lowest_line,l=s.highest_displaced_line,p=s.highest_non_displaced_line,u=s.lowest_displaced_line,f=s.lowest_non_displaced_line,g=s.displaced_x,m=s.non_displaced_x,y=Math.min(null!=g?g:0,null!=m?m:0),_=function(t,e,r){var s;s=r&&e?y-i:e?(null!=m?m:0)-i:(null!=g?g:0)-i;var h=e&&r?a:o;n.beginPath(),n.moveTo(s,t),n.lineTo(s+h,t),n.stroke()},x=r(r({},t.getStyle()||{}),this.getLedgerLineStyle()||{});void 0===x.lineWidth?x.lineWidth=2*ei.STAVE_LINE_THICKNESS:x.lineWidth*=2,this.applyStyle(n,x);for(var v=6;v<=c;++v){var S=void 0!==m&&v<=p,b=void 0!==l&&v<=l;_(t.getYForNote(v),S,b)}for(v=0;v>=d;--v){S=void 0!==m&&v>=f,b=void 0!==u&&v>=u;_(t.getYForNote(v),S,b)}this.restoreStyle(n,x)}},e.prototype.drawModifiers=function(){var t=this.checkContext();t.openGroup("modifiers");for(var e=0;e<this.modifiers.length;e++){var i=this.modifiers[e],n=i.checkIndex(),o=this.note_heads[n],r=o.getStyle();o.applyStyle(t,r),i.setContext(t),i.drawWithStyle(),o.restoreStyle(t,r)}t.closeGroup()},e.prototype.shouldDrawFlag=function(){var t=void 0!==this.stem,e=this.glyph.flag,i=void 0===this.beam;return t&&e&&i},e.prototype.drawFlag=function(){var t,e=this.checkContext();if(!e)throw new h("NoCanvasContext","Can't draw without a canvas context.");if(this.shouldDrawFlag()){var i=this.getNoteHeadBounds(),n=i.y_top,o=i.y_bottom,r=this.stem.getHeight(),a=this.getStemX(),s=this.getStemDirection()===M.DOWN?n-r+2:o-r-2;e.openGroup("flag",void 0,{pointerBBox:!0}),this.applyStyle(e,this.getFlagStyle()),null===(t=this.flag)||void 0===t||t.render(e,a,s),this.restoreStyle(e,this.getFlagStyle()),e.closeGroup()}},e.prototype.drawNoteHeads=function(){var t=this.checkContext();this.note_heads.forEach((function(e){t.openGroup("notehead",void 0,{pointerBBox:!0}),e.setContext(t).draw(),t.closeGroup()}))},e.prototype.drawStem=function(t){var e,i=this.checkContext();t&&this.setStem(new M(t)),this.shouldDrawFlag()&&this.stem&&this.stem.adjustHeightForFlag(),i.openGroup("stem",void 0,{pointerBBox:!0}),null===(e=this.stem)||void 0===e||e.setContext(i).draw(),i.closeGroup()},e.prototype.getStemExtension=function(){var e=t.prototype.getStemExtension.call(this);if(!this.glyph.stem)return e;var i=this.getStemDirection();if(i!==this.calculateOptimalStemDirection())return e;var n=(i===M.UP?3-this.maxLine:this.minLine-3)-3.5;if(n<=0)return e;var o=this.getStave(),r=10;return null!=o&&(r=o.getSpacingBetweenLines()),e+n*r},e.prototype.draw=function(){var t;if(0===this.ys.length)throw new h("NoYValues","Can't draw note without Y values.");var e=this.checkContext(),i=this.getNoteHeadBeginX(),n=this.hasStem()&&!this.beam;this.note_heads.forEach((function(t){return t.setX(i)}));var o=this.getStemX();null===(t=this.stem)||void 0===t||t.setNoteHeadXBounds(o,o),U("Rendering ",this.isChord()?"chord :":"note :",this.keys),this.applyStyle(),this.setAttribute("el",e.openGroup("stavenote",this.getAttribute("id"))),this.drawLedgerLines(),e.openGroup("note",void 0,{pointerBBox:!0}),n&&this.drawStem(),this.drawNoteHeads(),this.drawFlag(),e.closeGroup(),this.drawModifiers(),e.closeGroup(),this.restoreStyle(),this.setRendered()},e}(L),Y=function(t){function e(i){var n=t.call(this,r({glyph_font_scale:ei.DEFAULT_NOTATION_FONT_SCALE*e.SCALE,stroke_px:e.LEDGER_LINE_OFFSET},i))||this;return n.setAttribute("type","GraceNote"),n.slash=i.slash,n.slur=!0,n.buildNoteHeads(),n.width=3,n}return o(e,t),Object.defineProperty(e,"CATEGORY",{get:function(){return"gracenotes"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"LEDGER_LINE_OFFSET",{get:function(){return 2},enumerable:!1,configurable:!0}),Object.defineProperty(e,"SCALE",{get:function(){return.66},enumerable:!1,configurable:!0}),e.prototype.getStemExtension=function(){if(this.stem_extension_override)return this.stem_extension_override;var e=this.getGlyph();if(e){var i=t.prototype.getStemExtension.call(this);if(e.stem){var n=this.getStaveNoteScale();i=(M.HEIGHT+i)*n-M.HEIGHT}return i}return 0},e.prototype.getCategory=function(){return e.CATEGORY},e.prototype.getStaveNoteScale=function(){return this.render_options.glyph_font_scale/ei.DEFAULT_NOTATION_FONT_SCALE},e.prototype.draw=function(){t.prototype.draw.call(this),this.setRendered();var e=this.stem;if(this.slash&&e){var i=this.getStaveNoteScale(),n=i/.66,o=void 0,r=this.beam;if(r)r.postFormatted||r.postFormat(),o=this.calcBeamedNotesSlashBBox(8*n,8*n,{stem:6*n,beam:5*n});else{var a=this.getStemDirection(),s=this.getNoteHeadBounds(),h=e.getHeight(),c=this.getAbsoluteX(),d=a===M.DOWN?s.y_top-h:s.y_bottom-h,l=a===M.DOWN?this.glyph.stem_down_extension:this.glyph.stem_up_extension,p=ei.STEM_HEIGHT;p-=p/2.8,d+=(p+=l)*i*a;var u=a===M.UP?{x1:1,y1:0,x2:13,y2:-9}:{x1:-4,y1:1,x2:13,y2:9};o={x1:c+=u.x1*n,y1:d+=u.y1*n,x2:c+u.x2*n,y2:d+u.y2*n}}var f=this.checkContext();f.save(),f.setLineWidth(1*n),f.beginPath(),f.moveTo(o.x1,o.y1),f.lineTo(o.x2,o.y2),f.closePath(),f.stroke(),f.restore()}},e.prototype.calcBeamedNotesSlashBBox=function(t,e,i){var n=this.beam;if(!n)throw new h("NoBeam","Can't calculate without a beam.");var o=n.slope,r=n.notes[n.notes.length-1]===this?-1:1,a=Math.atan(o*r),s=Math.cos(a)*e,c=Math.sin(a)*e;t*=this.getStemDirection();var d=Math.atan((c-t)/s),l=Math.cos(d)*i.stem*r,p=Math.sin(d)*i.stem,u=Math.cos(d)*i.beam*r,f=Math.sin(d)*i.beam,g=this.getStemX(),m=n.notes[0].getStemX(),y=n.getBeamYToDraw()+(g-m)*o;return{x1:g-l,y1:y+t-p,x2:g+s*r+u,y2:y+c+f}},e}(j),H=function(t){function e(){var e=t.call(this)||this;return e.setAttribute("type","Dot"),e.position=F.Position.RIGHT,e.radius=2,e.setWidth(5),e.dot_shiftY=0,e}return o(e,t),Object.defineProperty(e,"CATEGORY",{get:function(){return"dots"},enumerable:!1,configurable:!0}),e.format=function(t,e){var i=e.right_shift;if(!t||0===t.length)return!1;for(var n=[],o={},r=0;r<t.length;++r){var a=void 0,s=void 0;if((x=(_=t[r]).getNote())instanceof j){var c=_.checkIndex();a=x.getKeyProps()[c],s=x.getRightDisplacedHeadPx()}else{if(!(x instanceof X))throw new h("Internal","Unexpected instance.");a={line:.5},s=0}var d=x.getAttribute("id");n.push({line:a.line,note:x,note_id:d,dot:_}),o[d]=Math.max(o[d]||s,s)}n.sort((function(t,e){return e.line-t.line}));var l=i,p=0,u=null,f=null,g=null,m=0;for(r=0;r<n.length;++r){var y=n[r],_=y.dot,x=y.note,v=(d=y.note_id,y.line);v===u&&x===f||(l=o[d]),x.isRest()||v===u||(.5===Math.abs(v%1)?m=0:(m=.5,null==f||f.isRest()||null==u||u-v!=.5?v+m===g&&(m=-.5):m=-.5)),x.isRest()?_.dot_shiftY+=-m:_.dot_shiftY=-m,g=v+m,_.setXShift(l),p=(l+=_.getWidth()+1)>p?l:p,u=v,f=x}return e.right_shift+=p,!0},e.prototype.getCategory=function(){return e.CATEGORY},e.prototype.setNote=function(t){return this.note=t,t.getCategory()===Y.CATEGORY&&(this.radius*=.5,this.setWidth(3)),this},e.prototype.setDotShiftY=function(t){return this.dot_shiftY=t,this},e.prototype.draw=function(){var t=this.checkContext(),e=this.checkAttachedNote();this.setRendered();var i=e.checkStave().getOptions().spacing_between_lines_px,n=e.getModifierStartXY(this.position,this.index,{forceFlagRight:!0});e.getCategory()===X.CATEGORY&&(n.y=e.getStemExtents().baseY);var o=n.x+this.x_shift+this.width-this.radius,r=n.y+this.y_shift+this.dot_shiftY*i;t.beginPath(),t.arc(o,r,this.radius,0,2*Math.PI,!1),t.fill()},e}(F);var X=function(t){function e(e,i){var n=t.call(this,e)||this;if(n.glyphs=[],n.setAttribute("type","TabNote"),n.ghost=!1,n.positions=e.positions,n.render_options=r(r({},n.render_options),{glyph_font_scale:ei.DEFAULT_TABLATURE_FONT_SCALE,draw_stem:i,draw_dots:i,draw_stem_through_stave:!1,y_shift:0,scale:1,font:"10pt Arial"}),n.glyph=ei.getGlyphProps(n.duration,n.noteType),!n.glyph)throw new h("BadArguments","Invalid note initialization data (No glyph found): "+JSON.stringify(e));return n.buildStem(),e.stem_direction?n.setStemDirection(e.stem_direction):n.setStemDirection(M.UP),n.ghost=!1,n.updateWidth(),n}return o(e,t),Object.defineProperty(e,"CATEGORY",{get:function(){return"tabnotes"},enumerable:!1,configurable:!0}),e.prototype.reset=function(){return this.stave&&this.setStave(this.stave),this},e.prototype.getCategory=function(){return e.CATEGORY},e.prototype.setGhost=function(t){return this.ghost=t,this.updateWidth(),this},e.prototype.hasStem=function(){return!!this.render_options.draw_stem},e.prototype.getStemExtension=function(){var t=this.getGlyph();return null!=this.stem_extension_override?this.stem_extension_override:t?1===this.getStemDirection()?t.tabnote_stem_up_extension:t.tabnote_stem_down_extension:0},e.prototype.addDot=function(){var t=new H;return this.dots+=1,this.addModifier(t,0)},e.prototype.updateWidth=function(){var t=this;this.glyphs=[],this.width=0;for(var e=0;e<this.positions.length;++e){var i=this.positions[e].fret;this.ghost&&(i="("+i+")");var n=ei.tabToGlyph(i,this.render_options.scale);this.glyphs.push(n),this.width=Math.max(n.getWidth(),this.width)}this.glyph.getWidth=function(){return t.width}},e.prototype.setStave=function(e){var i=this;t.prototype.setStave.call(this,e);var n=e.getContext();if(this.setContext(n),n){this.width=0;for(var o=function(t){var e=r.glyphs[t],i=""+e.text;"X"!==i.toUpperCase()&&(n.save(),n.setRawFont(r.render_options.font),e.width=n.measureText(i).width,n.restore(),e.getWidth=function(){return e.width}),r.width=Math.max(e.getWidth(),r.width)},r=this,a=0;a<this.glyphs.length;++a)o(a);this.glyph.getWidth=function(){return i.width}}var s=this.positions.map((function(t){var i=t.str;return e.getYForLine(Number(i)-1)}));return this.setYs(s),this.stem&&this.stem.setYBounds(this.getStemY(),this.getStemY()),this},e.prototype.getPositions=function(){return this.positions},e.prototype.addToModifierContext=function(t){this.modifierContext=t;for(var e=0;e<this.modifiers.length;++e)this.modifierContext.addMember(this.modifiers[e]);return this.modifierContext.addMember(this),this.preFormatted=!1,this},e.prototype.getModifierStartXY=function(t,e){if(!this.preFormatted)throw new h("UnformattedNote","Can't call GetModifierStartXY on an unformatted note");if(0===this.ys.length)throw new h("NoYValues","No Y-Values calculated for this note.");var i=0;if(t===F.Position.LEFT)i=-2;else if(t===F.Position.RIGHT)i=this.width+2;else if(t===F.Position.BELOW||t===F.Position.ABOVE){i=this.glyph.getWidth()/2}return{x:this.getAbsoluteX()+i,y:this.ys[e]}},e.prototype.getLineForRest=function(){return Number(this.positions[0].str)},e.prototype.preFormat=function(){this.preFormatted||(this.modifierContext&&this.modifierContext.preFormat(),this.setPreFormatted(!0))},e.prototype.getStemX=function(){return this.getCenterGlyphX()},e.prototype.getStemY=function(){var t=this.checkStave().getNumLines()-.5,e=M.UP===this.stem_direction?-.5:t;return this.checkStave().getYForLine(e)},e.prototype.getStemExtents=function(){return this.checkStem().getExtents()},e.prototype.drawFlag=function(){var t=this,e=t.beam,i=t.glyph,n=t.stem_direction,o=t.render_options,r=o.draw_stem,a=o.glyph_font_scale,s=this.checkContext(),h=null==e&&r;if(i.flag&&h){var c=this.getStemX()+1,d=this.getStemY()-this.checkStem().getHeight(),l=n===M.DOWN?i.code_flag_downstem:i.code_flag_upstem;S.renderGlyph(s,c,d,a,l,{category:"flag.tabStem"})}},e.prototype.drawModifiers=function(){var t=this;this.modifiers.forEach((function(e){(e.getCategory()!==H.CATEGORY||t.render_options.draw_dots)&&(e.setContext(t.getContext()),e.drawWithStyle())}))},e.prototype.drawStemThrough=function(){var t=this.getStemX(),e=this.getStemY(),i=this.checkContext(),n=this.render_options.draw_stem_through_stave;if(this.render_options.draw_stem&&n){var o=function(t,e,i,n){var o=1!==n,r=-1!==n,a=i.getSpacingBetweenLines(),s=i.getNumLines(),h=[];return e.forEach((function(e){var c=e.indexOf(s)>-1,d=e.indexOf(1)>-1;if(!(o&&d||r&&c)){1===e.length&&e.push(e[0]);var l=[];e.forEach((function(e,o,r){var h=1===e,c=e===s,d=i.getYForLine(e-1);0!==o||h?o!==r.length-1||c||(d+=a/2-1):d-=a/2-1,l.push(d),1===n&&h?l.push(t-2):-1===n&&c&&l.push(t+2)})),h.push(l.sort((function(t,e){return t-e})))}})),h}(e,function(t,e){for(var i=[],n=[],o=1;o<=t;o++)e.indexOf(o)>-1?(i.push(n),n=[]):n.push(o);return n.length>0&&i.push(n),i}(this.checkStave().getNumLines(),this.positions.map((function(t){return Number(t.str)}))),this.checkStave(),this.getStemDirection());i.save(),i.setLineWidth(M.WIDTH),o.forEach((function(e){0!==e.length&&(i.beginPath(),i.moveTo(t,e[0]),i.lineTo(t,e[e.length-1]),i.stroke(),i.closePath())})),i.restore()}},e.prototype.drawPositions=function(){for(var t=this.checkContext(),e=this.getAbsoluteX(),i=this.ys,n=0;n<this.positions.length;++n){var o=i[n]+this.render_options.y_shift,r=this.glyphs[n],a=e+this.glyph.getWidth()/2-r.getWidth()/2;if(t.clearRect(a-2,o-3,r.getWidth()+4,6),r.code)S.renderGlyph(t,a,o,this.render_options.glyph_font_scale*this.render_options.scale,r.code);else{t.save(),t.setRawFont(this.render_options.font);var s=r.text.toString();t.fillText(s,a,o+5*this.render_options.scale),t.restore()}}},e.prototype.draw=function(){var t=this.checkContext();if(0===this.ys.length)throw new h("NoYValues","Can't draw note without Y values.");this.setRendered();var e=null==this.beam&&this.render_options.draw_stem;if(t.openGroup("tabnote",void 0,{pointerBBox:!0}),this.drawPositions(),this.drawStemThrough(),this.stem&&e){var i=this.getStemX();this.stem.setNoteHeadXBounds(i,i),t.openGroup("stem",void 0,{pointerBBox:!0}),this.stem.setContext(t).draw(),t.closeGroup()}this.drawFlag(),this.drawModifiers(),t.closeGroup()},e}(L);function V(t){var e=0;return t.forEach((function(t){t.keyProps&&t.keyProps.forEach((function(t){e+=t.line-3}))})),e>=0?M.DOWN:M.UP}var z,K="L",J="B",q=function(t){function e(e,i){void 0===i&&(i=!1);var n,o,r=t.call(this)||this;if(r.slope=0,r.y_shift=0,r.setAttribute("type","Beam"),!e||0===e.length)throw new h("BadArguments","No notes provided for beam.");if(1===e.length)throw new h("BadArguments","Too few notes for beam.");if(r.ticks=e[0].getIntrinsicTicks(),r.ticks>=ei.durationToTicks("4"))throw new h("BadArguments","Beams can only be applied to notes shorter than a quarter note.");for(r.stem_direction=M.UP,n=0;n<e.length;++n)if((o=e[n]).hasStem()){r.stem_direction=o.getStemDirection();break}var a=r.stem_direction;if(i&&e[0].getCategory()===j.CATEGORY)a=V(e);else if(i&&e[0].getCategory()===X.CATEGORY){a=e.reduce((function(t,e){return t+e.getStemDirection()}),0)>-1?M.UP:M.DOWN}for(n=0;n<e.length;++n)o=e[n],i&&(o.setStemDirection(a),r.stem_direction=a),o.setBeam(r);return r.postFormatted=!1,r.notes=e,r.beam_count=r.getBeamCount(),r.break_on_indices=[],r.render_options={beam_width:5,max_slope:.25,min_slope:-.25,slope_iterations:20,slope_cost:100,show_stemlets:!1,stemlet_extension:7,partial_beam_length:10,flat_beams:!1,min_flat_beam_offset:15},r}return o(e,t),e.getDefaultBeamGroups=function(t){t&&"c"!==t||(t="4/4");var e={"1/2":["1/2"],"2/2":["1/2"],"3/2":["1/2"],"4/2":["1/2"],"1/4":["1/4"],"2/4":["1/4"],"3/4":["1/4"],"4/4":["1/4"],"1/8":["1/8"],"2/8":["2/8"],"3/8":["3/8"],"4/8":["2/8"],"1/16":["1/16"],"2/16":["2/16"],"3/16":["3/16"],"4/16":["2/16"]}[t];if(void 0!==e)return e.map((function(t){return(new f).parse(t)}));var i=parseInt(t.split("/")[0],10),n=parseInt(t.split("/")[1],10);return i%3==0?[new f(3,n)]:n>4?[new f(2,n)]:n<=4?[new f(1,n)]:[new f(1,4)]},e.applyAndGetBeams=function(t,i,n){return e.generateBeams(t.getTickables(),{groups:n,stem_direction:i})},e.generateBeams=function(t,i){i||(i={}),i.groups&&i.groups.length||(i.groups=[new f(2,8)]);var n,o,r,a=i.groups.map((function(t){if(!t.multiply)throw new h("InvalidBeamGroups","The beam groups must be an array of Vex.Flow.Fractions");return t.clone().multiply(ei.RESOLUTION,1)})),s=t,c=0,d=[],l=[];function p(){a.length-1>c?c+=1:c=0}n=[],o=new f(0,1),s.forEach((function(t){if(n=[],t.shouldIgnoreTicks())return d.push(l),void(l=n);l.push(t);var e,i=a[c].clone(),r=(e=l,e.reduce((function(t,e){return e.getTicks().clone().add(t)}),new f(0,1))).add(o),s=ei.durationToNumber(t.getDuration())<8;if(s&&t.getTuplet()&&(i.numerator*=2),r.greaterThan(i)){if(!s){var h=l.pop();h&&n.push(h)}d.push(l);do{o=r.subtract(a[c]),p()}while(o.greaterThanEquals(a[c]));l=n}else r.equals(i)&&(d.push(l),o=new f(0,1),l=n,p())})),l.length>0&&d.push(l),r=[],d.forEach((function(t){var e=[];t.forEach((function(t,n,o){var a=0===n||n===o.length-1,s=o[n-1],h=!i.beam_rests&&t.isRest(),c=i.beam_rests&&i.beam_middle_only&&t.isRest()&&a,d=!1;if(i.maintain_stem_directions&&s&&!t.isRest()&&!s.isRest()){var l=s.getStemDirection();d=t.getStemDirection()!==l}var p=parseInt(t.getDuration(),10)<8;h||c||d||p?(e.length>0&&r.push(e),e=d?[t]:[]):e.push(t)})),e.length>0&&r.push(e)})),(d=r).forEach((function(t){var e;if(i.maintain_stem_directions){var n=function(t){for(var e=0;e<t.length;e++){var i=t[e];if(!i.isRest())return i}return!1}(t);e=n?n.getStemDirection():M.UP}else e=i.stem_direction?i.stem_direction:V(t);!function(t,e){t.forEach((function(t){t.setStemDirection(e)}))}(t,e)}));var u,g=d.filter((function(t){if(t.length>1){var e=!0;return t.forEach((function(t){t.getIntrinsicTicks()>=ei.durationToTicks("4")&&(e=!1)})),e}return!1})),m=(u=[],d.forEach((function(t){var e;t.forEach((function(t){var i=t.getTuplet();i&&e!==i&&(e=i,u.push(e))}))})),u),y=[];return g.forEach((function(t){var n=new e(t);i.show_stemlets&&(n.render_options.show_stemlets=!0),i.secondary_breaks&&(n.render_options.secondary_break_ticks=ei.durationToTicks(i.secondary_breaks)),!0===i.flat_beams&&(n.render_options.flat_beams=!0,n.render_options.flat_beam_offset=i.flat_beam_offset),y.push(n)})),m.forEach((function(t){var e=t.notes[0].stem_direction===M.DOWN?B.LOCATION_BOTTOM:B.LOCATION_TOP;t.setTupletLocation(e);for(var i=!1,n=0;n<t.notes.length;n++){if(!t.notes[n].hasBeam()){i=!0;break}}t.setBracketed(i)})),y},e.prototype.getNotes=function(){return this.notes},e.prototype.getBeamCount=function(){return this.notes.map((function(t){return t.getGlyph().beam_count})).reduce((function(t,e){return e>t?e:t}))},e.prototype.breakSecondaryAt=function(t){return this.break_on_indices=t,this},e.prototype.getSlopeY=function(t,e,i,n){return i+(t-e)*n},e.prototype.calculateSlope=function(){for(var t=this,e=t.notes,i=t.stem_direction,n=t.render_options,o=n.max_slope,r=n.min_slope,a=n.slope_iterations,s=n.slope_cost,h=e[0],c=function(t,e){var i=t.getStemExtents().topY,n=t.getStemX();return(e.getStemExtents().topY-i)/(e.getStemX()-n)}(h,e[e.length-1]),d=(o-r)/a,l=Number.MAX_VALUE,p=0,u=0,f=r;f<=o;f+=d){for(var g=0,m=0,y=1;y<e.length;++y){var _=e[y],x=this.getSlopeY(_.getStemX(),h.getStemX(),h.getStemExtents().topY,f)+m,v=_.getStemExtents().topY;if(v*i<x*i){var S=Math.abs(v-x);m+=S*-i,g+=S*y}else g+=(v-x)*i}var b=c/2,w=s*Math.abs(b-f)+Math.abs(g);w<l&&(l=w,p=f,u=m)}this.slope=p,this.y_shift=u},e.prototype.calculateFlatSlope=function(){for(var t=this,e=t.notes,i=t.stem_direction,n=t.render_options,o=n.beam_width,r=n.min_flat_beam_offset,a=n.flat_beam_offset,s=0,h=0,c=0,d=0,l=0;l<e.length;l++){var p=e[l],u=p.getStemExtents().topY;s+=u,i===M.DOWN&&d<u?(d=u,h=Math.max.apply(Math,p.getYs()),c=p.getBeamCount()):i===M.UP&&(0===d||d>u)&&(d=u,h=Math.min.apply(Math,p.getYs()),c=p.getBeamCount())}var f=s/e.length,g=r+c*(1.5*o),m=h+g*-i;i===M.DOWN&&f<m?f=h+g:i===M.UP&&f>m&&(f=h-g),a?(i===M.DOWN&&f>a||i===M.UP&&f<a)&&(this.render_options.flat_beam_offset=f):this.render_options.flat_beam_offset=f,this.slope=0,this.y_shift=0},e.prototype.getBeamYToDraw=function(){var t=this.notes[0].getStemExtents().topY;return this.render_options.flat_beams&&this.render_options.flat_beam_offset&&(t=this.render_options.flat_beam_offset),t},e.prototype.applyStemExtensions=function(){for(var t=this,e=t.notes,i=t.slope,n=t.y_shift,o=t.stem_direction,r=t.beam_count,a=t.render_options,s=a.show_stemlets,c=a.stemlet_extension,d=a.beam_width,l=e[0],p=this.getBeamYToDraw(),u=l.getStemX(),f=0;f<e.length;++f){var g=e[f],m=g.getStem();if(!m)throw new h("NoStem","stem undefined.");var y=g.getStemX(),_=g.getStemExtents().topY,x=this.getSlopeY(y,u,p,i)+n,v=m.getExtension(),S=o===M.UP?_-x:x-_;if(m.setExtension(v+S),m.adjustHeightForBeam(),g.isRest()&&s){var b=(r-1)*d*1.5+d;m.setVisibility(!0).setStemlet(!0,b+c)}}},e.prototype.lookupBeamDirection=function(t,e,i,n){if("4"===t)return K;var o=""+ei.durationToNumber(t)/2,r=e<ei.durationToTicks(o),a=n<ei.durationToTicks(o),s=i<ei.durationToTicks(o);return r&&a&&s?J:r&&!a&&s?K:!r&&a&&s?"R":this.lookupBeamDirection(o,e,i,n)},e.prototype.getBeamLines=function(t){for(var e=ei.durationToTicks(t),i=!1,n=[],o=void 0,r=this.render_options.partial_beam_length,a=!1,s=0,h=0;h<this.notes.length;++h){var c=this.notes[h];s+=c.getTicks().value();var d=!1;parseInt(t,10)>=8&&(d=-1!==this.break_on_indices.indexOf(h),this.render_options.secondary_break_ticks&&s>=this.render_options.secondary_break_ticks&&(s=0,d=!0));var l=c.getIntrinsicTicks()<e,p=c.getStemX()-M.WIDTH/2,u=this.notes[h-1],f=this.notes[h+1],g=f&&f.getIntrinsicTicks()<e,m=u&&u.getIntrinsicTicks()<e,y=u&&f&&l&&!m&&!g;if(l)if(i)(o=n[n.length-1]).end=p,d&&(i=!1,f&&!g&&void 0===o.end&&(o.end=o.start-r));else{if(o={start:p,end:void 0},i=!0,y){var _=u.getIntrinsicTicks(),x=f.getIntrinsicTicks(),v=c.getIntrinsicTicks(),S=this.lookupBeamDirection(t,_,v,x);[K,J].includes(S)?o.end=o.start-r:o.end=o.start+r}else g?d&&(o.end=o.start-r,i=!1):o.end=(a||0===h)&&f?o.start+r:o.start-r;n.push(o)}else i=!1;a=d}var b=n[n.length-1];return b&&void 0===b.end&&(b.end=b.start-r),n},e.prototype.drawStems=function(t){this.notes.forEach((function(e){var i=e.getStem();i&&i.setContext(t).draw()}),this)},e.prototype.drawBeamLines=function(t){for(var e=["4","8","16","32","64"],i=this.notes[0],n=this.getBeamYToDraw(),o=i.getStemX(),r=this.render_options.beam_width*this.stem_direction,a=0;a<e.length;++a){for(var s=e[a],c=this.getBeamLines(s),d=0;d<c.length;++d){var l=c[d],p=l.start,u=this.getSlopeY(p,o,n,this.slope),f=l.end;if(!f)throw new h("NoLastBeamX","lastBeamX undefined.");var g=this.getSlopeY(f,o,n,this.slope);t.beginPath(),t.moveTo(p,u),t.lineTo(p,u+r),t.lineTo(f+1,g+r),t.lineTo(f+1,g),t.closePath(),t.fill()}n+=1.5*r}},e.prototype.preFormat=function(){return this},e.prototype.postFormat=function(){this.postFormatted||(this.notes[0].getCategory()===X.CATEGORY||this.render_options.flat_beams?this.calculateFlatSlope():this.calculateSlope(),this.applyStemExtensions(),this.postFormatted=!0)},e.prototype.draw=function(){var t=this.checkContext();this.setRendered(),this.unbeamable||(this.postFormatted||this.postFormat(),this.drawStems(t),this.applyStyle(),this.drawBeamLines(t),this.restoreStyle())},e}(y);!function(t){t[t.STRICT=1]="STRICT",t[t.SOFT=2]="SOFT",t[t.FULL=3]="FULL"}(z||(z={}));var Q=function(t){function e(i,n){var o=t.call(this)||this;if(o.setAttribute("type","Voice"),o.options=r({softmaxFactor:100},n),"string"==typeof i){var a=i.match(/(\d+)\/(\d+)/);a&&(i={num_beats:parseInt(a[1]),beat_value:parseInt(a[2]),resolution:ei.RESOLUTION})}return o.time=r({num_beats:4,beat_value:4,resolution:ei.RESOLUTION},i),o.totalTicks=new f(o.time.num_beats*(o.time.resolution/o.time.beat_value),1),o.resolutionMultiplier=1,o.tickables=[],o.ticksUsed=new f(0,1),o.smallestTickCount=o.totalTicks.clone(),o.largestTickWidth=0,o.mode=e.Mode.STRICT,o}return o(e,t),Object.defineProperty(e,"Mode",{get:function(){return z},enumerable:!1,configurable:!0}),e.prototype.getTotalTicks=function(){return this.totalTicks},e.prototype.getTicksUsed=function(){return this.ticksUsed},e.prototype.getLargestTickWidth=function(){return this.largestTickWidth},e.prototype.getSmallestTickCount=function(){return this.smallestTickCount},e.prototype.getTickables=function(){return this.tickables},e.prototype.getMode=function(){return this.mode},e.prototype.setMode=function(t){return this.mode=t,this},e.prototype.getResolutionMultiplier=function(){return this.resolutionMultiplier},e.prototype.getActualResolution=function(){return this.resolutionMultiplier*this.time.resolution},e.prototype.setStave=function(t){return this.stave=t,this.boundingBox=void 0,this},e.prototype.getBoundingBox=function(){var t,e,i;if(!this.boundingBox){for(t=void 0,i=0;i<this.tickables.length;++i)this.tickables[i].setStave(c(this.stave)),(e=this.tickables[i].getBoundingBox())&&(t=t?t.mergeWith(e):e);this.boundingBox=t}return this.boundingBox},e.prototype.setStrict=function(t){return this.mode=t?e.Mode.STRICT:e.Mode.SOFT,this},e.prototype.isComplete=function(){return this.mode!==e.Mode.STRICT&&this.mode!==e.Mode.FULL||this.ticksUsed.equals(this.totalTicks)},e.prototype.setSoftmaxFactor=function(t){return this.options.softmaxFactor=t,this},e.prototype.reCalculateExpTicksUsed=function(){var t=this,e=this.ticksUsed.value();return this.expTicksUsed=this.tickables.map((function(i){return Math.pow(t.options.softmaxFactor,i.getTicks().value()/e)})).reduce((function(t,e){return t+e})),this.expTicksUsed},e.prototype.softmax=function(t){var e=this;this.expTicksUsed||(this.expTicksUsed=this.reCalculateExpTicksUsed());var i,n=this.ticksUsed.value();return i=t,Math.pow(e.options.softmaxFactor,i/n)/this.expTicksUsed},e.prototype.addTickable=function(t){if(!t.shouldIgnoreTicks()){var i=t.getTicks();if(this.ticksUsed.add(i),this.expTicksUsed=0,(this.mode===e.Mode.STRICT||this.mode===e.Mode.FULL)&&this.ticksUsed.greaterThan(this.totalTicks))throw this.ticksUsed.subtract(i),new h("BadArgument","Too many ticks.");i.lessThan(this.smallestTickCount)&&(this.smallestTickCount=i.clone()),this.resolutionMultiplier=this.ticksUsed.denominator,this.totalTicks.add(0,this.ticksUsed.denominator)}return this.tickables.push(t),t.setVoice(this),this},e.prototype.addTickables=function(t){for(var e=0;e<t.length;++e)this.addTickable(t[e]);return this},e.prototype.preFormat=function(){if(this.preFormatted)return this;var t=c(this.stave);return this.tickables.forEach((function(e){e.getStave()||e.setStave(t)})),this.preFormatted=!0,this},e.prototype.draw=function(t,e){void 0===t&&(t=this.checkContext()),void 0===e&&(e=this.stave),this.setRendered();for(var i=void 0,n=0;n<this.tickables.length;++n){var o=this.tickables[n];if(e&&o.setStave(e),!o.getStave())throw new h("MissingStave","The voice cannot draw tickables without staves.");if(0===n&&(i=o.getBoundingBox()),n>0&&i){var r=o.getBoundingBox();r&&i.mergeWith(r)}o.setContext(t),o.drawWithStyle()}this.boundingBox=i},e}(y);function Z(t,e,i,n,o){if(e!==$.type.BOLD_DOUBLE_LEFT&&e!==$.type.BOLD_DOUBLE_RIGHT)throw new h("InvalidConnector","A REPEAT_BEGIN or REPEAT_END type must be provided.");var r=3,a=3.5;e===$.type.BOLD_DOUBLE_RIGHT&&(r=-5,a=3),t.fillRect(i+r,n,1,o-n),t.fillRect(i-2,n,a,o-n)}var $=function(t){function e(i,n){var o=t.call(this)||this;return o.setAttribute("type","StaveConnector"),o.thickness=ei.STAVE_LINE_THICKNESS,o.width=3,o.top_stave=i,o.bottom_stave=n,o.type=e.type.DOUBLE,o.font={family:"times",size:16,weight:"normal"},o.x_shift=0,o.texts=[],o}return o(e,t),e.prototype.setType=function(t){return(t="string"==typeof t?e.typeString[t]:t)>=e.type.SINGLE_RIGHT&&t<=e.type.NONE&&(this.type=t),this},e.prototype.setText=function(t,e){return this.texts.push({content:t,options:r({shift_x:0,shift_y:0},e)}),this},e.prototype.setFont=function(t){this.font=r(r({},this.font),t)},e.prototype.setXShift=function(t){if("number"!=typeof t)throw new h("InvalidType","x_shift must be a Number");return this.x_shift=t,this},e.prototype.draw=function(){var t=this.checkContext();this.setRendered();var i=this.top_stave.getYForLine(0),n=this.bottom_stave.getYForLine(this.bottom_stave.getNumLines()-1)+this.thickness,o=this.width,r=this.top_stave.getX();(this.type===e.type.SINGLE_RIGHT||this.type===e.type.BOLD_DOUBLE_RIGHT||this.type===e.type.THIN_DOUBLE)&&(r=this.top_stave.getX()+this.top_stave.getWidth());var a=n-i;switch(this.type){case e.type.SINGLE:case e.type.SINGLE_LEFT:case e.type.SINGLE_RIGHT:o=1;break;case e.type.DOUBLE:r-=this.width+2,i-=this.thickness,a+=.5;break;case e.type.BRACE:o=12;var s=this.top_stave.getX()-2+this.x_shift,c=i,d=s,l=n,p=s-o,u=c+a/2,f=p-.9*o,g=c+.2*a,m=s+1.1*o,y=u-.135*a,_=m,x=u+.135*a,v=f,b=l-.2*a,w=p-o,T=b,C=s+.4*o,E=u+.135*a,A=C,P=u-.135*a,k=w,D=g;t.beginPath(),t.moveTo(s,c),t.bezierCurveTo(f,g,m,y,p,u),t.bezierCurveTo(_,x,v,b,d,l),t.bezierCurveTo(w,T,C,E,p,u),t.bezierCurveTo(A,P,k,D,s,c),t.fill(),t.stroke();break;case e.type.BRACKET:a=(n+=6)-(i-=6),S.renderGlyph(t,r-5,i,40,"bracketTop"),S.renderGlyph(t,r-5,n,40,"bracketBottom"),r-=this.width+2;break;case e.type.BOLD_DOUBLE_LEFT:Z(t,this.type,r+this.x_shift,i,n-this.thickness);break;case e.type.BOLD_DOUBLE_RIGHT:Z(t,this.type,r,i,n-this.thickness);break;case e.type.THIN_DOUBLE:o=1,a-=this.thickness;break;case e.type.NONE:break;default:throw new h("InvalidType","The provided StaveConnector.type ("+this.type+") is invalid.")}this.type!==e.type.BRACE&&this.type!==e.type.BOLD_DOUBLE_LEFT&&this.type!==e.type.BOLD_DOUBLE_RIGHT&&this.type!==e.type.NONE&&t.fillRect(r,i,o,a),this.type===e.type.THIN_DOUBLE&&t.fillRect(r-3,i,o,a),t.save(),t.setLineWidth(2),t.setFont(this.font.family,this.font.size,this.font.weight);for(var F=0;F<this.texts.length;F++){var N=this.texts[F],M=t.measureText(""+N.content).width,B=this.top_stave.getX()-M-24+N.options.shift_x,O=(this.top_stave.getYForLine(0)+this.bottom_stave.getBottomLineY())/2+N.options.shift_y;t.fillText(""+N.content,B,O+4)}t.restore()},e.type={SINGLE_RIGHT:0,SINGLE_LEFT:1,SINGLE:1,DOUBLE:2,BRACE:3,BRACKET:4,BOLD_DOUBLE_LEFT:5,BOLD_DOUBLE_RIGHT:6,THIN_DOUBLE:7,NONE:8},e.typeString={singleRight:e.type.SINGLE_RIGHT,singleLeft:e.type.SINGLE_LEFT,single:e.type.SINGLE,double:e.type.DOUBLE,brace:e.type.BRACE,bracket:e.type.BRACKET,boldDoubleLeft:e.type.BOLD_DOUBLE_LEFT,boldDoubleRight:e.type.BOLD_DOUBLE_RIGHT,thinDouble:e.type.THIN_DOUBLE,none:e.type.NONE},e}(y),tt=function(t){function e(e){var i=t.call(this)||this;return i.setAttribute("type","FretHandFinger"),i.finger=e,i.width=7,i.position=F.Position.LEFT,i.x_shift=0,i.y_shift=0,i.x_offset=0,i.y_offset=0,i.font={family:"sans-serif",size:9,weight:"bold"},i}return o(e,t),Object.defineProperty(e,"CATEGORY",{get:function(){return"frethandfinger"},enumerable:!1,configurable:!0}),e.format=function(t,e){var i=e.left_shift,n=e.right_shift;if(!t||0===t.length)return!1;for(var o=[],r=null,a=0,s=0,h=0;h<t.length;++h){var c=(b=t[h]).getNote(),d=b.getPosition(),l=b.checkIndex(),p=c.getKeyProps()[l];if(c!==r){for(var u=0;u<c.keys.length;++u)0===i&&(a=Math.max(c.getLeftDisplacedHeadPx(),a)),0===n&&(s=Math.max(c.getRightDisplacedHeadPx(),s));r=c}o.push({note:c,num:b,pos:d,line:p.line,shiftL:a,shiftR:s})}o.sort((function(t,e){return e.line-t.line}));var f=0,g=0,m=0,y=0,_=null,x=null;for(h=0;h<o.length;++h){var v=0,S=o[h],b=(c=S.note,d=S.pos,S.num),w=S.line,T=S.shiftL,C=S.shiftR;w===_&&c===x||(f=i+T,g=n+C);var E=b.getWidth()+1;d===F.Position.LEFT?(b.setXShift(i+f),m=(v=i+E)>m?v:m):d===F.Position.RIGHT&&(b.setXShift(g),y=(v=s+E)>y?v:y),_=w,x=c}return e.left_shift+=m,e.right_shift+=y,!0},e.easyScoreHook=function(t,e,i){var n=(void 0===t?{}:t).fingerings;n&&n.split(",").map((function(t){var e=t.trim().split("."),n={number:e[0]};return e[1]&&(n.position=e[1]),i.getFactory().Fingering(n)})).map((function(t,i){return e.addModifier(t,i)}))},e.prototype.getCategory=function(){return e.CATEGORY},e.prototype.setFretHandFinger=function(t){return this.finger=t,this},e.prototype.getFretHandFinger=function(){return this.finger},e.prototype.setOffsetX=function(t){return this.x_offset=t,this},e.prototype.setOffsetY=function(t){return this.y_offset=t,this},e.prototype.draw=function(){var t=this.checkContext(),e=this.checkAttachedNote();this.setRendered();var i=e.getModifierStartXY(this.position,this.index),n=i.x+this.x_shift+this.x_offset,o=i.y+this.y_shift+this.y_offset+5;switch(this.position){case F.Position.ABOVE:n-=4,o-=12;break;case F.Position.BELOW:n-=2,o+=10;break;case F.Position.LEFT:n-=this.width;break;case F.Position.RIGHT:n+=1;break;default:throw new h("InvalidPosition","The position "+this.position+" does not exist")}t.save(),t.setFont(this.font.family,this.font.size,this.font.weight),t.fillText(""+this.finger,n,o),t.restore()},e}(F),et=function(t){function e(e){var i=t.call(this)||this;return i.setAttribute("type","NoteSubGroup"),i.position=F.Position.LEFT,i.subNotes=e,i.subNotes.forEach((function(t){t.setIgnoreTicks(!1)})),i.width=0,i.preFormatted=!1,i.formatter=new ee,i.voice=new Q({num_beats:4,beat_value:4,resolution:ei.RESOLUTION}).setStrict(!1),i.voice.addTickables(i.subNotes),i}return o(e,t),Object.defineProperty(e,"CATEGORY",{get:function(){return"notesubgroup"},enumerable:!1,configurable:!0}),e.format=function(t,e){if(!t||0===t.length)return!1;for(var i=0,n=0;n<t.length;++n){var o=t[n];o.preFormat(),i+=o.getWidth()}return e.left_shift+=i,!0},e.prototype.getCategory=function(){return e.CATEGORY},e.prototype.preFormat=function(){this.preFormatted||(this.formatter.joinVoices([this.voice]).format([this.voice],0),this.setWidth(this.formatter.getMinTotalWidth()),this.preFormatted=!0)},e.prototype.setWidth=function(t){return this.width=t,this},e.prototype.getWidth=function(){return this.width},e.prototype.draw=function(){var t=this.checkContext(),e=this.checkAttachedNote();this.setRendered(),this.alignSubNotesWithNote(this.subNotes,e),this.subNotes.forEach((function(e){return e.setContext(t).drawWithStyle()}))},e}(F),it=function(t){function e(e,i){var n=t.call(this)||this;return n.setAttribute("type","Stroke"),n.options=r({},i),n.all_voices=!("all_voices"in n.options)||n.options.all_voices,n.type=e,n.position=F.Position.LEFT,n.render_options={font_scale:38,stroke_px:3,stroke_spacing:10},n.font={family:"serif",size:10,weight:"bold italic"},n.setXShift(0),n.setWidth(10),n}return o(e,t),Object.defineProperty(e,"CATEGORY",{get:function(){return"strokes"},enumerable:!1,configurable:!0}),e.format=function(t,e){var i=e.left_shift;if(!t||0===t.length)return!1;var n=t.map((function(t){var e=t.getNote(),i=t.checkIndex();if(e instanceof j)return{line:e.getKeyProps()[i].line,shift:e.getLeftDisplacedHeadPx(),stroke:t};if(e instanceof X)return{line:e.getPositions()[i].str,shift:0,stroke:t};throw new h("Internal","Unexpexted")})),o=i,r=n.reduce((function(t,e){var i=e.stroke,n=e.shift;return i.setXShift(o+n),Math.max(i.getWidth()+0,t)}),0);return e.left_shift+=r,!0},e.prototype.getCategory=function(){return e.CATEGORY},e.prototype.getPosition=function(){return this.position},e.prototype.addEndNote=function(t){return this.note_end=t,this},e.prototype.draw=function(){var t=this.checkContext(),i=this.checkAttachedNote();this.setRendered();for(var n=i.getModifierStartXY(this.position,this.index),o=i.getYs(),r=n.y,a=n.y,s=n.x-5,c=i.checkStave().getOptions().spacing_between_lines_px,d=this.checkModifierContext().getMembers(i.getCategory()),l=0;l<d.length;l++){var p=d[l];if(p instanceof R){o=p.getYs();for(var u=0;u<o.length;u++)(this.note===d[l]||this.all_voices)&&(r=Math.min(r,o[u]),a=Math.max(a,o[u]))}}var f="",g=0,m=0,y=0,_=0;switch(this.type){case e.Type.BRUSH_DOWN:f="arrowheadBlackUp",g=-3,m=r-c/2+10,a+=c/2;break;case e.Type.BRUSH_UP:f="arrowheadBlackDown",g=.5,m=a+c/2,r-=c/2;break;case e.Type.ROLL_DOWN:case e.Type.RASQUEDO_DOWN:f="arrowheadBlackUp",g=-3,y=this.x_shift+g-2,i instanceof j?(m=(r+=1.5*c)-c,_=(a+=(a-r)%2!=0?.5*c:c)+c+2):(m=(r+=1.5*c)-.75*c,_=(a+=c)+.25*c);break;case e.Type.ROLL_UP:case e.Type.RASQUEDO_UP:f="arrowheadBlackDown",g=-4,y=this.x_shift+g-1,i instanceof j?(m=c/2,(a-(r+=.5*c))%2==0&&(a+=c/2),m=a+.5*c,_=r-1.25*c):(m=(a+=.5*c)+.25*c,_=(r+=.25*c)-c);break;case e.Type.ARPEGGIO_DIRECTIONLESS:r+=.5*c,a+=c;break;default:throw new h("InvalidType","The stroke type "+this.type+" does not exist")}var x="straight";if(this.type===e.Type.BRUSH_DOWN||this.type===e.Type.BRUSH_UP)t.fillRect(s+this.x_shift,r,1,a-r);else if(x="wiggly",i instanceof j)for(l=r;l<=a;l+=c)S.renderGlyph(t,s+this.x_shift-4,l,this.render_options.font_scale,"vexWiggleArpeggioUp");else{l=void 0;for(l=r;l<=a;l+=10)S.renderGlyph(t,s+this.x_shift-4,l,this.render_options.font_scale,"vexWiggleArpeggioUp");this.type===e.Type.RASQUEDO_DOWN&&(_=l+.25*c)}this.type!==e.Type.ARPEGGIO_DIRECTIONLESS&&(S.renderGlyph(t,s+this.x_shift+g,m,this.render_options.font_scale,f,{category:"stroke."+f+"."+x}),this.type!==e.Type.RASQUEDO_DOWN&&this.type!==e.Type.RASQUEDO_UP||(t.save(),t.setFont(this.font.family,this.font.size,this.font.weight),t.fillText("R",s+y,_),t.restore()))},e.Type={BRUSH_DOWN:1,BRUSH_UP:2,ROLL_DOWN:3,ROLL_UP:4,RASQUEDO_DOWN:5,RASQUEDO_UP:6,ARPEGGIO_DIRECTIONLESS:7},e}(F),nt=function(){function t(e){this.vexFlowCanvasContext=e,e.canvas?this.canvas=e.canvas:this.canvas={width:t.WIDTH,height:t.HEIGHT}}return Object.defineProperty(t,"WIDTH",{get:function(){return 600},enumerable:!1,configurable:!0}),Object.defineProperty(t,"HEIGHT",{get:function(){return 400},enumerable:!1,configurable:!0}),Object.defineProperty(t,"CANVAS_BROWSER_SIZE_LIMIT",{get:function(){return 32767},enumerable:!1,configurable:!0}),t.SanitizeCanvasDims=function(t,e){return Math.max(t,e)>this.CANVAS_BROWSER_SIZE_LIMIT&&(l("Canvas dimensions exceed browser limit. Cropping to "+this.CANVAS_BROWSER_SIZE_LIMIT),t>this.CANVAS_BROWSER_SIZE_LIMIT&&(t=this.CANVAS_BROWSER_SIZE_LIMIT),e>this.CANVAS_BROWSER_SIZE_LIMIT&&(e=this.CANVAS_BROWSER_SIZE_LIMIT)),[t,e]},t.prototype.clear=function(){this.vexFlowCanvasContext.clearRect(0,0,this.canvas.width,this.canvas.height)},t.prototype.openGroup=function(t,e,i){},t.prototype.closeGroup=function(){},t.prototype.add=function(t){},t.prototype.setFont=function(t,e,i){return this.vexFlowCanvasContext.font=(i||"")+" "+e+"pt "+t,this},t.prototype.setRawFont=function(t){return this.vexFlowCanvasContext.font=t,this},t.prototype.setFillStyle=function(t){return this.vexFlowCanvasContext.fillStyle=t,this},t.prototype.setBackgroundFillStyle=function(t){return this.background_fillStyle=t,this},t.prototype.setStrokeStyle=function(t){return this.vexFlowCanvasContext.strokeStyle=t,this},t.prototype.setShadowColor=function(t){return this.vexFlowCanvasContext.shadowColor=t,this},t.prototype.setShadowBlur=function(t){return this.vexFlowCanvasContext.shadowBlur=t,this},t.prototype.setLineWidth=function(t){return this.vexFlowCanvasContext.lineWidth=t,this},t.prototype.setLineCap=function(t){return this.vexFlowCanvasContext.lineCap=t,this},t.prototype.setLineDash=function(t){return this.vexFlowCanvasContext.lineDash=t,this},t.prototype.scale=function(t,e){return this.vexFlowCanvasContext.scale(t,e),this},t.prototype.resize=function(t,e){return this},t.prototype.rect=function(t,e,i,n){return this.vexFlowCanvasContext.rect(t,e,i,n),this},t.prototype.fillRect=function(t,e,i,n){return this.vexFlowCanvasContext.fillRect(t,e,i,n),this},t.prototype.clearRect=function(t,e,i,n){return this.vexFlowCanvasContext.clearRect(t,e,i,n),this},t.prototype.beginPath=function(){return this.vexFlowCanvasContext.beginPath(),this},t.prototype.moveTo=function(t,e){return this.vexFlowCanvasContext.moveTo(t,e),this},t.prototype.lineTo=function(t,e){return this.vexFlowCanvasContext.lineTo(t,e),this},t.prototype.bezierCurveTo=function(t,e,i,n,o,r){return this.vexFlowCanvasContext.bezierCurveTo(t,e,i,n,o,r),this},t.prototype.quadraticCurveTo=function(t,e,i,n){return this.vexFlowCanvasContext.quadraticCurveTo(t,e,i,n),this},t.prototype.arc=function(t,e,i,n,o,r){return this.vexFlowCanvasContext.arc(t,e,i,n,o,r),this},t.prototype.glow=function(){return this},t.prototype.fill=function(){return this.vexFlowCanvasContext.fill(),this},t.prototype.stroke=function(){return this.vexFlowCanvasContext.stroke(),this},t.prototype.closePath=function(){return this.vexFlowCanvasContext.closePath(),this},t.prototype.measureText=function(t){return this.vexFlowCanvasContext.measureText(t)},t.prototype.fillText=function(t,e,i){return this.vexFlowCanvasContext.fillText(t,e,i),this},t.prototype.save=function(){return this.vexFlowCanvasContext.save(),this},t.prototype.restore=function(){return this.vexFlowCanvasContext.restore(),this},Object.defineProperty(t.prototype,"font",{set:function(t){this.vexFlowCanvasContext.font=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fillStyle",{set:function(t){this.vexFlowCanvasContext.fillStyle=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"strokeStyle",{set:function(t){this.vexFlowCanvasContext.strokeStyle=t},enumerable:!1,configurable:!0}),t}(),ot={path:{x:!0,y:!0,width:!0,height:!0,"font-family":!0,"font-weight":!0,"font-style":!0,"font-size":!0},rect:{"font-family":!0,"font-weight":!0,"font-style":!0,"font-size":!0},text:{width:!0,height:!0}},rt=function(){function t(t){this.width=0,this.height=0,this.fontSize=0,this.element=t;var e=this.create("svg");this.element.appendChild(e),this.svg=e,this.groups=[this.svg],this.parent=this.svg,this.path="",this.pen={x:NaN,y:NaN},this.lineWidth=1,this.state={scale:{x:1,y:1},"font-family":"Arial","font-size":"8pt","font-weight":"normal"};var i={"stroke-dasharray":"none","font-family":"Arial","font-size":"10pt","font-weight":"normal","font-style":"normal"};this.attributes=r({"stroke-width":.3,fill:"black",stroke:"black"},i),this.background_attributes=r({"stroke-width":0,fill:"white",stroke:"white"},i),this.shadow_attributes={width:0,color:"black"},this.state_stack=[],this.iePolyfill()}return t.prototype.create=function(t){return document.createElementNS("http://www.w3.org/2000/svg",t)},t.prototype.openGroup=function(t,e,i){var n=this.create("g");return this.groups.push(n),this.parent.appendChild(n),this.parent=n,t&&n.setAttribute("class",u(t)),e&&n.setAttribute("id",u(e)),i&&i.pointerBBox&&n.setAttribute("pointer-events","bounding-box"),n},t.prototype.closeGroup=function(){this.groups.pop(),this.parent=this.groups[this.groups.length-1]},t.prototype.add=function(t){this.parent.appendChild(t)},t.prototype.iePolyfill=function(){"undefined"!=typeof navigator&&(this.ie=/MSIE 9/i.test(navigator.userAgent)||/MSIE 10/i.test(navigator.userAgent)||/rv:11\.0/i.test(navigator.userAgent)||/Trident/i.test(navigator.userAgent))},t.prototype.setFont=function(t,e,i){var n=!1,o=!1,a="normal";"string"==typeof i&&(-1!==i.indexOf("italic")&&(i=i.replace(/italic/g,""),o=!0),-1!==i.indexOf("bold")&&(i=i.replace(/bold/g,""),n=!0),i=i.replace(/ /g,""));var s={"font-family":t,"font-size":e+"pt","font-weight":i=void 0===(i=n?"bold":i)||""===i?"normal":i,"font-style":a=o?"italic":a};return this.fontSize=Number(e),this.attributes=r(r({},this.attributes),s),this.state=r(r({},this.state),s),this},t.prototype.setRawFont=function(t){var e=(t=t.trim()).split(" "),i=e[1],n=e[0];return this.attributes["font-family"]=i,this.state["font-family"]=i,this.attributes["font-size"]=n,this.state["font-size"]=n,this.fontSize=Number(n.match(/\d+/)),this},t.prototype.setFillStyle=function(t){return this.attributes.fill=t,this},t.prototype.setBackgroundFillStyle=function(t){return this.background_attributes.fill=t,this.background_attributes.stroke=t,this},t.prototype.setStrokeStyle=function(t){return this.attributes.stroke=t,this},t.prototype.setShadowColor=function(t){return this.shadow_attributes.color=t,this},t.prototype.setShadowBlur=function(t){return this.shadow_attributes.width=t,this},t.prototype.setLineWidth=function(t){return this.attributes["stroke-width"]=t,this.lineWidth=t,this},t.prototype.setLineDash=function(t){if("[object Array]"===Object.prototype.toString.call(t))return this.attributes["stroke-dasharray"]=t.join(","),this;throw new h("ArgumentError","lineDash must be an array of integers.")},t.prototype.setLineCap=function(t){return this.attributes["stroke-linecap"]=t,this},t.prototype.resize=function(t,e){this.width=t,this.height=e,this.element.style.width=t.toString(),this.svg.style.width=t.toString(),this.svg.style.height=e.toString();var i={width:t,height:e};return this.applyAttributes(this.svg,i),this.scale(this.state.scale.x,this.state.scale.y),this},t.prototype.scale=function(t,e){this.state.scale={x:t,y:e};var i=this.width/t,n=this.height/e;return this.setViewBox(0,0,i,n),this},t.prototype.setViewBox=function(t,e,i,n){if("string"==typeof t)this.svg.setAttribute("viewBox",t);else{var o=t+" "+e+" "+i+" "+n;this.svg.setAttribute("viewBox",o)}},t.prototype.applyAttributes=function(t,e){var i=ot[t.nodeName];return Object.keys(e).forEach((function(n){i&&i[n]||t.setAttributeNS(null,n,e[n])})),t},t.prototype.clear=function(){for(;this.svg.lastChild;)this.svg.removeChild(this.svg.lastChild);this.scale(this.state.scale.x,this.state.scale.y)},t.prototype.rect=function(t,e,i,n,o){n<0&&(e+=n,n*=-1);var a=this.create("rect");return void 0===o&&(o={fill:"none","stroke-width":this.lineWidth,stroke:"black"}),o=r(r({},o),{x:t,y:e,width:i,height:n}),this.applyAttributes(a,o),this.add(a),this},t.prototype.fillRect=function(t,e,i,n){return n<0&&(e+=n,n*=-1),this.rect(t,e,i,n,this.attributes),this},t.prototype.clearRect=function(t,e,i,n){return this.rect(t,e,i,n,this.background_attributes),this},t.prototype.beginPath=function(){return this.path="",this.pen.x=NaN,this.pen.y=NaN,this},t.prototype.moveTo=function(t,e){return this.path+="M"+t+" "+e,this.pen.x=t,this.pen.y=e,this},t.prototype.lineTo=function(t,e){return this.path+="L"+t+" "+e,this.pen.x=t,this.pen.y=e,this},t.prototype.bezierCurveTo=function(t,e,i,n,o,r){return this.path+="C"+t+" "+e+","+i+" "+n+","+o+" "+r,this.pen.x=o,this.pen.y=r,this},t.prototype.quadraticCurveTo=function(t,e,i,n){return this.path+="Q"+t+" "+e+","+i+" "+n,this.pen.x=i,this.pen.y=n,this},t.prototype.arc=function(t,e,i,n,o,r){function a(t){for(;t<0;)t+=2*Math.PI;for(;t>2*Math.PI;)t-=2*Math.PI;return t}if((n=a(n))>(o=a(o))){var s=n;n=o,o=s,r=!r}var h=o-n;return h>Math.PI?(this.arcHelper(t,e,i,n,n+h/2,r),this.arcHelper(t,e,i,n+h/2,o,r)):this.arcHelper(t,e,i,n,o,r),this},t.prototype.arcHelper=function(t,e,i,n,o,r){var a=t+i*Math.cos(n),s=e+i*Math.sin(n),h=t+i*Math.cos(o),c=e+i*Math.sin(o),d=0,l=0;r?(l=1,o-n<Math.PI&&(d=1)):o-n>Math.PI&&(d=1),this.path+="M"+a+" "+s+" A"+i+" "+i+" 0 "+d+" "+l+" "+h+" "+c,isNaN(this.pen.x)||isNaN(this.pen.y)||(this.path+="M"+this.pen.x+" "+this.pen.y)},t.prototype.closePath=function(){return this.path+="Z",this},t.prototype.glow=function(){if(this.shadow_attributes.width>0)for(var t=this.shadow_attributes,e=t.width/2,i=1;i<=e;i++){var n={stroke:t.color,"stroke-linejoin":"round","stroke-linecap":"round","stroke-width":+(.4*t.width/e*i).toFixed(3),opacity:+((t.opacity||.3)/e).toFixed(3)},o=this.create("path");n.d=this.path,this.applyAttributes(o,n),this.add(o)}return this},t.prototype.fill=function(t){this.glow();var e=this.create("path");return void 0===t&&(t=r(r({},this.attributes),{stroke:"none"})),t.d=this.path,this.applyAttributes(e,t),this.add(e),this},t.prototype.stroke=function(){this.glow();var t=this.create("path"),e=r(r({},this.attributes),{fill:"none","stroke-width":this.lineWidth,d:this.path});return this.applyAttributes(t,e),this.add(t),this},t.prototype.measureText=function(t){var e=this.create("text");if("function"!=typeof e.getBBox)return{x:0,y:0,width:0,height:0};e.textContent=t,this.applyAttributes(e,this.attributes),this.svg.appendChild(e);var i=e.getBBox();return this.ie&&""!==t&&"italic"===this.attributes["font-style"]&&(i=this.ieMeasureTextFix(i)),this.svg.removeChild(e),i},t.prototype.ieMeasureTextFix=function(t){var e=1.196*Number(this.fontSize)+1.9598,i=t.width-e,n=t.height-1.5;return{x:t.x,y:t.y,width:i,height:n}},t.prototype.fillText=function(t,e,i){if(!t||t.length<=0)return this;var n=r(r({},this.attributes),{stroke:"none",x:e,y:i}),o=this.create("text");return o.textContent=t,this.applyAttributes(o,n),this.add(o),this},t.prototype.save=function(){return this.state_stack.push({state:{"font-family":this.state["font-family"],"font-weight":this.state["font-weight"],"font-style":this.state["font-style"],"font-size":this.state["font-size"],scale:this.state.scale},attributes:{"font-family":this.attributes["font-family"],"font-weight":this.attributes["font-weight"],"font-style":this.attributes["font-style"],"font-size":this.attributes["font-size"],fill:this.attributes.fill,stroke:this.attributes.stroke,"stroke-width":this.attributes["stroke-width"],"stroke-dasharray":this.attributes["stroke-dasharray"]},shadow_attributes:{width:this.shadow_attributes.width,color:this.shadow_attributes.color},lineWidth:this.lineWidth}),this},t.prototype.restore=function(){var t=this.state_stack.pop();if(t){var e=t;this.state["font-family"]=e.state["font-family"],this.state["font-weight"]=e.state["font-weight"],this.state["font-style"]=e.state["font-style"],this.state["font-size"]=e.state["font-size"],this.state.scale=e.state.scale,this.attributes["font-family"]=e.attributes["font-family"],this.attributes["font-weight"]=e.attributes["font-weight"],this.attributes["font-style"]=e.attributes["font-style"],this.attributes["font-size"]=e.attributes["font-size"],this.attributes.fill=e.attributes.fill,this.attributes.stroke=e.attributes.stroke,this.attributes["stroke-width"]=e.attributes["stroke-width"],this.attributes["stroke-dasharray"]=e.attributes["stroke-dasharray"],this.shadow_attributes.width=e.shadow_attributes.width,this.shadow_attributes.color=e.shadow_attributes.color,this.lineWidth=e.lineWidth}return this},Object.defineProperty(t.prototype,"font",{set:function(t){this.setRawFont(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fillStyle",{set:function(t){this.setFillStyle(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"strokeStyle",{set:function(t){this.setStrokeStyle(t)},enumerable:!1,configurable:!0}),t}(),at=function(){function t(e,i){if(this.elementId=e,void 0===this.elementId)throw new h("BadArgument","Invalid id for renderer.");if(this.element=document.getElementById(e),this.element||(this.element=e),this.backend=i,this.backend===t.Backends.CANVAS){if(!this.element.getContext)throw new h("BadElement","Can't get canvas context from element: "+e);this.ctx=t.bolsterCanvasContext(this.element.getContext("2d"))}else{if(this.backend!==t.Backends.SVG)throw new h("InvalidBackend","No support for backend: "+this.backend);this.ctx=new rt(this.element)}}return t.buildContext=function(e,i,n,o,r){var a=new t(e,i);n&&o&&a.resize(n,o),r||(r="#FFF");var s=a.getContext();return s.setBackgroundFillStyle(r),t.lastContext=s,s},t.getCanvasContext=function(e,i,n,o){return t.buildContext(e,t.Backends.CANVAS,i,n,o)},t.getSVGContext=function(e,i,n,o){return t.buildContext(e,t.Backends.SVG,i,n,o)},t.bolsterCanvasContext=function(e){if(t.USE_CANVAS_PROXY)return new nt(e);return e.vexFlowCanvasContext=e,["clear","setFont","setRawFont","setFillStyle","setBackgroundFillStyle","setStrokeStyle","setShadowColor","setShadowBlur","setLineWidth","setLineCap","openGroup","closeGroup","getGroup"].forEach((function(t){t in e||(e[t]=nt.prototype[t])})),e},t.drawDashedLine=function(t,e,i,n,o,r){t.beginPath();var a=n-e,s=o-i,h=Math.atan2(s,a),c=e,d=i;t.moveTo(e,i);for(var l=0,p=!0;!(a<0?c<=n:c>=n)||!(s<0?d<=o:d>=o);){var u=r[l++%r.length],f=c+Math.cos(h)*u;c=a<0?Math.max(n,f):Math.min(n,f);var g=d+Math.sin(h)*u;d=s<0?Math.max(o,g):Math.min(o,g),p?t.lineTo(c,d):t.moveTo(c,d),p=!p}t.closePath(),t.stroke()},t.prototype.resize=function(e,i){var n;if(this.backend===t.Backends.CANVAS){if(!this.element.getContext)throw new h("BadElement","Can't get canvas context from element: "+this.elementId);e=(n=nt.SanitizeCanvasDims(e,i))[0],i=n[1];var o=window.devicePixelRatio||1;this.element.width=e*o,this.element.height=i*o,this.element.style.width=e+"px",this.element.style.height=i+"px",this.ctx=t.bolsterCanvasContext(this.element.getContext("2d")),this.ctx.scale(o,o)}else this.ctx.resize(e,i);return this},t.prototype.getContext=function(){return this.ctx},t.Backends={CANVAS:1,SVG:2},t.LineEndType={NONE:1,UP:2,DOWN:3},t.USE_CANVAS_PROXY=!1,t.lastContext=void 0,t}(),st=function(t){function e(e){var i=t.call(this)||this;return i.setAttribute("type","StringNumber"),i.string_number=e,i.setWidth(20),i.position=F.Position.ABOVE,i.x_shift=0,i.y_shift=0,i.x_offset=0,i.y_offset=0,i.dashed=!0,i.leg=at.LineEndType.NONE,i.radius=8,i.font={family:"sans-serif",size:10,weight:"bold"},i}return o(e,t),Object.defineProperty(e,"CATEGORY",{get:function(){return"stringnumber"},enumerable:!1,configurable:!0}),e.format=function(t,e){var i=e.left_shift,n=e.right_shift;if(!t||0===t.length)return!1;for(var o=[],r=null,a=0,s=0,c=0;c<t.length;++c){var d=(S=t[c]).getNote(),l=S.getPosition();if(!(d instanceof j))throw new h("NoStaveNote");var p=S.checkIndex(),u=d.getKeyProps()[p];if(d!==r){for(var f=0;f<d.keys.length;++f)0===i&&(a=Math.max(d.getLeftDisplacedHeadPx(),a)),0===n&&(s=Math.max(d.getRightDisplacedHeadPx(),s));r=d}o.push({pos:l,note:d,num:S,line:u.line,shiftL:a,shiftR:s})}o.sort((function(t,e){return e.line-t.line}));var g=0,m=0,y=0,_=null,x=null;for(c=0;c<o.length;++c){var v=0,S=(d=o[c].note,l=o[c].pos,o[c].num),b=o[c].line,w=o[c].shiftR;b===_&&d===x||(g=n+w);var T=S.getWidth()+1;l===F.Position.LEFT?(S.setXShift(i),m=(v=a+T)>m?v:m):l===F.Position.RIGHT&&(S.setXShift(g),y=(v+=T)>y?v:y),_=b,x=d}return e.left_shift+=m,e.right_shift+=y,!0},e.prototype.getCategory=function(){return e.CATEGORY},e.prototype.setLineEndType=function(t){return t>=at.LineEndType.NONE&&t<=at.LineEndType.DOWN&&(this.leg=t),this},e.prototype.setStringNumber=function(t){return this.string_number=t,this},e.prototype.setOffsetX=function(t){return this.x_offset=t,this},e.prototype.setOffsetY=function(t){return this.y_offset=t,this},e.prototype.setLastNote=function(t){return this.last_note=t,this},e.prototype.setDashed=function(t){return this.dashed=t,this},e.prototype.draw=function(){var t=this.checkContext(),e=this.checkAttachedNote();this.setRendered();var i=e.checkStave().getOptions().spacing_between_lines_px,n=e.getModifierStartXY(this.position,this.index),o=n.x+this.x_shift+this.x_offset,r=n.y+this.y_shift+this.y_offset;switch(this.position){case F.Position.ABOVE:case F.Position.BELOW:var a=e.getStemExtents(),s=a.topY,c=a.baseY+2;e.getStemDirection()===j.STEM_DOWN&&(s=a.baseY,c=a.topY-2),r=this.position===F.Position.ABOVE?e.hasStem()?s-1.75*i:n.y-1.75*i:e.hasStem()?c+1.5*i:n.y+1.75*i,r+=this.y_shift+this.y_offset;break;case F.Position.LEFT:o-=this.radius/2+5;break;case F.Position.RIGHT:o+=this.radius/2+6;break;default:throw new h("InvalidPosition","The position "+this.position+" is invalid")}t.save(),t.beginPath(),t.arc(o,r,this.radius,0,2*Math.PI,!1),t.setLineWidth(1.5),t.stroke(),t.setFont(this.font.family,this.font.size,this.font.weight);var d=o-t.measureText(this.string_number).width/2;if(t.fillText(""+this.string_number,d,r+4.5),this.last_note instanceof L){var l=this.last_note.getStemX()-e.getX()+5;t.setStrokeStyle("#000000"),t.setLineCap("round"),t.setLineWidth(.6),this.dashed?at.drawDashedLine(t,o+10,r,o+l,r,[3,3]):at.drawDashedLine(t,o+10,r,o+l,r,[3,0]);var p=void 0,u=void 0;switch(this.leg){case at.LineEndType.UP:p=-10,u=this.dashed?[3,3]:[3,0],at.drawDashedLine(t,o+l,r,o+l,r+p,u);break;case at.LineEndType.DOWN:p=10,u=this.dashed?[3,3]:[3,0],at.drawDashedLine(t,o+l,r,o+l,r+p,u)}}t.restore()},e}(F);function ht(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];mt.DEBUG&&d("Vex.Flow.Articulation",t)}var ct=F.Position,dt=ct.ABOVE,lt=ct.BELOW;function pt(t,e){return.5*t(e/.5)}function ut(t,e){return e===dt?t<=5:t>=1}function ft(t,e){return ut(t,e)?e===dt?Math.ceil:Math.floor:Math.round}function gt(t){var e=t.getCategory();return e===j.CATEGORY||e===Y.CATEGORY}var mt=function(t){function e(e){var i=t.call(this)||this;return i.setAttribute("type","Articulation"),i.type=e,i.position=lt,i.render_options={font_scale:38},i.reset(),i}return o(e,t),Object.defineProperty(e,"CATEGORY",{get:function(){return"articulations"},enumerable:!1,configurable:!0}),e.format=function(t,e){if(!t||0===t.length)return!1;var i=function(t,e,i){return pt(ft(e,i),c(t.glyph.getMetrics().height)/10+.5)};t.filter((function(t){return t.getPosition()===dt})).forEach((function(t){t.setTextLine(e.top_text_line),e.top_text_line+=i(t,e.top_text_line,dt)})),t.filter((function(t){return t.getPosition()===lt})).forEach((function(t){t.setTextLine(e.text_line),e.text_line+=i(t,e.text_line,lt)}));var n=t.map((function(t){return t.getWidth()})).reduce((function(t,e){return Math.max(e,t)}));return e.left_shift+=n/2,e.right_shift+=n/2,!0},e.easyScoreHook=function(t,e,i){var n=t.articulations;if(n){var o={staccato:"a.",tenuto:"a-",accent:"a>"};n.split(",").map((function(t){return t.trim().split(".")})).map((function(t){var e=t[0],n=t[1],r={type:o[e]};return n&&(r.position=F.PositionString[n]),i.getFactory().Articulation(r)})).map((function(t){return e.addModifier(t,0)}))}},e.prototype.reset=function(){if(this.articulation=ei.articulationCodes(this.type),!this.articulation)throw new h("ArgumentError","Articulation not found: "+this.type);var t=(this.position===dt?this.articulation.aboveCode:this.articulation.belowCode)||this.articulation.code;this.glyph=new S(null!=t?t:"",this.render_options.font_scale),this.setWidth(c(this.glyph.getMetrics().width))},e.prototype.getCategory=function(){return e.CATEGORY},e.prototype.draw=function(){var t,i=this.checkContext(),n=this.checkAttachedNote();this.setRendered();var o=this.checkIndex(),r=this,a=r.position,s=r.glyph,c=r.text_line,d=this.articulation.between_lines,l=n.checkStave(),p=l.getSpacingBetweenLines(),u=n.getCategory()===X.CATEGORY,f=n.getModifierStartXY(a,o).x,g=!d||u,m=function(t,e){var i=e===dt&&t.getStemDirection()===M.UP||e===lt&&t.getStemDirection()===M.DOWN;return gt(t)?t.hasStem()&&i?.5:1:t.hasStem()&&i?1:0}(n,a),y=this.musicFont.lookupMetric("articulation."+s.getCode()+".padding",0),_=(t={},t[dt]=function(){s.setOrigin(.5,1);var t=function(t,e){var i=t.getStemDirection(),n=t.getStemExtents(),o=n.topY,r=n.baseY;if(gt(t))return t.hasStem()?i===M.UP?o:r:Math.min.apply(Math,t.getYs());if(t.getCategory()===X.CATEGORY)return t.hasStem()&&i===M.UP?o:t.checkStave().getYForTopText(e);throw new h("UnknownCategory","Only can get the top and bottom ys of stavenotes and tabnotes")}(n,c)-(c+m)*p;return g?Math.min(l.getYForTopText(e.INITIAL_OFFSET),t):t},t[lt]=function(){s.setOrigin(.5,0);var t=function(t,e){var i=t.getStemDirection(),n=t.getStemExtents(),o=n.topY,r=n.baseY;if(gt(t))return t.hasStem()?i===M.UP?r:o:Math.max.apply(Math,t.getYs());if(t.getCategory()===X.CATEGORY)return t.hasStem()?i===M.UP?t.checkStave().getYForBottomText(e):o:t.checkStave().getYForBottomText(e);throw new h("UnknownCategory","Only can get the top and bottom ys of stavenotes and tabnotes")}(n,c)+(c+m)*p;return g?Math.max(l.getYForBottomText(e.INITIAL_OFFSET),t):t},t)[a]();if(!u){var x=a===dt?-1:1,v=u?n.getPositions()[o].str:n.getKeyProps()[o].line,S=(n.getYs()[o]-_)/p+Number(v),b=function(t,e,i,n){var o=pt(ft(e,i),e);if(t&&ut(o,i)&&o%1==0)return o+.5*-n;return o}(d,S,a,x);ut(b,a)&&s.setOrigin(.5,.5),_+=Math.abs(b-S)*p*x+y*x}ht("Rendering articulation at (x: "+f+", y: "+_+")"),s.render(i,f,_)},e.INITIAL_OFFSET=-.5,e}(F),yt=function(t){function e(e){var i=t.call(this)||this;return i.tickID=e&&e.tickID?e.tickID:0,i.setAttribute("type","TickContext"),i.currentTick=new f(0,1),i.maxTicks=new f(0,1),i.maxTickable=void 0,i.minTicks=void 0,i.minTickable=void 0,i.padding=1,i.x=0,i.xBase=0,i.xOffset=0,i.tickables=[],i.tickablesByVoice={},i.notePx=0,i.glyphPx=0,i.leftDisplacedHeadPx=0,i.rightDisplacedHeadPx=0,i.modLeftPx=0,i.modRightPx=0,i.totalLeftPx=0,i.totalRightPx=0,i.tContexts=[],i}return o(e,t),e.prototype.draw=function(){},e.getNextContext=function(t){var e=t.tContexts,i=e.indexOf(t);if(i+1<e.length)return e[i+1]},e.prototype.getTickID=function(){return this.tickID},e.prototype.getX=function(){return this.x},e.prototype.setX=function(t){return this.x=t,this.xBase=t,this.xOffset=0,this},e.prototype.getXBase=function(){return this.xBase},e.prototype.setXBase=function(t){this.xBase=t,this.x=t+this.xOffset},e.prototype.getXOffset=function(){return this.xOffset},e.prototype.setXOffset=function(t){this.xOffset=t,this.x=this.xBase+t},e.prototype.getWidth=function(){return this.width+2*this.padding},e.prototype.setPadding=function(t){return this.padding=t,this},e.prototype.getMaxTicks=function(){return this.maxTicks},e.prototype.getMinTicks=function(){return this.minTicks},e.prototype.getMaxTickable=function(){return this.maxTickable},e.prototype.getMinTickable=function(){return this.minTickable},e.prototype.getTickables=function(){return this.tickables},e.prototype.getTickablesForVoice=function(t){return this.tickablesByVoice[t]},e.prototype.getTickablesByVoice=function(){return this.tickablesByVoice},e.prototype.getCenterAlignedTickables=function(){return this.tickables.filter((function(t){return t.isCenterAligned()}))},e.prototype.getMetrics=function(){var t=this;return{width:t.width,glyphPx:t.glyphPx,notePx:t.notePx,leftDisplacedHeadPx:t.leftDisplacedHeadPx,rightDisplacedHeadPx:t.rightDisplacedHeadPx,modLeftPx:t.modLeftPx,modRightPx:t.modRightPx,totalLeftPx:t.totalLeftPx,totalRightPx:t.totalRightPx}},e.prototype.getCurrentTick=function(){return this.currentTick},e.prototype.setCurrentTick=function(t){this.currentTick=t,this.preFormatted=!1},e.prototype.addTickable=function(t,e){if(!t)throw new h("BadArgument","Invalid tickable added.");if(!t.shouldIgnoreTicks()){this.ignore_ticks=!1;var i=t.getTicks();i.greaterThan(this.maxTicks)&&(this.maxTicks=i.clone(),this.maxTickable=t),(null==this.minTicks||i.lessThan(this.minTicks))&&(this.minTicks=i.clone(),this.minTickable=t)}return t.setTickContext(this),this.tickables.push(t),this.tickablesByVoice[e||0]=t,this.preFormatted=!1,this},e.prototype.preFormat=function(){if(this.preFormatted)return this;for(var t=0;t<this.tickables.length;++t){var e=this.tickables[t];e.preFormat();var i=e.getMetrics();this.leftDisplacedHeadPx=Math.max(this.leftDisplacedHeadPx,i.leftDisplacedHeadPx),this.rightDisplacedHeadPx=Math.max(this.rightDisplacedHeadPx,i.rightDisplacedHeadPx),this.notePx=Math.max(this.notePx,i.notePx),this.glyphPx=Math.max(this.glyphPx,i.glyphWidth||0),this.modLeftPx=Math.max(this.modLeftPx,i.modLeftPx),this.modRightPx=Math.max(this.modRightPx,i.modRightPx),this.totalLeftPx=Math.max(this.totalLeftPx,i.modLeftPx+i.leftDisplacedHeadPx),this.totalRightPx=Math.max(this.totalRightPx,i.modRightPx+i.rightDisplacedHeadPx),this.width=this.notePx+this.totalLeftPx+this.totalRightPx}return this},e.prototype.postFormat=function(){return this.postFormatted||(this.postFormatted=!0),this},e}(O);function _t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];xt.DEBUG&&d("Vex.Flow.Ornament",t)}var xt=function(t){function e(i){var n=t.call(this)||this;n.setAttribute("type","Ornament"),n.type=i,n.delayed=!1,n.render_options={font_scale:38,accidentalLowerPadding:3,accidentalUpperPadding:3},n.ornament=ei.ornamentCodes(n.type);var o=n.getMetrics();if(n.adjustForStemDirection=!1,n.reportedWidth=o&&o.reportedWidth?o.reportedWidth:0,n.stemUpYOffset=o&&o.stemUpYOffset?o.stemUpYOffset:0,n.ornamentAlignWithNoteHead=e.ornamentAlignWithNoteHead.indexOf(n.type)>=0,!n.ornament)throw new h("ArgumentError","Ornament not found: '"+n.type+"'");return n.x_shift=o?o.xOffset:0,n.y_shift=o?o.yOffset:0,n.glyph=new S(n.ornament.code,n.render_options.font_scale,{category:"ornament."+n.ornament.code}),e.ornamentNoteTransition.indexOf(n.type)>=0&&(n.delayed=!0),o||n.glyph.setOrigin(.5,1),n}return o(e,t),Object.defineProperty(e,"CATEGORY",{get:function(){return"ornaments"},enumerable:!1,configurable:!0}),e.format=function(t,i){if(!t||0===t.length)return!1;for(var n=0,o=i.right_shift,r=i.left_shift,a=0,s=0;s<t.length;++s){var c=t[s];if(e.ornamentRelease.indexOf(c.type)>=0&&(c.x_shift+=o+2),e.ornamentAttack.indexOf(c.type)>=0&&(c.x_shift-=r+2),c.reportedWidth&&c.x_shift<0?r+=c.reportedWidth:c.reportedWidth&&c.x_shift>0?o+=c.reportedWidth:n=Math.max(c.getWidth(),n),e.ornamentArticulation.indexOf(c.type)>=0){if(!c.note)throw new h("NoAttachedNote");c.note.getLineNumber()>=3||c.getPosition()===F.Position.ABOVE?(i.top_text_line+=2,c.y_shift+=a,a-=c.glyph.bbox.getH()):(i.text_line+=2,c.y_shift+=a,a+=c.glyph.bbox.getH())}else c.getPosition()===F.Position.ABOVE?(c.setTextLine(i.top_text_line),i.top_text_line+=2):(c.setTextLine(i.text_line),i.text_line+=2)}return i.left_shift=r+n/2,i.right_shift=o+n/2,!0},Object.defineProperty(e,"ornamentNoteTransition",{get:function(){return["flip","jazzTurn","smear"]},enumerable:!1,configurable:!0}),Object.defineProperty(e,"ornamentAttack",{get:function(){return["scoop"]},enumerable:!1,configurable:!0}),Object.defineProperty(e,"ornamentAlignWithNoteHead",{get:function(){return["doit","fall","fallLong","doitLong","bend","plungerClosed","plungerOpen","scoop"]},enumerable:!1,configurable:!0}),Object.defineProperty(e,"ornamentRelease",{get:function(){return["doit","fall","fallLong","doitLong","jazzTurn","smear","flip"]},enumerable:!1,configurable:!0}),Object.defineProperty(e,"ornamentArticulation",{get:function(){return["bend","plungerClosed","plungerOpen"]},enumerable:!1,configurable:!0}),e.prototype.getMetrics=function(){return this.getFontStack()[0].getMetrics().glyphs.jazzOrnaments[this.ornament.code]},e.prototype.getCategory=function(){return e.CATEGORY},e.prototype.setDelayed=function(t){return this.delayed=t,this},e.prototype.setUpperAccidental=function(t){var e=this.render_options.font_scale/1.3;return this.accidentalUpper=new S(ei.accidentalCodes(t).code,e),this.accidentalUpper.setOrigin(.5,1),this},e.prototype.setLowerAccidental=function(t){var e=this.render_options.font_scale/1.3;return this.accidentalLower=new S(ei.accidentalCodes(t).code,e),this.accidentalLower.setOrigin(.5,1),this},e.prototype.draw=function(){var t=this.checkContext(),i=this.checkAttachedNote();this.setRendered();var n=i.getStemDirection(),o=i.checkStave(),r=Object.keys(this.getAttribute("classes")).join(" ");t.openGroup(r,this.getAttribute("id"));var a=i.checkStem().getExtents(),s=n===j.STEM_DOWN?a.baseY:a.topY;i.getCategory()===X.CATEGORY&&(i.hasStem()?n===j.STEM_DOWN&&(s=o.getYForTopText(this.text_line)):s=o.getYForTopText(this.text_line));var h=n===j.STEM_DOWN,c=o.getSpacingBetweenLines(),d=1;!h&&i.hasBeam()&&(d+=.5);var l=s-c*(this.text_line+d),p=i.getModifierStartXY(this.position,this.index),u=p.x,f=this.ornamentAlignWithNoteHead?p.y:Math.min(o.getYForTopText(this.text_line),l);if(f+=this.y_shift,this.delayed){var g=0,m=u-(o.getX()-10);if(void 0!==this.delayXShift)g=this.delayXShift;else{g+=this.glyph.getMetrics().width/2;var y=yt.getNextContext(i.getTickContext());g+=y?.5*(y.getX()-m):.5*(o.getX()+o.getWidth()-m),this.delayXShift=g}u+=g}_t("Rendering ornament: ",this.ornament,u,f),this.accidentalLower&&(this.accidentalLower.render(t,u,f),f-=this.accidentalLower.getMetrics().height,f-=this.render_options.accidentalLowerPadding),this.stemUpYOffset&&i.hasStem()&&1===i.getStemDirection()&&(f+=this.stemUpYOffset),i.getLineNumber()<5&&e.ornamentNoteTransition.indexOf(this.type)>=0&&(f=i.checkStave().getBoundingBox().getY()+40),this.glyph.render(t,u+this.x_shift,f),this.accidentalUpper&&(f-=this.glyph.getMetrics().height+this.render_options.accidentalUpperPadding,this.accidentalUpper.render(t,u,f)),t.closeGroup()},e}(F),vt={name:"petalumaScript",smufl:!1,spacing:50,glyphs:{" ":{x_min:0,x_max:250,y_min:0,y_max:500,ha:500,leftSideBearing:0,advanceWidth:250},0:{x_min:33,x_max:534,y_min:-13,y_max:751,ha:764,leftSideBearing:33,advanceWidth:570},1:{x_min:48,x_max:235,y_min:-17,y_max:734,ha:751,leftSideBearing:48,advanceWidth:286},2:{x_min:56,x_max:571,y_min:-19,y_max:741,ha:760,leftSideBearing:56,advanceWidth:626},3:{x_min:50,x_max:528,y_min:-7,y_max:731,ha:738,leftSideBearing:50,advanceWidth:589},4:{x_min:38,x_max:564,y_min:-13,y_max:743,ha:756,leftSideBearing:38,advanceWidth:614},5:{x_min:42,x_max:601,y_min:-34,y_max:743,ha:777,leftSideBearing:42,advanceWidth:648},6:{x_min:47,x_max:606,y_min:-16,y_max:743,ha:759,leftSideBearing:47,advanceWidth:667},7:{x_min:47,x_max:567,y_min:5,y_max:739,ha:734,leftSideBearing:0,advanceWidth:615},8:{x_min:40,x_max:541,y_min:-15,y_max:752,ha:767,leftSideBearing:40,advanceWidth:585},9:{x_min:40,x_max:537,y_min:-52,y_max:736,ha:788,leftSideBearing:40,advanceWidth:592},"!":{x_min:49,x_max:180,y_min:-7,y_max:761,ha:768,leftSideBearing:49,advanceWidth:230},'"':{x_min:39,x_max:304,y_min:596,y_max:804,ha:208,leftSideBearing:39,advanceWidth:353},"#":{x_min:33,x_max:599,y_min:-8,y_max:765,ha:773,leftSideBearing:33,advanceWidth:648},$:{x_min:53,x_max:495,y_min:-111,y_max:823,ha:934,leftSideBearing:53,advanceWidth:560},"%":{x_min:35,x_max:656,y_min:-128,y_max:808,ha:936,leftSideBearing:35,advanceWidth:711},"&":{x_min:53,x_max:441,y_min:-3,y_max:753,ha:756,leftSideBearing:53,advanceWidth:500},"'":{x_min:43,x_max:161,y_min:590,y_max:811,ha:221,leftSideBearing:43,advanceWidth:217},"(":{x_min:41,x_max:311,y_min:-36,y_max:845,ha:881,leftSideBearing:41,advanceWidth:308},")":{x_min:-8,x_max:257,y_min:-21,y_max:852,ha:873,leftSideBearing:-8,advanceWidth:280},"*":{x_min:59,x_max:539,y_min:175,y_max:589,ha:414,leftSideBearing:59,advanceWidth:601},"+":{x_min:33,x_max:361,y_min:180,y_max:587,ha:407,leftSideBearing:33,advanceWidth:400},",":{x_min:15,x_max:176,y_min:-129,y_max:92,ha:221,leftSideBearing:15,advanceWidth:205},"-":{x_min:40,x_max:380,y_min:317,y_max:452,ha:135,leftSideBearing:40,advanceWidth:422},".":{x_min:48,x_max:185,y_min:-56,y_max:84,ha:140,leftSideBearing:48,advanceWidth:227},"/":{x_min:-58,x_max:654,y_min:-122,y_max:844,ha:966,leftSideBearing:-58,advanceWidth:626},":":{x_min:65,x_max:225,y_min:97,y_max:536,ha:439,leftSideBearing:65,advanceWidth:302},";":{x_min:13,x_max:295,y_min:-139,y_max:536,ha:675,leftSideBearing:13,advanceWidth:334},"<":{x_min:28,x_max:438,y_min:-1,y_max:607,ha:608,leftSideBearing:28,advanceWidth:475},"=":{x_min:40,x_max:383,y_min:199.9598640852289,y_max:541,ha:341.0401359147711,leftSideBearing:40,advanceWidth:422},">":{x_min:35,x_max:421,y_min:28,y_max:632,ha:604,leftSideBearing:35,advanceWidth:466},"?":{x_min:45,x_max:548,y_min:-17,y_max:767,ha:784,leftSideBearing:45,advanceWidth:592},"@":{x_min:51,x_max:730,y_min:-78,y_max:753,ha:831,leftSideBearing:51,advanceWidth:781},A:{x_min:37,x_max:554,y_min:-4,y_max:746,ha:750,leftSideBearing:37,advanceWidth:617},B:{x_min:37,x_max:532,y_min:3,y_max:783,ha:780,leftSideBearing:37,advanceWidth:579},C:{x_min:37,x_max:583,y_min:-3,y_max:775,ha:778,leftSideBearing:37,advanceWidth:623},D:{x_min:50,x_max:530,y_min:-15,y_max:749,ha:764,leftSideBearing:50,advanceWidth:579},E:{x_min:45,x_max:531,y_min:-1,y_max:743,ha:744,leftSideBearing:45,advanceWidth:585},F:{x_min:45,x_max:459,y_min:23,y_max:727,ha:704,leftSideBearing:45,advanceWidth:510},G:{x_min:31,x_max:577,y_min:-8,y_max:733,ha:741,leftSideBearing:31,advanceWidth:611},H:{x_min:37,x_max:493,y_min:-22,y_max:758,ha:780,leftSideBearing:37,advanceWidth:535},I:{x_min:47,x_max:501,y_min:-3,y_max:731,ha:734,leftSideBearing:47,advanceWidth:541},J:{x_min:33,x_max:531,y_min:-23,y_max:725,ha:748,leftSideBearing:33,advanceWidth:573},K:{x_min:43,x_max:505,y_min:-10,y_max:740,ha:750,leftSideBearing:43,advanceWidth:560},L:{x_min:49,x_max:457,y_min:-2,y_max:746,ha:748,leftSideBearing:49,advanceWidth:510},M:{x_min:35,x_max:699,y_min:1,y_max:744,ha:743,leftSideBearing:35,advanceWidth:743},N:{x_min:34,x_max:533,y_min:-17,y_max:761,ha:778,leftSideBearing:34,advanceWidth:579},O:{x_min:41,x_max:608,y_min:-5,y_max:735,ha:740,leftSideBearing:41,advanceWidth:667},P:{x_min:53,x_max:451,y_min:-18,y_max:735,ha:753,leftSideBearing:53,advanceWidth:497},Q:{x_min:40,x_max:599,y_min:-67,y_max:744,ha:811,leftSideBearing:40,advanceWidth:648},R:{x_min:39,x_max:487,y_min:16,y_max:735,ha:719,leftSideBearing:39,advanceWidth:535},S:{x_min:35,x_max:552,y_min:-47,y_max:708,ha:755,leftSideBearing:35,advanceWidth:604},T:{x_min:26,x_max:656,y_min:-13,y_max:718,ha:731,leftSideBearing:26,advanceWidth:705},U:{x_min:41,x_max:518,y_min:-20,y_max:748,ha:768,leftSideBearing:41,advanceWidth:567},V:{x_min:47,x_max:509,y_min:-26,y_max:744,ha:770,leftSideBearing:47,advanceWidth:567},W:{x_min:44,x_max:789,y_min:-35,y_max:720,ha:755,leftSideBearing:44,advanceWidth:833},X:{x_min:63,x_max:635,y_min:-10,y_max:745,ha:755,leftSideBearing:63,advanceWidth:680},Y:{x_min:43,x_max:503,y_min:-21,y_max:734,ha:755,leftSideBearing:43,advanceWidth:541},Z:{x_min:42,x_max:584,y_min:-10,y_max:739,ha:749,leftSideBearing:42,advanceWidth:629},"[":{x_min:46,x_max:346,y_min:-150,y_max:884,ha:1034,leftSideBearing:46,advanceWidth:291},"\\":{x_min:20,x_max:616,y_min:-100,y_max:797,ha:897,leftSideBearing:20,advanceWidth:645},"]":{x_min:-76,x_max:226,y_min:-150,y_max:881,ha:1031,leftSideBearing:-76,advanceWidth:297},"^":{x_min:43,x_max:437,y_min:517,y_max:812,ha:295,leftSideBearing:43,advanceWidth:478},_:{x_min:29,x_max:563,y_min:-110,y_max:-1,ha:109,leftSideBearing:29,advanceWidth:598},"`":{x_min:54,x_max:321,y_min:540,y_max:747,ha:207,leftSideBearing:54,advanceWidth:368},a:{x_min:20,x_max:447,y_min:-17,y_max:495,ha:512,leftSideBearing:20,advanceWidth:494},b:{x_min:37,x_max:466,y_min:-27,y_max:770,ha:797,leftSideBearing:37,advanceWidth:510},c:{x_min:35,x_max:456,y_min:-9,y_max:507,ha:516,leftSideBearing:35,advanceWidth:460},d:{x_min:45,x_max:520,y_min:-15,y_max:764,ha:779,leftSideBearing:45,advanceWidth:560},e:{x_min:33,x_max:370,y_min:-5,y_max:501,ha:506,leftSideBearing:33,advanceWidth:397},f:{x_min:35,x_max:411,y_min:-13,y_max:695,ha:708,leftSideBearing:35,advanceWidth:453},g:{x_min:33,x_max:551,y_min:-257,y_max:505,ha:762,leftSideBearing:33,advanceWidth:611},h:{x_min:32,x_max:458,y_min:-29,y_max:743,ha:772,leftSideBearing:32,advanceWidth:491},i:{x_min:45,x_max:167,y_min:-13,y_max:631,ha:644,leftSideBearing:45,advanceWidth:220},j:{x_min:-127,x_max:261,y_min:-231,y_max:601,ha:832,leftSideBearing:-127,advanceWidth:308},k:{x_min:39,x_max:443,y_min:-3,y_max:700,ha:703,leftSideBearing:39,advanceWidth:497},l:{x_min:58,x_max:168,y_min:-8,y_max:686,ha:694,leftSideBearing:58,advanceWidth:227},m:{x_min:39,x_max:688,y_min:-14,y_max:501,ha:515,leftSideBearing:39,advanceWidth:718},n:{x_min:45,x_max:491,y_min:-32,y_max:512,ha:544,leftSideBearing:45,advanceWidth:541},o:{x_min:41,x_max:424,y_min:-12,y_max:493,ha:505,leftSideBearing:41,advanceWidth:447},p:{x_min:25,x_max:529,y_min:-260,y_max:500,ha:760,leftSideBearing:25,advanceWidth:573},q:{x_min:53,x_max:603,y_min:-235,y_max:514,ha:749,leftSideBearing:53,advanceWidth:623},r:{x_min:32,x_max:407,y_min:-7,y_max:492,ha:499,leftSideBearing:32,advanceWidth:460},s:{x_min:49,x_max:416,y_min:-12,y_max:519,ha:531,leftSideBearing:49,advanceWidth:460},t:{x_min:32,x_max:442,y_min:-5,y_max:684,ha:689,leftSideBearing:32,advanceWidth:469},u:{x_min:41,x_max:487,y_min:-5,y_max:507,ha:512,leftSideBearing:41,advanceWidth:510},v:{x_min:16,x_max:441,y_min:-20,y_max:542,ha:562,leftSideBearing:16,advanceWidth:456},w:{x_min:39,x_max:639,y_min:-22,y_max:505,ha:527,leftSideBearing:39,advanceWidth:661},x:{x_min:15,x_max:505,y_min:-39,y_max:539,ha:578,leftSideBearing:15,advanceWidth:541},y:{x_min:-98,x_max:501,y_min:-242,y_max:511,ha:753,leftSideBearing:-98,advanceWidth:548},z:{x_min:27,x_max:479,y_min:-3,y_max:494,ha:497,leftSideBearing:27,advanceWidth:494},"{":{x_min:0,x_max:0,y_min:0,y_max:0,ha:0,leftSideBearing:0,advanceWidth:308},"|":{x_min:0,x_max:0,y_min:0,y_max:0,ha:0,leftSideBearing:0,advanceWidth:308},"}":{x_min:0,x_max:0,y_min:0,y_max:0,ha:0,leftSideBearing:0,advanceWidth:308},"~":{x_min:0,x_max:0,y_min:0,y_max:0,ha:0,leftSideBearing:0,advanceWidth:308}},fontFamily:"Petaluma Script",resolution:1e3,generatedOn:"2020-06-14T18:33:25.407Z"},St={name:"Roboto Slab",smufl:!1,spacing:50,glyphs:{" ":{x_min:0,x_max:509,y_min:0,y_max:2e3,ha:2e3,leftSideBearing:0,advanceWidth:509},0:{x_min:121,x_max:1048,y_min:-21,y_max:1477,ha:1498,leftSideBearing:121,advanceWidth:1168},1:{x_min:117,x_max:767,y_min:0,y_max:1456,ha:1456,leftSideBearing:117,advanceWidth:844},2:{x_min:75.8474576645637,x_max:1040,y_min:0,y_max:1477,ha:1477,leftSideBearing:75,advanceWidth:1131},3:{x_min:74.85365853658536,x_max:994,y_min:-21,y_max:1477,ha:1498,leftSideBearing:74,advanceWidth:1106},4:{x_min:63,x_max:1114,y_min:0,y_max:1456,ha:1456,leftSideBearing:63,advanceWidth:1187},5:{x_min:96.8448275474953,x_max:982,y_min:-21,y_max:1456,ha:1477,leftSideBearing:96,advanceWidth:1081},6:{x_min:121,x_max:1067,y_min:-21,y_max:1477,ha:1498,leftSideBearing:121,advanceWidth:1144},7:{x_min:76,x_max:1060,y_min:0,y_max:1456,ha:1456,leftSideBearing:-30,advanceWidth:1128},8:{x_min:92,x_max:1039,y_min:-21,y_max:1477,ha:1498,leftSideBearing:92,advanceWidth:1131},9:{x_min:84,x_max:1026,y_min:-21,y_max:1477,ha:1498,leftSideBearing:84,advanceWidth:1154},"!":{x_min:143,x_max:340,y_min:0,y_max:1456,ha:1456,leftSideBearing:143,advanceWidth:483},'"':{x_min:166,x_max:634,y_min:1055,y_max:1560,ha:505,leftSideBearing:166,advanceWidth:770},"#":{x_min:63,x_max:1179,y_min:0,y_max:1456,ha:1456,leftSideBearing:63,advanceWidth:1246},$:{x_min:81.92156915727656,x_max:1012,y_min:-208,y_max:1693,ha:1901,leftSideBearing:81,advanceWidth:1110},"%":{x_min:77,x_max:1384,y_min:-21,y_max:1477,ha:1498,leftSideBearing:77,advanceWidth:1460},"&":{x_min:74,x_max:1242,y_min:-21,y_max:1477,ha:1498,leftSideBearing:74,advanceWidth:1289},"'":{x_min:166,x_max:324,y_min:1055,y_max:1560,ha:505,leftSideBearing:166,advanceWidth:460},"(":{x_min:114,x_max:650,y_min:-463,y_max:1636,ha:2099,leftSideBearing:114,advanceWidth:662},")":{x_min:11,x_max:547,y_min:-463,y_max:1636,ha:2099,leftSideBearing:11,advanceWidth:654},"*":{x_min:66,x_max:893,y_min:607,y_max:1456,ha:849,leftSideBearing:66,advanceWidth:958},"+":{x_min:73,x_max:1071,y_min:146,y_max:1206,ha:1060,leftSideBearing:73,advanceWidth:1145},",":{x_min:23,x_max:315,y_min:-311,y_max:221,ha:532,leftSideBearing:23,advanceWidth:404},"-":{x_min:154,x_max:643,y_min:538,y_max:692,ha:154,leftSideBearing:154,advanceWidth:797},".":{x_min:145,x_max:342,y_min:0,y_max:202,ha:202,leftSideBearing:145,advanceWidth:493},"/":{x_min:0,x_max:774,y_min:-125,y_max:1456,ha:1581,leftSideBearing:0,advanceWidth:824},":":{x_min:145,x_max:342,y_min:0,y_max:1082,ha:1082,leftSideBearing:145,advanceWidth:419},";":{x_min:53,x_max:345,y_min:-311,y_max:1082,ha:1393,leftSideBearing:53,advanceWidth:424},"<":{x_min:76,x_max:892,y_min:107,y_max:1013,ha:906,leftSideBearing:76,advanceWidth:1017},"=":{x_min:147,x_max:981,y_min:407,y_max:987,ha:580,leftSideBearing:147,advanceWidth:1127},">":{x_min:125,x_max:980,y_min:87,y_max:993,ha:906,leftSideBearing:125,advanceWidth:1060},"?":{x_min:65.92660602419838,x_max:890,y_min:0,y_max:1477,ha:1477,leftSideBearing:65,advanceWidth:953},"@":{x_min:84.3592218305664,x_max:1705.2346925277395,y_min:-453,y_max:1431,ha:1884,leftSideBearing:84,advanceWidth:1821},A:{x_min:70,x_max:1463,y_min:0,y_max:1456,ha:1456,leftSideBearing:70,advanceWidth:1533},B:{x_min:81,x_max:1253,y_min:0,y_max:1456,ha:1456,leftSideBearing:81,advanceWidth:1322},C:{x_min:80,x_max:1174,y_min:-21,y_max:1477,ha:1498,leftSideBearing:80,advanceWidth:1290},D:{x_min:81,x_max:1291,y_min:0,y_max:1456,ha:1456,leftSideBearing:81,advanceWidth:1356},E:{x_min:81,x_max:1190,y_min:0,y_max:1456,ha:1456,leftSideBearing:81,advanceWidth:1306},F:{x_min:81,x_max:1176,y_min:0,y_max:1456,ha:1456,leftSideBearing:81,advanceWidth:1256},G:{x_min:80,x_max:1226,y_min:-21,y_max:1477,ha:1498,leftSideBearing:80,advanceWidth:1346},H:{x_min:81,x_max:1497,y_min:0,y_max:1456,ha:1456,leftSideBearing:81,advanceWidth:1578},I:{x_min:81,x_max:604,y_min:0,y_max:1456,ha:1456,leftSideBearing:81,advanceWidth:685},J:{x_min:60,x_max:1100,y_min:-21,y_max:1456,ha:1477,leftSideBearing:60,advanceWidth:1169},K:{x_min:81,x_max:1427,y_min:0,y_max:1456,ha:1456,leftSideBearing:81,advanceWidth:1501},L:{x_min:81,x_max:1130,y_min:0,y_max:1456,ha:1456,leftSideBearing:81,advanceWidth:1210},M:{x_min:94,x_max:1888,y_min:0,y_max:1456,ha:1456,leftSideBearing:94,advanceWidth:1982},N:{x_min:83,x_max:1509,y_min:0,y_max:1456,ha:1456,leftSideBearing:83,advanceWidth:1592},O:{x_min:70,x_max:1281,y_min:-21,y_max:1477,ha:1498,leftSideBearing:70,advanceWidth:1351},P:{x_min:81,x_max:1242,y_min:0,y_max:1456,ha:1456,leftSideBearing:81,advanceWidth:1297},Q:{x_min:70,x_max:1348,y_min:-245,y_max:1477,ha:1722,leftSideBearing:70,advanceWidth:1376},R:{x_min:81,x_max:1285,y_min:0,y_max:1455,ha:1455,leftSideBearing:81,advanceWidth:1385},S:{x_min:115,x_max:1116,y_min:-21,y_max:1477,ha:1498,leftSideBearing:115,advanceWidth:1206},T:{x_min:96,x_max:1306,y_min:0,y_max:1456,ha:1456,leftSideBearing:96,advanceWidth:1406},U:{x_min:70,x_max:1452,y_min:-21,y_max:1456,ha:1477,leftSideBearing:70,advanceWidth:1522},V:{x_min:65,x_max:1443,y_min:0,y_max:1456,ha:1456,leftSideBearing:65,advanceWidth:1508},W:{x_min:72,x_max:2057,y_min:0,y_max:1456,ha:1456,leftSideBearing:72,advanceWidth:2129},X:{x_min:80,x_max:1449,y_min:0,y_max:1456,ha:1456,leftSideBearing:80,advanceWidth:1529},Y:{x_min:65,x_max:1396,y_min:0,y_max:1456,ha:1456,leftSideBearing:65,advanceWidth:1461},Z:{x_min:90,x_max:1107,y_min:0,y_max:1456,ha:1456,leftSideBearing:90,advanceWidth:1197},"[":{x_min:157,x_max:541,y_min:-312,y_max:1664,ha:1976,leftSideBearing:157,advanceWidth:573},"\\":{x_min:36,x_max:830,y_min:-125,y_max:1456,ha:1581,leftSideBearing:36,advanceWidth:841},"]":{x_min:23,x_max:408,y_min:-312,y_max:1664,ha:1976,leftSideBearing:23,advanceWidth:552},"^":{x_min:71,x_max:802,y_min:729,y_max:1456,ha:727,leftSideBearing:71,advanceWidth:864},_:{x_min:119,x_max:1041,y_min:-154,y_max:0,ha:154,leftSideBearing:119,advanceWidth:1168},"`":{x_min:40,x_max:456,y_min:1288,y_max:1560,ha:272,leftSideBearing:40,advanceWidth:496},a:{x_min:79,x_max:1053,y_min:-21,y_max:1102,ha:1123,leftSideBearing:79,advanceWidth:1132},b:{x_min:-16,x_max:1071,y_min:-21,y_max:1560,ha:1581,leftSideBearing:-16,advanceWidth:1145},c:{x_min:78,x_max:988,y_min:-21,y_max:1102,ha:1123,leftSideBearing:78,advanceWidth:1067},d:{x_min:78,x_max:1156,y_min:-21,y_max:1560,ha:1581,leftSideBearing:78,advanceWidth:1218},e:{x_min:74,x_max:980,y_min:-21,y_max:1102,ha:1123,leftSideBearing:74,advanceWidth:1059},f:{x_min:64,x_max:731,y_min:0,y_max:1581,ha:1581,leftSideBearing:64,advanceWidth:725},g:{x_min:78,x_max:1133,y_min:-437,y_max:1102,ha:1539,leftSideBearing:78,advanceWidth:1157},h:{x_min:49,x_max:1255,y_min:0,y_max:1560,ha:1560,leftSideBearing:49,advanceWidth:1315},i:{x_min:67,x_max:590,y_min:0,y_max:1560,ha:1560,leftSideBearing:67,advanceWidth:652},j:{x_min:-56,x_max:381,y_min:-437,y_max:1560,ha:1997,leftSideBearing:-56,advanceWidth:525},k:{x_min:64,x_max:1248,y_min:0,y_max:1560,ha:1560,leftSideBearing:64,advanceWidth:1287},l:{x_min:64,x_max:587,y_min:0,y_max:1560,ha:1560,leftSideBearing:64,advanceWidth:653},m:{x_min:74,x_max:1905,y_min:0,y_max:1102,ha:1102,leftSideBearing:74,advanceWidth:1977},n:{x_min:74,x_max:1278,y_min:0,y_max:1102,ha:1102,leftSideBearing:74,advanceWidth:1343},o:{x_min:78,x_max:1046,y_min:-21,y_max:1102,ha:1123,leftSideBearing:78,advanceWidth:1124},p:{x_min:34,x_max:1119,y_min:-416,y_max:1102,ha:1518,leftSideBearing:34,advanceWidth:1197},q:{x_min:78,x_max:1135,y_min:-416,y_max:1102,ha:1518,leftSideBearing:78,advanceWidth:1139},r:{x_min:72,x_max:808,y_min:0,y_max:1102,ha:1102,leftSideBearing:72,advanceWidth:854},s:{x_min:104,x_max:933,y_min:-21,y_max:1102,ha:1123,leftSideBearing:104,advanceWidth:1022},t:{x_min:24,x_max:678,y_min:-17,y_max:1343,ha:1360,leftSideBearing:24,advanceWidth:730},u:{x_min:52,x_max:1181,y_min:-21,y_max:1082,ha:1103,leftSideBearing:52,advanceWidth:1245},v:{x_min:26,x_max:1176,y_min:0,y_max:1082,ha:1082,leftSideBearing:26,advanceWidth:1206},w:{x_min:52,x_max:1777,y_min:0,y_max:1082,ha:1082,leftSideBearing:52,advanceWidth:1823},x:{x_min:42,x_max:1163,y_min:0,y_max:1082,ha:1082,leftSideBearing:42,advanceWidth:1203},y:{x_min:24,x_max:1172,y_min:-437,y_max:1082,ha:1519,leftSideBearing:24,advanceWidth:1192},z:{x_min:88,x_max:960,y_min:0,y_max:1082,ha:1082,leftSideBearing:88,advanceWidth:1032},"{":{x_min:63,x_max:671,y_min:-364,y_max:1597,ha:1961,leftSideBearing:63,advanceWidth:701},"|":{x_min:150,x_max:307,y_min:-270,y_max:1456,ha:1726,leftSideBearing:150,advanceWidth:451},"}":{x_min:27,x_max:635,y_min:-364,y_max:1597,ha:1961,leftSideBearing:27,advanceWidth:701},"~":{x_min:121,x_max:1257,y_min:401,y_max:803,ha:402,leftSideBearing:121,advanceWidth:1386}},fontFamily:"Roboto Slab",resolution:2048,generatedOn:"2020-06-15T19:12:58.120Z"};function bt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Ct.DEBUG&&d("Vex.Flow.TextFont",t)}var wt,Tt,Ct=function(){function t(e){if(this.resolution=1e3,this.glyphs={},this.family="",this.fontCacheKey="",this.size=14,this.maxSizeGlyph="H",this.weight="",this.style="",this.attrs={type:"TextFont"},!e.name)throw new h("BadArgument","Font constructor must specify a name");var i=e.glyphs?e:t.getFontDataByName(e.name);if(i)this.updateParams(i);else{if(!e.glyphs||!e.resolution)throw new h("BadArgument","Unknown font, must have glyph metrics and resolution");t.registerFont(e)}this.updateParams(e),this.updateCacheKey()}return Object.defineProperty(t,"CATEGORY",{get:function(){return"textFont"},enumerable:!1,configurable:!0}),Object.defineProperty(t,"DEBUG",{get:function(){return t.debug},set:function(e){t.debug=e},enumerable:!1,configurable:!0}),Object.defineProperty(t,"fontRegistry",{get:function(){return t.registryInstance||(t.registryInstance=[],t.registryInstance.push({name:"Roboto Slab",resolution:St.resolution,glyphs:St.glyphs,family:St.fontFamily,serifs:!0,monospaced:!1,italic:!1,bold:!1,maxSizeGlyph:"H",superscriptOffset:.66,subscriptOffset:.66,description:"Default serif text font to pair with Bravura/Gonville engraving font"}),t.registryInstance.push({name:"petalumaScript",resolution:vt.resolution,glyphs:vt.glyphs,family:vt.fontFamily,serifs:!1,monospaced:!1,italic:!1,bold:!1,maxSizeGlyph:"H",superscriptOffset:.66,subscriptOffset:.66,description:"Default sans-serif text font to pair with Petaluma engraving font"})),t.registryInstance},enumerable:!1,configurable:!0}),t.getFontFamilies=function(){var e={},i=[];return t.fontRegistry.forEach((function(t){e[t.family]?["bold","italic","monospaced","serifs"].forEach((function(i){t[i]&&(e[t.family][i]=!0)})):e[t.family]={family:t.family,description:t.description,bold:t.bold,serifs:t.serifs,italic:t.italic}})),Object.keys(e).forEach((function(t){i.push(e[t])})),i},t.fontWeightToBold=function(t){return!!t&&(isNaN(parseInt(t,10))?"bold"===t.toLowerCase():parseInt(t,10)>=600)},t.fontStyleToItalic=function(t){return"string"==typeof t&&"italic"===t.toLowerCase()},Object.defineProperty(t,"textWidthCache",{get:function(){return void 0===t.textWidthCacheInstance&&(t.textWidthCacheInstance={}),t.textWidthCacheInstance},enumerable:!1,configurable:!0}),t.getTextFontFromVexFontData=function(e){var i=0,n=void 0,o=t.fontRegistry[0],r=[],a=e.family.split(","),s=function(){var e=a[i];if((r=t.fontRegistry.filter((function(t){return t.family===e}))).length)return"break"};for(i=0;i<a.length;++i){if("break"===s())break}if(0===r.length)n=new t(o);else if(1===r.length)n=new t(r[0]);else{var h=t.fontWeightToBold(e.weight),c=t.fontStyleToItalic(e.style),d=r.find((function(t){return t.bold===h&&t.italic===c}));if(d)n=new t(d);else{var l=r.find((function(t){return t.italic===c||t.bold===h}));n=new t(l||r[0])}}return"number"==typeof e.size&&e.size>0&&n.setFontSize(e.size),n},t.getFontDataByName=function(e){return t.fontRegistry.find((function(t){return t.name===e}))},t.registerFont=function(e,i){var n=t.fontRegistry.find((function(t){return e.name===t.name}));n&&i&&(t.registryInstance=t.fontRegistry.filter((function(t){return t.name!==n.name}))),n||(bt("registering font "+e.name),t.registryInstance.push(e))},t.prototype.updateParams=function(t){t.name&&(this.name=t.name),t.resolution&&(this.resolution=t.resolution),t.glyphs&&(this.glyphs=t.glyphs),this.family=t.family,this.serifs=t.serifs,t.monospaced&&(this.monospaced=t.monospaced),this.italic=t.italic,this.bold=t.bold,t.maxSizeGlyph&&(this.maxSizeGlyph=t.maxSizeGlyph),t.superscriptOffset&&(this.superscriptOffset=t.superscriptOffset),t.subscriptOffset&&(this.subscriptOffset=t.subscriptOffset)},t.prototype.updateCacheKey=function(){this.fontCacheKey=this.family+"-"+this.size+"-"+this.weight+"-"+this.style},t.prototype.getMetricForCharacter=function(t){return this.glyphs[t]?this.glyphs[t]:this.glyphs[this.maxSizeGlyph]},Object.defineProperty(t.prototype,"maxHeight",{get:function(){return this.getMetricForCharacter(this.maxSizeGlyph).ha/this.resolution*this.pointsToPixels},enumerable:!1,configurable:!0}),t.prototype.getWidthForCharacter=function(t){var e=this.getMetricForCharacter(t);return e?e.advanceWidth/this.resolution*this.pointsToPixels:.65*this.pointsToPixels},t.prototype.getWidthForString=function(e){void 0===t.textWidthCache[this.fontCacheKey]&&(t.textWidthCache[this.fontCacheKey]={});var i=0;if(!t.textWidthCache[this.fontCacheKey][e]){for(var n=0;n<e.length;++n)i+=this.getWidthForCharacter(e[n]);t.textWidthCache[this.fontCacheKey][e]=i}return t.textWidthCache[this.fontCacheKey][e]},Object.defineProperty(t.prototype,"pointsToPixels",{get:function(){return this.size/72/(1/96)},enumerable:!1,configurable:!0}),t.prototype.setFontSize=function(t){return this.size=t,this.updateCacheKey(),this},t}();function Et(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];At.DEBUG&&d("Vex.Flow.Annotation",t)}!function(t){t[t.LEFT=1]="LEFT",t[t.CENTER=2]="CENTER",t[t.RIGHT=3]="RIGHT",t[t.CENTER_STEM=4]="CENTER_STEM"}(wt||(wt={})),function(t){t[t.TOP=1]="TOP",t[t.CENTER=2]="CENTER",t[t.BOTTOM=3]="BOTTOM",t[t.CENTER_STEM=4]="CENTER_STEM"}(Tt||(Tt={}));var At=function(t){function e(i){var n=t.call(this)||this;return n.setAttribute("type","Annotation"),n.text=i,n.justification=e.Justify.CENTER,n.vert_justification=e.VerticalJustify.TOP,n.font={family:"Arial",size:10,weight:""},n.setWidth(ei.textWidth(i)),n}return o(e,t),Object.defineProperty(e,"CATEGORY",{get:function(){return"annotations"},enumerable:!1,configurable:!0}),e.format=function(t,e){if(!t||0===t.length)return!1;for(var i=0,n=0;n<t.length;++n){var o,r=t[n],a=Ct.getTextFontFromVexFontData({family:r.font.family,size:r.font.size,weight:"normal"}),s=Math.floor(a.maxHeight/ei.STAVE_LINE_DISTANCE)+1;o=a.getWidthForString(r.text),i=Math.max(i,o),r.getPosition()===F.Position.ABOVE?(r.setTextLine(e.top_text_line),e.top_text_line+=s):(r.setTextLine(e.text_line),e.text_line+=s)}return e.left_shift+=i/2,e.right_shift+=i/2,!0},e.prototype.getCategory=function(){return e.CATEGORY},e.prototype.setFont=function(t,e,i){return this.font={family:t,size:e,weight:i},this},e.prototype.setVerticalJustification=function(t){return this.vert_justification="string"==typeof t?e.VerticalJustifyString[t]:t,this},e.prototype.getJustification=function(){return this.justification},e.prototype.setJustification=function(t){return this.justification="string"==typeof t?e.JustifyString[t]:t,this},e.prototype.draw=function(){var t=this.checkContext(),i=this.checkAttachedNote();this.setRendered();var n=i.getModifierStartXY(F.Position.ABOVE,this.index);t.save();var o=Object.keys(this.getAttribute("classes")).join(" ");t.openGroup(o,this.getAttribute("id")),t.setFont(this.font.family,this.font.size,this.font.weight);var r,a,s=t.measureText(this.text).width,h=t.measureText("m").width;r=this.justification===e.Justify.LEFT?n.x:this.justification===e.Justify.RIGHT?n.x-s:this.justification===e.Justify.CENTER?n.x-s/2:i.getStemX()-s/2;var c={},d=0,l=i.hasStem(),p=i.checkStave();if(l&&(c=i.checkStem().getExtents(),d=p.getSpacingBetweenLines()),this.vert_justification===e.VerticalJustify.BOTTOM){if(a=p.getYForBottomText(this.text_line+ei.TEXT_HEIGHT_OFFSET_HACK),l){var u=1===i.getStemDirection()?c.baseY:c.topY;a=Math.max(a,u+d*(this.text_line+2))}}else if(this.vert_justification===e.VerticalJustify.CENTER){var f=i.getYForTopText(this.text_line)-1;a=f+(p.getYForBottomText(this.text_line)-f)/2+h/2}else if(this.vert_justification===e.VerticalJustify.TOP)a=Math.min(p.getYForTopText(this.text_line),i.getYs()[0]-10),l&&(a=Math.min(a,c.topY-5-d*this.text_line));else{var g=i.getStemExtents();a=g.topY+(g.baseY-g.topY)/2+h/2}Et("Rendering annotation: ",this.text,r,a),t.fillText(this.text,r,a),t.closeGroup(),t.restore()},e.Justify=wt,e.JustifyString={left:e.Justify.LEFT,right:e.Justify.RIGHT,center:e.Justify.CENTER,centerStem:e.Justify.CENTER_STEM},e.VerticalJustify=Tt,e.VerticalJustifyString={above:e.VerticalJustify.TOP,top:e.VerticalJustify.TOP,below:e.VerticalJustify.BOTTOM,bottom:e.VerticalJustify.BOTTOM,center:e.VerticalJustify.CENTER,centerStem:e.VerticalJustify.CENTER_STEM},e}(F);function Pt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];kt.DEBUG&&d("Vex.Flow.ChordSymbol",t)}var kt=function(t){function e(){var i=t.call(this)||this;i.setAttribute("type","ChordSymbol"),i.symbolBlocks=[],i.horizontal=e.horizontalJustify.LEFT,i.vertical=e.verticalJustify.TOP,i.useKerning=!0,i.reportWidth=!0;var n="Arial";return n="Petaluma"===i.musicFont.getName()?"petalumaScript,Arial":"Roboto Slab,Times",i.font={family:n,size:12,weight:""},i.textFont=Ct.getTextFontFromVexFontData(i.font),i}return o(e,t),Object.defineProperty(e,"CATEGORY",{get:function(){return"chordSymbol"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"superSubRatio",{get:function(){return e.chordSymbolMetrics.global.superSubRatio},enumerable:!1,configurable:!0}),Object.defineProperty(e,"NOTEXTFORMAT",{get:function(){return void 0!==e.noFormat&&e.noFormat},set:function(t){e.noFormat=t},enumerable:!1,configurable:!0}),e.getMetricForGlyph=function(t){if(e.chordSymbolMetrics[t])return e.chordSymbolMetrics[t]},e.prototype.getYOffsetForText=function(t){var e=0,i=0,n=this.textFont.resolution;for(i=0;i<t.length;++i){var o=this.textFont.getMetricForCharacter(t[i]);o&&(e=o.y_max<e?o.y_max:e)}return i>0?e/n*-1:0},Object.defineProperty(e,"engravingFontResolution",{get:function(){return ei.DEFAULT_FONT_STACK[0].getResolution()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"spacingBetweenBlocks",{get:function(){return e.chordSymbolMetrics.global.spacing/e.engravingFontResolution},enumerable:!1,configurable:!0}),e.prototype.getWidthForCharacter=function(t){return this.textFont.getMetricForCharacter(t).advanceWidth/this.textFont.resolution},e.getWidthForGlyph=function(t){var i=e.getMetricForGlyph(t.code);return i?i.advanceWidth/e.engravingFontResolution:.65},e.getYShiftForGlyph=function(t){var i=e.getMetricForGlyph(t.code);return i?i.yOffset/e.engravingFontResolution:0},e.getXShiftForGlyph=function(t){var i=e.getMetricForGlyph(t.code);return i?-1*i.leftSideBearing/e.engravingFontResolution:0},Object.defineProperty(e,"superscriptOffset",{get:function(){return e.chordSymbolMetrics.global.superscriptOffset/e.engravingFontResolution},enumerable:!1,configurable:!0}),Object.defineProperty(e,"subscriptOffset",{get:function(){return e.chordSymbolMetrics.global.subscriptOffset/e.engravingFontResolution},enumerable:!1,configurable:!0}),Object.defineProperty(e,"kerningOffset",{get:function(){return e.chordSymbolMetrics.global.kerningOffset/e.engravingFontResolution},enumerable:!1,configurable:!0}),Object.defineProperty(e,"chordSymbolMetrics",{get:function(){return ei.DEFAULT_FONT_STACK[0].getMetrics().glyphs.chordSymbol},enumerable:!1,configurable:!0}),Object.defineProperty(e,"lowerKerningText",{get:function(){return ei.DEFAULT_FONT_STACK[0].getMetrics().glyphs.chordSymbol.global.lowerKerningText},enumerable:!1,configurable:!0}),Object.defineProperty(e,"upperKerningText",{get:function(){return ei.DEFAULT_FONT_STACK[0].getMetrics().glyphs.chordSymbol.global.upperKerningText},enumerable:!1,configurable:!0}),e.format=function(t,i){if(!t||0===t.length)return!1;for(var n=0,o=0,r=[],a=0;a<t.length;++a){for(var s=t[a],h=s.font.size/20,c=2*h,d=1,l=!1,p=0;p<s.symbolBlocks.length;++p){var u=s.symbolBlocks[p],f=s.isSuperscript(u),g=s.isSubscript(u),m=f||g?e.superSubRatio:1,y=u.symbolType===e.symbolTypes.GLYPH?c*m:h*m;if((f||g)&&(d=2),u.symbolType===e.symbolTypes.GLYPH?(u.yShift+=e.getYShiftForGlyph(u.glyph)*s.pointsToPixels*m,u.xShift+=e.getXShiftForGlyph(u.glyph)*s.pointsToPixels*m,u.glyph.scale=u.glyph.scale*y,u.width=e.getWidthForGlyph(u.glyph)*s.pointsToPixels*m):u.symbolType===e.symbolTypes.TEXT&&(u.width=u.width*s.textFont.pointsToPixels*m,u.yShift+=s.getYOffsetForText(u.text)*y),u.symbolType===e.symbolTypes.GLYPH&&u.glyph.code===e.glyphs.over.code&&(d=2),u.width+=e.spacingBetweenBlocks*s.pointsToPixels*m,f&&p>0){var _=s.symbolBlocks[p-1];s.isSuperscript(_)||(o=n)}g&&o>0&&(l=!0,u.xShift=u.xShift+(o-n),n=o,o=0,s.setEnableKerning(!1)),f||g||(o=0),u.vAlign=l,n+=u.width}s.updateKerningAdjustments(),s.updateOverBarAdjustments(),s.getVertical()===e.verticalJustify.TOP?(s.setTextLine(i.top_text_line),i.top_text_line+=d):(s.setTextLine(i.text_line+1),i.text_line+=d+1),s.getReportWidth()?r.push(n):r.push(0)}return n=r.reduce((function(t,e){return t+e})),i.left_shift+=n/2,i.right_shift+=n/2,!0},Object.defineProperty(e.prototype,"pointsToPixels",{get:function(){return this.textFont.pointsToPixels},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"superscriptOffset",{get:function(){return e.superscriptOffset*this.pointsToPixels},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"subscriptOffset",{get:function(){return e.subscriptOffset*this.pointsToPixels},enumerable:!1,configurable:!0}),e.prototype.setReportWidth=function(t){return this.reportWidth=t,this},e.prototype.getReportWidth=function(){return this.reportWidth},e.prototype.updateOverBarAdjustments=function(){var t=0,i=this.symbolBlocks.findIndex((function(t){return t.symbolType===e.symbolTypes.GLYPH&&"csymDiagonalArrangementSlash"===t.glyph.code}));if(!(i<0)){for(var n=this.symbolBlocks[i].width/4,o=.25*this.pointsToPixels;t<i;++t){(r=this.symbolBlocks[t]).xShift=r.xShift+n,r.yShift=r.yShift-o}for(t=i+1;t<this.symbolBlocks.length;++t){var r;(r=this.symbolBlocks[t]).xShift=r.xShift-n,r.yShift=r.yShift+o}}},e.prototype.updateKerningAdjustments=function(){for(var t=0,e=0;e<this.symbolBlocks.length;++e){var i=this.symbolBlocks[e];t+=this.getKerningAdjustment(e),i.xShift+=t}},e.prototype.getKerningAdjustment=function(t){if(!this.useKerning)return 0;var i=this.symbolBlocks[t],n=e.kerningOffset*this.pointsToPixels,o=t>0?this.symbolBlocks[t-1]:void 0,r=0;i.symbolType===e.symbolTypes.GLYPH&&i.glyph.code===e.glyphs.over.code&&(r+=i.glyph.metrics.x_shift),void 0!==o&&o.symbolType===e.symbolTypes.GLYPH&&o.glyph.code===e.glyphs.over.code&&(r+=o.glyph.metrics.x_shift);var a=!1,s=!1;return null!=o&&o.symbolType===e.symbolTypes.TEXT&&(a=e.upperKerningText.some((function(t){return t===o.text[o.text.length-1]})),s=e.lowerKerningText.some((function(t){return t===o.text[o.text.length-1]}))),a&&i.symbolModifier===e.symbolModifiers.SUPERSCRIPT&&(r+=n),s&&i.symbolType===e.symbolTypes.TEXT&&(i.text[0]>="a"&&i.text[0]<="z"&&(r+=n/2),e.upperKerningText.some((function(t){return t===(null==o?void 0:o.text[o.text.length-1])}))&&(r+=n/2)),r},e.prototype.getSymbolBlock=function(t){var i=(t=null==t?{}:t).symbolType?t.symbolType:e.symbolTypes.TEXT,n={text:t.text?t.text:"",symbolType:i,symbolModifier:t.symbolModifier?t.symbolModifier:e.symbolModifiers.NONE,xShift:0,yShift:0,vAlign:0,width:(0,0),glyph:void 0};if(i===e.symbolTypes.GLYPH&&"string"==typeof t.glyph){var o=e.glyphs[t.glyph];n.glyph=new S(o.code,20,{category:"chordSymbol"})}else if(i===e.symbolTypes.TEXT){for(var r=0,a=0;a<n.text.length;++a)r+=this.getWidthForCharacter(n.text[a]);n.width=r}else i===e.symbolTypes.LINE&&(n.width=t.width);return n},e.prototype.addSymbolBlock=function(t){return this.symbolBlocks.push(this.getSymbolBlock(t)),this},e.prototype.addText=function(t,i){return(i=null==i?{}:i).text=t,i.symbolType=e.symbolTypes.TEXT,this.addSymbolBlock(i)},e.prototype.addTextSuperscript=function(t){var i=e.symbolTypes.TEXT,n=e.symbolModifiers.SUPERSCRIPT;return this.addSymbolBlock({text:t,symbolType:i,symbolModifier:n})},e.prototype.addTextSubscript=function(t){var i=e.symbolTypes.TEXT,n=e.symbolModifiers.SUBSCRIPT;return this.addSymbolBlock({text:t,symbolType:i,symbolModifier:n})},e.prototype.addGlyphSuperscript=function(t){var i=e.symbolTypes.GLYPH,n=e.symbolModifiers.SUPERSCRIPT;return this.addSymbolBlock({glyph:t,symbolType:i,symbolModifier:n})},e.prototype.addGlyph=function(t,i){return(i=null==i?{}:i).glyph=t,i.symbolType=e.symbolTypes.GLYPH,this.addSymbolBlock(i)},e.prototype.addGlyphOrText=function(t,i){i=null==i?{}:i;for(var n="",o=0;o<t.length;++o)e.glyphs[t[o]]?(n.length>0&&(this.addText(n,i),n=""),this.addGlyph(t[o],i)):n+=t[o];return n.length>0&&this.addText(n,i),this},e.prototype.addLine=function(t,i){return(i=null==i?{}:i).symbolType=e.symbolTypes.LINE,i.width=t,this.addSymbolBlock(i)},e.prototype.getCategory=function(){return e.CATEGORY},e.prototype.setFont=function(t,e,i){return this.font={family:t,size:e,weight:i},this.textFont=Ct.getTextFontFromVexFontData(this.font),this},e.prototype.setFontSize=function(t){return this.font.size=t,this.textFont.setFontSize(t),this},e.prototype.setEnableKerning=function(t){return this.useKerning=t,this},e.prototype.setVertical=function(t){return this.vertical="string"==typeof t?e.verticalJustifyString[t]:t,this},e.prototype.getVertical=function(){return this.vertical},e.prototype.setHorizontal=function(t){return this.horizontal="string"==typeof t?e.horizontalJustifyString[t]:t,this},e.prototype.getWidth=function(){var t=0;return this.symbolBlocks.forEach((function(e){t+=e.vAlign?0:e.width})),t},e.prototype.isSuperscript=function(t){return void 0!==t.symbolModifier&&t.symbolModifier===e.symbolModifiers.SUPERSCRIPT},e.prototype.isSubscript=function(t){return void 0!==t.symbolModifier&&t.symbolModifier===e.symbolModifiers.SUBSCRIPT},e.prototype.draw=function(){var t=this,i=this.checkContext(),n=this.checkAttachedNote();this.setRendered(),i.save();var o=Object.keys(this.getAttribute("classes")).join(" ");i.openGroup(o,this.getAttribute("id"));var r,a=n.getModifierStartXY(F.Position.ABOVE,this.index);i.setFont(this.font.family,this.font.size,this.font.weight);var s=n.hasStem(),h=n.checkStave();if(this.vertical===e.verticalJustify.BOTTOM){if(r=h.getYForBottomText(this.text_line+ei.TEXT_HEIGHT_OFFSET_HACK),s){var c=n.checkStem().getExtents(),d=h.getSpacingBetweenLines(),l=1===n.getStemDirection()?c.baseY:c.topY;r=Math.max(r,l+d*(this.text_line+2))}}else if(r=Math.min(h.getYForTopText(this.text_line),n.getYs()[0]-10),s){c=n.checkStem().getExtents(),d=h.getSpacingBetweenLines();r=Math.min(r,c.topY-5-d*this.text_line)}var p=a.x;p=this.horizontal===e.horizontalJustify.LEFT?a.x:this.horizontal===e.horizontalJustify.RIGHT?a.x+this.getWidth():this.horizontal===e.horizontalJustify.CENTER?a.x-this.getWidth()/2:n.getStemX()-this.getWidth()/2,Pt("Rendering ChordSymbol: ",this.textFont,p,r),this.symbolBlocks.forEach((function(n){var o=t.isSuperscript(n),a=t.isSubscript(n),s=r;Pt("shift was ",n.xShift,n.yShift),Pt("curY pre sub ",s),o&&(s+=t.superscriptOffset),a&&(s+=t.subscriptOffset),Pt("curY sup/sub ",s),n.symbolType===e.symbolTypes.TEXT?((o||a)&&(i.save(),i.setFont(t.font.family,t.font.size*e.superSubRatio,t.font.weight)),Pt("Rendering Text: ",n.text,p+n.xShift,s+n.yShift),i.fillText(n.text,p+n.xShift,s+n.yShift),(o||a)&&i.restore()):n.symbolType===e.symbolTypes.GLYPH?(s+=n.yShift,Pt("Rendering Glyph: ",n.glyph.code,p+n.xShift,s),n.glyph.render(i,p+n.xShift,s)):n.symbolType===e.symbolTypes.LINE&&(Pt("Rendering Line : ",n.width,p,s),i.beginPath(),i.setLineWidth(1),i.moveTo(p,r),i.lineTo(p+n.width,s),i.stroke()),p+=n.width,n.vAlign&&(p+=n.xShift)})),i.closeGroup(),i.restore()},e.DEBUG=!1,e.horizontalJustify={LEFT:1,CENTER:2,RIGHT:3,CENTER_STEM:4},e.horizontalJustifyString={left:e.horizontalJustify.LEFT,right:e.horizontalJustify.RIGHT,center:e.horizontalJustify.CENTER,centerStem:e.horizontalJustify.CENTER_STEM},e.verticalJustify={TOP:1,BOTTOM:2},e.verticalJustifyString={top:e.verticalJustify.TOP,above:e.verticalJustify.TOP,below:e.verticalJustify.BOTTOM,bottom:e.verticalJustify.BOTTOM},e.glyphs={diminished:{code:"csymDiminished"},dim:{code:"csymDiminished"},halfDiminished:{code:"csymHalfDiminished"},"+":{code:"csymAugmented"},augmented:{code:"csymAugmented"},majorSeventh:{code:"csymMajorSeventh"},minor:{code:"csymMinor"},"-":{code:"csymMinor"},"(":{code:"csymParensLeftTall"},leftParen:{code:"csymParensLeftTall"},")":{code:"csymParensRightTall"},rightParen:{code:"csymParensRightTall"},leftBracket:{code:"csymBracketLeftTall"},rightBracket:{code:"csymBracketRightTall"},leftParenTall:{code:"csymParensLeftVeryTall"},rightParenTall:{code:"csymParensRightVeryTall"},"/":{code:"csymDiagonalArrangementSlash"},over:{code:"csymDiagonalArrangementSlash"},"#":{code:"accidentalSharp"},b:{code:"accidentalFlat"}},e.symbolTypes={GLYPH:1,TEXT:2,LINE:3},e.symbolModifiers={NONE:1,SUBSCRIPT:2,SUPERSCRIPT:3},e}(F),Dt=function(t){function e(i,n,o){var r=t.call(this)||this;return r.setAttribute("type","Bend"),r.text=i,r.x_shift=0,r.release=n||!1,r.font="10pt Arial",r.render_options={line_width:1.5,line_style:"#777777",bend_width:8,release_width:8},o?r.phrase=o:(r.phrase=[{type:e.UP,text:r.text}],r.release&&r.phrase.push({type:e.DOWN,text:""})),r.updateWidth(),r}return o(e,t),Object.defineProperty(e,"CATEGORY",{get:function(){return"bends"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"UP",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(e,"DOWN",{get:function(){return 1},enumerable:!1,configurable:!0}),e.format=function(t,e){if(!t||0===t.length)return!1;for(var i=0,n=e.top_text_line,o=0;o<t.length;++o){var r=t[o];r.setXShift(i),i=r.getWidth(),r.setTextLine(n)}return e.right_shift+=i,e.top_text_line+=1,!0},e.prototype.getCategory=function(){return e.CATEGORY},e.prototype.setXShift=function(t){return this.x_shift=t,this.updateWidth(),this},e.prototype.setFont=function(t){return this.font=t,this},e.prototype.getText=function(){return this.text},e.prototype.updateWidth=function(){var t=this;for(var i,n,o=0,r=0;r<this.phrase.length;++r){var a=this.phrase[r];if(null!=a.width)o+=a.width;else{var s=a.type===e.UP?this.render_options.bend_width:this.render_options.release_width;a.width=Math.max(s,(i=a.text,n=void 0,(n=t.getContext())?n.measureText(i).width:ei.textWidth(i)))+3,a.draw_width=a.width/2,o+=a.width}}return this.setWidth(o+this.x_shift),this},e.prototype.draw=function(){var t=this.checkContext(),i=this.checkAttachedNote();this.setRendered();var n=i.getModifierStartXY(F.Position.RIGHT,this.index);n.x+=3,n.y+=.5;var o=this.x_shift,r=i.checkStave(),a=r.getYForTopText(this.text_line)+3,s=r.getYForTopText(this.text_line)-1,c=this;function d(e,i,n,o){t.save(),t.beginPath(),t.setLineWidth(c.render_options.line_width),t.setStrokeStyle(c.render_options.line_style),t.setFillStyle(c.render_options.line_style),t.moveTo(e,o),t.quadraticCurveTo(e+n,o,e+n,i),t.stroke(),t.restore()}function l(e,i,n){var o=n||1;t.beginPath(),t.moveTo(e,i),t.lineTo(e-4,i+4*o),t.lineTo(e+4,i+4*o),t.closePath(),t.fill()}function p(e,i){t.save(),t.setRawFont(c.font);var n=e-t.measureText(i).width/2;t.fillText(i,n,s),t.restore()}for(var u,f,g,m,y,_,x=void 0,v=0,S=0,b=0;b<this.phrase.length;++b){var w=this.phrase[b];w.draw_width||(w.draw_width=0),0===b&&(w.draw_width+=o),S=w.draw_width+v-(1===b?o:0),w.type===e.UP&&(x&&x.type===e.UP&&l(n.x,a),u=n.x,f=n.y,m=a,y=void 0,_=void 0,y=u+(g=S),_=f,t.save(),t.beginPath(),t.setLineWidth(c.render_options.line_width),t.setStrokeStyle(c.render_options.line_style),t.setFillStyle(c.render_options.line_style),t.moveTo(u,f),t.quadraticCurveTo(y,_,u+g,m),t.stroke(),t.restore()),w.type===e.DOWN&&(x&&x.type===e.UP&&d(n.x,n.y,S,a),x&&x.type===e.DOWN&&(l(n.x,n.y,-1),d(n.x,n.y,S,a)),x||(S=w.draw_width,d(n.x,n.y,S,a))),p(n.x+S,w.text),x=w,v=w.draw_width,x.x=n.x,n.x+=S}if(!x||null==x.x)throw new h("NoLastBendForBend","Internal error.");x.type===e.UP?l(x.x+S,a):x.type===e.DOWN&&l(x.x+S,n.y,-1)},e}(F),Ft=function(t){function e(){var e=t.call(this)||this;return e.setAttribute("type","Vibrato"),e.position=F.Position.RIGHT,e.render_options={harsh:!1,vibrato_width:20,wave_height:6,wave_width:4,wave_girth:2},e.setVibratoWidth(e.render_options.vibrato_width),e}return o(e,t),Object.defineProperty(e,"CATEGORY",{get:function(){return"vibratos"},enumerable:!1,configurable:!0}),e.format=function(t,e,i){if(!t||0===t.length)return!1;var n=e.top_text_line,o=0,r=e.right_shift-7,a=i.getMembers(Dt.CATEGORY);a&&a.length>0&&n--;for(var s=0;s<t.length;++s){var h=t[s];h.setXShift(r),h.setTextLine(n),r+=o+=h.getWidth()}return e.right_shift+=o,e.top_text_line+=1,!0},e.prototype.getCategory=function(){return e.CATEGORY},e.prototype.setHarsh=function(t){return this.render_options.harsh=t,this},e.prototype.setVibratoWidth=function(t){return this.render_options.vibrato_width=t,this.setWidth(t),this},e.prototype.draw=function(){var t=this.checkContext(),i=this.checkAttachedNote();this.setRendered();var n=i.getModifierStartXY(F.Position.RIGHT,this.index).x+this.x_shift,o=i.getYForTopText(this.text_line)+2;e.renderVibrato(t,n,o,this.render_options)},e.renderVibrato=function(t,e,i,n){var o,r=n.harsh,a=n.vibrato_width,s=n.wave_width,h=n.wave_girth,c=n.wave_height,d=a/s;if(t.beginPath(),r){for(t.moveTo(e,i+h+1),o=0;o<d/2;++o)t.lineTo(e+s,i-c/2),e+=s,t.lineTo(e+s,i+c/2),e+=s;for(o=0;o<d/2;++o)t.lineTo(e-s,i-c/2+h+1),e-=s,t.lineTo(e-s,i+c/2+h+1),e-=s;t.fill()}else{for(t.moveTo(e,i+h),o=0;o<d/2;++o)t.quadraticCurveTo(e+s/2,i-c/2,e+s,i),e+=s,t.quadraticCurveTo(e+s/2,i+c/2,e+s,i),e+=s;for(o=0;o<d/2;++o)t.quadraticCurveTo(e-s/2,i+c/2+h,e-s,i+h),e-=s,t.quadraticCurveTo(e-s/2,i-c/2+h,e-s,i+h),e-=s;t.fill()}},e}(F);function Nt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Bt.DEBUG&&d("Vex.Flow.ModifierContext",t)}var Mt,Bt=function(){function t(){this.members={},this.preFormatted=!1,this.postFormatted=!1,this.width=0,this.spacing=0,this.state={left_shift:0,right_shift:0,text_line:0,top_text_line:0},this.PREFORMAT=[j,H,tt,se,it,re,et,st,mt,xt,At,kt,Dt,Ft],this.POSTFORMAT=[j]}return t.prototype.addModifier=function(t){return Nt("addModifier is deprecated, use addMember instead."),this.addMember(t)},t.prototype.addMember=function(t){var e=t.getCategory();return this.members[e]||(this.members[e]=[]),this.members[e].push(t),t.setModifierContext(this),this.preFormatted=!1,this},t.prototype.getModifiers=function(t){return Nt("getModifiers is deprecated, use getMembers instead."),this.getMembers(t)},t.prototype.getMembers=function(t){return this.members[t]},t.prototype.getWidth=function(){return this.width},t.prototype.getLeftShift=function(){return this.state.left_shift},t.prototype.getRightShift=function(){return this.state.right_shift},t.prototype.getState=function(){return this.state},t.prototype.getMetrics=function(){if(!this.formatted)throw new h("UnformattedMember","Unformatted member has no metrics.");return{width:this.state.left_shift+this.state.right_shift+this.spacing,spacing:this.spacing}},t.prototype.preFormat=function(){var t=this;this.preFormatted||(this.PREFORMAT.forEach((function(e){Nt("Preformatting ModifierContext: ",e.CATEGORY),e.format(t.getMembers(e.CATEGORY),t.state,t)})),this.width=this.state.left_shift+this.state.right_shift,this.preFormatted=!0)},t.prototype.postFormat=function(){var t=this;this.postFormatted||this.POSTFORMAT.forEach((function(e){Nt("Postformatting ModifierContext: ",e.CATEGORY),e.postFormat(t.getMembers(e.CATEGORY))}))},t}();!function(t){t[t.CENTER=0]="CENTER",t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT",t[t.ABOVE=3]="ABOVE",t[t.BELOW=4]="BELOW",t[t.BEGIN=5]="BEGIN",t[t.END=6]="END"}(Mt||(Mt={}));var Ot,Rt=function(t){function e(){var i=t.call(this)||this;return i.width=0,i.x=0,i.setAttribute("type","StaveModifier"),i.padding=10,i.position=e.Position.ABOVE,i}return o(e,t),Object.defineProperty(e,"Position",{get:function(){return Mt},enumerable:!1,configurable:!0}),e.prototype.getPosition=function(){return this.position},e.prototype.setPosition=function(t){return this.position=t,this},e.prototype.getStave=function(){return this.stave},e.prototype.checkStave=function(){if(!this.stave)throw new h("NoStave","No stave attached to instance");return this.stave},e.prototype.setStave=function(t){return this.stave=t,this},e.prototype.getWidth=function(){return this.width},e.prototype.setWidth=function(t){return this.width=t,this},e.prototype.getX=function(){return this.x},e.prototype.setX=function(t){return this.x=t,this},e.prototype.getCategory=function(){return""},e.prototype.placeGlyphOnLine=function(t,e,i,n){void 0===n&&(n=0),t.setYShift(e.getYForLine(null!=i?i:0)-e.getYForGlyphs()+n)},e.prototype.getPadding=function(t){return void 0!==t&&t<2?0:this.padding},e.prototype.setPadding=function(t){return this.padding=t,this},e.prototype.setLayoutMetrics=function(t){return this.layoutMetrics=t,this},e.prototype.getLayoutMetrics=function(){return this.layoutMetrics},e.prototype.draw=function(t,e){},e}(y);!function(t){t[t.SINGLE=1]="SINGLE",t[t.DOUBLE=2]="DOUBLE",t[t.END=3]="END",t[t.REPEAT_BEGIN=4]="REPEAT_BEGIN",t[t.REPEAT_END=5]="REPEAT_END",t[t.REPEAT_BOTH=6]="REPEAT_BOTH",t[t.NONE=7]="NONE"}(Ot||(Ot={}));var Lt,Wt=function(t){function e(e){var i=t.call(this)||this;i.setAttribute("type","Barline"),i.thickness=ei.STAVE_LINE_THICKNESS;var n=Ot;return i.widths={},i.widths[n.SINGLE]=5,i.widths[n.DOUBLE]=5,i.widths[n.END]=5,i.widths[n.REPEAT_BEGIN]=5,i.widths[n.REPEAT_END]=5,i.widths[n.REPEAT_BOTH]=5,i.widths[n.NONE]=5,i.paddings={},i.paddings[n.SINGLE]=0,i.paddings[n.DOUBLE]=0,i.paddings[n.END]=0,i.paddings[n.REPEAT_BEGIN]=15,i.paddings[n.REPEAT_END]=15,i.paddings[n.REPEAT_BOTH]=15,i.paddings[n.NONE]=0,i.layoutMetricsMap={},i.layoutMetricsMap[n.SINGLE]={xMin:0,xMax:1,paddingLeft:5,paddingRight:5},i.layoutMetricsMap[n.DOUBLE]={xMin:-3,xMax:1,paddingLeft:5,paddingRight:5},i.layoutMetricsMap[n.END]={xMin:-5,xMax:1,paddingLeft:5,paddingRight:5},i.layoutMetricsMap[n.REPEAT_END]={xMin:-10,xMax:1,paddingLeft:5,paddingRight:5},i.layoutMetricsMap[n.REPEAT_BEGIN]={xMin:-2,xMax:10,paddingLeft:5,paddingRight:5},i.layoutMetricsMap[n.REPEAT_BOTH]={xMin:-10,xMax:10,paddingLeft:5,paddingRight:5},i.layoutMetricsMap[n.NONE]={xMin:0,xMax:0,paddingLeft:5,paddingRight:5},i.setPosition(Rt.Position.BEGIN),i.setType(e),i}return o(e,t),Object.defineProperty(e,"CATEGORY",{get:function(){return"barlines"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"type",{get:function(){return Ot},enumerable:!1,configurable:!0}),Object.defineProperty(e,"typeString",{get:function(){return{single:Ot.SINGLE,double:Ot.DOUBLE,end:Ot.END,repeatBegin:Ot.REPEAT_BEGIN,repeatEnd:Ot.REPEAT_END,repeatBoth:Ot.REPEAT_BOTH,none:Ot.NONE}},enumerable:!1,configurable:!0}),e.prototype.getCategory=function(){return e.CATEGORY},e.prototype.getType=function(){return this.type},e.prototype.setType=function(t){return this.type="string"==typeof t?e.typeString[t]:t,this.setWidth(this.widths[this.type]),this.setPadding(this.paddings[this.type]),this.setLayoutMetrics(this.layoutMetricsMap[this.type]),this},e.prototype.draw=function(t){switch(t.checkContext(),this.setRendered(),this.type){case Ot.SINGLE:this.drawVerticalBar(t,this.x,!1);break;case Ot.DOUBLE:this.drawVerticalBar(t,this.x,!0);break;case Ot.END:this.drawVerticalEndBar(t,this.x);break;case Ot.REPEAT_BEGIN:this.drawRepeatBar(t,this.x,!0),t.getX()!==this.x&&this.drawVerticalBar(t,t.getX());break;case Ot.REPEAT_END:this.drawRepeatBar(t,this.x,!1);break;case Ot.REPEAT_BOTH:this.drawRepeatBar(t,this.x,!1),this.drawRepeatBar(t,this.x,!0)}},e.prototype.drawVerticalBar=function(t,e,i){var n=t.checkContext(),o=t.getTopLineTopY(),r=t.getBottomLineBottomY();i&&n.fillRect(e-3,o,1,r-o),n.fillRect(e,o,1,r-o)},e.prototype.drawVerticalEndBar=function(t,e){var i=t.checkContext(),n=t.getTopLineTopY(),o=t.getBottomLineBottomY();i.fillRect(e-5,n,1,o-n),i.fillRect(e-2,n,3,o-n)},e.prototype.drawRepeatBar=function(t,e,i){var n=t.checkContext(),o=t.getTopLineTopY(),r=t.getBottomLineBottomY(),a=3;i||(a=-5),n.fillRect(e+a,o,1,r-o),n.fillRect(e-2,o,3,r-o);i?a+=4:a-=4;var s=e+a+1,h=(t.getNumLines()-1)*t.getSpacingBetweenLines(),c=o+(h=h/2-t.getSpacingBetweenLines()/2)+1;n.beginPath(),n.arc(s,c,2,0,2*Math.PI,!1),n.fill(),c+=t.getSpacingBetweenLines(),n.beginPath(),n.arc(s,c,2,0,2*Math.PI,!1),n.fill()},e}(Rt),It=function(t){function e(e,i,n){var o=t.call(this)||this;return o.setAttribute("type","Repetition"),o.symbol_type=e,o.x=i,o.x_shift=0,o.y_shift=n,o.font={family:"times",size:12,weight:"bold",style:"italic"},o}return o(e,t),Object.defineProperty(e,"CATEGORY",{get:function(){return"repetitions"},enumerable:!1,configurable:!0}),e.prototype.getCategory=function(){return e.CATEGORY},e.prototype.setShiftX=function(t){return this.x_shift=t,this},e.prototype.setShiftY=function(t){return this.y_shift=t,this},e.prototype.draw=function(t,i){switch(this.setRendered(),this.symbol_type){case e.type.CODA_RIGHT:this.drawCodaFixed(t,i+t.getWidth());break;case e.type.CODA_LEFT:this.drawSymbolText(t,i,"Coda",!0);break;case e.type.SEGNO_LEFT:this.drawSignoFixed(t,i);break;case e.type.SEGNO_RIGHT:this.drawSignoFixed(t,i+t.getWidth());break;case e.type.DC:this.drawSymbolText(t,i,"D.C.",!1);break;case e.type.DC_AL_CODA:this.drawSymbolText(t,i,"D.C. al",!0);break;case e.type.DC_AL_FINE:this.drawSymbolText(t,i,"D.C. al Fine",!1);break;case e.type.DS:this.drawSymbolText(t,i,"D.S.",!1);break;case e.type.DS_AL_CODA:this.drawSymbolText(t,i,"D.S. al",!0);break;case e.type.DS_AL_FINE:this.drawSymbolText(t,i,"D.S. al Fine",!1);break;case e.type.FINE:this.drawSymbolText(t,i,"Fine",!1)}return this},e.prototype.drawCodaFixed=function(t,e){var i=t.getYForTopText(t.getNumLines())+this.y_shift;return S.renderGlyph(t.checkContext(),this.x+e+this.x_shift,i+25,40,"coda",{category:"coda"}),this},e.prototype.drawSignoFixed=function(t,e){var i=t.getYForTopText(t.getNumLines())+this.y_shift;return S.renderGlyph(t.checkContext(),this.x+e+this.x_shift,i+25,30,"segno",{category:"segno"}),this},e.prototype.drawSymbolText=function(t,i,n,o){var r=t.checkContext();r.save(),r.setFont(this.font.family,this.font.size,this.font.weight);var a=0+this.x_shift,s=i+this.x_shift;if(this.symbol_type===e.type.CODA_LEFT)s=(a=this.x+t.getOptions().vertical_bar_width)+r.measureText(n).width+12;else if(this.symbol_type===e.type.DS){var h=t.getNoteStartX()-this.x;a=this.x+i+this.x_shift+t.getWidth()-5-h-r.measureText(n).width}else a=(s=this.x+i+t.getWidth()-5+this.x_shift)-+r.measureText(n).width-12;var c=t.getYForTopText(t.getNumLines())+this.y_shift;return o&&S.renderGlyph(r,s,c,40,"coda",{category:"coda"}),r.fillText(n,a,c+5),r.restore(),this},e.type={NONE:1,CODA_LEFT:2,CODA_RIGHT:3,SEGNO_LEFT:4,SEGNO_RIGHT:5,DC:6,DC_AL_CODA:7,DC_AL_FINE:8,DS:9,DS_AL_CODA:10,DS_AL_FINE:11,FINE:12},e}(Rt),Ut=function(t){function e(e,i,n){var o=t.call(this)||this;return o.setAttribute("type","StaveSection"),o.setWidth(16),o.section=e,o.x=i,o.shift_x=0,o.shift_y=n,o.font={family:"sans-serif",size:12,weight:"bold"},o}return o(e,t),Object.defineProperty(e,"CATEGORY",{get:function(){return"stavesection"},enumerable:!1,configurable:!0}),e.prototype.getCategory=function(){return e.CATEGORY},e.prototype.setStaveSection=function(t){return this.section=t,this},e.prototype.setShiftX=function(t){return this.shift_x=t,this},e.prototype.setShiftY=function(t){return this.shift_y=t,this},e.prototype.draw=function(t,e){var i=t.checkContext();this.setRendered(),i.save(),i.setLineWidth(2),i.setFont(this.font.family,this.font.size,this.font.weight);var n=i.measureText(""+this.section).width,o=n+6;o<18&&(o=18);var r=t.getYForTopText(3)+this.shift_y,a=this.x+e;return i.beginPath(),i.setLineWidth(2),i.rect(a,r,o,20),i.stroke(),a+=(o-n)/2,i.fillText(""+this.section,a,r+16),i.restore(),this},e}(Rt),Gt=function(t){function e(e,i,n){var o=t.call(this)||this;return o.setAttribute("type","StaveTempo"),o.tempo=e,o.position=Rt.Position.ABOVE,o.x=i,o.shift_x=10,o.shift_y=n,o.font={family:"times",size:14,weight:"bold"},o.render_options={glyph_font_scale:30},o}return o(e,t),Object.defineProperty(e,"CATEGORY",{get:function(){return"stavetempo"},enumerable:!1,configurable:!0}),e.prototype.getCategory=function(){return e.CATEGORY},e.prototype.setTempo=function(t){return this.tempo=t,this},e.prototype.setShiftX=function(t){return this.shift_x=t,this},e.prototype.setShiftY=function(t){return this.shift_y=t,this},e.prototype.draw=function(t,e){var i=t.checkContext();this.setRendered();var n=this.render_options,o=n.glyph_font_scale/38,r=this.tempo.name,a=this.tempo.duration,s=this.tempo.dots,h=this.tempo.bpm,c=this.font,d=this.x+this.shift_x+e,l=t.getYForTopText(1)+this.shift_y;if(i.save(),r&&(i.setFont(c.family,c.size,c.weight),i.fillText(r,d,l),d+=i.measureText(r).width),a&&h){i.setFont(c.family,c.size,"normal"),r&&(d+=i.measureText(" ").width,i.fillText("(",d,l),d+=i.measureText("(").width);var p=ei.getGlyphProps(a);if(d+=3*o,S.renderGlyph(i,d,l,n.glyph_font_scale,p.code_head),d+=p.getWidth()*o,p.stem){var u=30;p.beam_count&&(u+=3*(p.beam_count-1));var f=l-(u*=o);i.fillRect(d-o,f,o,u),p.flag&&(S.renderGlyph(i,d,f,n.glyph_font_scale,p.code_flag_upstem,{category:"flag.staveTempo"}),s||(d+=6*o))}for(var g=0;g<s;g++)d+=6*o,i.beginPath(),i.arc(d,l+2*o,2*o,0,2*Math.PI,!1),i.fill();i.fillText(" = "+h+(r?")":""),d+3*o,l)}return i.restore(),this},e}(Rt);!function(t){t[t.LEFT=1]="LEFT",t[t.CENTER=2]="CENTER",t[t.RIGHT=3]="RIGHT"}(Lt||(Lt={}));var jt=function(t){function e(i){var n=t.call(this,i)||this;if(n.setAttribute("type","TextNote"),n.text=i.text,n.superscript=i.superscript,n.subscript=i.subscript,n.glyph=void 0,n.font=r({family:"Arial",size:12,weight:""},i.font),i.glyph){var o=e.GLYPHS[i.glyph];if(!o)throw new h("Invalid glyph type: "+i.glyph);n.glyph=new S(o.code,40,{category:"textNote"}),n.setWidth(n.glyph.getMetrics().width)}return n.line=i.line||0,n.smooth=i.smooth||!1,n.ignore_ticks=i.ignore_ticks||!1,n.justification=e.Justification.LEFT,n}return o(e,t),Object.defineProperty(e,"Justification",{get:function(){return Lt},enumerable:!1,configurable:!0}),Object.defineProperty(e,"GLYPHS",{get:function(){return{segno:{code:"segno"},tr:{code:"ornamentTrill"},mordent:{code:"ornamentMordent"},mordent_upper:{code:"ornamentShortTrill"},mordent_lower:{code:"ornamentMordent"},f:{code:"dynamicForte"},p:{code:"dynamicPiano"},m:{code:"dynamicMezzo"},s:{code:"dynamicSforzando"},z:{code:"dynamicZ"},coda:{code:"coda"},pedal_open:{code:"keyboardPedalPed"},pedal_close:{code:"keyboardPedalUp"},caesura_straight:{code:"caesura"},caesura_curved:{code:"caesuraCurved"},breath:{code:"breathMarkComma"},tick:{code:"breathMarkTick"},turn:{code:"ornamentTurn"},turn_inverted:{code:"ornamentTurnSlash"}}},enumerable:!1,configurable:!0}),e.prototype.setJustification=function(t){return this.justification=t,this},e.prototype.setLine=function(t){return this.line=t,this},e.prototype.preFormat=function(){var t=this.checkContext();if(!this.tickContext)throw new h("NoTickContext","Can't preformat without a TickContext.");this.preFormatted||(this.smooth?this.setWidth(0):this.glyph||(t.setFont(this.font.family,this.font.size,this.font.weight),this.setWidth(t.measureText(this.text).width)),this.justification===e.Justification.CENTER?this.leftDisplacedHeadPx=this.width/2:this.justification===e.Justification.RIGHT&&(this.leftDisplacedHeadPx=this.width),this.rightDisplacedHeadPx=this.tickContext.getMetrics().glyphPx/2,this.setPreFormatted(!0))},e.prototype.draw=function(){var t=this.checkContext(),i=this.checkStave();if(!this.tickContext)throw new h("NoTickContext","Can't draw without a TickContext.");this.setRendered();var n,o=this.getAbsoluteX()+this.tickContext.getMetrics().glyphPx/2,r=this.getWidth();if(this.justification===e.Justification.CENTER?o-=r/2:this.justification===e.Justification.RIGHT&&(o-=r),this.glyph)n=i.getYForLine(this.line+-3),this.glyph.render(t,o,n);else{n=i.getYForLine(this.line+-3),this.applyStyle(t),t.setFont(this.font.family,this.font.size,this.font.weight),t.fillText(this.text,o,n);var a=t.measureText(this.text).height;void 0===a&&(a=t.measureText("M").width),this.superscript&&(t.setFont(this.font.family,this.font.size/1.3,this.font.weight),t.fillText(this.superscript,o+r+2,n-a/2.2)),this.subscript&&(t.setFont(this.font.family,this.font.size/1.3,this.font.weight),t.fillText(this.subscript,o+r+2,n+a/2.2-1)),this.restoreStyle(t)}},e}(R),Yt=function(t){function e(e,i,n){var o=t.call(this)||this;return o.setAttribute("type","StaveText"),o.setWidth(16),o.text=e,o.position=i,o.options={shift_x:0,shift_y:0,justification:jt.Justification.CENTER},o.options=r(r({},o.options),n),o.font={family:"times",size:16,weight:"normal"},o}return o(e,t),Object.defineProperty(e,"CATEGORY",{get:function(){return"stavetext"},enumerable:!1,configurable:!0}),e.prototype.getCategory=function(){return e.CATEGORY},e.prototype.setStaveText=function(t){return this.text=t,this},e.prototype.setShiftX=function(t){return this.shift_x=t,this},e.prototype.setShiftY=function(t){return this.shift_y=t,this},e.prototype.setFont=function(t){return this.font=r(r({},this.font),t),this},e.prototype.setText=function(t){return this.text=t,this},e.prototype.draw=function(t){var e=t.checkContext();this.setRendered(),e.save(),e.setLineWidth(2),e.setFont(this.font.family,this.font.size,this.font.weight);var i,n,o=e.measureText(""+this.text).width,r=Rt.Position,a=jt.Justification;switch(this.position){case r.LEFT:case r.RIGHT:n=(t.getYForLine(0)+t.getBottomLineY())/2+this.options.shift_y,i=this.position===r.LEFT?t.getX()-o-24+this.options.shift_x:t.getX()+t.getWidth()+24+this.options.shift_x;break;case r.ABOVE:case r.BELOW:i=t.getX()+this.options.shift_x,this.options.justification===a.CENTER?i+=t.getWidth()/2-o/2:this.options.justification===a.RIGHT&&(i+=t.getWidth()-o),n=this.position===r.ABOVE?t.getYForTopText(2)+this.options.shift_y:t.getYForBottomText(2)+this.options.shift_y;break;default:throw new h("InvalidPosition","Value Must be in Modifier.Position.")}return e.fillText(""+this.text,i,n+4),e.restore(),this},e}(Rt);function Ht(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Vt.DEBUG&&d("Vex.Flow.Clef",t)}var Xt,Vt=function(t){function e(i,n,o){var r=t.call(this)||this;return r.clef=e.types.treble,r.setAttribute("type","Clef"),r.setPosition(Rt.Position.BEGIN),r.setType(i,n,o),r.setWidth(r.musicFont.lookupMetric("clef."+r.size+".width")),Ht("Creating clef:",i),r}return o(e,t),Object.defineProperty(e,"CATEGORY",{get:function(){return"clefs"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"types",{get:function(){return{treble:{code:"gClef",line:3,point:0},bass:{code:"fClef",line:1,point:0},alto:{code:"cClef",line:2,point:0},tenor:{code:"cClef",line:1,point:0},percussion:{code:"restMaxima",line:2,point:0},soprano:{code:"cClef",line:4,point:0},"mezzo-soprano":{code:"cClef",line:3,point:0},"baritone-c":{code:"cClef",line:0,point:0},"baritone-f":{code:"fClef",line:2,point:0},subbass:{code:"fClef",line:0,point:0},french:{code:"gClef",line:4,point:0},tab:{code:"6stringTabClef",point:0}}},enumerable:!1,configurable:!0}),e.prototype.getCategory=function(){return e.CATEGORY},e.prototype.setType=function(t,i,n){if(this.type=t,this.clef=e.types[t],this.size=void 0===i?"default":i,this.clef.point=this.musicFont.lookupMetric("clef."+this.size+".point",0),this.glyph=new S(this.clef.code,this.clef.point,{category:"clef."+this.clef.code+"."+this.size}),void 0!==n){var o=this.musicFont.lookupMetric("clef.annotations."+n+".smuflCode"),r=this.musicFont.lookupMetric("clef.annotations."+n+"."+this.size+".point"),a=this.musicFont.lookupMetric("clef.annotations."+n+"."+this.size+"."+this.type+".line"),s=this.musicFont.lookupMetric("clef.annotations."+n+"."+this.size+"."+this.type+".shiftX");this.annotation={code:o,point:r,line:a,x_shift:s},this.attachment=new S(this.annotation.code,this.annotation.point),this.attachment.metrics.x_max=0,this.attachment.setXShift(this.annotation.x_shift)}else this.annotation=void 0;return this},e.prototype.getWidth=function(){if("tab"===this.type&&!this.stave)throw new h("ClefError","Can't get width without stave.");return this.width},e.prototype.setStave=function(t){if(this.stave=t,"tab"!==this.type)return this;if(!this.glyph)throw new h("ClefError","Can't set stave without glyph.");var e=this.stave.getOptions().num_lines,i=this.musicFont.lookupMetric("clef.lineCount."+e+".point"),n=this.musicFont.lookupMetric("clef.lineCount."+e+".shiftY");return this.glyph.setPoint(i),this.glyph.setYShift(n),this},e.prototype.draw=function(){if(!this.x)throw new h("ClefError","Can't draw clef without x.");if(!this.stave)throw new h("ClefError","Can't draw clef without stave.");if(!this.glyph)throw new h("ClefError","Can't draw clef without glyph.");this.setRendered(),this.glyph.setStave(this.stave),this.glyph.setContext(this.stave.getContext()),void 0!==this.clef.line&&this.placeGlyphOnLine(this.glyph,this.stave,this.clef.line),this.glyph.renderToStave(this.x),void 0!==this.annotation&&void 0!==this.attachment&&(this.placeGlyphOnLine(this.attachment,this.stave,this.annotation.line),this.attachment.setStave(this.stave),this.attachment.setContext(this.stave.getContext()),this.attachment.renderToStave(this.x))},e}(Rt),zt=function(t){function e(e,i,n){var o=t.call(this)||this;return o.accList=[],o.setAttribute("type","KeySignature"),o.setKeySig(e,i,n),o.setPosition(Rt.Position.BEGIN),o.glyphFontScale=38,o.glyphs=[],o.xPositions=[],o.paddingForced=!1,o}return o(e,t),Object.defineProperty(e,"CATEGORY",{get:function(){return"keysignatures"},enumerable:!1,configurable:!0}),e.prototype.getCategory=function(){return e.CATEGORY},e.prototype.convertToGlyph=function(t,i){var n=ei.accidentalCodes(t.type),o=new S(n.code,this.glyphFontScale),r=1;if("n"===t.type&&i){var a=e.accidentalSpacing[i.type];if(a)r=i.line>=t.line?a.above:a.below}this.placeGlyphOnLine(o,this.checkStave(),t.line),this.glyphs.push(o);var s=this.xPositions[this.xPositions.length-1],h=o.getMetrics().width+r;this.xPositions.push(s+h),this.width+=h},e.prototype.cancelKey=function(t){return this.formatted=!1,this.cancelKeySpec=t,this},e.prototype.convertToCancelAccList=function(t){var e=ei.keySignature(t),i=this.accList.length>0&&e.length>0&&e[0].type!==this.accList[0].type,n=i?e.length:e.length-this.accList.length;if(!(n<1)){for(var o=[],r=0;r<n;r++){var a=r;i||(a=e.length-n+r);var s=e[a];o.push({type:"n",line:s.line})}return this.accList=o.concat(this.accList),{accList:o,type:e[0].type}}},e.prototype.addToStave=function(t){return this.paddingForced=!0,t.addModifier(this),this},e.prototype.convertAccLines=function(t,e,i){void 0===i&&(i=this.accList);var n,o,r=0;switch(t){case"soprano":"#"===e?n=[2.5,.5,2,0,1.5,-.5,1]:r=-1;break;case"mezzo-soprano":"b"===e?n=[0,2,.5,2.5,1,3,1.5]:r=1.5;break;case"alto":r=.5;break;case"tenor":"#"===e?n=[3,1,2.5,.5,2,0,1.5]:r=-.5;break;case"baritone-f":case"baritone-c":"b"===e?n=[.5,2.5,1,3,1.5,3.5,2]:r=2;break;case"bass":case"french":r=1}if(void 0!==n)for(o=0;o<i.length;++o)i[o].line=n[o];else if(0!==r)for(o=0;o<i.length;++o)i[o].line+=r},e.prototype.getPadding=function(t){return this.formatted||this.format(),0===this.glyphs.length||!this.paddingForced&&t<2?0:this.padding},e.prototype.getWidth=function(){return this.formatted||this.format(),this.width},e.prototype.setKeySig=function(t,e,i){return this.formatted=!1,this.keySpec=t,this.cancelKeySpec=e,this.alterKeySpec=i,this},e.prototype.alterKey=function(t){return this.formatted=!1,this.alterKeySpec=t,this},e.prototype.convertToAlterAccList=function(t){for(var e=Math.min(t.length,this.accList.length),i=0;i<e;++i)t[i]&&(this.accList[i].type=t[i])},e.prototype.format=function(){var t=this.checkStave();this.width=0,this.glyphs=[],this.xPositions=[0],this.accList=ei.keySignature(c(this.keySpec));var e,i=this.accList,n=i.length>0?i[0].type:void 0;if(this.cancelKeySpec&&(e=this.convertToCancelAccList(this.cancelKeySpec)),this.alterKeySpec&&this.convertToAlterAccList(this.alterKeySpec),this.accList.length>0){var o=(this.position===Rt.Position.END?t.getEndClef():t.getClef())||t.getClef();e&&this.convertAccLines(o,e.type,e.accList),this.convertAccLines(o,n,i);for(var r=0;r<this.accList.length;++r)this.convertToGlyph(this.accList[r],this.accList[r+1])}this.formatted=!0},e.prototype.draw=function(){if(!this.x)throw new h("KeySignatureError","Can't draw key signature without x.");if(!this.stave)throw new h("KeySignatureError","Can't draw key signature without stave.");this.formatted||this.format(),this.setRendered();for(var t=0;t<this.glyphs.length;t++){var e=this.glyphs[t],i=this.x+this.xPositions[t];e.setStave(this.stave),e.setContext(this.stave.checkContext()),e.renderToStave(i)}},e.accidentalSpacing={"#":{above:6,below:4},b:{above:4,below:7},n:{above:4,below:1},"##":{above:6,below:4},bb:{above:4,below:7},db:{above:4,below:7},d:{above:4,below:7},bbs:{above:4,below:7},"++":{above:6,below:4},"+":{above:6,below:4},"+-":{above:6,below:4},"++-":{above:6,below:4},bs:{above:4,below:10},bss:{above:4,below:10}},e}(Rt),Kt=function(t){function e(e,i,n,o,r,a){var s,h=t.call(this,o,r,a)||this;h.timeSignature=e,h.topGlyphs=[],h.botGlyphs=[];for(var d=0,l=0;l<i.length;++l){var p=i[l],u=new S("timeSig"+p,h.timeSignature.point);h.topGlyphs.push(u),d+=null!==(s=u.getMetrics().width)&&void 0!==s?s:0}var f=0;for(l=0;l<n.length;++l){p=n[l];var g=new S("timeSig"+p,h.timeSignature.point);h.botGlyphs.push(g),f+=c(g.getMetrics().width)}return h.width=Math.max(d,f),h.xMin=h.getMetrics().x_min,h.topStartX=(h.width-d)/2,h.botStartX=(h.width-f)/2,h.reset(),h}return o(e,t),e.prototype.getMetrics=function(){return{x_min:this.xMin,x_max:this.xMin+this.width,width:this.width}},e.prototype.renderToStave=function(t){for(var e=c(this.stave),i=t+this.topStartX,n=0;n<this.topGlyphs.length;++n){var o=this.topGlyphs[n];S.renderOutline(this.checkContext(),o.getMetrics().outline,this.scale,i+this.x_shift,e.getYForLine(this.timeSignature.topLine)),i+=c(o.getMetrics().width)}i=t+this.botStartX;for(n=0;n<this.botGlyphs.length;++n){o=this.botGlyphs[n];this.timeSignature.placeGlyphOnLine(o,e,0),S.renderOutline(this.checkContext(),o.getMetrics().outline,this.scale,i+o.getMetrics().x_shift,e.getYForLine(this.timeSignature.bottomLine)),i+=c(o.getMetrics().width)}},e}(S),Jt=function(t){function e(e,i,n){void 0===e&&(e="4/4"),void 0===i&&(i=15),void 0===n&&(n=!0);var o=t.call(this)||this;o.setAttribute("type","TimeSignature"),o.validate_args=n;var r=i;o.point=o.musicFont.lookupMetric("digits.point");var a=o.musicFont.lookupMetric("digits.shiftLine",0);return o.topLine=2+a,o.bottomLine=4+a,o.setPosition(Rt.Position.BEGIN),o.info=o.parseTimeSpec(e),o.setWidth(c(o.info.glyph.getMetrics().width)),o.setPadding(r),o}return o(e,t),Object.defineProperty(e,"CATEGORY",{get:function(){return"timesignatures"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"glyphs",{get:function(){return{C:{code:"timeSigCommon",point:40,line:2},"C|":{code:"timeSigCutCommon",point:40,line:2}}},enumerable:!1,configurable:!0}),e.prototype.getCategory=function(){return e.CATEGORY},e.prototype.parseTimeSpec=function(t){if("C"===t||"C|"===t){var i=e.glyphs[t],n=i.line,o=i.code,r=i.point;return{line:n,num:!1,glyph:new S(o,r)}}this.validate_args&&function(t){var e=t.split("/").filter((function(t){return""!==t}));if(2!==e.length)throw new h("BadTimeSignature","Invalid time spec: "+t+'. Must be in the form "<numerator>/<denominator>"');e.forEach((function(e){if(isNaN(Number(e)))throw new h("BadTimeSignature","Invalid time spec: "+t+". Must contain two valid numbers.")}))}(t);var a=t.split("/").map((function(t){return t.split("")})),s=a[0],c=a[1];return{num:!0,glyph:this.makeTimeSignatureGlyph(s,c)}},e.prototype.makeTimeSignatureGlyph=function(t,e){return new Kt(this,t,e,"timeSig0",this.point)},e.prototype.getInfo=function(){return this.info},e.prototype.setTimeSig=function(t){return this.info=this.parseTimeSpec(t),this},e.prototype.draw=function(){if(!this.x)throw new h("TimeSignatureError","Can't draw time signature without x.");if(!this.stave)throw new h("TimeSignatureError","Can't draw time signature without stave.");this.setRendered(),this.info.glyph.setStave(this.stave),this.info.glyph.setContext(this.stave.getContext()),this.placeGlyphOnLine(this.info.glyph,this.stave,this.info.line),this.info.glyph.renderToStave(this.x)},e}(Rt);!function(t){t[t.NONE=1]="NONE",t[t.BEGIN=2]="BEGIN",t[t.MID=3]="MID",t[t.END=4]="END",t[t.BEGIN_END=5]="BEGIN_END"}(Xt||(Xt={}));var qt=function(t){function e(e,i,n,o){var r=t.call(this)||this;return r.setAttribute("type","Volta"),r.volta=e,r.x=n,r.y_shift=o,r.number=i,r.font={family:"sans-serif",size:9,weight:"bold"},r}return o(e,t),Object.defineProperty(e,"CATEGORY",{get:function(){return"voltas"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"type",{get:function(){return Xt},enumerable:!1,configurable:!0}),e.prototype.getCategory=function(){return e.CATEGORY},e.prototype.setShiftY=function(t){return this.y_shift=t,this},e.prototype.draw=function(t,i){var n=t.checkContext();this.setRendered();var o=t.getWidth()-i,r=t.getYForTopText(t.getOptions().num_lines)+this.y_shift,a=1.5*t.getOptions().spacing_between_lines_px;switch(this.volta){case e.type.BEGIN:n.fillRect(this.x+i,r,1,a);break;case e.type.END:o-=5,n.fillRect(this.x+i+o,r,1,a);break;case e.type.BEGIN_END:o-=3,n.fillRect(this.x+i,r,1,a),n.fillRect(this.x+i+o,r,1,a)}return this.volta!==e.type.BEGIN&&this.volta!==e.type.BEGIN_END||(n.save(),n.setFont(this.font.family,this.font.size,this.font.weight),n.fillText(this.number,this.x+i+5,r+15),n.restore()),n.fillRect(this.x+i,r,o,1),this},e}(Rt),Qt=function(t){function e(e,i,n,o){var a=t.call(this)||this;return a.height=0,a.setAttribute("type","Stave"),a.x=e,a.y=i,a.width=n,a.formatted=!1,a.start_x=e+5,a.end_x=e+n,a.modifiers=[],a.measure=0,a.clef="treble",a.endClef=void 0,a.font={family:"sans-serif",size:8,weight:""},a.options={spacing:2,thickness:2,x_shift:0,y_shift:10,vertical_bar_width:10,glyph_spacing_px:10,num_lines:5,fill_style:"#999999",left_bar:!0,right_bar:!0,spacing_between_lines_px:ei.STAVE_LINE_DISTANCE,space_above_staff_ln:4,space_below_staff_ln:4,top_text_position:1,bottom_text_position:4,line_config:[]},a.bounds={x:a.x,y:a.y,w:a.width,h:0},a.options=r(r({},a.options),o),a.defaultLedgerLineStyle={},a.resetLines(),a.addModifier(new Wt(a.options.left_bar?Ot.SINGLE:Ot.NONE)),a.addEndModifier(new Wt(a.options.right_bar?Ot.SINGLE:Ot.NONE)),a}return o(e,t),Object.defineProperty(e,"defaultPadding",{get:function(){var t=ei.DEFAULT_FONT_STACK[0];return t.lookupMetric("stave.padding")+t.lookupMetric("stave.endPaddingMax")},enumerable:!1,configurable:!0}),Object.defineProperty(e,"rightPadding",{get:function(){return ei.DEFAULT_FONT_STACK[0].lookupMetric("stave.endPaddingMax")},enumerable:!1,configurable:!0}),e.prototype.setDefaultLedgerLineStyle=function(t){this.defaultLedgerLineStyle=t},e.prototype.getDefaultLedgerLineStyle=function(){return r(r({},this.getStyle()),this.defaultLedgerLineStyle)},e.prototype.space=function(t){return this.options.spacing_between_lines_px*t},e.prototype.resetLines=function(){this.options.line_config=[];for(var t=0;t<this.options.num_lines;t++)this.options.line_config.push({visible:!0});this.height=(this.options.num_lines+this.options.space_above_staff_ln)*this.options.spacing_between_lines_px,this.options.bottom_text_position=this.options.num_lines},e.prototype.getOptions=function(){return this.options},e.prototype.setNoteStartX=function(t){this.formatted||this.format(),this.start_x=t;var e=this.modifiers[0];return e.setX(this.start_x-e.getWidth()),this},e.prototype.getNoteStartX=function(){return this.formatted||this.format(),this.start_x},e.prototype.getNoteEndX=function(){return this.formatted||this.format(),this.end_x},e.prototype.getTieStartX=function(){return this.start_x},e.prototype.getTieEndX=function(){return this.x+this.width},e.prototype.getX=function(){return this.x},e.prototype.getNumLines=function(){return this.options.num_lines},e.prototype.setNumLines=function(t){return this.options.num_lines=parseInt(t,10),this.resetLines(),this},e.prototype.setY=function(t){return this.y=t,this},e.prototype.getY=function(){return this.y},e.prototype.getTopLineTopY=function(){return this.getYForLine(0)-ei.STAVE_LINE_THICKNESS/2},e.prototype.getBottomLineBottomY=function(){return this.getYForLine(this.getNumLines()-1)+ei.STAVE_LINE_THICKNESS/2},e.prototype.setX=function(t){var e=t-this.x;this.formatted=!1,this.x=t,this.start_x+=e,this.end_x+=e;for(var i=0;i<this.modifiers.length;i++){var n=this.modifiers[i];n.setX(n.getX()+e)}return this},e.prototype.setWidth=function(t){return this.formatted=!1,this.width=t,this.end_x=this.x+t,this},e.prototype.getWidth=function(){return this.width},e.prototype.getStyle=function(){return r({fillStyle:this.options.fill_style,strokeStyle:this.options.fill_style,lineWidth:ei.STAVE_LINE_THICKNESS},this.style||{})},e.prototype.setMeasure=function(t){return this.measure=t,this},e.prototype.getModifierXShift=function(t){if(void 0===t&&(t=0),"number"!=typeof t)throw new h("InvalidIndex","Must be of number type");if(this.formatted||this.format(),1===this.getModifiers(Rt.Position.BEGIN).length)return 0;if(this.modifiers[t].getPosition()===Rt.Position.RIGHT)return 0;var e=this.start_x-this.x,i=this.modifiers[0];return i.getType()===Ot.REPEAT_BEGIN&&e>i.getWidth()&&(e-=i.getWidth()),e},e.prototype.setRepetitionTypeLeft=function(t,e){return this.modifiers.push(new It(t,this.x,e)),this},e.prototype.setRepetitionTypeRight=function(t,e){return this.modifiers.push(new It(t,this.x,e)),this},e.prototype.setVoltaType=function(t,e,i){return this.modifiers.push(new qt(t,e,this.x,i)),this},e.prototype.setSection=function(t,e){return this.modifiers.push(new Ut(t,this.x,e)),this},e.prototype.setTempo=function(t,e){return this.modifiers.push(new Gt(t,this.x,e)),this},e.prototype.setText=function(t,e,i){return this.modifiers.push(new Yt(t,e,i)),this},e.prototype.getHeight=function(){return this.height},e.prototype.getSpacingBetweenLines=function(){return this.options.spacing_between_lines_px},e.prototype.getBoundingBox=function(){return new x(this.x,this.y,this.width,this.getBottomY()-this.y)},e.prototype.getBottomY=function(){var t=this.options,e=t.spacing_between_lines_px;return this.getYForLine(t.num_lines)+t.space_below_staff_ln*e},e.prototype.getBottomLineY=function(){return this.getYForLine(this.options.num_lines)},e.prototype.getYForLine=function(t){var e=this.options,i=e.spacing_between_lines_px,n=e.space_above_staff_ln;return this.y+t*i+n*i},e.prototype.getLineForY=function(t){var e=this.options,i=e.spacing_between_lines_px,n=e.space_above_staff_ln;return(t-this.y)/i-n},e.prototype.getYForTopText=function(t){return void 0===t&&(t=0),this.getYForLine(-t-this.options.top_text_position)},e.prototype.getYForBottomText=function(t){return void 0===t&&(t=0),this.getYForLine(this.options.bottom_text_position+t)},e.prototype.getYForNote=function(t){var e=this.options,i=e.spacing_between_lines_px,n=e.space_above_staff_ln;return this.y+n*i+5*i-t*i},e.prototype.getYForGlyphs=function(){return this.getYForLine(3)},e.prototype.addModifier=function(t,e){return void 0!==e&&t.setPosition(e),t.setStave(this),this.formatted=!1,this.modifiers.push(t),this},e.prototype.addEndModifier=function(t){return this.addModifier(t,Rt.Position.END),this},e.prototype.setBegBarType=function(t){var e=Ot.SINGLE,i=Ot.REPEAT_BEGIN,n=Ot.NONE;return t!==e&&t!==i&&t!==n||(this.modifiers[0].setType(t),this.formatted=!1),this},e.prototype.setEndBarType=function(t){return t!==Ot.REPEAT_BEGIN&&(this.modifiers[1].setType(t),this.formatted=!1),this},e.prototype.setClef=function(t,e,i,n){void 0===n&&(n=Rt.Position.BEGIN),n===Rt.Position.END?this.endClef=t:this.clef=t;var o=this.getModifiers(n,Vt.CATEGORY);return 0===o.length?this.addClef(t,e,i,n):o[0].setType(t,e,i),this},e.prototype.getClef=function(){return this.clef},e.prototype.setEndClef=function(t,e,i){return this.setClef(t,e,i,Rt.Position.END),this},e.prototype.getEndClef=function(){return this.endClef},e.prototype.setKeySignature=function(t,e,i){void 0===i&&(i=Rt.Position.BEGIN);var n=this.getModifiers(i,zt.CATEGORY);return 0===n.length?this.addKeySignature(t,e,i):n[0].setKeySig(t,e),this},e.prototype.setEndKeySignature=function(t,e){return this.setKeySignature(t,e,Rt.Position.END),this},e.prototype.setTimeSignature=function(t,e,i){void 0===i&&(i=Rt.Position.BEGIN);var n=this.getModifiers(i,Jt.CATEGORY);return 0===n.length?this.addTimeSignature(t,e,i):n[0].setTimeSig(t),this},e.prototype.setEndTimeSignature=function(t,e){return this.setTimeSignature(t,e,Rt.Position.END),this},e.prototype.addKeySignature=function(t,e,i){return void 0===i&&(i=Rt.Position.BEGIN),this.addModifier(new zt(t,e).setPosition(i),i),this},e.prototype.addClef=function(t,e,i,n){return void 0===n||n===Rt.Position.BEGIN?this.clef=t:n===Rt.Position.END&&(this.endClef=t),this.addModifier(new Vt(t,e,i),n),this},e.prototype.addEndClef=function(t,e,i){return this.addClef(t,e,i,Rt.Position.END),this},e.prototype.addTimeSignature=function(t,e,i){return this.addModifier(new Jt(t,e),i),this},e.prototype.addEndTimeSignature=function(t,e){return this.addTimeSignature(t,e,Rt.Position.END),this},e.prototype.addTrebleGlyph=function(){return this.addClef("treble"),this},e.prototype.getModifiers=function(t,e){return void 0===t&&void 0===e?this.modifiers:this.modifiers.filter((function(i){return!(void 0!==t&&t!==i.getPosition()||void 0!==e&&e!==i.getCategory())}))},e.prototype.sortByCategory=function(t,e){for(var i=t.length-1;i>=0;i--)for(var n=0;n<i;n++)if(e[t[n].getCategory()]>e[t[n+1].getCategory()]){var o=t[n];t[n]=t[n+1],t[n+1]=o}},e.prototype.format=function(){var t,e,i,n=this.modifiers[0],o=this.modifiers[1],r=this.getModifiers(Rt.Position.BEGIN),a=this.getModifiers(Rt.Position.END);this.sortByCategory(r,{barlines:0,clefs:1,keysignatures:2,timesignatures:3}),this.sortByCategory(a,{timesignatures:0,keysignatures:1,barlines:2,clefs:3}),r.length>1&&n.getType()===Ot.REPEAT_BEGIN&&(r.push(r.splice(0,1)[0]),r.splice(0,0,new Wt(Ot.SINGLE))),a.indexOf(o)>0&&a.splice(0,0,new Wt(Ot.NONE));for(var s=0,h=this.x,c=0;c<r.length;c++)e=(i=r[c]).getPadding(c+s),t=i.getWidth(),h+=e,i.setX(h),h+=t,e+t===0&&s--;this.start_x=h,h=this.x+this.width;var d={left:0,right:0,paddingRight:0,paddingLeft:0},l=0;for(c=0;c<a.length;c++){l=(i=a[c]).getCategory()===Wt.CATEGORY?c:l,d.right=0,d.left=0,d.paddingRight=0,d.paddingLeft=0;var p=i.getLayoutMetrics();p?(0!==c&&(d.right=p.xMax||0,d.paddingRight=p.paddingRight||0),d.left=-p.xMin||0,d.paddingLeft=p.paddingLeft||0,c===a.length-1&&(d.paddingLeft=0)):(d.paddingRight=i.getPadding(c-l),0!==c&&(d.right=i.getWidth()),0===c&&(d.left=i.getWidth())),h-=d.paddingRight,h-=d.right,i.setX(h),h-=d.left,h-=d.paddingLeft}this.end_x=1===a.length?this.x+this.width:h,this.formatted=!0},e.prototype.draw=function(){var t=this.checkContext();this.setRendered(),this.formatted||this.format();for(var e,i=this.options.num_lines,n=this.width,o=this.x,r=0;r<i;r++)e=this.getYForLine(r),this.applyStyle(),this.options.line_config[r].visible&&(t.beginPath(),t.moveTo(o,e),t.lineTo(o+n,e),t.stroke()),this.restoreStyle();for(var a=0;a<this.modifiers.length;a++)"function"==typeof this.modifiers[a].draw&&(this.modifiers[a].applyStyle(t),this.modifiers[a].draw(this,this.getModifierXShift(a)),this.modifiers[a].restoreStyle(t));if(this.measure>0){t.save(),t.setFont(this.font.family,this.font.size,this.font.weight);var s=t.measureText(""+this.measure).width;e=this.getYForTopText(0)+3,t.fillText(""+this.measure,this.x-s/2,e),t.restore()}return this},e.prototype.drawVertical=function(t,e){this.drawVerticalFixed(this.x+t,e)},e.prototype.drawVerticalFixed=function(t,e){var i=this.checkContext(),n=this.getYForLine(0),o=this.getYForLine(this.options.num_lines-1);e&&i.fillRect(t-3,n,1,o-n+1),i.fillRect(t,n,1,o-n+1)},e.prototype.drawVerticalBar=function(t){this.drawVerticalBarFixed(this.x+t)},e.prototype.drawVerticalBarFixed=function(t){var e=this.checkContext(),i=this.getYForLine(0),n=this.getYForLine(this.options.num_lines-1);e.fillRect(t,i,1,n-i+1)},e.prototype.getConfigForLines=function(){return this.options.line_config},e.prototype.setConfigForLine=function(t,e){if(t>=this.options.num_lines||t<0)throw new h("StaveConfigError","The line number must be within the range of the number of lines in the Stave.");if(void 0===e.visible)throw new h("StaveConfigError","The line configuration object is missing the 'visible' property.");if("boolean"!=typeof e.visible)throw new h("StaveConfigError","The line configuration objects 'visible' property must be true or false.");return this.options.line_config[t]=e,this},e.prototype.setConfigForLines=function(t){if(t.length!==this.options.num_lines)throw new h("StaveConfigError","The length of the lines configuration array must match the number of lines in the Stave");for(var e in t)t[e]||(t[e]=this.options.line_config[e]),this.options.line_config[e]=r(r({},this.options.line_config[e]),t[e]);return this.options.line_config=t,this},e}(y);function Zt(t,e,i){var n=ee.getResolutionMultiplier(t),o={},r=[],a=[];return t.forEach((function(t,s){var h=new f(0,n);t.getTickables().forEach((function(t){var n=h.numerator;if(!o[n]){var c=e({tickID:n});a.push(c),o[n]=c,r.push(n)}i(t,o[n],s),h.add(t.getTicks())}))})),{map:o,array:a,list:r.sort((function(t,e){return t-e})),resolutionMultiplier:n}}function $t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];ee.DEBUG&&d("Vex.Flow.Formatter",t)}function te(t,e,i,n){var o=e;for(i+=1;i<t.length;i+=1){var r=t[i];if(!r.isRest()&&!r.shouldIgnoreTicks()){o=r.getLineForRest();break}}n&&e!==o&&(o=p(Math.max(e,o),Math.min(e,o)));return o}var ee=function(){function t(t){void 0===t&&(t={}),this.formatterOptions=r({globalSoftmax:!1,maxIterations:5},t),this.justifyWidth=0,this.totalCost=0,this.totalShift=0,this.durationStats={},this.minTotalWidth=0,this.hasMinTotalWidth=!1,this.tickContexts=void 0,this.modifierContexts=void 0,this.contextGaps={total:0,gaps:[]},this.voices=[],this.lossHistory=[]}return t.SimpleFormat=function(t,e,i){void 0===e&&(e=0);var n=(void 0===i?{}:i).paddingBetween,o=void 0===n?10:n;t.reduce((function(t,e){e.addToModifierContext(new Bt);var i=(new yt).addTickable(e).preFormat(),n=i.getMetrics();return i.setX(t+n.totalLeftPx),t+i.getWidth()+n.totalRightPx+o}),e)},t.plotDebugging=function(t,e,i,n,o,a){var s=i+(a=r({stavePadding:ei.DEFAULT_FONT_STACK[0].lookupMetric("stave.padding")},a)).stavePadding,h=e.contextGaps;t.save(),t.setFont("Arial",8,""),h.gaps.forEach((function(e){var i,r,a;i=s+e.x1,r=s+e.x2,a="rgba(100,200,100,0.4)",t.beginPath(),t.setStrokeStyle(a),t.setFillStyle(a),t.setLineWidth(1),t.fillRect(i,n,Math.max(r-i,0),o-n),t.setFillStyle("green"),t.fillText(Math.round(e.x2-e.x1).toString(),s+e.x1,o+12)})),t.setFillStyle("red"),t.fillText("Loss: "+(e.totalCost||0).toFixed(2)+" Shift: "+(e.totalShift||0).toFixed(2)+" Gap: "+h.total.toFixed(2),s-20,o+27),t.restore()},t.FormatAndDraw=function(e,i,n,o){var a={auto_beam:!1,align_rests:!1};"object"==typeof o?a=r(r({},a),o):"boolean"==typeof o&&(a.auto_beam=o);var s=new Q(ei.TIME4_4).setMode(Q.Mode.SOFT).addTickables(n),h=a.auto_beam?q.applyAndGetBeams(s):[];return(new t).joinVoices([s]).formatToStave([s],i,{align_rests:a.align_rests,stave:i}),s.setStave(i).draw(e,i),h.forEach((function(t){return t.setContext(e).draw()})),s.getBoundingBox()},t.FormatAndDrawTab=function(e,i,n,o,a,s,h){var c={auto_beam:s,align_rests:!1};"object"==typeof h?c=r(r({},c),h):"boolean"==typeof h&&(c.auto_beam=h);var d=new Q(ei.TIME4_4).setMode(Q.Mode.SOFT).addTickables(a),l=new Q(ei.TIME4_4).setMode(Q.Mode.SOFT).addTickables(o),p=c.auto_beam?q.applyAndGetBeams(d):[];(new t).joinVoices([d]).joinVoices([l]).formatToStave([d,l],n,{align_rests:c.align_rests}),d.draw(e,n),l.draw(e,i),p.forEach((function(t){return t.setContext(e).draw()})),new $(n,i).setContext(e).draw()},t.AlignRestsToNotes=function(t,e,i){t.forEach((function(n,o){if(n instanceof j&&n.isRest()){if(n.getTuplet()&&!i)return;var r=n.getGlyph().position.toUpperCase();if("R/4"!==r&&"B/4"!==r)return;if(e||n.getBeam()){var a=n.getKeyProps()[0];if(0===o)a.line=te(t,a.line,o,!1),n.setKeyLine(0,a.line);else if(o>0&&o<t.length){var s=void 0,h=t[o-1];h&&h.isRest()?(s=h.keyProps[0].line,a.line=s):(s=h.getLineForRest(),a.line=te(t,s,o,!0)),n.setKeyLine(0,a.line)}}}}))},t.estimateJustifiedMinWidth=function(e,i){var n=new t(i);return e.forEach((function(t){n.joinVoices([t])})),n.preCalculateMinTotalWidth(e)},t.prototype.alignRests=function(e,i){if(!e||!e.length)throw new h("BadArgument","No voices to format rests");e.forEach((function(e){return t.AlignRestsToNotes(e.getTickables(),i)}))},t.prototype.preCalculateMinTotalWidth=function(t){var e=this,i=ei.DEFAULT_FONT_STACK[0].lookupMetric("stave.unalignedNotePadding"),n=0,o=0,r=0,a=[],s=[];if(this.hasMinTotalWidth)return this.minTotalWidth;if(!this.tickContexts){if(!t)throw new h("BadArgument","'voices' required to run preCalculateMinTotalWidth");this.createTickContexts(t)}var c=this.tickContexts,d=c.list,l=c.map;this.minTotalWidth=0,d.forEach((function(i){var h=l[i];h.preFormat(),h.getTickables().length<t.length&&(n+=1),h.getTickables().forEach((function(t){o+=t.getMetrics().width,r+=t.getTicks().value(),a.push(t.getMetrics().width),s.push(t.getTicks().value())}));var c=h.getWidth();e.minTotalWidth+=c})),this.hasMinTotalWidth=!0;var p=o>0?o/a.length:1/a.length,u=a.map((function(t){return Math.pow(t-p,2)})).reduce((function(t,e){return t+e})),f=Math.pow(u/a.length,.5)/p,g=r/s.length,m=s.map((function(t){return Math.pow(t-g,2)})).reduce((function(t,e){return t+e})),y=Math.pow(m/s.length,.5)/g,_=Math.max(y,f)*d.length*i,x=i*n;return this.minTotalWidth+Math.max(x,_)},t.prototype.getMinTotalWidth=function(){if(!this.hasMinTotalWidth)throw new h("NoMinTotalWidth","Call 'preCalculateMinTotalWidth' or 'preFormat' before calling 'getMinTotalWidth'");return this.minTotalWidth},t.getResolutionMultiplier=function(t){if(!t||!t.length)throw new h("BadArgument","No voices to format");var e=t[0].getTotalTicks();return t.reduce((function(t,i){if(!i.getTotalTicks().equals(e))throw new h("TickMismatch","Voices should have same total note duration in ticks.");if(i.getMode()===Q.Mode.STRICT&&!i.isComplete())throw new h("IncompleteVoice","Voice does not have enough notes.");return Math.max(t,f.LCM(t,i.getResolutionMultiplier()))}),1)},t.prototype.createModifierContexts=function(t){var e=Zt(t,(function(){return new Bt}),(function(t,e){return t.addToModifierContext(e)}));return this.modifierContexts=e,e},t.prototype.createTickContexts=function(t){var e=Zt(t,(function(t){return new yt(t)}),(function(t,e,i){return e.addTickable(t,i)}));this.tickContexts=e;var i=this.tickContexts.array;return i.forEach((function(t){t.tContexts=i})),e},t.prototype.preFormat=function(t,e,i,n){var o=this;void 0===t&&(t=0);var r=this.tickContexts;if(!r)throw new h("NoTickContexts","preFormat requires TickContexs");var a=r.list,s=r.map;this.lossHistory=[],i&&n&&i.forEach((function(t){return t.setStave(n).preFormat()}));var d=0,l=0;this.minTotalWidth=0;var p=0;a.forEach((function(t){var i=s[t];e&&i.setContext(e),i.preFormat();var n=i.getWidth();o.minTotalWidth+=n;var r=i.getMaxTicks().value();p+=r;var a=i.getMetrics();d=d+l+a.totalLeftPx,i.setX(d),l=n-a.totalLeftPx}));var u=this.formatterOptions,f=u.softmaxFactor||100,g=a.map((function(t){return Math.pow(f,s[t].getMaxTicks().value()/p)})).reduce((function(t,e){return t+e}));if(this.minTotalWidth=d+l,this.hasMinTotalWidth=!0,t<=0)return this.evaluate();var m=s[a[0]],y=s[a[a.length-1]];function _(t){return a.map((function(e,i){var n,o=s[e],r=o.getTickablesByVoice();if(i>0)for(var h=s[a[i-1]],c=function(e){var i=s[a[e]].getTickablesByVoice(),c=[];if(Object.keys(r).forEach((function(t){i[t]&&c.push(t)})),c.length>0){var d=0,l=1/0,m=0;if(c.forEach((function(t){var e=i[t].getTicks().value();e>d&&(n=i[t],d=e);var o=r[t],a=o.getX()-(o.getMetrics().modLeftPx+o.getMetrics().leftDisplacedHeadPx),s=i[t].getMetrics(),h=i[t].getX()+s.notePx+s.modRightPx+s.rightDisplacedHeadPx;l=Math.min(l,a-h)})),l=Math.min(l,o.getX()-(h.getX()+.05*t)),u.globalSoftmax){var y=p;m=Math.pow(f,d/y)/g*t}else n&&(m=n.getVoice().softmax(d)*t);return{value:{expectedDistance:m,maxNegativeShiftPx:l,fromTickable:n}}}},d=i-1;d>=0;d--){var l=c(d);if("object"==typeof l)return l.value}return{expectedDistance:0,fromTickablePx:0,maxNegativeShiftPx:0}}))}function x(t){var e=v/2,i=0;return a.forEach((function(n,o){var r=s[n];if(o>0){var a=r.getX(),h=t[o],d=c(h.fromTickable).getX()+h.expectedDistance-(a+i),l=0;d>0?i+=d:d<0&&(l=Math.min(h.maxNegativeShiftPx,Math.abs(d)),i+=-l),r.setX(a+i)}r.getCenterAlignedTickables().forEach((function(t){t.setCenterXShift(e-r.getX())}))})),y.getX()-m.getX()}for(var v=t-y.getMetrics().notePx-y.getMetrics().totalRightPx-m.getMetrics().totalLeftPx,S=v,b=x(_(S)),w=ei.DEFAULT_FONT_STACK[0],T=w.lookupMetric("stave.endPaddingMax"),C=w.lookupMetric("stave.endPaddingMin"),E=v-C,A=this.formatterOptions.maxIterations;b>E&&A>0||b+T<E&&A>1;)b=x(_(S-=b-E)),A--;return 1===a.length?0:(this.justifyWidth=t,this.evaluate())},t.prototype.evaluate=function(){var t=this;if(!this.tickContexts)return 0;var e=this.tickContexts,i=this.justifyWidth;this.contextGaps={total:0,gaps:[]},e.list.forEach((function(i,n){if(0!==n){var o=e.list[n-1],r=e.map[o],a=e.map[i],s=r.getMetrics(),h=a.getMetrics(),c=r.getX()+s.notePx+s.totalRightPx,d=a.getX()-h.totalLeftPx,l=d-c;t.contextGaps.total+=l,t.contextGaps.gaps.push({x1:c,x2:d}),a.getFormatterMetrics().freedom.left=l,r.getFormatterMetrics().freedom.right=l}})),this.durationStats={};var n=this.durationStats;this.voices.forEach((function(t){t.getTickables().forEach((function(t,e,o){var r=t.getTicks().clone().simplify().toString(),a=t.getMetrics(),s=t.getFormatterMetrics(),h=t.getX()+a.notePx+a.modRightPx+a.rightDisplacedHeadPx,c=0;if(e<o.length-1){var d=o[e+1],l=d.getMetrics();c=d.getX()-l.modLeftPx-l.leftDisplacedHeadPx-h,s.space.used=d.getX()-t.getX(),d.getFormatterMetrics().freedom.left=c}else c=i-h,s.space.used=i-t.getX();s.freedom.right=c,function(t,e){var i=n[t];void 0===i?n[t]={mean:e,count:1}:(i.count+=1,i.mean=(i.mean+e)/2)}(r,s.space.used)}))}));var o=0;return this.voices.forEach((function(t){t.getTickables().forEach((function(t){var e=t.getTicks().clone().simplify().toString(),i=t.getFormatterMetrics();i.space.mean=n[e].mean,i.duration=e,i.iterations+=1,i.space.deviation=i.space.used-i.space.mean,o+=Math.pow(i.space.deviation,2)}))})),this.totalCost=Math.sqrt(o),this.lossHistory.push(this.totalCost),this.totalCost},t.prototype.tune=function(t){var e=this;if(!this.tickContexts)return 0;var i=this.tickContexts;t=r({alpha:.5},t);var n=0;return this.totalShift=0,i.list.forEach((function(o,r,a){var s=i.map[o],h=r>0?i.map[a[r-1]]:void 0,d=r<a.length-1?i.map[a[r+1]]:void 0;!function(t,e,i,n){t.setX(t.getX()+e),t.getFormatterMetrics().freedom.left+=e,t.getFormatterMetrics().freedom.right-=e,i&&(i.getFormatterMetrics().freedom.right+=e),n&&(n.getFormatterMetrics().freedom.left-=e)}(s,n,h,d);var l=-s.getTickables().map((function(t){return t.getFormatterMetrics().space.deviation})).reduce((function(t,e){return t+e}));l>0?n=-Math.min(s.getFormatterMetrics().freedom.right,Math.abs(l)):l<0&&(n=d?Math.min(d.getFormatterMetrics().freedom.right,Math.abs(l)):0),n*=c(t).alpha,e.totalShift+=n})),this.evaluate()},t.prototype.postFormat=function(){var t=function(t){return t.list.forEach((function(e){return t.map[e].postFormat()}))};return this.modifierContexts&&t(this.modifierContexts),this.tickContexts&&t(this.tickContexts),this},t.prototype.joinVoices=function(t){return this.createModifierContexts(t),this.hasMinTotalWidth=!1,this},t.prototype.format=function(t,e,i){var n=r({align_rests:!1},i);this.voices=t;var o=this.formatterOptions.softmaxFactor;return o&&this.voices.forEach((function(t){return t.setSoftmaxFactor(o)})),this.alignRests(t,n.align_rests),this.createTickContexts(t),this.preFormat(e,n.context,t,n.stave),n.stave&&this.postFormat(),this},t.prototype.formatToStave=function(t,e,i){var n=r({padding:10,context:e.getContext()},i),o=e.getNoteEndX()-e.getNoteStartX()-Qt.defaultPadding;return $t("Formatting voices to width: ",o),this.format(t,o,n)},t}(),ie=function(t){function e(e,i){var n=t.call(this)||this;return n.setAttribute("type","StaveTie"),n.notes=e,n.text=i,n.render_options={cp1:8,cp2:12,text_shift_x:0,first_x_shift:0,last_x_shift:0,y_shift:7,tie_spacing:0,font:{family:"Arial",size:10,weight:""}},n.font=n.render_options.font,n.setNotes(e),n}return o(e,t),e.prototype.setFont=function(t){return this.font=t,this},e.prototype.setDirection=function(t){return this.direction=t,this},e.prototype.setNotes=function(t){if(!t.first_note&&!t.last_note)throw new h("BadArguments","Tie needs to have either first_note or last_note set.");if(t.first_indices||(t.first_indices=[0]),t.last_indices||(t.last_indices=[0]),t.first_indices.length!==t.last_indices.length)throw new h("BadArguments","Tied notes must have similar index sizes");return this.notes=t,this},e.prototype.isPartial=function(){return!this.notes.first_note||!this.notes.last_note},e.prototype.renderTie=function(t){if(0===t.first_ys.length||0===t.last_ys.length)throw new h("BadArguments","No Y-values to render");var e=this.checkContext(),i=this.render_options.cp1,n=this.render_options.cp2;Math.abs(t.last_x_px-t.first_x_px)<10&&(i=2,n=8);for(var o=this.render_options.first_x_shift,r=this.render_options.last_x_shift,a=this.render_options.y_shift*t.direction,s=0;s<this.notes.first_indices.length;++s){var c=(t.last_x_px+r+(t.first_x_px+o))/2,d=t.first_ys[this.notes.first_indices[s]]+a,l=t.last_ys[this.notes.last_indices[s]]+a;if(isNaN(d)||isNaN(l))throw new h("BadArguments","Bad indices for tie rendering.");var p=(d+l)/2+i*t.direction,u=(d+l)/2+n*t.direction;e.beginPath(),e.moveTo(t.first_x_px+o,d),e.quadraticCurveTo(c,p,t.last_x_px+r,l),e.quadraticCurveTo(c,u,t.first_x_px+o,d),e.closePath(),e.fill()}},e.prototype.renderText=function(t,e){var i,n,o;if(this.text){var r=this.checkContext(),a=(t+e)/2;a-=r.measureText(this.text).width/2;var s=null!==(n=null===(i=this.notes.first_note)||void 0===i?void 0:i.checkStave())&&void 0!==n?n:null===(o=this.notes.last_note)||void 0===o?void 0:o.checkStave();r.save(),r.setFont(this.font.family,this.font.size,this.font.weight),r.fillText(this.text,a+this.render_options.text_shift_x,s.getYForTopText()-1),r.restore()}},e.prototype.draw=function(){this.checkContext(),this.setRendered();var t,e,i,n,o=this.notes.first_note,r=this.notes.last_note,a=0;o?(t=o.getTieRightX()+this.render_options.tie_spacing,a=o.getStemDirection(),i=o.getYs()):(t=r.checkStave().getTieStartX(),i=r.getYs(),this.notes.first_indices=this.notes.last_indices);r?(e=r.getTieLeftX()+this.render_options.tie_spacing,a=r.getStemDirection(),n=r.getYs()):(e=o.checkStave().getTieEndX(),n=o.getYs(),this.notes.last_indices=this.notes.first_indices);return this.direction&&(a=this.direction),this.renderTie({first_x_px:t,last_x_px:e,first_ys:i,last_ys:n,direction:a}),this.renderText(t,e),!0},e}(y),ne=function(t){function e(e,i){var n=t.call(this,e,i)||this;return n.setAttribute("type","TabTie"),n.render_options.cp1=9,n.render_options.cp2=11,n.render_options.y_shift=3,n.direction=-1,n.setNotes(e),n}return o(e,t),e.createHammeron=function(t){return new e(t,"H")},e.createPulloff=function(t){return new e(t,"P")},e}(ie);function oe(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];re.DEBUG&&d("Vex.Flow.GraceNoteGroup",t)}var re=function(t){function e(e,i){var n=t.call(this)||this;return n.setAttribute("type","GraceNoteGroup"),n.position=F.Position.LEFT,n.grace_notes=e,n.width=0,n.preFormatted=!1,n.show_slur=i,n.slur=void 0,n.formatter=new ee,n.voice=new Q({num_beats:4,beat_value:4,resolution:ei.RESOLUTION}).setStrict(!1),n.render_options={slur_y_shift:0},n.beams=[],n.voice.addTickables(n.grace_notes),n}return o(e,t),Object.defineProperty(e,"CATEGORY",{get:function(){return"gracenotegroups"},enumerable:!1,configurable:!0}),e.format=function(t,e){if(!t||0===t.length)return!1;for(var i=[],n=null,o=0,r=0;r<t.length;++r){var a=(p=t[r]).getNote(),s=a.getCategory()===j.CATEGORY,h=s?4:0;if(s&&a!==n){for(var c=0;c<a.keys.length;++c)o=Math.max(a.getLeftDisplacedHeadPx(),o);n=a}i.push({shift:o,gracenote_group:p,spacing:h})}var d,l=i[0].shift;for(r=0;r<i.length;++r){(p=i[r].gracenote_group).preFormat(),d=p.getWidth()+i[r].spacing,l=Math.max(d,l)}for(r=0;r<i.length;++r){var p;d=(p=i[r].gracenote_group).getWidth()+i[r].spacing,p.setSpacingFromNextModifier(l-Math.min(d,l))}return e.left_shift+=l,!0},e.prototype.getCategory=function(){return e.CATEGORY},e.prototype.preFormat=function(){this.preFormatted||(this.formatter.joinVoices([this.voice]).format([this.voice],0,{}),this.setWidth(this.formatter.getMinTotalWidth()),this.preFormatted=!0)},e.prototype.beamNotes=function(t){if((t=t||this.grace_notes).length>1){var e=new q(t);e.render_options.beam_width=3,e.render_options.partial_beam_length=4,this.beams.push(e)}return this},e.prototype.setWidth=function(t){return this.width=t,this},e.prototype.getWidth=function(){return this.width},e.prototype.getGraceNotes=function(){return this.grace_notes},e.prototype.draw=function(){var t=this.checkContext(),e=this.checkAttachedNote();if(this.setRendered(),oe("Drawing grace note group for:",e),this.alignSubNotesWithNote(this.getGraceNotes(),e),this.grace_notes.forEach((function(e){e.setContext(t).draw()})),this.beams.forEach((function(e){e.setContext(t).draw()})),this.show_slur){var i=e.getCategory()===j.CATEGORY,n=i?ie:ne;this.slur=new n({last_note:this.grace_notes[0],first_note:e,first_indices:[0],last_indices:[0]}),this.slur.render_options.cp2=12,this.slur.render_options.y_shift=(i?7:5)+this.render_options.slur_y_shift,this.slur.setContext(t).draw()}},e}(F);function ae(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];se.DEBUG&&d("Vex.Flow.Accidental",t)}var se=function(t){function e(e){var i=t.call(this)||this;if(i.setAttribute("type","Accidental"),ae("New accidental: ",e),i.type=e,i.position=F.Position.LEFT,i.render_options={font_scale:38,stroke_px:3,parenLeftPadding:2,parenRightPadding:2},i.accidental=ei.accidentalCodes(i.type),!i.accidental)throw new h("ArgumentError","Unknown accidental type: "+e);return i.cautionary=!1,i.reset(),i}return o(e,t),Object.defineProperty(e,"CATEGORY",{get:function(){return"accidentals"},enumerable:!1,configurable:!0}),e.format=function(t,e){var i=this,n=ei.DEFAULT_FONT_STACK[0],o=n.lookupMetric("accidental.noteheadAccidentalPadding"),r=e.left_shift+o,a=n.lookupMetric("accidental.accidentalSpacing"),s=n.lookupMetric("accidental.leftPadding");if(t&&0!==t.length){for(var h=[],c=void 0,d=0,l=0;l<t.length;++l){var p=(w=t[l]).getNote(),u=p.getStave(),f=w.checkIndex(),g=p.getKeyProps()[f];if(p!==c){for(var m=0;m<p.keys.length;++m)d=Math.max(p.getLeftDisplacedHeadPx(),d);c=p}if(u){var y=u.getOptions().spacing_between_lines_px,_=u.getYForLine(g.line),x=Math.round(_/y*2)/2;h.push({y:_,line:x,shift:d,acc:w,lineSpace:y})}else h.push({line:g.line,shift:d,acc:w})}h.sort((function(t,e){return e.line-t.line}));var v=[],S=0,b=void 0;for(l=0;l<h.length;l++){var w=h[l];void 0!==b&&b===w.line||v.push({line:w.line,flatLine:!0,dblSharpLine:!0,numAcc:0,width:0,column:0}),"b"!==w.acc.type&&"bb"!==w.acc.type&&(v[v.length-1].flatLine=!1),"##"!==w.acc.type&&(v[v.length-1].dblSharpLine=!1),v[v.length-1].numAcc++,v[v.length-1].width+=w.acc.getWidth()+a,S=w.shift>S?w.shift:S,b=w.line}var T,C=0,E=function(t){for(var e=!1,n=t,o=t;o+1<v.length&&!e;)A.checkCollision(v[o],v[o+1])?o++:e=!0;var r=function(t){return v[n+t]},a=function(t){return t.map(r)},s=function(t,e){var i=a([t,e]).map((function(t){return t.line}));return i[0]-i[1]},h=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t.map(a).every((function(t){var e=t[0],n=t[1];return!i.checkCollision(e,n)}))},c=o-n+1,d=A.checkCollision(v[n],v[o])?"a":"b";switch(c){case 3:"a"===d&&.5===s(1,2)&&.5!==s(0,1)&&(d="second_on_bottom");break;case 4:h([0,2],[1,3])&&(d="spaced_out_tetrachord");break;case 5:"b"===d&&h([1,3])&&(d="spaced_out_pentachord",h([0,2],[2,4])&&(d="very_spaced_out_pentachord"));break;case 6:h([0,3],[1,4],[2,5])&&(d="spaced_out_hexachord"),h([0,2],[2,4],[1,3],[3,5])&&(d="very_spaced_out_hexachord")}var l=void 0,p=void 0;if(c>=7){for(var u=2,f=!0;!0===f;){f=!1;for(var g=0;g+u<v.length;g++)if(A.checkCollision(v[g],v[g+u])){f=!0,u++;break}}for(l=t;l<=o;l++)p=(l-t)%u+1,v[l].column=p,C=C>p?C:p}else for(l=t;l<=o;l++)p=ei.accidentalColumnsTable[c][d][l-t],v[l].column=p,C=C>p?C:p;T=t=o},A=this;for(l=0;l<v.length;l++)E(l),l=T;var P=[],k=[];for(l=0;l<=C;l++)P[l]=0,k[l]=0;P[0]=S+r,k[0]=S+r,v.forEach((function(t){t.width>P[t.column]&&(P[t.column]=t.width)}));for(l=1;l<P.length;l++)k[l]=P[l]+k[l-1];var D=k[k.length-1],F=0;v.forEach((function(t){for(var e=0,i=F+t.numAcc;F<i;F++){var n=k[t.column-1]+e;h[F].acc.setXShift(n),e+=h[F].acc.getWidth()+a,ae("Line, accCount, shift: ",t.line,F,n)}})),e.left_shift+=D+s}},e.checkCollision=function(t,e){var i=e.line-t.line,n=3;i>0?(n=e.flatLine||e.dblSharpLine?2.5:3,t.dblSharpLine&&(i-=.5)):(n=t.flatLine||t.dblSharpLine?2.5:3,e.dblSharpLine&&(i-=.5));var o=Math.abs(i)<n;return ae("Line_1, Line_2, Collision: ",t.line,e.line,o),o},e.applyAccidentals=function(t,i){var n=[],o={};t.forEach((function(t){var e=new f(0,1);t.getTickables().forEach((function(t){if(!t.shouldIgnoreTicks()){var i=o[e.value()];i?i.push(t):(n.push(e.value()),o[e.value()]=[t]),e.add(t.getTicks())}}))}));var r=new D;i||(i="C");var a=r.createScaleMap(i);n.forEach((function(t){var i=o[t],n=[],s=function(t){t.isRest()||t.shouldIgnoreTicks()||(t.keys.forEach((function(i,o){var s=r.getNoteParts(i.split("/")[0]),h=s.accidental||"n",c=s.root+h,d=a[s.root]===c,l=n.indexOf(c)>-1;if(!d||d&&l){a[s.root]=c;var p=new e(h);t.addAccidental(o,p),n.push(c)}})),t.getModifiers().forEach((function(t){t.getCategory()===re.CATEGORY&&t.getGraceNotes().forEach(s)})))};i.forEach(s)}))},e.prototype.reset=function(){var t=this.render_options.font_scale;this.glyph=new S(this.accidental.code,t),this.glyph.setOriginX(1),this.cautionary&&(this.parenLeft=new S(ei.accidentalCodes("{").code,t),this.parenRight=new S(ei.accidentalCodes("}").code,t),this.parenLeft.setOriginX(1),this.parenRight.setOriginX(1))},e.prototype.getCategory=function(){return e.CATEGORY},e.prototype.getWidth=function(){var t=this.cautionary?c(this.parenLeft).getMetrics().width+c(this.parenRight).getMetrics().width+this.render_options.parenLeftPadding+this.render_options.parenRightPadding:0;return this.glyph.getMetrics().width+t},e.prototype.setNote=function(t){if(!t)throw new h("ArgumentError","Bad note value: "+t);return this.note=t,t.getCategory()===Y.CATEGORY&&(this.render_options.font_scale=25,this.reset()),this},e.prototype.setAsCautionary=function(){return this.cautionary=!0,this.render_options.font_scale=28,this.reset(),this},e.prototype.draw=function(){var t=this,e=t.type,i=t.position,n=t.index,o=t.cautionary,r=t.x_shift,a=t.y_shift,s=t.glyph,h=t.parenLeft,d=t.parenRight,l=t.render_options,p=l.parenLeftPadding,u=l.parenRightPadding,f=this.checkContext(),g=this.checkAttachedNote();this.setRendered();var m=g.getModifierStartXY(i,n),y=m.x+r,_=m.y+a;ae("Rendering: ",e,y,_),o?(c(d).render(f,y,_),y-=c(d).getMetrics().width,y-=u,y-=this.accidental.parenRightPaddingAdjustment,s.render(f,y,_),y-=s.getMetrics().width,y-=p,c(h).render(f,y,_)):s.render(f,y,_)},e}(F);function he(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];ce.DEBUG&&d("Vex.Flow.BarNote",t)}var ce=function(t){function e(e){var i;void 0===e&&(e=Ot.SINGLE);var n=t.call(this,{duration:"b"})||this;n.setAttribute("type","BarNote"),n.metrics={widths:{}};var o=Ot;return n.metrics.widths=((i={})[o.SINGLE]=8,i[o.DOUBLE]=12,i[o.END]=15,i[o.REPEAT_BEGIN]=14,i[o.REPEAT_END]=14,i[o.REPEAT_BOTH]=18,i[o.NONE]=0,i),n.ignore_ticks=!0,n.setType(e),n}return o(e,t),e.prototype.getType=function(){return this.type},e.prototype.setType=function(t){return this.type="string"==typeof t?Wt.typeString[t]:t,this.setWidth(this.metrics.widths[this.type]),this},e.prototype.addToModifierContext=function(){return this},e.prototype.preFormat=function(){return this.setPreFormatted(!0),this},e.prototype.draw=function(){var t=this.checkContext();he("Rendering bar line at: ",this.getAbsoluteX()),this.style&&this.applyStyle(t);var e=new Wt(this.type);e.setX(this.getAbsoluteX()),e.draw(this.checkStave()),this.style&&this.restoreStyle(t),this.setRendered()},e}(R),de=function(t){function e(e,i,n){var o=t.call(this,{duration:"b"})||this;return o.setAttribute("type","ClefNote"),o.type=e,o.clef_obj=new Vt(e,i,n),o.clef=o.clef_obj.clef,o.glyph=new S(o.clef.code,o.clef.point),o.setWidth(o.glyph.getMetrics().width),o.ignore_ticks=!0,o}return o(e,t),Object.defineProperty(e,"CATEGORY",{get:function(){return"clefnote"},enumerable:!1,configurable:!0}),e.prototype.setType=function(t,e,i){return this.type=t,this.clef_obj=new Vt(t,e,i),this.clef=this.clef_obj.clef,this.glyph=new S(this.clef.code,this.clef.point),this.setWidth(this.glyph.getMetrics().width),this},e.prototype.getClef=function(){return this.clef},e.prototype.setContext=function(e){return t.prototype.setContext.call(this,e),this.glyph.setContext(this.getContext()),this},e.prototype.getBoundingBox=function(){return t.prototype.getBoundingBox.call(this)},e.prototype.addToModifierContext=function(){return this},e.prototype.getCategory=function(){return e.CATEGORY},e.prototype.preFormat=function(){return this.setPreFormatted(!0),this},e.prototype.draw=function(){var t,e=this.checkStave();this.glyph.getContext()||this.glyph.setContext(this.getContext()),this.setRendered();var i=this.getAbsoluteX();if(this.glyph.setStave(e),this.glyph.setYShift(e.getYForLine(null!==(t=this.clef.line)&&void 0!==t?t:0)-e.getYForGlyphs()),this.glyph.renderToStave(i),void 0!==this.clef_obj.annotation){var n=new S(this.clef_obj.annotation.code,this.clef_obj.annotation.point);n.getContext()||n.setContext(this.getContext()),n.setStave(e),n.setYShift(e.getYForLine(this.clef_obj.annotation.line)-e.getYForGlyphs()),n.setXShift(this.clef_obj.annotation.x_shift),n.renderToStave(i)}},e}(R);function le(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];ue.DEBUG&&d("Vex.Flow.Crescendo",t)}var pe,ue=function(t){function e(e){var i=t.call(this,e)||this;return i.options={extend_left:0,extend_right:0,y_shift:0},i.setAttribute("type","Crescendo"),i.decrescendo=!1,i.line=e.line||0,i.height=15,i}return o(e,t),e.prototype.setLine=function(t){return this.line=t,this},e.prototype.setHeight=function(t){return this.height=t,this},e.prototype.setDecrescendo=function(t){return this.decrescendo=t,this},e.prototype.preFormat=function(){return this.preFormatted=!0,this},e.prototype.draw=function(){var t=this.checkContext(),e=this.checkStave();this.setRendered();var i=this.getTickContext(),n=yt.getNextContext(i),o=this.getAbsoluteX(),r=n?n.getX():e.getX()+e.getWidth(),a=e.getYForLine(this.line+-3)+1;le("Drawing ",this.decrescendo?"decrescendo ":"crescendo ",this.height,"x",o-r),function(t,e){var i=e.begin_x,n=e.end_x,o=e.y,r=e.height/2;t.beginPath(),e.reverse?(t.moveTo(i,o-r),t.lineTo(n,o),t.lineTo(i,o+r)):(t.moveTo(n,o-r),t.lineTo(i,o),t.lineTo(n,o+r)),t.stroke(),t.closePath()}(t,{begin_x:o-this.options.extend_left,end_x:r+this.options.extend_right,y:a+this.options.y_shift,height:this.height,reverse:this.decrescendo})},e}(R);!function(t){t[t.NEAR_HEAD=1]="NEAR_HEAD",t[t.NEAR_TOP=2]="NEAR_TOP"}(pe||(pe={}));var fe=function(t){function e(i,n,o){var a=t.call(this)||this;return a.setAttribute("type","Curve"),a.render_options=r({thickness:2,x_shift:0,y_shift:10,position:e.Position.NEAR_HEAD,position_end:e.Position.NEAR_HEAD,invert:!1,cps:[{x:0,y:10},{x:0,y:10}]},o),a.from=i,a.to=n,a}return o(e,t),Object.defineProperty(e,"Position",{get:function(){return pe},enumerable:!1,configurable:!0}),Object.defineProperty(e,"PositionString",{get:function(){return{nearHead:e.Position.NEAR_HEAD,nearTop:e.Position.NEAR_TOP}},enumerable:!1,configurable:!0}),e.prototype.setNotes=function(t,e){if(!t&&!e)throw new h("BadArguments","Curve needs to have either first_note or last_note set.");return this.from=t,this.to=e,this},e.prototype.isPartial=function(){return!this.from||!this.to},e.prototype.renderCurve=function(t){var e=this.checkContext(),i=this.render_options.cps,n=this.render_options.x_shift,o=this.render_options.y_shift*t.direction,r=t.first_x+n,a=t.first_y+o,s=t.last_x-n,h=t.last_y+o,c=this.render_options.thickness,d=(s-r)/(i.length+2);e.beginPath(),e.moveTo(r,a),e.bezierCurveTo(r+d+i[0].x,a+i[0].y*t.direction,s-d+i[1].x,h+i[1].y*t.direction,s,h),e.bezierCurveTo(s-d+i[1].x,h+(i[1].y+c)*t.direction,r+d+i[0].x,a+(i[0].y+c)*t.direction,r,a),e.stroke(),e.closePath(),e.fill()},e.prototype.draw=function(){this.checkContext(),this.setRendered();var t,i,n,o,r=this.from,a=this.to,s=0,h="baseY",c="baseY";function d(t){return"string"==typeof t?e.PositionString[t]:t}var l=d(this.render_options.position),p=d(this.render_options.position_end);(l===e.Position.NEAR_TOP&&(h="topY",c="topY"),p===e.Position.NEAR_HEAD?c="baseY":p===e.Position.NEAR_TOP&&(c="topY"),r)?(t=r.getTieRightX(),s=r.getStemDirection(),n=r.getStemExtents()[h]):(t=a.checkStave().getTieStartX(),n=a.getStemExtents()[h]);a?(i=a.getTieLeftX(),s=a.getStemDirection(),o=a.getStemExtents()[c]):(i=r.checkStave().getTieEndX(),o=r.getStemExtents()[c]);return this.renderCurve({first_x:t,last_x:i,first_y:n,last_y:o,direction:s*(!0===this.render_options.invert?-1:1)}),!0},e}(y);function ge(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];ye.DEBUG&&d("Vex.Flow.Parser",t)}function me(t){if("matchedString"in t)return t.matchedString;if("results"in t)return me(t.results);var e=t;return 1===e.length?me(e[0]):0===e.length?null:e.map(me)}var ye=function(){function t(t){this.grammar=t,this.line="",this.pos=0,this.errorPos=-1}return t.prototype.parse=function(t){this.line=t,this.pos=0,this.errorPos=-1;var e=this.expect(this.grammar.begin());return e.errorPos=this.errorPos,e},t.prototype.matchFail=function(t){-1===this.errorPos&&(this.errorPos=this.pos),this.pos=t},t.prototype.matchSuccess=function(){this.errorPos=-1},t.prototype.matchToken=function(t,e){void 0===e&&(e=!1);var i=e?new RegExp("^(("+t+"))"):new RegExp("^(("+t+")\\s*)"),n=this.line.slice(this.pos).match(i);return null!==n?{success:!0,matchedString:n[2],incrementPos:n[1].length,pos:this.pos}:{success:!1,pos:this.pos}},t.prototype.expectOne=function(t,e){void 0===e&&(e=!1);var i=[],n=this.pos,o=!0,r=!1;if(e=!0===e||!0===t.maybe,t.expect)for(var a=0,s=t.expect;a<s.length;a++){var h=s[a],c=this.pos,d=this.expect(h);if(d.success){if(i.push(d),r=!0,t.or)break}else if(o=!1,!t.or){this.pos=c;break}}var l=t.or&&r||o,p=l||!0===e,u=l?1:0;return e&&!l&&(this.pos=n),p?this.matchSuccess():this.matchFail(n),{success:p,results:i,numMatches:u}},t.prototype.expectOneOrMore=function(t,e){void 0===e&&(e=!1);var i=[],n=this.pos,o=0,r=!0;do{var a=this.expectOne(t);a.success&&a.results?(o++,i.push(a.results)):r=!1}while(r);var s=o>0||!0===e;return!e||o>0||(this.pos=n),s?this.matchSuccess():this.matchFail(n),{success:s,results:i,numMatches:o}},t.prototype.expectZeroOrMore=function(t){return this.expectOneOrMore(t,!0)},t.prototype.expect=function(t){if(ge("Evaluating rule function:",t),!t)throw new h("Invalid rule function");var e,i=t.bind(this.grammar)();if(i.token)(e=this.matchToken(i.token,!0===i.noSpace)).success&&(this.pos+=e.incrementPos);else{if(!i.expect)throw ge(i),new h("Bad grammar! No `token` or `expect` property "+i);e=i.oneOrMore?this.expectOneOrMore(i):i.zeroOrMore?this.expectZeroOrMore(i):this.expectOne(i)}var n=[];return e.matches=n,e.results&&e.results.forEach((function(t){n.push(me(t))})),i.run&&e.success&&i.run({matches:n}),e},t.DEBUG=!1,t}();function _e(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Te.DEBUG&&d("Vex.Flow.EasyScore",t)}var xe=function(){function t(t){this.builder=t}return t.prototype.begin=function(){return this.LINE},t.prototype.LINE=function(){return{expect:[this.PIECE,this.PIECES,this.EOL]}},t.prototype.PIECE=function(){var t=this;return{expect:[this.CHORDORNOTE,this.PARAMS],run:function(){return t.builder.commitPiece()}}},t.prototype.PIECES=function(){return{expect:[this.COMMA,this.PIECE],zeroOrMore:!0}},t.prototype.PARAMS=function(){return{expect:[this.DURATION,this.TYPE,this.DOTS,this.OPTS]}},t.prototype.CHORDORNOTE=function(){return{expect:[this.CHORD,this.SINGLENOTE],or:!0}},t.prototype.CHORD=function(){var t=this;return{expect:[this.LPAREN,this.NOTES,this.RPAREN],run:function(e){return t.builder.addChord(e.matches[1])}}},t.prototype.NOTES=function(){return{expect:[this.NOTE],oneOrMore:!0}},t.prototype.NOTE=function(){return{expect:[this.NOTENAME,this.ACCIDENTAL,this.OCTAVE]}},t.prototype.SINGLENOTE=function(){var t=this;return{expect:[this.NOTENAME,this.ACCIDENTAL,this.OCTAVE],run:function(e){var i=e;t.builder.addSingleNote(i.matches[0],i.matches[1],i.matches[2])}}},t.prototype.ACCIDENTAL=function(){return{expect:[this.ACCIDENTALS],maybe:!0}},t.prototype.DOTS=function(){var t=this;return{expect:[this.DOT],zeroOrMore:!0,run:function(e){return t.builder.setNoteDots(e.matches)}}},t.prototype.TYPE=function(){var t=this;return{expect:[this.SLASH,this.MAYBESLASH,this.TYPES],maybe:!0,run:function(e){return t.builder.setNoteType(e.matches[2])}}},t.prototype.DURATION=function(){var t=this;return{expect:[this.SLASH,this.DURATIONS],maybe:!0,run:function(e){return t.builder.setNoteDuration(e.matches[1])}}},t.prototype.OPTS=function(){return{expect:[this.LBRACKET,this.KEYVAL,this.KEYVALS,this.RBRACKET],maybe:!0}},t.prototype.KEYVALS=function(){return{expect:[this.COMMA,this.KEYVAL],zeroOrMore:!0}},t.prototype.KEYVAL=function(){var t=this;return{expect:[this.KEY,this.EQUALS,this.VAL],run:function(e){return t.builder.addNoteOption(e.matches[0],e.matches[2].slice(1,-1))}}},t.prototype.VAL=function(){return{expect:[this.SVAL,this.DVAL],or:!0}},t.prototype.KEY=function(){return{token:"[a-zA-Z][a-zA-Z0-9]*"}},t.prototype.DVAL=function(){return{token:'["][^"]*["]'}},t.prototype.SVAL=function(){return{token:"['][^']*[']"}},t.prototype.NOTENAME=function(){return{token:"[a-gA-G]"}},t.prototype.OCTAVE=function(){return{token:"[0-9]+"}},t.prototype.ACCIDENTALS=function(){return{token:"bbs|bb|bss|bs|b|db|d|##|#|n|\\+\\+-|\\+-|\\+\\+|\\+|k|o"}},t.prototype.DURATIONS=function(){return{token:"[0-9whq]+"}},t.prototype.TYPES=function(){return{token:"[rRsSxX]"}},t.prototype.LPAREN=function(){return{token:"[(]"}},t.prototype.RPAREN=function(){return{token:"[)]"}},t.prototype.COMMA=function(){return{token:"[,]"}},t.prototype.DOT=function(){return{token:"[.]"}},t.prototype.SLASH=function(){return{token:"[/]"}},t.prototype.MAYBESLASH=function(){return{token:"[/]?"}},t.prototype.EQUALS=function(){return{token:"[=]"}},t.prototype.LBRACKET=function(){return{token:"\\["}},t.prototype.RBRACKET=function(){return{token:"\\]"}},t.prototype.EOL=function(){return{token:"$"}},t}(),ve=function(t){this.chord=[],this.dots=0,this.options={},this.duration=t},Se=function(){function t(t){this.commitHooks=[],this.factory=t,this.reset()}return t.prototype.reset=function(t){void 0===t&&(t={}),this.options={stem:"auto",clef:"treble"},this.elements={notes:[],accidentals:[]},this.rollingDuration="8",this.resetPiece(),Object.assign(this.options,t)},t.prototype.getFactory=function(){return this.factory},t.prototype.getElements=function(){return this.elements},t.prototype.addCommitHook=function(t){this.commitHooks.push(t)},t.prototype.resetPiece=function(){_e("resetPiece"),this.piece=new ve(this.rollingDuration)},t.prototype.setNoteDots=function(t){_e("setNoteDots:",t),t&&(this.piece.dots=t.length)},t.prototype.setNoteDuration=function(t){_e("setNoteDuration:",t),this.rollingDuration=this.piece.duration=t||this.rollingDuration},t.prototype.setNoteType=function(t){_e("setNoteType:",t),t&&(this.piece.type=t)},t.prototype.addNoteOption=function(t,e){_e("addNoteOption: key:",t,"value:",e),this.piece.options[t]=e},t.prototype.addNote=function(t,e,i){_e("addNote:",t,e,i),this.piece.chord.push({key:t,accid:e,octave:i})},t.prototype.addSingleNote=function(t,e,i){_e("addSingleNote:",t,e,i),this.addNote(t,e,i)},t.prototype.addChord=function(t){var e=this;_e("startChord"),"object"!=typeof t[0]?this.addSingleNote(t[0]):t.forEach((function(t){t&&e.addNote.apply(e,t)})),_e("endChord")},t.prototype.commitPiece=function(){var t=this;_e("commitPiece");var e=this.factory;if(e){var i=r(r({},this.options),this.piece.options);if(void 0===i.stem)throw new h("options.stem is not defined");if(void 0===i.clef)throw new h("options.clef is not defined");var n=i.stem.toLowerCase(),o=i.clef,a="auto"===n,s=a||"up"!==n?j.STEM_DOWN:j.STEM_UP,c=this.piece,d=c.chord,l=c.duration,p=c.dots,u=c.type,f=d.map((function(t){return t.key+"/"+t.octave})),g=e.StaveNote({keys:f,duration:l,dots:p,type:u,clef:o,auto_stem:a});a||g.setStemDirection(s);var m=[];d.forEach((function(t,i){var n=t.accid;if("string"==typeof n){var o=e.Accidental({type:n});g.addAccidental(i,o),m.push(o)}else m.push(void 0)}));for(var y=0;y<p;y++)g.addDotToAll();this.commitHooks.forEach((function(e){return e(i,g,t)})),this.elements.notes.push(g),this.elements.accidentals.push(m),this.resetPiece()}},t}();function be(t,e){void 0!==t.id&&e.setAttribute("id",t.id)}function we(t,e){if(t.class){t.class.split(/\s*,\s*/).forEach((function(t){return e.addClass(t)}))}}var Te=function(){function t(t){void 0===t&&(t={}),this.setOptions(t),this.defaults={clef:"treble",time:"4/4",stem:"auto"}}return t.prototype.set=function(t){return Object.assign(this.defaults,t),this},t.prototype.setOptions=function(t){var e=this;return this.options=r({commitHooks:[be,we,mt.easyScoreHook,tt.easyScoreHook],throwOnError:!1},t),this.factory=this.options.factory,this.builder=this.options.builder||new Se(this.factory),this.grammar=new xe(this.builder),this.parser=new ye(this.grammar),this.options.commitHooks.forEach((function(t){return e.addCommitHook(t)})),this},t.prototype.setContext=function(t){return this.factory&&this.factory.setContext(t),this},t.prototype.parse=function(t,e){void 0===e&&(e={}),this.builder.reset(e);var i=this.parser.parse(t);if(!i.success&&this.options.throwOnError)throw _e(i),new h("Error parsing line: "+t);return i},t.prototype.beam=function(t,e){return void 0===e&&(e={}),this.factory.Beam({notes:t,options:e}),t},t.prototype.tuplet=function(t,e){return void 0===e&&(e={}),this.factory.Tuplet({notes:t,options:e}),t},t.prototype.notes=function(t,e){return void 0===e&&(e={}),e=r({clef:this.defaults.clef,stem:this.defaults.stem},e),this.parse(t,e),this.builder.getElements().notes},t.prototype.voice=function(t,e){return e=r({time:this.defaults.time},e),this.factory.Voice(e).addTickables(t)},t.prototype.addCommitHook=function(t){this.builder.addCommitHook(t)},t.DEBUG=!1,t}();function Ce(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Ae.DEBUG&&d("Vex.Flow.TextDynamics",t)}var Ee,Ae=function(t){function e(e){var i=t.call(this,e)||this;return i.setAttribute("type","TextDynamics"),i.sequence=e.text.toLowerCase(),i.line=e.line||0,i.glyphs=[],i.render_options=r(r({},i.render_options),{glyph_font_size:40}),Ce("New Dynamics Text: ",i.sequence),i}return o(e,t),Object.defineProperty(e,"GLYPHS",{get:function(){return{f:{code:"dynamicForte",width:12},p:{code:"dynamicPiano",width:14},m:{code:"dynamicMezzo",width:17},s:{code:"dynamicSforzando",width:10},z:{code:"dynamicZ",width:12},r:{code:"dynamicRinforzando",width:12}}},enumerable:!1,configurable:!0}),e.prototype.setLine=function(t){return this.line=t,this},e.prototype.preFormat=function(){var t=this,i=0;return this.sequence.split("").forEach((function(n){var o=e.GLYPHS[n];if(!o)throw new h("Invalid dynamics character: "+n);var r=c(t.render_options.glyph_font_size),a=new S(o.code,r,{category:"textNote"});t.glyphs.push(a),i+=o.width})),this.setWidth(i),this.preFormatted=!0,this},e.prototype.draw=function(){var t=this;this.setRendered();var i=this.getAbsoluteX(),n=this.checkStave().getYForLine(this.line+-3);Ce("Rendering Dynamics: ",this.sequence);var o=i;this.glyphs.forEach((function(i,r){var a=t.sequence[r];i.render(t.checkContext(),o,n),o+=e.GLYPHS[a].width}))},e}(R);function Pe(){if(!Ee){var t=new I({duration:"w",note_type:"r"});Ee={glyph_font_scale:t.render_options.glyph_font_scale,glyph_code:t.glyph_code,width:t.getWidth()}}return Ee}var ke=function(t){function e(e,i){var n=t.call(this)||this;n.setAttribute("type","MultiMeasureRest");var o=n.musicFont.lookupMetric("digits.point"),a=n.musicFont.lookupMetric("digits.shiftLine",0);return n.render_options={show_number:!0,number_line:-.5,number_glyph_point:o,line:2,spacing_between_lines_px:10,serif_thickness:2,use_symbols:!1,semibrave_rest_glyph_scale:ei.DEFAULT_NOTATION_FONT_SCALE},n.render_options=r(r({},n.render_options),i),n.render_options.number_line+=a,n.number_of_measures=e,n.xs={left:NaN,right:NaN},n}return o(e,t),e.prototype.getXs=function(){return this.xs},e.prototype.setStave=function(t){return this.stave=t,this},e.prototype.getStave=function(){return this.stave},e.prototype.checkStave=function(){if(!this.stave)throw new h("NoStave","No stave attached to instance");return this.stave},e.prototype.drawLine=function(t,e,i,n){var o=this.checkStave().getYForLine(this.render_options.line),r=.1*(i-e);e+=r,i-=r;var a=this.render_options.serif_thickness,s=.25*n;null!=this.render_options.line_thickness&&(s=.5*this.render_options.line_thickness),t.save(),t.beginPath(),t.moveTo(e,o-n),t.lineTo(e+a,o-n),t.lineTo(e+a,o-s),t.lineTo(i-a,o-s),t.lineTo(i-a,o-n),t.lineTo(i,o-n),t.lineTo(i,o+n),t.lineTo(i-a,o+n),t.lineTo(i-a,o+s),t.lineTo(e+a,o+s),t.lineTo(e+a,o+n),t.lineTo(e,o+n),t.closePath(),t.fill()},e.prototype.drawSymbols=function(t,e,i,n){var o=this.checkStave(),r=Math.floor(this.number_of_measures/4),a=this.number_of_measures%4,s=Math.floor(a/2),h=a%2,c=Pe(),d=c.width*(this.render_options.semibrave_rest_glyph_scale/c.glyph_font_scale),l={2:{width:.5*d,height:n},1:{width:d}},p=1.35*d;null!=this.render_options.symbol_spacing&&(p=this.render_options.symbol_spacing);var u=e+.5*(i-e)-.5*(r*l[2].width+s*l[2].width+h*l[1].width+(r+s+h-1)*p),f=o.getYForLine(this.render_options.line-1),g=o.getYForLine(this.render_options.line),m=o.getYForLine(this.render_options.line+1);t.save(),t.setStrokeStyle("none"),t.setLineWidth(0);for(var y=0;y<r;++y)t.fillRect(u,g-l[2].height,l[2].width,l[2].height),t.fillRect(u,m-l[2].height,l[2].width,l[2].height),u+=l[2].width+p;for(y=0;y<s;++y)t.fillRect(u,g-l[2].height,l[2].width,l[2].height),u+=l[2].width+p;for(y=0;y<h;++y)S.renderGlyph(t,u,f,this.render_options.semibrave_rest_glyph_scale,c.glyph_code),u+=l[1].width+p;t.restore()},e.prototype.draw=function(){var t=this.checkContext();this.setRendered();var e=this.checkStave(),i=this.render_options.spacing_between_lines_px,n=e.getNoteStartX(),o=e.getNoteEndX(),r=e.getModifiers(Rt.Position.BEGIN);if(1===r.length&&r[0].getCategory()===Wt.CATEGORY&&(n-=r[0].getWidth()),null!=this.render_options.padding_left&&(n=e.getX()+this.render_options.padding_left),null!=this.render_options.padding_right&&(o=e.getX()+e.getWidth()-this.render_options.padding_right),this.xs.left=n,this.xs.right=o,this.render_options.use_symbols?this.drawSymbols(t,n,o,i):this.drawLine(t,n,o,i),this.render_options.show_number){var a="/"+this.number_of_measures,s=new Jt(a,0,!1);s.point=this.render_options.number_glyph_point,s.setTimeSig(a),s.setStave(e),s.setX(n+.5*(o-n)-.5*s.getInfo().glyph.getMetrics().width),s.bottomLine=this.render_options.number_line,s.setContext(t).draw()}},e}(y);function De(t,e,i,n,o,r,a){t.beginPath(),t.moveTo(e,i),t.lineTo(n,o),t.lineTo(r,a),t.lineTo(e,i),t.closePath(),t.fill()}var Fe=function(t){function e(i){var n=t.call(this)||this;return n.setAttribute("type","StaveLine"),n.notes=i,n.text="",n.font={family:"Arial",size:10,weight:""},n.render_options={padding_left:4,padding_right:3,line_width:1,line_dash:void 0,rounded_end:!0,color:void 0,draw_start_arrow:!1,draw_end_arrow:!1,arrowhead_length:10,arrowhead_angle:Math.PI/8,text_position_vertical:e.TextVerticalPosition.TOP,text_justification:e.TextJustification.CENTER},n.setNotes(i),n}return o(e,t),e.prototype.setFont=function(t){return this.font=t,this},e.prototype.setText=function(t){return this.text=t,this},e.prototype.setNotes=function(t){if(!t.first_note&&!t.last_note)throw new h("BadArguments","Notes needs to have either first_note or last_note set.");if(t.first_indices||(t.first_indices=[0]),t.last_indices||(t.last_indices=[0]),t.first_indices.length!==t.last_indices.length)throw new h("BadArguments","Connected notes must have similar index sizes");return this.first_note=t.first_note,this.first_indices=t.first_indices,this.last_note=t.last_note,this.last_indices=t.last_indices,this},e.prototype.applyLineStyle=function(){var t=this.checkContext(),e=this.render_options;e.line_dash&&t.setLineDash(e.line_dash),e.line_width&&t.setLineWidth(e.line_width),e.rounded_end?t.setLineCap("round"):t.setLineCap("square")},e.prototype.applyFontStyle=function(){var t=this.checkContext();this.font&&t.setFont(this.font.family,this.font.size,this.font.weight);var e=this.render_options.color;e&&(t.setStrokeStyle(e),t.setFillStyle(e))},e.prototype.draw=function(){var t=this,i=this.checkContext();this.setRendered();var n=this.first_note,o=this.last_note,r=this.render_options;i.save(),this.applyLineStyle();var a={x:0,y:0},s={x:0,y:0};this.first_indices.forEach((function(e,h){var c=t.last_indices[h];a=n.getModifierStartXY(2,e),s=o.getModifierStartXY(1,c);var d=a.y>s.y;a.x+=n.getMetrics().modRightPx+r.padding_left,s.x-=o.getMetrics().modLeftPx+r.padding_right;var l=n.getGlyph().getWidth();n.getKeyProps()[e].displaced&&1===n.getStemDirection()&&(a.x+=l+r.padding_left),o.getKeyProps()[c].displaced&&-1===o.getStemDirection()&&(s.x-=l+r.padding_right),a.y+=d?-3:1,s.y+=d?2:0,function(t,e,i,n){var o,r,a,s,h=n.draw_start_arrow&&n.draw_end_arrow,c=e.x,d=e.y,l=i.x,p=i.y,u=Math.sqrt((l-c)*(l-c)+(p-d)*(p-d)),f=(u-n.arrowhead_length/3)/u;n.draw_end_arrow||h?(o=Math.round(c+(l-c)*f),r=Math.round(d+(p-d)*f)):(o=l,r=p),n.draw_start_arrow||h?(a=c+(l-c)*(1-f),s=d+(p-d)*(1-f)):(a=c,s=d),n.color&&(t.setStrokeStyle(n.color),t.setFillStyle(n.color)),t.beginPath(),t.moveTo(a,s),t.lineTo(o,r),t.stroke(),t.closePath();var g,m,y,_,x=Math.atan2(p-d,l-c),v=Math.abs(n.arrowhead_length/Math.cos(n.arrowhead_angle));(n.draw_end_arrow||h)&&(g=x+Math.PI+n.arrowhead_angle,y=l+Math.cos(g)*v,_=p+Math.sin(g)*v,m=x+Math.PI-n.arrowhead_angle,De(t,y,_,l,p,l+Math.cos(m)*v,p+Math.sin(m)*v)),(n.draw_start_arrow||h)&&(g=x+n.arrowhead_angle,y=c+Math.cos(g)*v,_=d+Math.sin(g)*v,m=x-n.arrowhead_angle,De(t,y,_,c,d,c+Math.cos(m)*v,d+Math.sin(m)*v))}(i,a,s,t.render_options)})),i.restore();var h=i.measureText(this.text).width,c=r.text_justification,d=0;if(c===e.TextJustification.LEFT)d=a.x;else if(c===e.TextJustification.CENTER){d=(s.x-a.x)/2+a.x-h/2}else c===e.TextJustification.RIGHT&&(d=s.x-h);var l=0,p=r.text_position_vertical;return p===e.TextVerticalPosition.TOP?l=n.checkStave().getYForTopText():p===e.TextVerticalPosition.BOTTOM&&(l=n.checkStave().getYForBottomText(ei.TEXT_HEIGHT_OFFSET_HACK)),i.save(),this.applyFontStyle(),i.fillText(this.text,d,l),i.restore(),this},e.TextVerticalPosition={TOP:1,BOTTOM:2},e.TextJustification={LEFT:1,CENTER:2,RIGHT:3},e}(y),Ne=function(t){function e(e,i,n){var o=t.call(this,i)||this;return o.options=r({ignoreTicks:!1,line:2},n),o.setAttribute("type","GlyphNote"),o.ignore_ticks=o.options.ignoreTicks,e&&o.setGlyph(e),o}return o(e,t),e.prototype.setGlyph=function(t){return this.glyph=t,this.setWidth(this.glyph.getMetrics().width),this},e.prototype.getBoundingBox=function(){return this.glyph.getBoundingBox()},e.prototype.addToModifierContext=function(t){this.modifierContext=t;for(var e=0;e<this.modifiers.length;++e)this.modifierContext.addMember(this.modifiers[e]);return this.setPreFormatted(!1),this},e.prototype.preFormat=function(){return!this.preFormatted&&this.modifierContext&&this.modifierContext.preFormat(),this.setPreFormatted(!0),this},e.prototype.drawModifiers=function(){var t=this.checkContext();t.openGroup("modifiers");for(var e=0;e<this.modifiers.length;e++){var i=this.modifiers[e];i.setContext(t),i.drawWithStyle()}t.closeGroup()},e.prototype.draw=function(){var t=this.checkStave(),e=t.checkContext();this.setRendered(),e.openGroup("glyphNote",this.getAttribute("id")),this.glyph.getContext()||this.glyph.setContext(e),this.glyph.setStave(t),this.glyph.setYShift(t.getYForLine(this.options.line)-t.getYForGlyphs());var i=this.isCenterAligned()?this.getAbsoluteX()-this.getWidth()/2:this.getAbsoluteX();this.glyph.renderToStave(i),this.drawModifiers(),e.closeGroup()},e}(R),Me=function(t){function e(e,i,n){var o=this;(o=t.call(this,void 0,r({duration:"q",align_center:"slash"!==e},i),n)||this).setAttribute("type","RepeatNote");var a=new S({1:"repeat1Bar",2:"repeat2Bars",4:"repeat4Bars",slash:"repeatBarSlash"}[e]||"repeat1Bar",o.musicFont.lookupMetric("repeatNote.point",40),{category:"repeatNote"});return o.setGlyph(a),o}return o(e,t),e}(Ne),Be=function(t){function e(e){void 0===e&&(e={});var i=t.call(this)||this;return i.setAttribute("type","System"),i.setOptions(e),i.parts=[],i}return o(e,t),e.prototype.setOptions=function(t){void 0===t&&(t={}),this.options=r(r({x:10,y:10,width:500,spaceBetweenStaves:12,autoWidth:!1,noJustification:!1,debugFormatter:!1,formatIterations:0,noPadding:!1},t),{details:r({alpha:.5},t.details)}),!1===this.options.noJustification&&void 0===t.width&&(this.options.autoWidth=!0),this.factory=this.options.factory||new Ke({renderer:{elementId:null,width:0,height:0}})},e.prototype.setContext=function(e){return t.prototype.setContext.call(this,e),this.factory.setContext(e),this},e.prototype.addConnector=function(t){return void 0===t&&(t="double"),this.connector=this.factory.StaveConnector({top_stave:this.parts[0].stave,bottom_stave:this.parts[this.parts.length-1].stave,type:t}),this.connector},e.prototype.addStave=function(t){var e=this,i=t.stave;i||(i=this.factory.Stave({x:this.options.x,y:this.options.y,width:this.options.width,options:r({left_bar:!1},t.options)}));var n=r(r({stave:i,voices:[],spaceAbove:0,spaceBelow:0,debugNoteMetrics:!1},t),{options:r({left_bar:!1},t.options)});return n.voices.forEach((function(t){return t.setContext(e.getContext()).setStave(n.stave).getTickables().forEach((function(t){return t.setStave(n.stave)}))})),this.parts.push(n),n.stave},e.prototype.format=function(){var t=this,e=0,i=new ee(r({},this.options.details));this.formatter=i;var n=this.options.y,o=0,a=[],s=[];this.parts.forEach((function(e){n+=e.stave.space(e.spaceAbove),e.stave.setY(n),t.options.autoWidth?e.voices.forEach((function(t){i.joinVoices([t])})):i.joinVoices(e.voices),n+=e.stave.space(e.spaceBelow),n+=e.stave.space(t.options.spaceBetweenStaves),e.debugNoteMetrics&&(s.push({y:n,voice:e.voices[0]}),n+=15),a=a.concat(e.voices),o=Math.max(o,e.stave.getNoteStartX())})),this.parts.forEach((function(t){return t.stave.setNoteStartX(o)})),this.options.autoWidth?(e=i.preCalculateMinTotalWidth(a),this.parts.forEach((function(i){i.stave.setWidth(e+Qt.rightPadding+(o-t.options.x))}))):e=this.options.noPadding?this.options.width-this.options.x:this.options.width-(o-this.options.x)-Qt.defaultPadding,i.format(a,this.options.noJustification?0:e);for(var h=0;h<this.options.formatIterations;h++)i.tune({alpha:this.options.details.alpha});this.startX=o,this.debugNoteMetricsYs=s,this.lastY=n},e.prototype.draw=function(){var t=this.checkContext();if(!(this.formatter&&this.startX&&this.lastY&&this.debugNoteMetricsYs))throw new h("NoFormated","Format must be instatiated before draw");this.setRendered(),this.options.debugFormatter&&ee.plotDebugging(t,this.formatter,this.startX,this.options.y,this.lastY),this.debugNoteMetricsYs.forEach((function(e){e.voice.getTickables().forEach((function(i){return R.plotMetrics(t,i,e.y)}))}))},e}(y),Oe=function(t){function e(e,i){var n=t.call(this,{duration:"b"})||this;n.setAttribute("type","TimeSigNote");var o=new Jt(e,i);return n.timeSigInfo=o.getInfo(),n.setWidth(n.timeSigInfo.glyph.getMetrics().width),n.ignore_ticks=!0,n}return o(e,t),e.prototype.addToModifierContext=function(){return this},e.prototype.preFormat=function(){return this.setPreFormatted(!0),this},e.prototype.draw=function(){var t=this.checkStave(),e=this.checkContext();this.setRendered(),this.timeSigInfo.glyph.getContext()||this.timeSigInfo.glyph.setContext(e),this.timeSigInfo.glyph.setStave(t),this.timeSigInfo.glyph.setYShift(t.getYForLine(2)-t.getYForGlyphs()),this.timeSigInfo.glyph.renderToStave(this.getAbsoluteX())},e}(R),Re=function(t){function e(e,i,n){var o=t.call(this,{duration:"b"})||this;return o.setAttribute("type","KeySigNote"),o.keySignature=new zt(e,i,n),o.ignore_ticks=!0,o}return o(e,t),e.prototype.addToModifierContext=function(){return this},e.prototype.preFormat=function(){return this.setPreFormatted(!0),this.keySignature.setStave(this.checkStave()),this.setWidth(this.keySignature.getWidth()),this},e.prototype.draw=function(){var t=this.checkStave().checkContext();this.setRendered(),this.keySignature.setX(this.getAbsoluteX()),this.keySignature.setContext(t),this.keySignature.draw()},e}(R);function Le(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Ue.DEBUG&&d("Vex.Flow.PedalMarking",t)}function We(t,e,i,n,o){var r=Ue.GLYPHS[t];new S(r.code,o,{category:"pedalMarking"}).render(e,i+r.x_shift,n+r.y_shift)}var Ie,Ue=function(t){function e(i){var n=t.call(this)||this;return n.setAttribute("type","PedalMarking"),n.notes=i,n.type=e.type.TEXT,n.line=0,n.custom_depress_text="",n.custom_release_text="",n.font={family:"Times New Roman",size:12,weight:"italic bold"},n.render_options={bracket_height:10,text_margin_right:6,bracket_line_width:1,color:"black"},n}return o(e,t),e.prototype.setType=function(t){return(t="string"==typeof t?e.typeString[t]:t)>=e.type.TEXT&&t<=e.type.MIXED&&(this.type=t),this},e.createSustain=function(t){return new e(t)},e.createSostenuto=function(t){var i=new e(t);return i.setType(e.type.MIXED),i.setCustomText("Sost. Ped."),i},e.createUnaCorda=function(t){var i=new e(t);return i.setType(e.type.TEXT),i.setCustomText("una corda","tre corda"),i},e.prototype.setCustomText=function(t,e){return this.custom_depress_text=t||"",this.custom_release_text=e||"",this},e.prototype.setLine=function(t){return this.line=t,this},e.prototype.drawBracketed=function(){var t,i,n=this,o=this.checkContext(),r=!1;this.notes.forEach((function(a,s,c){r=!r;var d=a.getAbsoluteX(),l=a.checkStave().getYForBottomText(n.line+3);if(d<t)throw new h("InvalidConfiguration","The notes provided must be in order of ascending x positions");var p=c[s+1]===a,u=c[s-1]===a,f=0,g=n.musicFont.lookupMetric("pedalMarking."+(r?"down":"up")+".point");if(r)if(f=u?5:0,n.type!==e.type.MIXED||u)o.beginPath(),o.moveTo(d,l-n.render_options.bracket_height),o.lineTo(d+f,l),o.stroke(),o.closePath();else if(n.custom_depress_text){var m=o.measureText(n.custom_depress_text).width;o.fillText(n.custom_depress_text,d-m/2,l),f=m/2+n.render_options.text_margin_right}else We("pedal_depress",o,d,l,g),f=20+n.render_options.text_margin_right;else f=p?-5:0,o.beginPath(),o.moveTo(t,i),o.lineTo(d+f,l),o.lineTo(d,l-n.render_options.bracket_height),o.stroke(),o.closePath();t=d+f,i=l}))},e.prototype.drawText=function(){var t=this,e=this.checkContext(),i=!1;this.notes.forEach((function(n){i=!i;var o=n.checkStave(),r=n.getAbsoluteX(),a=o.getYForBottomText(t.line+3),s=t.musicFont.lookupMetric("pedalMarking."+(i?"down":"up")+".point"),h=0;i?t.custom_depress_text?(h=e.measureText(t.custom_depress_text).width,e.fillText(t.custom_depress_text,r-h/2,a)):We("pedal_depress",e,r,a,s):t.custom_release_text?(h=e.measureText(t.custom_release_text).width,e.fillText(t.custom_release_text,r-h/2,a)):We("pedal_release",e,r,a,s)}))},e.prototype.draw=function(){var t=this.checkContext();this.setRendered(),t.save(),t.setStrokeStyle(this.render_options.color),t.setFillStyle(this.render_options.color),t.setFont(this.font.family,this.font.size,this.font.weight),Le("Rendering Pedal Marking"),this.type===e.type.BRACKET||this.type===e.type.MIXED?(t.setLineWidth(this.render_options.bracket_line_width),this.drawBracketed()):this.type===e.type.TEXT&&this.drawText(),t.restore()},e.GLYPHS={pedal_depress:{code:"keyboardPedalPed",x_shift:-10,y_shift:0},pedal_release:{code:"keyboardPedalUp",x_shift:-2,y_shift:3}},e.type={TEXT:1,BRACKET:2,MIXED:3},e.typeString={text:e.type.TEXT,bracket:e.type.BRACKET,mixed:e.type.MIXED},e}(y);function Ge(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];je.DEBUG&&d("Vex.Flow.TextBracket",t)}!function(t){t[t.TOP=1]="TOP",t[t.BOTTOM=-1]="BOTTOM"}(Ie||(Ie={}));var je=function(t){function e(i){var n=i.start,o=i.stop,r=i.text,a=void 0===r?"":r,s=i.superscript,h=void 0===s?"":s,c=i.position,d=void 0===c?e.Position.TOP:c,l=t.call(this)||this;return l.setAttribute("type","TextBracket"),l.start=n,l.stop=o,l.text=a,l.superscript=h,l.position="string"==typeof d?e.PositionString[d]:d,l.line=1,l.font={family:"Serif",size:15,weight:"italic"},l.render_options={dashed:!0,dash:[5],color:"black",line_width:1,show_bracket:!0,bracket_height:8,underline_superscript:!0},l}return o(e,t),Object.defineProperty(e,"Positions",{get:function(){return Ge("Positions is deprecated, use Position instead."),e.Position},enumerable:!1,configurable:!0}),Object.defineProperty(e,"Position",{get:function(){return Ie},enumerable:!1,configurable:!0}),Object.defineProperty(e,"PositionsString",{get:function(){return Ge("PositionsString is deprecated, use PositionString instead."),e.PositionsString},enumerable:!1,configurable:!0}),Object.defineProperty(e,"PositionString",{get:function(){return{top:e.Position.TOP,bottom:e.Position.BOTTOM}},enumerable:!1,configurable:!0}),e.prototype.applyStyle=function(t){return t.setFont(this.font.family,this.font.size,this.font.weight),t.setStrokeStyle(this.render_options.color),t.setFillStyle(this.render_options.color),t.setLineWidth(this.render_options.line_width),this},e.prototype.setDashed=function(t,e){return this.render_options.dashed=t,e&&(this.render_options.dash=e),this},e.prototype.setFont=function(t){return this.font=r(r({},this.font),t),this},e.prototype.setLine=function(t){return this.line=t,this},e.prototype.draw=function(){var t=this.checkContext();this.setRendered();var i=0;switch(this.position){case e.Position.TOP:i=this.start.checkStave().getYForTopText(this.line);break;case e.Position.BOTTOM:i=this.start.checkStave().getYForBottomText(this.line+ei.TEXT_HEIGHT_OFFSET_HACK);break;default:throw new h("InvalidPosition","The position "+this.position+" is invalid.")}var n={x:this.start.getAbsoluteX(),y:i},o={x:this.stop.getAbsoluteX(),y:i};Ge("Rendering TextBracket: start:",n,"stop:",o,"y:",i);var r=this.render_options.bracket_height*this.position;t.save(),this.applyStyle(t),t.fillText(this.text,n.x,n.y);var a=t.measureText(this.text).width,s=t.measureText("M").width,c=n.y-s/2.5;t.setFont(this.font.family,this.font.size/1.4,this.font.weight),t.fillText(this.superscript,n.x+a+1,c);var d=t.measureText(this.superscript).width,l=t.measureText("M").width,p=n.x,u=c,f=o.x+this.stop.getGlyph().getWidth();this.position===e.Position.TOP?(p+=a+d+5,u-=l/2.7):this.position===e.Position.BOTTOM&&(u+=l/2.7,p+=a+2,this.render_options.underline_superscript||(p+=d)),this.render_options.dashed?(at.drawDashedLine(t,p,u,f,u,this.render_options.dash),this.render_options.show_bracket&&at.drawDashedLine(t,f,u+1*this.position,f,u+r,this.render_options.dash)):(t.beginPath(),t.moveTo(p,u),t.lineTo(f,u),this.render_options.show_bracket&&t.lineTo(f,u+r),t.stroke(),t.closePath()),t.restore()},e}(y);function Ye(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];He.DEBUG&&d("Vex.Flow.VibratoBracket",t)}var He=function(t){function e(e){var i=t.call(this)||this;return i.setAttribute("type","VibratoBracket"),i.start=e.start,i.stop=e.stop,i.line=1,i.render_options={harsh:!1,wave_height:6,wave_width:4,wave_girth:2,vibrato_width:0},i}return o(e,t),e.prototype.setLine=function(t){return this.line=t,this},e.prototype.setHarsh=function(t){return this.render_options.harsh=t,this},e.prototype.draw=function(){var t=this.checkContext();this.setRendered();var e=this.start&&this.start.checkStave().getYForTopText(this.line)||this.stop&&this.stop.checkStave().getYForTopText(this.line)||0,i=this.start&&this.start.getAbsoluteX()||this.stop&&this.stop.checkStave().getTieStartX()||0,n=this.stop&&this.stop.getAbsoluteX()-this.stop.getWidth()-5||this.start&&this.start.checkStave().getTieEndX()-10||0;this.render_options.vibrato_width=n-i,Ye("Rendering VibratoBracket: start_x:",i,"stop_x:",n,"y:",e),Ft.renderVibrato(t,i,e,this.render_options)},e}(y),Xe=function(t){function e(e){var i,n=this;if(!e)throw new h("BadArguments","Ghost note must have valid initialization data to identify duration.");if("string"==typeof e)i={duration:e};else{if("object"!=typeof e)throw new h("BadArguments","Ghost note must have valid initialization data to identify duration.");i=e}return(n=t.call(this,i)||this).setAttribute("type","GhostNote"),n.setWidth(0),n}return o(e,t),e.prototype.isRest=function(){return!0},e.prototype.setStave=function(e){return t.prototype.setStave.call(this,e),this},e.prototype.addToModifierContext=function(){return this},e.prototype.preFormat=function(){return this.setPreFormatted(!0),this},e.prototype.draw=function(){this.setRendered();for(var t=0;t<this.modifiers.length;++t){var e=this.modifiers[t];e.setContext(this.getContext()),e.drawWithStyle()}},e}(L),Ve=function(t){function e(e,i,n,o){var a=this,s=r({spacing_between_lines_px:13,num_lines:6,top_text_position:1},o);return(a=t.call(this,e,i,n,s)||this).setAttribute("type","TabStave"),a}return o(e,t),e.prototype.getYForGlyphs=function(){return this.getYForLine(2.5)},e.prototype.addTabGlyph=function(){return this.addClef("tab"),this},e}(Qt);function ze(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Ke.DEBUG&&d("Vex.Flow.Factory",t)}var Ke=function(){function t(t){void 0===t&&(t={}),ze("New factory: ",t);var e={stave:{space:10},renderer:{elementId:"",backend:at.Backends.SVG,width:500,height:200,background:"#FFF"},font:{family:"Arial",size:10,weight:""}};this.options=e,this.setOptions(t)}return t.newFromElementId=function(e,i,n){return void 0===i&&(i=500),void 0===n&&(n=200),new t({renderer:{elementId:e,width:i,height:n,backend:at.Backends.SVG}})},t.prototype.reset=function(){this.renderQ=[],this.systems=[],this.staves=[],this.voices=[],this.stave=void 0},t.prototype.getOptions=function(){return this.options},t.prototype.setOptions=function(t){void 0===t&&(t={}),t.stave&&(this.options.stave=t.stave),t.renderer&&(this.options.renderer=t.renderer),t.font&&(this.options.font=t.font),null!==this.options.renderer.elementId&&this.initRenderer(),this.reset()},t.prototype.initRenderer=function(){if(!this.options.renderer)throw new h("NoRenderer");var t=this.options.renderer,e=t.elementId,i=t.backend,n=t.width,o=t.height,r=t.background;if(""===e)throw ze(this),new h("HTML DOM element not set in Factory");this.context=at.buildContext(e,null!=i?i:at.Backends.SVG,n,o,r)},t.prototype.getContext=function(){return this.context},t.prototype.setContext=function(t){return this.context=t,this},t.prototype.getStave=function(){return this.stave},t.prototype.getVoices=function(){return this.voices},t.prototype.space=function(t){if(!this.options.stave)throw new h("NoStave");return this.options.stave.space*t},t.prototype.Stave=function(t){if(void 0===t&&(t={}),!this.options.renderer)throw new h("NoRenderer");if(!this.options.stave)throw new h("NoStave");var e=r({x:0,y:0,width:this.options.renderer.width-this.space(1),options:{spacing_between_lines_px:this.options.stave.space}},t),i=new Qt(e.x,e.y,e.width,e.options);return this.staves.push(i),i.setContext(this.context),this.stave=i,i},t.prototype.TabStave=function(t){if(void 0===t&&(t={}),!this.options.renderer)throw new h("NoRenderer");if(!this.options.stave)throw new h("NoStave");var e=r({x:0,y:0,width:this.options.renderer.width-this.space(1),options:{spacing_between_lines_px:1.3*this.options.stave.space}},t),i=new Ve(e.x,e.y,e.width,e.options);return this.staves.push(i),i.setContext(this.context),this.stave=i,i},t.prototype.StaveNote=function(t){var e=new j(t);return this.stave&&e.setStave(this.stave),e.setContext(this.context),this.renderQ.push(e),e},t.prototype.GlyphNote=function(t,e,i){var n=new Ne(t,e,i);return this.stave&&n.setStave(this.stave),n.setContext(this.context),this.renderQ.push(n),n},t.prototype.RepeatNote=function(t,e,i){var n=new Me(t,e,i);return this.stave&&n.setStave(this.stave),n.setContext(this.context),this.renderQ.push(n),n},t.prototype.GhostNote=function(t){var e=new Xe(t);return this.stave&&e.setStave(this.stave),e.setContext(this.context),this.renderQ.push(e),e},t.prototype.TextNote=function(t){var e=new jt(t);return this.stave&&e.setStave(this.stave),e.setContext(this.context),this.renderQ.push(e),e},t.prototype.BarNote=function(t){void 0===t&&(t={});var e=new ce(t.type);return this.stave&&e.setStave(this.stave),e.setContext(this.context),this.renderQ.push(e),e},t.prototype.ClefNote=function(t){void 0===t&&(t={});var e=r({type:"treble",options:{size:"default",annotation:void 0}},t),i=new de(e.type,e.options.size,e.options.annotation);return this.stave&&i.setStave(this.stave),i.setContext(this.context),this.renderQ.push(i),i},t.prototype.TimeSigNote=function(t){void 0===t&&(t={});var e=r({time:"4/4"},t),i=new Oe(e.time);return this.stave&&i.setStave(this.stave),i.setContext(this.context),this.renderQ.push(i),i},t.prototype.KeySigNote=function(t){var e=new Re(t.key,t.cancelKey,t.alterKey);return this.stave&&e.setStave(this.stave),e.setContext(this.context),this.renderQ.push(e),e},t.prototype.TabNote=function(t){var e=new X(t);return this.stave&&e.setStave(this.stave),e.setContext(this.context),this.renderQ.push(e),e},t.prototype.GraceNote=function(t){var e=new Y(t);return this.stave&&e.setStave(this.stave),e.setContext(this.context),e},t.prototype.GraceNoteGroup=function(t){var e=new re(t.notes,t.slur);return e.setContext(this.context),e},t.prototype.Accidental=function(t){var e=new se(t.type);return e.setContext(this.context),e},t.prototype.Annotation=function(t){void 0===t&&(t={});var e=r({text:"p",vJustify:"below",hJustify:"center",fontFamily:"Times",fontSize:14,fontWeight:"bold italic",options:{}},t),i=new At(e.text);return i.setJustification(e.hJustify),i.setVerticalJustification(e.vJustify),i.setFont(e.fontFamily,e.fontSize,e.fontWeight),i.setContext(this.context),i},t.prototype.ChordSymbol=function(t){void 0===t&&(t={});var e=r({vJustify:"top",hJustify:"center",kerning:!0,reportWidth:!0},t),i=new kt;return i.setHorizontal(e.hJustify),i.setVertical(e.vJustify),i.setEnableKerning(e.kerning),i.setReportWidth(e.reportWidth),"string"==typeof e.fontFamily&&"number"==typeof e.fontSize?"string"==typeof e.fontWeight?i.setFont(e.fontFamily,e.fontSize,e.fontWeight):i.setFont(e.fontFamily,e.fontSize,""):"number"==typeof e.fontSize&&i.setFontSize(e.fontSize),i.setContext(this.context),i},t.prototype.Articulation=function(t){void 0===t&&(t={});var e=r({type:"a.",position:"above"},t),i=new mt(e.type);return i.setPosition(e.position),i.setContext(this.context),i},t.prototype.TextDynamics=function(t){void 0===t&&(t={});var e=r({text:"p",duration:"q",dots:0,line:0},t),i=new Ae({text:e.text,line:e.line,duration:e.duration,dots:e.dots});return this.stave&&i.setStave(this.stave),i.setContext(this.context),this.renderQ.push(i),i},t.prototype.Fingering=function(t){var e=r({number:"0",position:"left"},t),i=new tt(e.number);return i.setPosition(e.position),i.setContext(this.context),i},t.prototype.StringNumber=function(t){var e=new st(t.number);return e.setPosition(t.position),e.setContext(this.context),e},t.prototype.TickContext=function(){return(new yt).setContext(this.context)},t.prototype.ModifierContext=function(){return new Bt},t.prototype.MultiMeasureRest=function(t){if(void 0===t.number_of_measures)throw new h("NoNumberOfMeasures");var e=new ke(t.number_of_measures,t);return e.setContext(this.context),this.renderQ.push(e),e},t.prototype.Voice=function(t){void 0===t&&(t={});var e=r({time:"4/4"},t),i=new Q(e.time,e.options);return this.voices.push(i),i},t.prototype.StaveConnector=function(t){var e=new $(t.top_stave,t.bottom_stave);return e.setType(t.type).setContext(this.context),this.renderQ.push(e),e},t.prototype.Formatter=function(t){return void 0===t&&(t={}),new ee(t)},t.prototype.Tuplet=function(t){void 0===t&&(t={});var e=r({notes:[],options:{}},t),i=new B(e.notes,e.options).setContext(this.context);return this.renderQ.push(i),i},t.prototype.Beam=function(t){var e,i,n,o=new q(t.notes,null===(e=t.options)||void 0===e?void 0:e.autoStem).setContext(this.context);return o.breakSecondaryAt(null!==(n=null===(i=t.options)||void 0===i?void 0:i.secondaryBeamBreaks)&&void 0!==n?n:[]),this.renderQ.push(o),o},t.prototype.Curve=function(t){var e=new fe(t.from,t.to,t.options).setContext(this.context);return this.renderQ.push(e),e},t.prototype.StaveTie=function(t){var e,i=new ie({first_note:t.from,last_note:t.to,first_indices:t.first_indices,last_indices:t.last_indices},t.text);return(null===(e=t.options)||void 0===e?void 0:e.direction)&&i.setDirection(t.options.direction),i.setContext(this.context),this.renderQ.push(i),i},t.prototype.StaveLine=function(t){var e,i,n=new Fe({first_note:t.from,last_note:t.to,first_indices:t.first_indices,last_indices:t.last_indices});return(null===(e=t.options)||void 0===e?void 0:e.text)&&n.setText(t.options.text),(null===(i=t.options)||void 0===i?void 0:i.font)&&n.setFont(t.options.font),n.setContext(this.context),this.renderQ.push(n),n},t.prototype.VibratoBracket=function(t){var e=new He({start:t.from,stop:t.to});return t.options.line&&e.setLine(t.options.line),t.options.harsh&&e.setHarsh(t.options.harsh),e.setContext(this.context),this.renderQ.push(e),e},t.prototype.TextBracket=function(t){var e=new je({start:t.from,stop:t.to,text:t.text,superscript:t.options.superscript,position:t.options.position});return t.options.line&&e.setLine(t.options.line),t.options.font&&e.setFont(t.options.font),e.setContext(this.context),this.renderQ.push(e),e},t.prototype.System=function(t){void 0===t&&(t={}),t.factory=this;var e=new Be(t).setContext(this.context);return this.systems.push(e),e},t.prototype.EasyScore=function(t){return void 0===t&&(t={}),t.factory=this,new Te(t)},t.prototype.PedalMarking=function(t){void 0===t&&(t={});var e=r({notes:[],options:{style:"mixed"}},t),i=new Ue(e.notes);return i.setType(Ue.typeString[e.options.style]),i.setContext(this.context),this.renderQ.push(i),i},t.prototype.NoteSubGroup=function(t){void 0===t&&(t={});var e=r({notes:[]},t),i=new et(e.notes);return i.setContext(this.context),i},t.prototype.TextFont=function(t){return t.factory=this,new Ct(t)},t.prototype.draw=function(){var t=this;this.systems.forEach((function(e){return e.setContext(t.context).format()})),this.staves.forEach((function(e){return e.setContext(t.context).draw()})),this.voices.forEach((function(e){return e.setContext(t.context).draw()})),this.renderQ.forEach((function(e){e.isRendered()||e.setContext(t.context).draw()})),this.systems.forEach((function(e){return e.setContext(t.context).draw()})),this.reset()},t}(),Je=function(t){function e(e){var i=t.call(this,e,!1)||this;return i.setAttribute("type","GraceTabNote"),i.render_options=r(r({},i.render_options),{y_shift:.3,scale:.6,font:"7.5pt Arial"}),i.updateWidth(),i}return o(e,t),Object.defineProperty(e,"CATEGORY",{get:function(){return"gracetabnotes"},enumerable:!1,configurable:!0}),e.prototype.getCategory=function(){return e.CATEGORY},e.prototype.draw=function(){t.prototype.draw.call(this),this.setRendered()},e}(X),qe=function(){function t(t){this.music=new D,this.setKey(t)}return t.prototype.setKey=function(t){return this.key=t,this.reset(),this},t.prototype.getKey=function(){return this.key},t.prototype.reset=function(){if(this.keyParts=this.music.getKeyParts(this.key),this.keyString=this.keyParts.root,this.keyParts.accidental&&(this.keyString+=this.keyParts.accidental),!D.scaleTypes[this.keyParts.type])throw new h("BadArguments","Unsupported key type: "+this.key);this.scale=this.music.getScaleTones(this.music.getNoteValue(this.keyString),D.scaleTypes[this.keyParts.type]),this.scaleMap={},this.scaleMapByValue={},this.originalScaleMapByValue={};for(var t=D.root_indices[this.keyParts.root],e=0;e<D.roots.length;++e){var i=(t+e)%D.roots.length,n=D.roots[i],o=this.music.getRelativeNoteName(n,this.scale[e]);this.scaleMap[n]=o,this.scaleMapByValue[this.scale[e]]=o,this.originalScaleMapByValue[this.scale[e]]=o}return this},t.prototype.getAccidental=function(t){var e=this.music.getKeyParts(t).root,i=this.music.getNoteParts(this.scaleMap[e]);return{note:this.scaleMap[e],accidental:i.accidental}},t.prototype.selectNote=function(t){t=t.toLowerCase();var e=this.music.getNoteParts(t),i=this.scaleMap[e.root],n=this.music.getNoteParts(i);if(i===t)return{note:i,accidental:e.accidental,change:!1};var o=this.scaleMapByValue[this.music.getNoteValue(t)];if(null!=o)return{note:o,accidental:this.music.getNoteParts(o).accidental,change:!1};var r=this.originalScaleMapByValue[this.music.getNoteValue(t)];return null!=r?(this.scaleMap[n.root]=r,delete this.scaleMapByValue[this.music.getNoteValue(i)],this.scaleMapByValue[this.music.getNoteValue(t)]=r,{note:r,accidental:this.music.getNoteParts(r).accidental,change:!0}):n.root===t?(delete this.scaleMapByValue[this.music.getNoteValue(this.scaleMap[e.root])],this.scaleMapByValue[this.music.getNoteValue(n.root)]=n.root,this.scaleMap[n.root]=n.root,{note:n.root,accidental:void 0,change:!0}):(delete this.scaleMapByValue[this.music.getNoteValue(this.scaleMap[e.root])],this.scaleMapByValue[this.music.getNoteValue(t)]=t,delete this.scaleMap[n.root],this.scaleMap[n.root]=t,{note:t,accidental:e.accidental,change:!0})},t}(),Qe=function(t){function e(e,i){var n=t.call(this)||this;return n.setAttribute("type","StaveHairpin"),n.notes=e,n.hairpin=i,n.position=F.Position.BELOW,n.render_options={height:10,y_shift:0,left_shift_px:0,right_shift_px:0,right_shift_ticks:0,left_shift_ticks:0},n.setNotes(e),n}return o(e,t),e.FormatByTicksAndDraw=function(t,i,n,o,r,a){var s=i.pixelsPerTick;if(null==s)throw new h("BadArguments","A valid Formatter must be provide to draw offsets by ticks.");var c=s*a.left_shift_ticks,d=s*a.right_shift_ticks,l={height:a.height,y_shift:a.y_shift,left_shift_px:c,right_shift_px:d,right_shift_ticks:0,left_shift_ticks:0};new e({first_note:n.first_note,last_note:n.last_note},o).setContext(t).setRenderOptions(l).setPosition(r).draw()},e.prototype.setPosition=function(t){return t!==F.Position.ABOVE&&t!==F.Position.BELOW||(this.position=t),this},e.prototype.setRenderOptions=function(t){return null!=t.height&&null!=t.y_shift&&null!=t.left_shift_px&&null!=t.right_shift_px&&(this.render_options=t),this},e.prototype.setNotes=function(t){if(!t.first_note&&!t.last_note)throw new h("BadArguments","Hairpin needs to have either first_note or last_note set.");return this.first_note=t.first_note,this.last_note=t.last_note,this},e.prototype.renderHairpin=function(t){var i=this.checkContext(),n=this.render_options.y_shift+20,o=t.first_y;this.position===F.Position.ABOVE&&(n=30-n,o=t.first_y-t.staff_height);var r=this.render_options.left_shift_px,a=this.render_options.right_shift_px;switch(i.beginPath(),this.hairpin){case e.type.CRESC:i.moveTo(t.last_x+a,o+n),i.lineTo(t.first_x+r,o+this.render_options.height/2+n),i.lineTo(t.last_x+a,o+this.render_options.height+n);break;case e.type.DECRESC:i.moveTo(t.first_x+r,o+n),i.lineTo(t.last_x+a,o+this.render_options.height/2+n),i.lineTo(t.first_x+r,o+this.render_options.height+n)}i.stroke(),i.closePath()},e.prototype.draw=function(){this.checkContext(),this.setRendered();var t=this.first_note,e=this.last_note;if(!t||!e)throw new h("NoNote","Notes required to draw");var i=t.getModifierStartXY(this.position,0),n=e.getModifierStartXY(this.position,0);this.renderHairpin({first_x:i.x,last_x:n.x,first_y:t.checkStave().getY()+t.checkStave().getHeight(),last_y:e.checkStave().getY()+e.checkStave().getHeight(),staff_height:t.checkStave().getHeight()})},e.type={CRESC:1,DECRESC:2},e}(y),Ze=function(t){function e(i,n){var o=t.call(this,i,"sl.")||this;if(o.setAttribute("type","TabSlide"),!n){var r=i.first_note.getPositions()[0].fret,a=i.last_note.getPositions()[0].fret;n=parseInt(r,10)>parseInt(a,10)?e.SLIDE_DOWN:e.SLIDE_UP}return o.direction=n,o.render_options.cp1=11,o.render_options.cp2=14,o.render_options.y_shift=.5,o.setFont({family:"Times",size:10,weight:"bold italic"}),o.setNotes(i),o}return o(e,t),Object.defineProperty(e,"SLIDE_UP",{get:function(){return 1},enumerable:!1,configurable:!0}),Object.defineProperty(e,"SLIDE_DOWN",{get:function(){return-1},enumerable:!1,configurable:!0}),e.createSlideUp=function(t){return new e(t,e.SLIDE_UP)},e.createSlideDown=function(t){return new e(t,e.SLIDE_DOWN)},e.prototype.renderTie=function(t){if(0===t.first_ys.length||0===t.last_ys.length)throw new h("BadArguments","No Y-values to render");var i=this.checkContext(),n=t.first_x_px,o=t.first_ys,r=t.last_x_px,a=t.direction;if(a!==e.SLIDE_UP&&a!==e.SLIDE_DOWN)throw new h("BadSlide","Invalid slide direction");for(var s=0;s<this.notes.first_indices.length;++s){var c=o[this.notes.first_indices[s]]+this.render_options.y_shift;if(isNaN(c))throw new h("BadArguments","Bad indices for slide rendering.");i.beginPath(),i.moveTo(n,c+3*a),i.lineTo(r,c-3*a),i.closePath(),i.stroke()}this.setRendered()},e}(ne),$e=function(t){function e(e){var i=t.call(this)||this;return i.setAttribute("type","Tremolo"),i.num=e,i.position=F.Position.CENTER,i.code="tremolo1",i}return o(e,t),Object.defineProperty(e,"CATEGORY",{get:function(){return"tremolo"},enumerable:!1,configurable:!0}),e.prototype.getCategory=function(){return e.CATEGORY},e.prototype.draw=function(){var t=this.checkContext(),e=this.checkAttachedNote();this.setRendered();var i=e.getStemDirection(),n=e.getModifierStartXY(this.position,this.index).x,o=e.getCategory()===Y.CATEGORY,r=o?Y.SCALE:1,a="tremolo."+(o?"grace":"default"),s=this.musicFont.lookupMetric(a+".spacing")*i,h=this.num*s,c=e.getStemExtents().baseY-h;c+=i<0?this.musicFont.lookupMetric(a+".offsetYStemDown")*r:this.musicFont.lookupMetric(a+".offsetYStemUp")*r;var d=this.musicFont.lookupMetric(a+".point");n+=this.musicFont.lookupMetric(a+".offsetXStem"+(i===M.UP?"Up":"Down"));for(var l=0;l<this.num;++l)S.renderGlyph(t,n,c,d,this.code,{category:a}),c+=s},e}(F),ti=function(){function t(t){void 0===t&&(t="E/5,B/4,G/4,D/4,A/3,E/3,B/2,E/2"),this.tuningValues=[],this.setTuning(t)}return Object.defineProperty(t,"names",{get:function(){return{standard:"E/5,B/4,G/4,D/4,A/3,E/3",dagdad:"D/5,A/4,G/4,D/4,A/3,D/3",dropd:"E/5,B/4,G/4,D/4,A/3,D/3",eb:"Eb/5,Bb/4,Gb/4,Db/4,Ab/3,Db/3",standardBanjo:"D/5,B/4,G/4,D/4,G/5"}},enumerable:!1,configurable:!0}),t.prototype.noteToInteger=function(t){return ei.keyProperties(t).int_value},t.prototype.setTuning=function(e){t.names[e]&&(e=t.names[e]),this.tuningValues=[];var i=e.split(/\s*,\s*/);if(0===i.length)throw new h("BadArguments","Invalid tuning string: "+e);for(var n=0;n<i.length;++n)this.tuningValues[n]=this.noteToInteger(i[n])},t.prototype.getValueForString=function(t){var e=Number(t);if(e<1||e>this.tuningValues.length)throw new h("BadArguments","String number must be between 1 and "+this.tuningValues.length+":"+t);return this.tuningValues[e-1]},t.prototype.getValueForFret=function(t,e){var i=this.getValueForString(e),n=Number(t);if(n<0)throw new h("BadArguments","Fret number must be 0 or higher: "+t);return i+n},t.prototype.getNoteForFret=function(t,e){var i=this.getValueForFret(t,e),n=Math.floor(i/12),o=i%12;return ei.integerToNote(o)+"/"+n},t}(),ei=r(r({},k),{Accidental:se,Annotation:At,Articulation:mt,Barline:Wt,BarNote:ce,Beam:q,Bend:Dt,BoundingBox:x,ChordSymbol:kt,Clef:Vt,ClefNote:de,Crescendo:ue,Curve:fe,Dot:H,EasyScore:Te,Element:y,Factory:Ke,Font:w,Fonts:T,Formatter:ee,Fraction:f,FretHandFinger:tt,GhostNote:Xe,Glyph:S,GlyphNote:Ne,GraceNote:Y,GraceNoteGroup:re,GraceTabNote:Je,KeyManager:qe,KeySignature:zt,KeySigNote:Re,Modifier:F,ModifierContext:Bt,MultiMeasureRest:ke,Music:D,Note:R,NoteHead:I,NoteSubGroup:et,Ornament:xt,Parser:ye,PedalMarking:Ue,Registry:m,Renderer:at,RepeatNote:Me,Repetition:It,Stave:Qt,StaveConnector:$,StaveHairpin:Qe,StaveLine:Fe,StaveModifier:Rt,StaveNote:j,StaveTempo:Gt,StaveText:Yt,StaveTie:ie,Stem:M,StringNumber:st,Stroke:it,System:Be,TabNote:X,TabSlide:Ze,TabStave:Ve,TabTie:ne,TextBracket:je,TextDynamics:Ae,TextFont:Ct,TextNote:jt,TickContext:yt,TimeSignature:Jt,TimeSigNote:Oe,Tremolo:$e,Tuning:ti,Tuplet:B,Vibrato:Ft,VibratoBracket:He,Voice:Q,Volta:qt}),ii={Flow:ei,forEach:function(t,e){for(var i=0;i<t.length;i++)e(t[i],i)},SortAndUnique:function(t,e,i){if(t.length>1){var n=[],o=void 0;t.sort(e);for(var r=0;r<t.length;++r)0!==r&&i(t[r],o)||n.push(t[r]),o=t[r];return n}return t},Contains:function(t,e){for(var i=t.length;i--;)if(t[i]===e)return!0;return!1},getCanvasContext:function(t){if(!t)throw new h("BadArgument","Invalid canvas selector: "+t);var e=document.getElementById(t);if(!e||!e.getContext)throw new h("UnsupportedBrowserError","This browser does not support HTML5 Canvas");return e.getContext("2d")},BM:function(t,e){var i=(new Date).getTime();e(),d(t,(new Date).getTime()-i+"ms")},StackTrace:function(){return(new Error).stack}}}},n={};function o(t){var e=n[t];if(void 0!==e)return e.exports;var r=n[t]={exports:{}};return i[t](r,r.exports,o),r.exports}o.m=i,o.d=(t,e)=>{for(var i in e)o.o(e,i)&&!o.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},o.f={},o.e=t=>Promise.all(Object.keys(o.f).reduce(((e,i)=>(o.f[i](t,e),e)),[])),o.u=t=>"vexflow-font-"+{81:"leland",289:"custom",347:"bravura",571:"gonville",623:"petaluma"}[t]+"-min.js",o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),t={},e="Vex:",o.l=(i,n,r,a)=>{if(t[i])t[i].push(n);else{var s,h;if(void 0!==r)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var l=c[d];if(l.getAttribute("src")==i||l.getAttribute("data-webpack")==e+r){s=l;break}}s||(h=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,o.nc&&s.setAttribute("nonce",o.nc),s.setAttribute("data-webpack",e+r),s.src=i),t[i]=[n];var p=(e,n)=>{s.onerror=s.onload=null,clearTimeout(u);var o=t[i];if(delete t[i],s.parentNode&&s.parentNode.removeChild(s),o&&o.forEach((t=>t(n))),e)return e(n)},u=setTimeout(p.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=p.bind(null,s.onerror),s.onload=p.bind(null,s.onload),h&&document.head.appendChild(s)}},o.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t;o.g.importScripts&&(t=o.g.location+"");var e=o.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var i=e.getElementsByTagName("script");i.length&&(t=i[i.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),o.p=t})(),(()=>{var t={179:0};o.f.j=(e,i)=>{var n=o.o(t,e)?t[e]:void 0;if(0!==n)if(n)i.push(n[2]);else{var r=new Promise(((i,o)=>n=t[e]=[i,o]));i.push(n[2]=r);var a=o.p+o.u(e),s=new Error;o.l(a,(i=>{if(o.o(t,e)&&(0!==(n=t[e])&&(t[e]=void 0),n)){var r=i&&("load"===i.type?"missing":i.type),a=i&&i.target&&i.target.src;s.message="Loading chunk "+e+" failed.\n("+r+": "+a+")",s.name="ChunkLoadError",s.type=r,s.request=a,n[1](s)}}),"chunk-"+e,e)}};var e=(e,i)=>{var n,r,[a,s,h]=i,c=0;for(n in s)o.o(s,n)&&(o.m[n]=s[n]);if(h)h(o);for(e&&e(i);c<a.length;c++)r=a[c],o.o(t,r)&&t[r]&&t[r][0](),t[a[c]]=0},i=this.webpackChunkVex=this.webpackChunkVex||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))})();var r,a={};return(r=o(763)).s.Flow.VERSION="3.0.9",r.s.Flow.BUILD="6c373fc6e0e699bb6ac90e05e11c9dce6364c1b7",(()=>{o.d(a,{default:()=>t});const t=o(763).s})(),a=a.default})()}));
//# sourceMappingURL=vexflow-core-min.js.map